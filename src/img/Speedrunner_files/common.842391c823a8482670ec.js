(window.webpackJsonp=window.webpackJsonp||[]).push([["common"],{"+YbT":function(e,t){var n={obj:null,highlight:!1,start:function(e){e.touches&&1==e.touches.length&&(n.clear(),n.end(e),n.obj=this||null,n.obj&&(n.highlight=!0,addClass("hover",n.obj),addClass("_thover",n.obj)))},cancel:function(e){n.obj&&(n.highlight=!1,n.end(e))},end:function(){n.obj&&(removeClass("hover",n.obj),n.highlight&&(n.clear(),addClass("active",n.obj)),n.obj=null,n.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=n},"+cqQ":function(e,t,n){"use strict";function i(){var e=[],t=a.bind(e);return t.off=r.bind(e),t._fns=e,t}function a(){var e=this,t=arguments,n=t[0];if("function"!=typeof n){for(var i=e.length,a=!1,r=0;r<i;r++)!0===e[r].apply(null,t)&&(a=!0);return a}Array.prototype.slice.call(t).forEach((function(t){return e.push(t)}))}function r(e){e?function(e,t){for(;;){var n=e.indexOf(t);if(!(n>=0))break;e.splice(n,1)}}(this,e):this.length=0}function o(e,t){e((function n(){t(),setTimeout((function(){e.off(n)}))}))}n.r(t),n.d(t,"onEmitOnce",(function(){return o})),t.default=Object.assign(i,{kind:function(){var e={};return function(t){return e[t]||(e[t]=i())}}}),window.befall=i},"/8IX":function(e,t){function n(e,t){if(!e)throw new Error(t||"AssertionError")}n.notEqual=function(e,t,i){n(e!=t,i)},n.notOk=function(e,t){n(!e,t)},n.equal=function(e,t,i){n(e==t,i)},n.ok=n,e.exports=n},"/Id8":function(e,t,n){"use strict";n.r(t),n.d(t,"Msg__restoreInner",(function(){return F})),n.d(t,"Msg__reply",(function(){return $})),n.d(t,"Msg__authorName",(function(){return K})),n.d(t,"Msg__replyAttach",(function(){return Y})),n.d(t,"Msg__replyLink",(function(){return Q})),n.d(t,"Msg__textPreview",(function(){return W})),n.d(t,"Msg__attachPreview",(function(){return q})),n.d(t,"Msg_makeReplyLink",(function(){return U})),n.d(t,"Msg_makePinnedReplyLink",(function(){return H})),n.d(t,"Msg_detailed",(function(){return R}));var i=n("MUpH"),a=n("bZ/P"),r=n("TYsd"),o=n("9y81"),s=n("KMpi"),l=n("u33z"),c=n("B+U2"),u=n("BoyB"),d=n("A6le"),_=n("SNk7"),f=n("Y6JH"),p=n("fdw3"),h=n("TjCR");function m(){var e=Object(i.default)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n      <div class="','"\n        ',"\n        ",'\n        style="width: ',"px; height: ",'px;"\n      >\n        <img class="msg__stickerImg sticker_img" height="','" src="','">\n      </div>\n    ']);return g=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return A=function(){return e},e}function b(){var e=Object(i.default)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return w=function(){return e},e}function O(){var e=Object(i.default)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return O=function(){return e},e}function S(){var e=Object(i.default)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return S=function(){return e},e}function k(){var e=Object(i.default)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return k=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return C=function(){return e},e}function E(){var e=Object(i.default)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return E=function(){return e},e}function j(){var e=Object(i.default)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return j=function(){return e},e}function T(){var e=Object(i.default)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n    </div>\n  "]);return T=function(){return e},e}function I(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return I=function(){return e},e}function M(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return M=function(){return e},e}function D(){var e=Object(i.default)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return D=function(){return e},e}function P(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n    </div>\n  "]);return P=function(){return e},e}function x(){var e=Object(i.default)(['\n      <div class="','" ',">\n        ","\n      </div>\n    "]);return x=function(){return e},e}var L=function(e){var t=e.id,n=e.removed,i=e.isExpired,c=i||e.service,u=function(e){var t=window.lang,n=e.isDefaultCasperTimerShown;if(e.service)return e.text;var i,c=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),u=Object(o.default)({mix:"msg__check",icon:"check"}),_=r.default.html({class:"msg__star"}),m=!!e.attaches.gift,v=store.mail.msgs[e.id];v&&v.authorId===v.peerId&&(i=store.mail.peers[v.peerId]);var g=e.admin?(M=e.admin,a.default.html(C(),M.url,M.name)):"",A=e.removed?F(e.id):"",b=e.edited?N():"",y=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",w=e.pending?r.default.html({inner:[Object(f.default)({icon:Object(h.getRecent16Icon)()})],class:"msg__pending",tag:"div"}):"",O=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",S=e.channel?function(e){var t=Object(l.default)({class:"msg__actionForward",onClick:a.default.onClick("Msg._onActionClick","event","forward",e)});return a.default.html(E(),t)}(e.id):"",k=m&&i?'<div class="msg__giftHead">'+langSex(i.sex,t.mobile_mail_sent_gift)+"</div>":"",j=Object(p.timestamp)(),T=null;var M;e.ttl&&(T=Math.round(e.ts+e.ttl-j));var P,x=T?r.default.render(Object(d.default)({durationInSeconds:T,isDefaultCasperTimerShown:n})):"";P=m?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return a.default.html(I(),n,t)}(e):B(e);var L=e.keyboard?G(e):"";return a.default.html(D(),c,e.authorUrl,e.authorName,k,y,w,O,b,g,x,u,_,S,P,L,A)}(e),m=!c&&!(!e.attaches||!e.attaches.gift),v=a.default.class("msg",{id:t,service:c,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:m}),g="";c||(g=e.pending||e.failed?a.default.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):a.default.onClick("Msg._onClick","event","this",t));if(i){var A=r.default.render(Object(_.default)());return a.default.html(x(),v,g,A)}return a.default.html(P(),v,g,u)};function B(e){var t,n,i=window.lang,r=e.text,o=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,r,o,s){void 0===i&&(i=""),void 0===r&&(r=!0),void 0===o&&(o=""),void 0===s&&(s="");var l=Date.now(),c=Math.random(),u=""+l+c,d="msg__sticker",_="";s&&(d+=" sticker_animation",_='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var f=a.default.onClick("Msg._onStickerClick","event","this",r,i);return Object(p.isSAKIntegration)()?a.default.html(g(),d,_,f,t,t,t,n):a.default.html(v(),d,o,f,_,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=a.default.html(A(),n)):J(e)&&Object.keys(e.attaches).length&&(o+=1,t=z(q(e),!e.failed&&1===o));var l,c=e.forwards;c.length&&(J(e)&&X(c)?(o+=1,l=z(langNumeric(c.length,i.mobile_mail_N_forwards),!e.failed&&1===o)):l=(l=c.map((function(t){return function e(t,n,i){var r=window.lang,o=store.mail,l=o.forwards[t]||o.msgs[t];if(!l)return"";var c,u=o.members[l.authorId],d=l.peerId,_=(o.peers[d],K(u,d,o.cur.userId)),f=l.edited,p=u.avatar,h=u.url,m=_,v=l.date,g=l.text,A=l.attachesHTML,b=l.forwards,y=l.reply,w=Object(s.default)({mix:"mi_author_photo",photos:[p],size:36}),O=f?N():"";if(i>0){for(var S=[],k=b.length,C=0;C<k;C++){var E=e(b[C],n,i-1);S.push(E)}c=S.join("")}else if(b.length){var T=langNumeric(b.length,r.mobile_mail_N_forwards);c='<a href="/mail?act=msg&id='+n+'" class="msg__fwdsLink">'+T+"</a>"}A&&(A='<div class="mi_medias">'+(A=A.replace(/%top_msg_id%/g,n))+"</div>");c&&(c='<div class="mi_forwarded">'+c+"</div>");g&&(g='<div class="mi_text">'+g+"</div>");var I=y?V(y,n,{}):"",M=l.attaches.gift?" msg__forwardGift":"";return a.default.html(j(),M,w,h,m,v,O,I,g,A,c)}(t,e.id,e.maxDepth-1)}))).join(""));var u,d=e.reply;d&&(J(e)&&(X([d])||!function(e){var t=store.mail;return Object(p.isForwardedMessageId)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(d))?(o+=1,u=z(i.mobile_mail_in_reply_to,!e.failed&&1===o)):u=V(d,e.id,{isPinned:e.isPinned,chatId:e.chatId}));return t&&(t='<div class="mi_medias">'+t+"</div>"),l&&(l='<div class="mi_forwarded">'+l+"</div>"),r&&(r='<div class="mi_text">'+r+"</div>"),a.default.html(M(),u,r,t,l)}function R(e){var t=B(e),n=e.keyboard?G(e):"",i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),r=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],a=n.peers[i.peerId],r="";if(Object(p.isChatPeer)(i.peerId)){var o='<a href="'+Object(p.wrapCommunityMailUrl)("/mail?act=show&peer="+i.peerId)+'">'+a.title+"</a>";r=t.mobile_mail_message_to_chat.replace("{chat}",o)}return r}(e);return a.default.html(T(),i,e.authorUrl,e.authorName,r,e.date,t,n)}function N(){var e=window.lang;return a.default.html(k(),e.mobile_mail_edited_short)}function F(e){var t=window.lang,n=a.default.onClick("Msg._onRestoreClick","event",e);return a.default.html(S(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function H(e,t){var n="/mail?act=msg";return n=Object(p.concatValues)(n,"&id=pinned&chat="+e),t&&(n=Object(p.concatValues)(n,"&replyId="+t+"&reply=true")),Object(p.wrapCommunityMailUrl)(n)}function U(e,t,n){var i="/mail?act=msg";return t?(i=Object(p.concatValues)(i,"&id="+t+"&reply=true"),n&&(i=Object(p.concatValues)(i,"&reply_id="+n))):i=Object(p.concatValues)(i,"&id="+e),Object(p.wrapCommunityMailUrl)(i)}function V(e,t,n){var i=store.mail.forwards[e]||store.mail.msgs[e],a=store.mail.replies[e]||store.mail.pendingReplies[e];return Q($(i,K(store.mail.members[i.authorId],i.peerId,store.mail.cur.userId),a.preview_url),a.msg_id,t,e,n)}function $(e,t,n){var i="";i=e.isExpired?'<span class="msg__replyDisappeared">'+Object(p.getLang)("mobile_casper_chat_message_disappeared")+"</span>":e.body?W(e.body):Y(e);var r="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(r=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),a.default.html(O(),r,t,e.date,i)}function W(e){return e=e.replace(/<br>/g,"\n"),e=Object(p.mailReplaceDomainMentions)(e,"@$3"),e=Object(p.mailReplaceMentions)(e,"$3"),e=Object(p.emojiToHTML)(e)}function q(e){var t,n=window.lang,i=Object.keys(e.attaches),a=i.length;if(a>1){for(var r=0,o=i.length,s=0;s<o;s++)r+=0|e.attaches[i[s]];t=langNumeric(r,n.mobile_mail_attachments)}else if(1===a){var l=i[0],c=e.attaches[l];if(1===c)switch(l){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"artist":t=n.mobile_mail_added_artist;break;case"curator":t=n.mobile_mail_added_curator;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":case"group_call_in_progress":t=n.mobile_mail_added_call}else if(c>1)switch(l){case"photo":t=langNumeric(c,n.mobile_mail_added_photos);break;case"video":t=langNumeric(c,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(c,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(c,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function z(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=Object(u.default)({large:!0}))+"</div>"),a.default.html(w(),e,n)}function Y(e){var t=q(e);return a.default.html(y(),t)}function Q(e,t,n,i,r){var o="";o=r.isPinned&&r.chatId?H(r.chatId,i):U(t,n,i);var s=a.default.onClick("Msg._onReplyClick","event",t,n,i);return a.default.html(b(),o,s,e)}function G(e){var t=function(e){var t=window.store;if(!t.mail||!t.mail.cur||!t.mail.cur.pressedButtons)return{};return t.mail.cur.pressedButtons.msgs[e]}(e.id),n=r.default.render(Object(c.default)({msgId:e.id,pressed:t,keyboard:e.keyboard}));return a.default.html(m(),n)}function K(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function X(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,a=e.length,r=0;r<a;r++){var o=e[r];if(Object(p.isForwardedMessageId)(o)){var s=i[o];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var l=t[o];if(!l)return!0;if(!l.authorId||!n[l.authorId])return!0}}return!1}function J(e){return e.pending||e.failed||e.waiting}var Z=n("UxAg"),ee=n("+cqQ"),te=n("Gzds"),ne=n("OcsD"),ie=need("Voting");Object.assign(L,{class:"msg",onClick:Object(ee.default)(),onPendingClick:Object(ee.default)(),onRestoreClick:Object(ee.default)(),onReplyClick:Object(ee.default)(),onForward:Object(ee.default)(),onLoadAgain:Object(ee.default)(),getElem:function(e){return Object(Z.$)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?Object(Z.$$)(".msg_id_"+e).forEach((function(e){return e.remove()})):ce(e,!1)},spam:function(e){ce(e,!0)},restore:function(e){Object(Z.$$)(".msg_id_"+e).forEach((function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")}))},unselectAll:function(){Object(Z.$$)(".msg_selected").forEach((function(e){return e.classList.remove("msg_selected")}))},getReplyDataFromHTML:function(e){var t=e&&L.getElem(e),n="";if(t){var i=Object(Z.$)(".thumbs_map .thumb_map_img_as_div",t);return(n=i&&i.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach((function(e){var n=Object(Z.$)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)}))},markAsRead:function(e){Object(Z.$$)(".msg_id_"+e).forEach((function(e){return e.classList.remove("msg_unread")}))},getId:function(e){var t=a.default.parseClass(re,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(oe).innerHTML}}),L._onClick=ue,L._onPendingClick=de,L._onTouchStart=fe,L._onRestoreClick=le,L._onActionClick=pe,L._onReplyClick=me,L._onStickerClick=ve,L.onStickerTouchStart=ge;var ae,re="msg",oe=".msg__text",se=!1;function le(e,t){e.stopPropagation(),t=parseInt(t,10),L.onRestoreClick(t)}function ce(e,t){void 0===t&&(t=!1);var n=F(e);Object(Z.$$)(".msg_id_"+e).forEach((function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)}))}function ue(e,t,n){_e(e.target,t,(function(){t.classList.toggle("msg_selected"),L.onClick(n)}))}function de(e,t,n,i,a){_e(e.target,t,(function(){L.onPendingClick(n,i,a)}))}function _e(e,t,n){for(var i=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(i&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+ie.cls))return;e=e.parentElement}se?se=!1:he()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||n()}function fe(){he()&&(se=!0)}function pe(e,t,n){switch(t){case"forward":L.onForward(n)}}function he(){return window.getSelection().toString().length>0}function me(e,t,n,i){e.preventDefault(),L.onReplyClick(t,n,i)}function ve(e,t,n,i){n&&(e.preventDefault(),i&&te.default.stickersClick(t,i))}function ge(e,t){if(clearTimeout(ae),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;Object(ne.addEvent)(t,"contextmenu",Ae),Object(ne.addEvent)(t,"touchmove",a,{passive:!0}),Object(ne.addEvent)(t,"touchend",r,{passive:!0}),Object(ne.addEvent)(t,"touchcancel",r,{passive:!0}),ae=setTimeout((function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),r()}),500)}function a(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&r()}function r(){clearTimeout(ae),Object(ne.removeEvent)(t,"contextmenu",Ae),Object(ne.removeEvent)(t,"touchmove",a,{passive:!0}),Object(ne.removeEvent)(t,"touchend",r,{passive:!0}),Object(ne.removeEvent)(t,"touchcancel",r,{passive:!0})}}function Ae(e){event.preventDefault(),event.stopPropagation()}t.default=L;window.Msg=L},"03kU":function(e,t,n){"use strict";n.r(t);var i=n("OmnB"),a=n.n(i),r=n("jE6c"),o=100,s=101,l=102,c=103,u=105,d=106,_=107,f=108,p=109,h=110,m=112,v=113,g=[s,c,l,d,_,f,p,h],A="click_on_video",b="click_on_audio",y="click_on_photo",w="external_link_click",O="click_on_carousel_next",S="click_on_carousel_prev",k="click_on_mentions",C="night_mod_on",E="night_mod_off",j="close";function T(e,t,n){var i=[];if(Object(r.each)(e,(function(e,t){n&&!["w","z","y","x","m","s"].includes(e)||i.push(t)})),!i.length)return[!1];i.sort((function(e,t){return e[1]-t[1]})),t*=window.devicePixelRatio>=2?2:1;var a=i[i.length-1];return Object(r.each)(i,(function(e,n){if(n[1]>=t)return a=n,!1})),a}var I={};function M(e,t){if(Object(r.isObject)(t)&&!Object(r.isEmpty)(t)){var n="https://vk-callback.go.mail.ru/longread_pxl?action="+e;Object(r.each)(t,(function(e,t){n+="&"+e+"="+t})),(new Image).src=n}}function D(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function P(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,n=document.getElementsByTagName("iframe"),i=n.length-1;i>=0;i--){var a=n[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout((function(){if("MEASURE"===e.type){var n=e.details.height;t.setAttribute("height",n)}}),100)}}}function x(e,t){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes"));(domData(n,"media-links")||"").split(",");if(!(i.length<=1||domData(e,"carousel-inited"))){if(domData(e,"carousel-inited",1),t.mobile)return function(e,t,n){void 0===n&&(n={});var i,a,o,s=geByClass1("article_photo_carousel__controls",t),l=geByClass1("article_photo_carousel__counter",t),c=domData(l,"counter-lang")||getLang("global_article_carousel_counter"),u=getSize(geByClass1("article_figure_content",t)),d=geByClass1("article_photo_carousel_inner",t),_=n.onClick,f=0,p=0,h=!1,m=0,v=0,g=!1,A=!1;s.addEventListener("touchstart",(function(e){a=e.touches[0].pageX,i=e.touches[0].pageY,addClass(d,"--no_trans"),h=!0,clearTimeout(o)}));var b,y=!1;function w(n,i,a,s,p){if(void 0===s&&(s=!1),void 0===p&&(p=!0),!i||!h){if(h=!0,i)return d.style.transform="translateX(-50px)",void(o=setTimeout((function(){d.style.transform="translateX(0px)"}),700));clearTimeout(o),f=void 0===f?Math.min(e.length-1,Math.max(0,f+n)):a,s&&Object(r.isFunction)(_)&&v!==f&&_(v<f?O:S),domData(t,"photo-carousel-index",f),L(f,t),l.innerHTML=c.replace("{counter}",f+1).replace("{total}",e.length),p||addClass(d,"--no_trans"),d.style.transform="translateX(-"+f*u[0]+"px)",p||(d.offsetWidth,removeClass(d,"--no_trans"))}}return s.addEventListener("touchmove",(function(t){if(A||!(Math.abs(t.touches[0].pageY-i)>5||g)){if(p=t.touches[0].pageX-a,!(Math.abs(p)<10)||y){A||window.addEventListener("touchmove",b=function(e){return cancelEvent(e)},{passive:!1}),A=!0,y=!0;var n=Math.min(e.length-1,Math.max(0,f+(p<0?1:-1))),r=0===n&&0===f,o=n===e.length-1&&f===e.length-1;m=n;var s=-f*u[0];s+=r||o?.2*p:p,d.style.transform="translateX("+s+"px)"}}else g=!0})),s.addEventListener("touchend",(function(){y=!1,g=!1,A=!1,v=f,removeClass(d,"--no_trans"),b&&window.removeEventListener("touchmove",b),Math.abs(p)<50||(f=m),w(0,!1,m,!0)})),function(e,t,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0),t||(m=n),v=f,w(e,t,n,i,a)}}(i,e,t);var a=function(e,t,n,i){var a,r=0,o=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=geByClass1("article_photo_carousel__left",t),_=geByClass1("article_photo_carousel__right",t),f=n.onClick,p=!1;function h(n,i){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(a=setTimeout((function(){u.style.transform="translateX(0px)"}),700));clearTimeout(a),r=Math.min(e.length-1,Math.max(0,r+n)),u.style.transform="translateX(-"+r*c[0]+"px)",s.innerHTML=l.replace("{counter}",r+1).replace("{total}",e.length),toggle(d,r>0),toggle(_,r<e.length-1),domData(t,"photo-carousel-index",r),L(r,t)}}return _.addEventListener("click",(function(e){return h(1),f&&f(O),cancelEvent(e)})),d.addEventListener("click",(function(e){return h(-1),f&&f(S),cancelEvent(e)})),t.addEventListener("mousemove",(function(){o.style.opacity=1})),t.addEventListener("mouseleave",(function(){o.style.opacity=0})),h}(i,e,t);return window.data(e,"changePhotoFunction",a),a}}function L(e,t){var n=geByTag1("figcaption",t),i=[];n&&((i=domData(n,"captions"))&&(i=JSON.parse(i)),n.innerHTML=i[e]||"")}var B,R,N=n("lkNA"),F={};window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;var H,U=function(){function e(e,t,n){var i=this;this._handleClick=function(e){if(e.target.href)try{var t=new URL(e.target.href);window.location.pathname===t.pathname&&t.search.match(/\?|&anchor=/)&&(e.preventDefault(),i.scrollToAnchor(null,t.search),window.history.replaceState({},document.title,""+t.pathname+t.search))}catch(e){console.error(e)}},this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._els={view:ge("article_view_"+e.raw_id)},window.cur&&cur.destroy&&cur.destroy.push((function(){i.deinit()})),n&&this.ready()}var t=e.prototype;return t.getEl=function(){return this._els.view},t.getArticle=function(){return this._article},t.getScrollNode=function(){return this._options.getScrollNode?this._options.getScrollNode():document},t._getScrollTop=function(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop},t.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.changeCarouselPosition=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var a=F[e];Object(r.isFunction)(a)&&a(0,!1,t,n,i)},t.deinit=function(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),document.removeEventListener("click",this._handleClick),clearTimeout(this._readTO)},t._onViewScroll=function(){var e=this,t=scrollGetY(),n=window.innerHeight;Object(r.each)(geByTag("figure",this._els.view),(function(i,a){var o=Object(r.intval)(domData(a,"done"));if(!o){var s=getH(a),l=getXY(a)[1],c=Object(r.intval)(domData(a,"type")),u=101==c?-200:100,d=l<=t+n-u&&t+u<=l+s;(o=e._onObjectView(d,c,a))&&domData(a,"done",1)}})),Object(r.each)(geByTag("figure",this._els.view),(function(i,a){var o,s=getH(a),l=getXY(a)[1],c=Object(r.intval)(domData(a,"type")),u=l,d=l+s,_=t,f=t+n;if(u>f||_>d)o=!1;else{var p=Math.max(u,_);o=(Math.min(d,f)-p)/s>.7}e._onObjectPartialView(o,c,a)}))},t._initObjects=function(){var e=this;this._initedObjects=this._initedObjects||{},Object(r.each)(geByClass("_article_unmute_button",this._els.view),(function(t,n){e._initedObjects[t]||(e._initedObjects[t]=!0,n.addEventListener("click",(function(){var e=n.parentNode,t=geByTag1("video",e);t.muted=!t.muted,toggleClass(e,"article_object_unmuted",!t.muted)})))})),Object(r.each)(geByTag("figure",this._els.view),(function(t,n){if(!e._initedObjects[t])switch(e._initedObjects[t]=!0,parseInt(domData(n,"type"))){case s:var i=x(n,{mobile:e._options.mobile,moderDeletePhoto:e._options.moderDeletePhoto,onClick:function(t){e.sendStats({type:t})}});if(e._initPhoto(n),i){var a=window._articleCarouselGlobalId++;n.setAttribute("data-carousel-id",a),F[a]=i}break;case u:case o:geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:b})}),!0);break;case m:case v:break;case c:case l:if(e._options.mobile){var r=geByTag1("video",n);r&&(r.addEventListener("play",(function(){e.sendStats({type:A})})),r.addEventListener("pause",(function(){e.sendStats({type:A})})))}else{geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:A})}),!0)}}})),this._els.view&&this._els.view.addEventListener("click",(function(t){var n=t.target;if(matchesSelector(n,'a[href^="/away"]')){var i=decodeURIComponent(unescape(n.href)).split("vk.com/away.php?to=")[1];i&&e.sendStats({type:w,domain:encodeURIComponent(e._getUrlDomain(i))})}}))},t._initPhoto=function(e){var t=this;geByClass1("article_figure_content",e).addEventListener("click",(function(){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes")),a=Object(r.intval)(domData(e,"photo-carousel-index"));t._options.onImageOpen&&t._options.onImageOpen.call(t,i,e,a),t.sendStats({type:y})}))},t._initStats=function(){if(this._statsInited)this._scrollStatEvent&&this._scrollStatEvent();else{this._statsInited=!0,this._openTime=Date.now();var e,t=-1,n=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);var i=this;this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){var r=i.getCurrentScrollRatio();if(!(r<0)){var o=1;r>=.95?o=4:r>.66?o=3:r>.33&&(o=2),function(r){if(i._isReady&&(i._article.has_more&&(r=Math.min(r,1)),!(t>=r))){for(var o=t+1;o<=r;o++)n.push(o);if(t=r,clearTimeout(e),e=setTimeout(a,300),3==r&&i._article.ttr){var s=i._article.ttr-i.getTimeSpent();s>0&&(i._readTO=setTimeout((function(){if(!document.hidden){var e=i.getCurrentScrollRatio();if(!(e<0||e>1.3)){var r=4==t;n=[t=4],a(r)}}}),1e3*s))}}}(o),4!=o||i._article.has_more||(i.getScrollNode().removeEventListener("scroll",i._scrollStatEvent),i._scrollStatEvent=!1)}},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}function a(e){if(n.length){var t=i._article,a=i._options,o="";if(t.ref)o=t.ref;else if(window.cur){if("feed"===(o=window.cur.module)&&cur.articlePrevLoc&&!a.mobile)"search"===nav.fromStr(cur.articlePrevLoc).section&&(o="feed_search")}var s={act:"stats",scroll:n.join(","),spent:i.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:a.isWebView?1:0,post_id:a.sourcePostId,is_widget:a.isWidget,is_delayed_scroll_4:Object(r.intval)(e),track_code:a.trackCode,ref:o};ajax.post(a.mobile?"article.php":"al_articles.php",s),t.mailru_stats_data&&n.forEach((function(e){M("scroll_"+e,t.mailru_stats_data)})),n=[]}}},t._initGoogleAnalytics=function(){var e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{var t=document.createElement("script");t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+e),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}},t._onObjectPartialView=function(e,t,n){var i=domQuery1("[data-sizes]",n),a=Boolean(Number(domData(i,"should-disable-carousel-animation")));if(t==s&&!a&&JSON.parse(domData(i,"sizes")).length>1){var r=n.getAttribute("data-carousel-id");e?R!=r&&(clearTimeout(B),B=setTimeout((function(){var e=F[r];e&&e(1,!0)}),400),R=r):r==R&&(R=-1,clearTimeout(B))}},t._onObjectView=function(e,t,n){var i=!1;switch(t){case s:if(e){var a=geByTag1("img",n),o=getW(a)||this._options.width,l=domQuery1("[data-sizes]",n),u=JSON.parse(domData(l,"sizes")),m=geByTag("img",n);u.forEach((function(e,t){var n=T(u[t],o,!0)[0];!function(e,t){if(!0===I[e])return t&&t(),!0;if(Array.isArray(I[e]))return I[e].push(t),!1;I[e]=[t];var n=new Image;n.onload=function(){var t=I[e];I[e]=!0,Object(r.each)(t,(function(e,t){t&&t()}))},n.src=e}(n,(function(){var e=m[t];removeClass(e,"article_object_photo__image_blur"),e.src=n}))})),i=!0}break;case c:if(!this._options.mobile){var v=geByTag1("video",n);if(v)if(e){if(v.hasAttribute("autoplay")){var g=v.play();g&&g.catch((function(){}))}}else v.pause();else i=!0}break;case d:case _:case f:case p:case h:this.initEmbed(t,n),i=!0}return i},t.initEmbed=function(e,t){var n=this;switch(e){case d:var i=domQuery1("[data-tweet-id]",t),a=domData(i,"tweet-id");Object(N.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){window.twttr.widgets.createTweet(a,i,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case _:var r=window.vk&&0==window.vk.lang?"ru_RU":"en_US";Object(N.loadScript)("https://connect.facebook.net/"+r+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){window.FB.XFBML.parse()}});break;case f:Object(N.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){window.instgrm.Embeds.process(),addEvent(window,"message",P)}});break;case p:var o=domQuery1("[data-raw-id]",t),s=domData(o,"raw-id"),l=domData(o,"index"),c=s.split(";"),u=c[0],m=c[1];Object(N.loadScript)("/js/api/openapi.js",{onLoad:function(){ajax.post("dev.php",{act:"a_get_post_hash",post:u+"_"+m},{onDone:function(e){e&&window.VK&&window.VK.Widgets&&window.VK.Widgets.Post("vk_post_"+s+"_"+l,u,m,e,{from:n._options.isWebView?"article_webview":""})}})}});break;case h:Object(N.loadScript)("https://telegram.org/js/telegram-widget.js?5",{})}},t.getCurrentScrollRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e},t.getScreenVisibilityRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1],n=this._getScrollTop(),i=window.innerHeight,a=t,r=t+e,o=n,s=n+i;if(o>r||a>s)return 0;var l=Math.max(a,o);return(Math.min(r,s)-l)/i},t.update=function(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())},t.ready=function(){var e=this;(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),setTimeout((function(){var t=D("anchor");if(t){e._options.isWebView||e.scrollToAnchor(t);var n=e.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body),n.click&&n.click(),n.focus()}}),0),!this._options.mobile&&window.AudioPlaylist)&&(this._article.audios_list&&this._article.audios_list.length>0&&new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list}));this.getScrollNode().addEventListener("scroll",this._scrollEvent=function(){e._onViewScroll(),e._options.onScroll&&e._options.onScroll.call(e,e.getCurrentScrollRatio())}),document.addEventListener("click",this._handleClick),setTimeout((function(){e._scrollEvent()}),this._options.objectsInitDelay||0)},t.scrollToAnchor=function(e,t){e=e||D("anchor",t);var n=this._options,i=this.getScrollNode();i===document&&(i=document.scrollingElement||window.scrollNode||document.body);e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var a=n.isWebView?0:25,r=t.parentNode.offsetTop-a;window.setTimeout((function(){i.scrollTo?i.scrollTo(0,r):i.scrollTop=r}),10)}}()},t.sendStats=function(e){var t=this._article,n=this._options,i={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:n.isWebView?1:0};Object.assign(i,e),ajax.post(n.mobile?"article.php":"al_articles.php",i)},t._getUrlDomain=function(e){var t=document.createElement("a");return t.href=e,t.hostname},e}(),V=[],$=!1,W=function(){function e(){}return e.init=function(e,t,n){if(void 0===n&&(n={}),$=n.mobile||n.isWebView,t&&e.ads&&!isEmpty(e.ads)&&!(e.has_more||isArray(e.ads)&&0==e.ads.length)){var i=ce("ins");addClass(i,"mrg-tag"),addClass(i,"article_adsblock"),n.mobile&&addClass(i,"article_adsblock_mobile"),setStyle(i,{display:"block","text-decoration":"none"});var a="";for(var r in n.deviceInfo)n.deviceInfo.hasOwnProperty(r)&&(a+="&"+r+"="+n.deviceInfo[r]);for(var o in e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",a),e.ads.data)e.ads.data.hasOwnProperty(o)&&domData(i,o,""+e.ads.data[o]);t.appendChild(i),window.MRGtag||(window.MRGtag=[]);var s=n.isWebView?{iframeMode:!0}:{},l=e.ads.eventsHash;if(q(e,n,"requested",l),s.onNoAds=function(){q(e,n,"no_ads",l)},s.onAdsLoaded=function(){q(e,n,"ads_loaded",l)},s.onAdsClosed=function(){q(e,n,"ads_closed",l)},s.onAdsSuccess=function(){q(e,n,"ads_success",l)},s.onAdsClicked=function(){q(e,n,"ads_clicked",l)},s.onScriptError=function(){q(e,n,"script_error",l)},window.MRGtagOnAdsImpression=function(){q(e,n,"ads_impression",l)},window.MRGtag.push(s),!window.mailRuSdsScriptLoaded){var c=document.createElement("script");c.setAttribute("src",e.ads.script),c.setAttribute("async","true"),document.head.appendChild(c),window.mailRuSdsScriptLoaded=!0}}},e.wasShown=function(){return!1},e}();function q(e,t,n,i){V.push(n+"/"+e.owner_id+"_"+e.id+"/"+i),clearTimeout(H),H=setTimeout((function(){var e=$?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:V.join(","),is_web_view:intval(t.isWebView)}),V=[]}),200)}var z,Y,Q,G,K,X,J=n("aJgW");window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var Z,ee,te,ne=!1,ie=[],ae=[],re=1,oe=2,se={},le={};function ue(e,t){e=e.split("_");for(var n=0;n<t.length;n++){var i=t[n].split("_");if(i[0]==e[0]&&i[1]==e[1])return n}return-1}function de(){return document}function _e(){return(document.scrollingElement||window.scrollNode||document.body).scrollTop}function fe(e){return domQuery('.articleView__social_buttons[data-article-id="'+e+'"] .articleView__footer_btn_bookmark')}function pe(e){if(X!=e.raw_id)if(X=e.raw_id,Y.isWebView)!function(e){a.a.send("articleUpdate",{article:Oe(e),isSubscribedToOwner:e.is_subscribed_to_owner})}(e);else{var t=geByClass1("articleView__owner"),n=geByTag1("img",t);t&&n&&(n.src=e.owner_photo);var i=geByTag1("a",t);t&&i&&(i.href=e.owner_href);var o=geByClass1("articleView__ownerName"),s=geByTag1("a",o);o&&s&&(s.href=e.owner_href,s.innerHTML=e.owner_name);var l=geByClass1("articleView__footer"),c=geByClass1("articleView__footer_views");c&&(c.innerHTML=e.views_formatted);var u=geByClass1("articleView__social_buttons",l);l&&u&&!e.is_blog&&u.setAttribute("data-article-id",e.raw_id);var d=[domQuery1('.articleView__content_misc_block[data-article-id="'+e.raw_id+'"] .articleView__footer_btn_share'),l&&domQuery1(".articleView__footer_btn_share",l)];Object(r.each)(d,(function(t,n){n&&!e.is_blog&&(n.href="/like?act=publish&object=article"+e.raw_id+"&list="+e.access_hash)}));var _=fe(e.raw_id),f=JSON.stringify(e.mailru_stats_data);Object(r.each)(_,(function(t,n){n&&(n.setAttribute("onclick","Article.fave(this, '"+e.url+"', '"+e.fave_hash+"', "+f+", '"+e.raw_id+"')"),toggleClass(n,"_active",e.is_faved))}));var p=geByClass1("Unfold__item_name_noted");p&&(p.href="/feed?section=search&q=url:https://vk.com"+e.url);var h=geByClass1("Unfold__item_name_report");h&&(h.href="/reports?act=add&object=article"+e.raw_id+"_"+e.access_hash+"&refrom=feed")}}function he(e,t){void 0===t&&(t=!1),e.has_more||(ie=ie.concat(e.audios_list));var n=new U(e,{notFull:!!Y.preloadMoreHash,isWebView:Y.isWebView,mobile:!0,width:Y.width,getScrollTop:_e,getScrollNode:de,trackCode:Y.trackCode,onScroll:function(t){if(!e.has_more){var n=ae[ae.length-1],i=gpeByClass("articleView__content",n.getEl());t>.6&&e.next_article_url&&(ae.length<20&&(ve(e.next_article_url),addClass(i,"articleView_waitNextArticle")),function(){var e=ae[ae.length-1];if(e){var t=gpeByClass("articleView__content",e.getEl()),n=geByClass1("articleView__social_buttons",t);n&&show(n)}}()),t>.99&&e.next_article_url&&ae.length<20&&ve(e.next_article_url,(function(e,t){if(e){for(var n=0;n<ae.length;n++)if(ae[n].getArticle().raw_id==t.raw_id)return;te||(te=setTimeout((function(){var n=domCreate(e);K.appendChild(n),removeClass(i,"articleView_waitNextArticle"),addClass(n,"articleView_nextPrepared"),requestAnimationFrame((function(){removeClass(n,"articleView_nextPrepared")})),he(t),te=null}),400))}})),this.getScreenVisibilityRatio()>.5&&pe(e)}},onImageOpen:function(e,t,i){if(Y.isWebView){for(var r=[],o=0;o<e.length;o++){var s=e[o],l=[];for(var c in s)s.hasOwnProperty(c)&&l.push({type:c,src:s[c][0],width:s[c][1],height:s[c][2]});r.push(l)}Z=t,ee=n,a.a.send("articlePhotoView",{photos:r,index:i})}}});if(t||n.ready(),ae.push(n),me(e),Object(r.each)(geByTag("video"),(function(e,t){domData(t,"auto-pause-inited")||(domData(t,"auto-pause-inited",1),t.addEventListener("play",(function(){Object(r.each)(geByTag("video"),(function(e,n){n!=t&&n.pause()}))})))})),Y.isWebView){Object(r.each)(geByTag("figure",n._els.view),(function(e,t){var i=Object(r.intval)(domData(t,"type"));n._onObjectView(!1,i,t)&&domData(t,"done",1)}));var i=document.getElementsByClassName("articleView__educationCloseButton")[0];i&&i.addEventListener("click",(function(e){var t=e.target,n=Object(r.intval)(domData(t,"article-id")),i=Object(r.intval)(domData(t,"course-id")),o=Object(r.intval)(domData(t,"step-id")),s=t.href;a.a.send("articleClose",{fallback_url:s,payload:{status:"read",data:{author_id:n,course_id:i,step_id:o}}}),e.preventDefault()}))}}function me(e){var t=gpeByClass("articleView__content",ge("article_view_"+e.raw_id)),n=geByClass1("articleView__ads_block",t);W.init(e,n,Y)}function ve(e,t){var n=le[e];n!==oe?Object(r.isArray)(n)?t&&t(n[0],n[1]):(se[e]=se[e]||[],t&&se[e].push(t),n!=re&&(le[e]=re,ajax.post("article.php",{act:"view",url:e,scroll_load:1,wall_owner_id:Y.wallOwnerId,audio_bridge:Object(r.intval)(Y.audioBridge),can_infinite_scroll:Object(r.intval)(Y.canInfiniteScroll),web_view:Y.isWebView,context:Y.context,ref:"scroll",v:Y.clientVersion},{onDone:function(t,n){for(var i=se[e],a=0;a<i.length;a++)i[a](t,n);le[e]=[t,n]}}))):t&&t()}function Ae(e,t){var n=fe(e);Object(r.each)(n,(function(e,n){toggleClass(n,"_active",t)}))}function be(){var e=D("anchor");e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var n=Y.isWebView?0:25,i=t.parentNode.offsetTop-n;window.setTimeout((function(){var e;e=i,(document.scrollingElement||window.scrollNode||document.body).scrollTop=e}),0)}}()}function ye(e){if(void 0===e&&(e={}),ne)be();else{Y.deviceInfo=e.deviceInfo;var t=ae[0],n=t.getArticle();t.ready(),n.has_more?ajax.post("article.php",{act:"load_more",rev:n.rev,hash:n.has_more_hash,article_owner_id:n.owner_id,article_id:n.id,audio_bridge:Object(r.intval)(Y.audioBridge),no_lazy_images:Object(r.intval)(Y.noLazyImages),can_infinite_scroll:Object(r.intval)(Y.canInfiniteScroll),wall_owner_id:Y.wallOwnerId,context:Y.context,client_version:Y.clientVersion},{onFail:function(){Y.failTries>0&&(Y.failTries--,setTimeout((function(){ye(e)}),2e3))},onDone:function(e,i){ne=!0,n.audios_list=i.audios_list,n.next_article_url=i.next_article_url,n.has_more=!1,n.audios_list&&n.audios_list.length&&(ie=ie.concat(n.audios_list));var a=domCreate(e),r=geByClass1("article_view",a),o=geByClass1("article_view");"figure"!==o.lastElementChild.tagName.toLowerCase()&&o.lastChild.remove();for(var s=o.children.length,l=r.children;s<l.length;)o.appendChild(l[s]);var c=geByClass1("article_preload_spinner");c&&c.parentNode.removeChild(c);var u=geByClass1("articleView__content_misc_block",a);o.parentNode.appendChild(u),function(){for(var e=geByClass1("article").children,t=0;t<e.length;t++){var n=t>0&&e[t-1],i=e[t],a=t+1<e.length&&e[t+1],r=n?n.tagName+"_"+domData(n,"type"):"",o=i?i.tagName+"_"+domData(i,"type"):"",s=a?a.tagName+"_"+domData(a,"type"):"",l=!1,c=!1,u=!1;r&&o==r||(l=!0),s&&o==s||(c=!0),(g.includes(+s.type)||s.sep)&&(u=!0),toggleClass(i,"article_decoration_first",l),toggleClass(i,"article_decoration_last",c),toggleClass(i,"article_decoration_before",u)}}(),me(n),be(),t.update()}}):ajax.post("article.php",{act:"next_url",access_hash:n.access_hash,article_owner_id:n.owner_id,article_id:n.id,wall_owner_id:Y.wallOwnerId,context:Y.context},{onDone:function(e){e&&(n.next_article_url=e,t.update())}});var i=t.getEl();e.paddingTop&&setStyle(i,"marginTop",Object(r.intval)(e.paddingTop)),e.paddingBottom&&setStyle(i,"marginBottom",Object(r.intval)(e.paddingBottom)),e.noDarkModeTransition&&addClass(i,"article_dark_no_transition")}}function we(e){var t=null;return Object(r.each)(ae,(function(n,i){var a=i.getArticle();if(a.raw_id==e)return t=a,!1})),t}function Oe(e){var t="https://"+Y.devHost+"vk.com"+e.url,n={id:e.id,owner_id:e.owner_id,owner_name:e.owner_name,state:"available",can_report:e.can_report,title:e.title,subtitle:"",views:e.views,shares:e.shares,is_favorite:e.is_faved,url:t,view_url:t,access_key:e.access_hash,published_date:e.published_date,no_footer:e.no_footer};return e.owner_photo&&0!=e.owner_photo.indexOf("/images/")&&(n.owner_photo=e.owner_photo),n}function Se(e,t){void 0===t&&(t="");var n=ae[ae.length-1];if(t)for(var i=0;i<ae.length;i++)if(ae[i]._article.raw_id===t){n=ae[i];break}n.sendStats({type:e})}window.ArticleView=U,window.Article={init:function(e,t){if((Y=t).mobile=!0,Y.failTries=50,window.cur&&(window.cur.lang=window.cur.lang||{},extend(window.cur.lang,t.lang||{})),K=geByClass1("articleView__content_list"),!Y.isWebView){var n,i=_e(),o=geByClass1("articleView__header"),s=geByClass1("articleView__footer"),l=geByClass1("articleView__layout");de().addEventListener("scroll",n=function(){var e=l.clientHeight,t=Math.max(0,_e()),n=t-i>0,a=t+window.innerHeight+20>e;toggleClass(o,"articleView__header--narrow",n),s&&toggleClass(s,"articleView__footer--hidden",!a&&n),i=t},{passive:!0});var c=geByClass1("articleView__close"),u=geByClass1("articleView__close_mini");c.addEventListener("click",Se.bind(window,j)),u.addEventListener("click",Se.bind(window,j)),window.cur&&cur.destroy.push((function(){document.removeEventListener("scroll",n),removeClass(document.body,"article_body_with_transition")})),Y.isStandalone&&(window.al=!1);var d=Object(r.intval)(l.classList.contains("article_dark")),_=document.querySelector(".basis");_&&J.colorScheme.applyScheme(_,d?J.ColorSchemeName.Dark:J.ColorSchemeName.Light)}if(Y.preloadMoreHash||show(geByClass1("article_layer_prev_next")),Y.isWebView){var f=geByClass1("article");addClass(f,"article_webview")}Y.isWebView&&Y.audioBridge&&(window.audioplayer={playPause:function(e,t){var n=gpeByClass("audio_item",e.target);if(Q&&Q!=n&&(removeClass(Q,"ai_playing"),Q=!1),G&&(removeClass(G,"article_object_audioplaylist_playing"),G=!1),hasClass(n,"ai_playing"))a.a.send("audioPause",{}),removeClass(n,"ai_playing");else{var i=ue(t,ie),r=ie;-1==i&&(r.unshift(t),i=0),a.a.send("audioPlay",{audioIds:r,pos:i}),addClass(n,"ai_playing"),Q=n}return cancelEvent(e),!1}}),Y.isWebView?(a.a.send("articleReady"),window.addEventListener("VKWebAppEvent",(function(e){var t=e.detail||{};switch(t.type){case"articleOwnerSubscribed":var n=t.ownerId,i=t.isSubscribed;Object(r.each)(ae,(function(e,t){var a=t.getArticle();if(a.owner_id==n)return a.is_subscribed_to_owner=i,!1}));break;case"articleBookmarked":var a=t.articleOwnerId+"_"+t.articleId,o=we(a);o&&(o.is_faved=t.isBookmarked);var s=fe(a);Object(r.each)(s,(function(e,n){toggleClass(n,"_active",!!t.isBookmarked)}));break;case"articleWebViewShow":ye(t);break;case"articleWebViewClose":Se(j);break;case"didShareArticle":var l=t.articleRawId,c=t.shareType;if(!c)break;Se(c,l);break;case"articleMentionClick":var u=t.articleRawId;Se(k,u);break;case"articlePhotoCarouselPositionChanged":default:var d=t.index;if(void 0===d)return;ee&&Z&&ee.changeCarouselPosition(domData(Z,"carousel-id"),d,!0,!1)}})),he(e,!0)):he(e,!1)},fave:function(e,t,n,i,o){var s=!hasClass(e,"_active");ajax.post("article.php",{act:"fave",url:t,add:Object(r.intval)(s),hash:n}),ae.forEach((function(e){var n=e.getArticle();n.url==t&&(n.is_faved=s)})),M(s?"fave":"unfave",i),Ae(o,s),Y.isWebView?function(e){var t=we(e);t&&(JSON.stringify({article:Oe(t)}),a.a.send("articleBookmarked",{article:Oe(t)}))}(o):Share&&Share.setBookmarkState(o,s)},toggleButton:Ae,share:function(e,t,n){return function(e){var t=we(e),n=Y.clientVersion;if(t)if(n){var i={type:"article",data:Oe(t)};a.a.send("share",i)}else{var r={article:Oe(t)};a.a.send("articleShare",r)}}(t),!1},subscribe:function(e,t,n){ajax.post("article.php",{act:"subscribe",owner_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"articleView__subscribed",t),e.innerHTML=n}})},toggleDarkMode:function(e){z||(z=setTimeout((function(){var t=geByClass1("articleView__layout");toggleClass(t,"article_dark",e),toggleClass(document.body,"article_dark",e);var n=Object(r.intval)(hasClass(t,"article_dark"));z=!1,void 0!==e||Y.isWebView||ajax.post("article.php",{act:"set_dark_mode",dark:n});var i=geByClass1("articleMenu");i&&Unfold.setTitle(i,"dark_mode",n?getLang("mobile_articles_menu_dark_disable"):getLang("mobile_articles_menu_dark")),Se(n?C:E);var a=document.querySelector(".basis");a&&!Y.isWebView&&J.colorScheme.applyScheme(a,n?J.ColorSchemeName.Dark:J.ColorSchemeName.Light)}),e?0:10))},onWebViewShow:ye,sendStats:Se,audioPlayPlaylist:function(e,t,n){var i=gpeByClass("article_object_audioplaylist_webview",e);if(Q&&(removeClass(Q,"ai_playing"),Q=!1),G){var r=G;if(removeClass(r,"article_object_audioplaylist_playing"),G=!1,r==i)return a.a.send("audioPause",{}),cancelEvent(n)}var o=ue(t,ie),s=ie;return-1==o&&(s.unshift(t),o=0),a.a.send("audioPlay",{audioIds:s,pos:o}),addClass(i,"article_object_audioplaylist_playing"),G=i,cancelEvent(n)},onAudioStateChanged:function(e,t){Q&&(removeClass(Q,"ai_playing"),Q=!1),G&&(removeClass(G,"article_object_audioplaylist_playing"),G=!1),e=(e=e.split("_"))[0]+"_"+e[1];var n=ge("audio"+e);n&&toggleClass(n,"ai_playing","play"==t);for(var i=geByClass("_article_object_audioplaylist_webview"),a=0;a<i.length;a++){if((domData(i[a],"ids")||"").split(",").indexOf(e)>=0&&"play"==t){addClass(i[a],"article_object_audioplaylist_playing"),G=i[a];break}}}}},"0hva":function(e,t,n){"use strict";n.r(t),n.d(t,"initAlbumPage",(function(){return p}));var i=n("vOib"),a=n("1VZq"),r=n("z1UI"),o=n("O5lf"),s=(n("tlMv"),n("z9sQ"));var l,c,u,d,_=function(e){void 0===e&&(e={});var t=window.lang,n=e.title||"",l=e.description||"",c=e.pretag,u=e.buttons||{},d=(e.photos||[]).map((function(e){return Object(a.default)({photo:e})})),_=null;if(e.is_loading)_=Wd.wrap(Object(o.default)({mix:"al_loading",type:"pageLoader"}));else{if(!d.length)return Object(r.default)({separator:!0,more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_type:"primary",more_url:e.add_url,text:t.mobile_photos_placeholder_album_text});_={inner:[d],class:"AlbumPage__photos photos_page",tag:"div"}}var f=s.default.class("AlbumPage",{withoutDescription:!l},"--");return{inner:[Object(i.default)({inner:[{inner:[{inner:[n],class:"AlbumPage__title",tag:"h2"},l&&{inner:[l],class:"AlbumPage__description",tag:"span"}],class:"AlbumPage__info",tag:"div"},u.prev,_,u.more,c]})],class:f,tag:"div"}},f=n("OcsD");function p(){var e=$("#mhead");Object(f.getH)(e);$(".AlbumPage")&&(l=!1,c=!1,u=!1,d=!1,Object(f.onBodyScroll)(h),Object(f.onBodyScroll)(!0))}function h(){if(l||(l=$(".AlbumPage__title"),c=Object(f.getH)(l)),u||(u=$(".header__title",$("#mhead"))),!u)return Object(f.onBodyScroll)("__clear",h);d||(d=$(".header__text",u));var e=Math.min(40,Math.max(0,getY(l)-c-scrollTop()));f.setStyle.transform(d,1,[0,e]),u.classList.toggle("header__title--initial-position",0===e)}var m=n("Cbap");m.default.getRouter().addRoute(/\/(?:album|tag)(-?\d+(?:_\d+)?)/,p),m.default.getRouter().addRoute(/\/(?:attachments\?act=choose_photo).*(?:album|tag)=(-?\d+(?:_\d+)?)/,p);t.default=_},"1By4":function(e,t,n){"use strict";n.r(t);var i=n("2mXy"),a=n("fdw3"),r=n("OcsD");t.default={html:_,render:function(e){if(O(e))return e;return _(e)},preactRender:i.render,createElement:i.createElement,wrap:function(e){return e?{__raw__:e}:null},handle:function(){var e=j(arguments[0]),t=Array.prototype.slice.call(arguments,1),n=e[0];if(!n)return;O(n)||console.warn('Invalid handler "'+n+'"');var i=M(window,n);if(!C(i))return void console.warn("`"+n+"` is not a function");return i.apply(null,e.slice(1).concat(t))},handle2:function(e,t){var n=Array.prototype.slice.call(arguments,2),i=e[0];if(!i)return;O(i)||console.warn('Invalid handler "'+i+'"');var a=M(window,i);if(!C(a))return void console.warn("`"+i+"` is not a function");for(var r=e.slice(1),o=0,s=r.length;o<s;o++)if("event"===r[o]){r[o]=t;break}a.apply(null,r.concat(n))},elem:function(e){return e?Object(r.ceFromString)(_(e)):""},preactElem:c,preact:d,hydrate:function(e,t,n){return Object(i.hydrate)(Object(i.createElement)(e,t),n)},class:h,style:m,getInternalData:function(){return{__is_wd_internal_data:!0}},innerItemToString:p,toFlatArray:I,prepareHandler:v,isAttrHandler:f,mountPreactComponent:function(e,t,n){if(!n)return;n.innerHTML="",Object(i.render)(Object(i.createElement)(e,t),n)},mountPreactTemplate:u,preactElemFromTemplate:function(e){return c((function(){return e}),{})}};var o=["tag","inner","attrs","innerHTML","outerHTML","_"],s=["area","base","br","col","command","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],l=["abort","auxclick","beforecopy","beforecut","beforepaste","blur","cancel","canplay","canplaythrough","change","click","close","contextmenu","copy","cuechange","cut","dblclick","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","durationchange","emptied","ended","error","focus","gotpointercapture","input","invalid","keydown","keypress","keyup","load","loadeddata","loadedmetadata","loadstart","lostpointercapture","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","paste","pause","play","playing","pointercancel","pointerdown","pointerenter","pointerleave","pointermove","pointerout","pointerover","pointerup","progress","ratechange","reset","resize","scroll","search","seeked","seeking","select","selectstart","stalled","submit","suspend","timeupdate","toggle","touchcancel","touchend","touchmove","touchstart","volumechange","waiting","wheel"].map((function(e){return"on"+e}));function c(e,t){var n=document.createElement("div");return u(e,t,n),n.children[0]}function u(e,t,n){Object(i.render)(d(e,t),n)}function d(e,t){return function e(t,n){return function(n){var o=C(t)?t(n):t;if(!o)return null;if("string"==typeof o||"number"==typeof o)return o;if(S(o))return o.map((function(t){return e(t)(t&&t.props)}));o.children=o.inner?S(o.inner)?o.inner:[o.inner]:null,delete o.inner,o.attrs=o.attrs||{},S(o.children)&&(o.children=Object(r.flatArray)(o.children),o.children=o.children.map((function(t){return t&&t.__raw__?Object(i.createElement)("div",{dangerouslySetInnerHTML:{__html:t.__raw__}}):e(t)(t&&t.props)})));var s=Object(r.flatArray)([o.class,o.className]).reduce((function(e,t){return t&&e.push.apply(e,t.split(" ").map((function(e){return e.trim()})).filter((function(e){return!!e}))),e}),[]);Object.keys(o).forEach((function(e){if(y(e)){var t=o[e];o[e]=Object(a.preactCallback)(t),o["preacted-"+e.toLowerCase()]=!0}}));var l=Object.assign({},o,{className:s.length?s.join(" "):null});return delete l.class,delete l.tag,delete l.attrs,Object(i.createElement)(o.tag||"div",l,o.children)}}((function(t){return e(t)}))(t)}function _(e){if(O(e))return e?{__raw__:e}:null;if(S(e))return e.map(_).join("");if(!k(e))throw"Invalid input, object is expected";if("outerHTML"in e){var t=e.outerHTML;if(O(t))return t;if(w(t))return t.toString();if(t)throw"Invalid outerHTML";return""}var n=function(e){if("tag"in e){var t=e.tag;if(O(t)&&/^[\w-]+$/.test(t))return t;throw"Invalid tag name"}if(E(e.href))return"a";return"div"}(e),i=function(e){if("innerHTML"in e){var t=e.innerHTML;if(O(t))return t;if(w(t))return t.toString();if(t)throw"Invalid innerHTML";return""}if("inner"in e)return I(e.inner).map(p).join("");return""}(e),a=function(e){var t="";k(e.attrs)&&Object.assign(e,e.attrs);for(var n in e)if(!b(n)){var i=e[n];"class"===n?i=h(i):f(n,i)?i=v(i):i&&(i=A(i)),"style"===n&&(i=m(i));var a=T(n);!0===i?t+=" "+a:w(i)?t+=" "+a+'="'+i+'"':O(i)?t+=" "+a+'="'+T(i)+'"':i&&(i=i.__raw__?i.__raw__:A(i))&&(t+=" "+a+'="'+i+'"')}O(e.attrs)&&(t+=" "+e.attrs.replace(/</g,"&lt;").replace(/>/g,"&gt;"));return t}(e);return function(e){return s.includes(e.toLowerCase())}(n)?"<"+n+a+" />":"<"+n+a+">"+i+"</"+n+">"}function f(e,t){return y(e)&&(S(t)||O(n=t)&&/^[\w.]+$/.test(n));var n}function p(e){return w(e)?e.toString():O(e)?T(e):k(e)?e.__raw__?e.__raw__:_(e):""}function h(e){return I(e).filter(E).join(" ").trim().replace(/\s+/g," ")}function m(e){return k(e)?Object.entries(e).map((function(e){var t=e[0],n=e[1];return(t=t.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})))+":"+n})).join(";"):e}function v(e){var t=j(e);if(!t.length)return null;var n=t[0];return O(n)?n+"("+t.slice(1).map(g).join(", ")+")":e}function g(e){return w(e)||"this"===e||"event"===e||void 0===e?e:T(JSON.stringify(e),!0)}function A(e){return void 0===e&&(e=""),e="boolean"==typeof e||w(e)?e:O(e)?T(e,!0):k(e)?e.__raw__:T(JSON.stringify(e),!0)}function b(e){return o.includes(e)}function y(e){return l.includes(e.toLowerCase())}function w(e){return"number"==typeof e&&!isNaN(e)}function O(e){return"string"==typeof e}function S(e){return Array.isArray(e)}function k(e){return"[object Object]"===Object.prototype.toString.call(e)}function C(e){return"[object Function]"===Object.prototype.toString.call(e)}function E(e){return O(e)&&e}function j(e){return S(e)?e:[e]}function T(e,t){return void 0===e&&(e=""),t?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):(e=e.replace(/&(?!(#\d{0,4};|quot;|lt;|gt;|amp;))/g,"&amp;",e)).replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function I(e){return S(e)?function e(t){var n=[];return t.forEach((function(t){S(t)?n=n.concat(e(t)):n.push(t)})),n}(e):[e]}function M(e,t){for(var n=t.split("."),i=n.length,a=e,r=0;r<i;r++)try{a=a[n[r]]}catch(e){return}return a}},"1KAK":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=(n("KMpi"),n("/Id8")),o=n("fdw3");function s(){var e=Object(i.default)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=function(e){var t=e.msgId,n=e.withDivider?function(){var e=window.lang;return a.default.html(s(),e.mobile_mail_new_msgs)}():"",i=store.mail,c=Object(o.isForwardedMessageId)(t)?i.forwards[t]:i.msgs[t];if(!c)return null;var u,d=i.members[c.authorId],_=c.peerId,f=i.peers[_];if(!e.detailed){var p=store.mail.presend,h=(p=p&&p.msgs)&&p["edit"+t];h&&(c=h)}f&&(f.isIncomingMR||f.isRejectedMR)&&(n="");if(c.isService)u=Object(r.default)({id:t,text:c.service,service:!0,unread:c.isUnread});else{var m=Object(r.Msg__authorName)(d,_,i.cur.userId),v={id:t,text:c.text,important:c.isImportant,unread:c.isUnread,authorPhoto:d.avatar,authorName:m,authorUrl:d.url,date:c.date,removed:i.cur.msgRemoved[t],admin:c.adminName?{name:c.adminName,url:c.adminUrl}:null,edited:c.edited,channel:f.isChannel&&f.ownerId!==i.cur.viewerId,attaches:c.attaches,attachesHTML:c.attachesHTML,attachesLoading:c.attachesLoading,forwards:c.forwards,reply:c.reply,pending:c.pending,waiting:c.waiting,failed:c.failed,sendId:c.sendId,sticker:c.sticker,keyboard:c.keyboard,maxDepth:e.detailed?i.cur.maxDetailedMsgDepth:i.cur.maxMsgDepth,ttl:c.ttl,ts:c.ts,isExpired:c.isExpired,isDefaultCasperTimerShown:!f.isCasper,isPinned:e.isPinned,chatId:e.chatId};u=e.detailed?Object(r.Msg_detailed)(v):Object(r.default)(v)}return a.default.html(l(),n,u)};t.default=c;window.uMsg=c},"1VZq":function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("HaOv"),r=n("xTMR");var o=function(e){var t,n=e.photo,o=n.restriction;if(o&&"block"===o.type)t={inner:[{inner:[Object(i.default)({icon:Object(a.getDoNotDisturbOutline56Icon)()})],class:"PhotosPhotoItem__restriction",tag:"div"}],class:"_image PhotosPhotoItem__photo",tag:"div"};else{var s=["_image",Bem.class("PhotosPhotoItem__photo",{blur:o&&"blur"===o.type},"--")];t={inner:[o&&o.type?{inner:[Object(i.default)({icon:Object(r.getHideOutline56Icon)()})],class:"PhotosPhotoItem__restriction",tag:"div"}:null],style:"background-image: url("+n.src+")",attrs:n.attrs,class:s,tag:"div"}}return{inner:[t],href:n.href,class:"PhotosPhotoItem "+n.class,onclick:n.onclick,tag:"a"}};t.default=o},"29dZ":function(e,t,n){"use strict";n.r(t);var i=n("UvyM"),a=n("myok");n.d(t,"setDisabled",(function(){return a.setDisabled})),n.d(t,"setLoading",(function(){return a.setLoading})),Object.assign(i.default,a.default),window.Btn=i.default,t.default=i.default},"2IoG":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function r(){var e=Object(i.default)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return r=function(){return e},e}t.default=function(e){void 0===e&&(e={});var t,n,i=a.default.list(e.inner);e.url?(t="a",n=a.default.attr("href",e.url)):(t=e.tag||"div",n="");return a.default.html(r(),t,e.mix,n,e.attrs,i,t)}},"3pHe":function(e,t,n){"use strict";n.r(t),n.d(t,"Messenger",(function(){return ue}));var i={};n.r(i),n.d(i,"showCaptcha",(function(){return He})),n.d(i,"renderBody",(function(){return Ue}));var a,r=n("MUpH"),o=n("bZ/P"),s=n("z9sQ"),l=n("TYsd"),c=n("Mc5h"),u=(n("9y81"),n("O5lf")),d=n("AgBx"),_=n("QBkA"),f=n("rKp0"),p=n("u33z"),h=n("PUg3"),m=n("CkGd"),v=n("drfJ"),g=n("+cqQ"),A=n("DkIl");function b(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&y())}function y(){var e=store.mail.cur;(e?e.peerId:null)?a=setTimeout((function(){k(),y()}),3e4):w()}function w(){a&&clearTimeout(a)}function O(){$$(".mailHat").forEach((function(e){return e.outerHTML=Object(v.default)()}))}function S(){}function k(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,a=n?n.peerId:null;if(a){var r=i[a];if(r.lastActionTime&&!r.isOnline){var o=n.timeShift,s=function(e,t){var n=window.lang,i="";e+=t;var a=parseInt(Date.now()/1e3)-e;if(a>7776e3)return"";if(a<60)i=n.mobile_profile_status_just_now;else if(a<3600){var r=intval(a/60);i=langWordNumeric(r,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(a<14400){var o=intval(a/3600);i=langWordNumeric(o,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,a=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,a.mobile_mail_date,0,a.months_sm_of,!1):langDate(t,a.mobile_mail_short_date_time,0,a.months_sm_of,!1)}(e);return i}(r.lastActionTime,o);r.offlineText=s?langSex(r.sex,e.mobile_mail_last_activity_tip).replace("{time}",s):""}else r.canSeeOnline||(r.offlineText=function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(r.onlineStatus,r.sex));O()}}Object.assign(v.default,{onUnreadClick:Object(g.default)(),onBackClick:Object(g.default)(),onBackToDialogClick:Object(g.default)(),onCancelEditing:Object(g.default)(),setModifiers:A.MailHat_convo.setModifiers,redrawCounter:function(){var e=store.mail.cur.countUnread;if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}navigator.setAppBadge&&navigator.setAppBadge(e);Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e)},redrawOnline:k,redraw:O,startStatusUpdate:y,cancelStatusUpdate:w}),A.MailHat_main.onUnreadClick(v.default.onUnreadClick),A.MailHat_main.onBurgerClick(menu.open),A.MailHat_main.onCancelForwardTap(v.default.onBackToDialogClick),A.MailHat_convo.onBackTap(v.default.onBackClick),A.MailHat_convo.onCancelEditingTap(v.default.onCancelEditing),uVK.onReady(b),uVK.onReady(S),page.onChange(S);var C=v.default;window.uMailHat=v.default;var E=n("29dZ"),j=function(e){var t=window.lang;return l.default.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[Object(E.default)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),Object(E.default)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})};Object.assign(j,{accept:function(e,t,n){E.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&E.default.setLoading(t,!1)}),(function(){E.default.setLoading(t,!1)}))},reject:function(e,t,n){E.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&E.default.setLoading(t,!1)}),(function(){E.default.setLoading(t,!1)}))}});var T=j;var I=T;window.MessageRequestBox=T;var M=n("Y6JH"),D=n("fdw3"),P=n("k0dR"),x=function(e){var t=e.tagsData,n=[];e.tags&&t.peerTags&&(n=e.tags.filter((function(e){return t.peerTags.indexOf(e.id)>-1})));var i=L({fromAd:t.fromAd,peerTags:n,urls:e.data.urls}),a=R(e.data),r=(l=e.data,c=l.likesCount||l.repliesCount,{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_activity_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[c?[l.likesCount?{inner:[l.likesCount],class:"PeerProfile__blockItem",tag:"span"}:"",l.repliesCount?{inner:[l.repliesCount],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(D.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}),o=function(e){return{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_note_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.note?{inner:[e.note],tag:"span"}:"",{inner:[Object(D.getLang)(e.note?"mobile_mail_peer_profile_edit_note_link":"mobile_mail_peer_profile_add_note_link")],href:e.urls.editNote,class:e.note?"PeerProfile__editNoteLink":"PeerProfile__blockLink",tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}(e.data),s=N(e.data);var l,c;return[i,a,r,o,s]};function L(e){for(var t=e.fromAd?1:0,n=3-t,i=[],a=e.fromAd?{inner:[Object(M.default)({icon:Object(P.getAdTag10Icon)()}),{inner:[Object(D.getLang)("mobile_mail_ad_tag_no_access_text")],tag:"span"}],class:"PeerProfile__adTag",tag:"div"}:"",r=e.peerTags,o=0,s=0;s<r.length;s++)e.fromMessenger&&s>=n?o++:i.push(r[s]);var l=window.lang,c=i.length+t;return{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_tags_label")],class:"PeerProfile__blockLabel",tag:"div"},c>0?{inner:[a,B(i),o>0?{inner:["+"+langNumeric(o,l.mobile_mail_peer_profile_extra_tags)],href:e.urls.showPeerProfile,class:"PeerProfile__extraTag",tag:"a"}:"",e.fromMessenger?"":{inner:[Object(D.getLang)("mobile_mail_peer_profile_edit_tags_link")],href:e.urls.toggleTags,class:"PeerProfile__editTag",tag:"a"}],class:"PeerProfile__blockContent PeerProfile__tagsList",tag:"div"}:{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_add_tags_link")],href:e.urls.toggleTags,tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function B(e){return[e.map((function(e){return{inner:[e.name],class:"PeerProfile__peerTag",style:"background-color: "+e.color,tag:"div"}}))]}function R(e){var t=e.city||e.age;return{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_info_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[t?[e.city?{inner:[e.city],class:"PeerProfile__blockItem",tag:"span"}:"",e.age?{inner:[e.age],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(D.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function N(e){return{inner:[{inner:[Object(D.getLang)("mobile_mail_peer_profile_join_date_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.joinDate?e.joinDate:Object(D.getLang)("mobile_mail_peer_profile_join_date_empty_text")],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}n("wCFN");var F=n("UxAg"),H=n("OcsD"),U=n("p5n7"),V=n("7ADY");function W(e){var t=e.index+"_";return{inner:[Object(U.default)({name:"tags["+t+"id]",type:"hidden",value:e.id}),Object(U.default)({name:"tags["+t+"state]",type:"hidden",value:e.state||"",class:"PeerProfileManageTags__stateLabel"}),Object(U.default)({name:"tags["+t+"color]",type:"hidden",value:e.color,class:"PeerProfileManageTags__colorLabel"}),Object(U.default)({name:"tags["+t+"name]",class:"PeerProfileManageTags__label",placeholder:Object(D.getLang)("mobile_mail_peer_profile_manage_tags_placeholder"),value:e.name,maxlength:20,on_change:["PeerProfile.onTagNameChange","this"]}),{class:"PeerProfileManageTags__color",style:"background-color: "+e.color,tag:"span"},{inner:[Object(M.default)({icon:Object(V.getCancel24Icon)()})],class:"PeerProfileManageTags__remove",onClick:["PeerProfile.onRemoveTagClick","this"],tag:"div"}],class:"PeerProfileManageTags__field",tag:"div"}}Object.assign(x,{onMessengerBlockClick:function(e,t){if(Object(H.gpeByClass)("PeerProfile__adTag",e.target))return;nav.go(t)},toggleTag:function(e,t,n,i){ajaxRequest("/mail",{act:"toggle_peer_profile_tag",tag_id:e,action:i.checked?"bind":"unbind",peer_id:t,hash:n})},onAddTagClick:function(e){var t=e.$btn,n=t.parentElement,i=Object(F.$$)(Q,n),a=Object(F.$$)("."+Z(),n);if(i.length-a.length>=20)return;var r=l.default.elem(W({id:"",name:"",color:K(n),state:"new",index:i.length}));n.insertBefore(r,t),J()},onRemoveTagClick:function(e){var t=e.parentElement,n=Object(F.$)(".PeerProfileManageTags__stateLabel",t),i=Object(F.$)(".TextInput__native",n);"new"===i.value?t.remove():(Object(H.addClass)(Z(),t),i.value="deleted",X());J()},onTagNameChange:function(e){var t=e.closest(".PeerProfileManageTags__field"),n=Object(F.$)(".PeerProfileManageTags__stateLabel",t),i=Object(F.$)(".TextInput__native",n);"new"!==i.value&&(i.value="changed");X()}});var z=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],Y="PeerProfileManageTags__field",Q="."+Y,G="PeerProfileManageTags__addLink";function K(e){var t=Object(F.$$)(Q,e),n=Array.from(t).reduce((function(e,t){var n=Object(F.$)(".PeerProfileManageTags__stateLabel",t);if("deleted"!==Object(F.$)(".TextInput__native",n).value){var i=Object(F.$)(".PeerProfileManageTags__colorLabel",t);e[Object(F.$)(".TextInput__native",i).value]=!0}return e}),{});return z.find((function(e){return!n[e]}))}function X(){var e=Object(F.$)(".HeaderBtn"),t=s.default.class("HeaderBtn",{hidden:!0},"--").replace("HeaderBtn ","");Object(H.removeClass)(t,e)}function J(){var e=Object(F.$)(".PeerProfileManageTags__addLink"),t=e.parentElement,n=Object(F.$$)(Q,t),i=Object(F.$$)("."+Z(),t),a=n.length-i.length,r=s.default.class(G,{hidden:!0},"--").replace(G+" ","");Object(H.toggleClass)(r,e,a>=20)}function Z(){return s.default.class(Y,{removed:!0},"--").replace(Y+" ","")}window.PeerProfile=x;var ee=n("l4rn");function te(){var e=Object(r.default)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return te=function(){return e},e}function ne(){var e=Object(r.default)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return ne=function(){return e},e}function ie(){var e=Object(r.default)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return ie=function(){return e},e}function ae(){var e=Object(r.default)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return ae=function(){return e},e}function re(){var e=Object(r.default)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return re=function(){return e},e}function oe(){var e=Object(r.default)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return oe=function(){return e},e}function se(){var e=Object(r.default)(['\n    <div class="messenger__header">\n      ','\n    </div>\n    <div class="messenger__content">\n      <div class="','">','</div>\n      <div class="messenger__pinned">','</div>\n      <div class="messenger__peerProfile">',"</div>\n      ",'\n      <div class="','">\n        <div class="messenger__mrbox">','</div>\n        <div class="messenger__write">','</div>\n        <div class="messenger__acts">',"</div>\n      </div>\n    </div>\n  "]);return se=function(){return e},e}function le(){var e=Object(r.default)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">','</div>\n        <div class="messenger__content">\n          ','\n        </div>\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return le=function(){return e},e}var ce=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=Object(f.default)({scrap:"folder"}),a=Object(f.default)({scrap:"search"}),r=e.page,o="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR;return ue({mix:me(),mailHat:C(),convo:de(),page:r,mrs:o,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:a})};function ue(e){var t=window.lang.mobile_mail_search_only_messages,n=Object(_.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?Ae(e.mrs):"",a=o.default.onClick("Messenger._onSearchMsgsClick"),r=Object(d.default)({mix:"messenger__body",attrs:o.default.onScroll("Messenger._onMainScroll","this"),inner:[Object(c.default)({mix:"messenger__filter",inner:n}),Object(c.default)({mix:o.default.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),Object(c.default)({mix:"messenger__searchMsgs",attrs:a,inner:t}),Object(c.default)({mix:"messenger__loadable",inner:[Object(c.default)({mix:"messenger__folderList",inner:e.scrapFolder}),Object(c.default)({mix:"messenger__searchList",inner:e.scrapSearch}),_e()]})]});return o.default.html(le(),e.mix,e.mailHat,r,e.convo,e.page)}function de(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=C(),a=fe(),r=pe(),s=Object(h.default)(),l=n&&n.canPin,u=Object(m.default)({canPin:l,isChannel:n.isChannel}),_=n.isCasper,p=Object(f.default)({scrap:"peer",isCasper:_}),v=n.isIncomingMR?I(t.peerId):"",g=n.isRejectedMR?function(){var e=window.lang;return o.default.html(oe(),e.mobile_mail_mrs_rejected_info)}():"",A=t.peerId>0&&t.peerId<2e9,b=e.flags.isPeerProfileEnabled&&A?be({tags:e.peerProfileTags,tagsData:n.peerProfileTagsData,data:n.peerProfileData}):"",y=Object(d.default)({mix:"messenger__body",attrs:o.default.onScroll("Messenger._onConvoScroll","this"),inner:[Object(c.default)({mix:"messenger__spacer"}),Object(c.default)({mix:"messenger__convoList",inner:[p,g]}),_e()]}),w="messenger__banner";r&&(w+=" messenger__bannerVisible");var O=o.default.class("messenger__footer",{actionsOpen:ve(),isIncomingMR:n.isIncomingMR});return o.default.html(se(),i,w,r,a,b,y,O,v,s,u)}function _e(){var e=Object(u.default)({mix:""});return o.default.html(ae(),e)}function fe(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function pe(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if(Object(D.isSAKIntegration)()||!i)return"";var a="";i.icon&&(a=o.default.html(ie(),i.icon));for(var r=i.buttons,s=r.length,l=[],c=0;c<s;c++)l.push(he(r[c],c));l=o.default.list(l);var u=Object(p.default)({class:"messenger__banner_close",onClick:o.default.onClick("uMessenger.onBannerButtonClick","event")}),d=o.default.onClick("uMessenger.onBannerTextClick","event");return o.default.html(ne(),a,d,i.text,l,u)}function he(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=o.default.class("messenger__banner_button",n),r=e.type;return"gifts_link"===e.type&&(r="link",i="_self"),Object(p.default)({class:a,text:e.text,type:"link"===r?"link":"button",link:"link"===r?{href:e.link,target:i}:null,onClick:o.default.onClick("uMessenger.onBannerButtonClick","event",t)})}function me(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null;return o.default.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e))}function ve(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function Ae(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return o.default.html(te(),n)}function be(e){var t=e.tags,n=e.tagsData,i=e.data;if(!i)return"";var a=[];t&&n.peerTags&&(a=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var r,o=a.length;return r=n.fromAd||o?L({fromAd:n.fromAd,peerTags:a,fromMessenger:!0,urls:e.data.urls}):i.city||i.age?R(i):N(i),l.default.html({class:"PeerProfile__wrapper",inner:[{class:s.default.class("PeerProfile",{messenger:!0},"--"),inner:r},{class:"PeerProfile__link",inner:Object(M.default)(Object(ee.getChevronCompactRight24Icon)())}],onClick:["PeerProfile.onMessengerBlockClick","event",i.urls.showPeerProfile]})}var ye=n("jk6M"),we=n("Qz23");function Oe(){Object(we.cleanScrollView)(ue.getConvoBody()),removeEvent(ue.getConvoBody(),"touchstart",Se,{passive:!0})}function Se(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function ke(e,t){$$(".messenger__layer_"+e).forEach((function(e){e.classList.toggle("messenger__layer_loading",t)}))}function Ce(e){return $(".messenger__layer_"+e+" .messenger__body")}function Ee(e){ue.onMainScroll(e)}function je(e){ue.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&ue.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&ue.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout((function(){e._isScrolling=!1}),100)}function Te(){var e,t,n=ue.getConvoBody();n&&(n.prevHeight&&n.prevHeight!==n.offsetHeight&&(e=n,t=n.scrollBottom,e.scrollTop=e.scrollHeight-e.offsetHeight-t),n.prevHeight=n.offsetHeight,n.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(n),Ie&&requestAnimationFrame(Te))}Object.assign(ue,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:Object(g.default)("scrollElem"),onQueryChange:_.default.onChange,onQueryClear:_.default.onClear,onSearchMsgsClick:Object(g.default)(),setQuery:_.default.setQuery,setQuerySilently:_.default.setQuerySilently,getMainBody:function(e){return Ce("main")},setMainLoading:function(e){return ke("main",e)},onConvoAtTop:Object(g.default)(),onConvoAtBottom:Object(g.default)(),onConvoScroll:Object(g.default)("scrollElem"),setConvoLoading:function(e){return ke("convo",e)},getConvoBody:function(){return Ce("convo")},scrollConvoToBottom:function(){var e=ue.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=de();Oe(),$$(".messenger__layer_convo").forEach((function(t){t.innerHTML=e}))},cleanConvoBody:Oe,setupConvoBody:function(){Object(we.setScrollView)(ue.getConvoBody(),{topBanner:!1}),addEvent(ue.getConvoBody(),"touchstart",Se,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")},renderMessengerPeerProfile:function(e){$(".messenger__peerProfile").innerHTML=be(e)}}),ue._onMainScroll=Ee,ue._onConvoScroll=je,ue._onSearchMsgsClick=ue.onSearchMsgsClick;var Ie=!1;if(ce.startPolling=function(){Ie=!0,Te()},ce.stopPolling=function(){Ie=!1},Object.assign(ce,{redraw:function(){$$(".uMessenger").forEach((function(e){return e.outerHTML=ce()}))},redrawView:function(){$$(".uMessenger").forEach((function(e){return e.className=me()}));var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(Pe(),m.default.togglePin(n[t.peerId].canPin));xe()},redrawMailActions:function(){var e=ve();$$(".messenger__layer_convo").forEach((function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),m.default.update();var n=store.mail,i=n.cur,a=n.peers;if(!i.peerId||!a[i.peerId].isIncomingMR){var r=t.$(".messenger__write").offsetHeight,o=t.$(".messenger__acts").offsetHeight-r,s=t.$(".messenger__body");requestAnimationFrame((function(){!s._fixed&&o&&(s.style.paddingBottom=o+"px",s._fixed=!0),o<=0&&(s.style.paddingBottom=0,s._fixed=!1)}))}}))},redrawPinnedMsg:Pe,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,a=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach((function(t){t.classList.toggle("messenger_pinnedVisible",a&&e),t.classList.toggle("messenger_pinnedHidden",a&&!e)}))},redrawBanner:function(){var e=pe();$$(".messenger__banner").forEach((function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)}))},redrawMRsHint:xe,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=ue.getConvoBody();if(ye.default.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach((function(e){return e.classList.remove("load_before_closed")}));var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(De&&clearInterval(De),De=setInterval((function(){e.isScrolling||(clearInterval(De),t())}),10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach((function(e){return e.classList.remove("load_before_closed")}));var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var a=ue.getConvoBody();if($(".mailScrap__loading_before"),t)a.scrollTop=i.offsetTop-.18*a.offsetHeight;else{var r=$(".typing_id_curConvo").offsetHeight;a.scrollTop=i.offsetTop-.5*(a.offsetHeight+2)+(i.offsetHeight+r)/2,i.offsetHeight>a.offsetHeight&&(a.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout((function(){removeClass("msg_highlight",i)}),1500)),!0},loadMailPage:Object(g.default)()}),ye.default.safari_mobile){var Me=null;ue.onConvoScroll((function(e){e.isScrolling=!0,Me&&clearTimeout(Me),Me=setTimeout((function(){return e.isScrolling=!1}),50)}))}var De=null;function Pe(){var e=store.mail,t=e.peers,n=e.cur,i=fe(),a=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(a)}function xe(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var a=t?Ae(t):"";i.innerHTML=a}i.classList.toggle("messenger__mrsHint_hidden",!n)}var Le=n("cq4b"),Be=n("/Id8"),Re=n("fWqt"),Ne=n("qHA9"),Fe=n("iS9e");function He(e,t){Fe.default.open({body:Ue(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var a,r=Object(F.$)('[name="'+e.key+'"]',i);r=r&&r.value||"",Fe.default.close(),Object(Ne.mailRequest)(e.location,Object.assign({},e.post,(a={},a[e.key]=r,a))).then((function(e){t(Promise.resolve(e))}),(function(e){t(Promise.reject(e))}))},onClose:function(){Fe.default.close(),t(null)}})}function Ue(e){return l.default.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[Object(U.default)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}var Ve=i,$e=n("V4qE"),We=n("cZev"),qe=n("GYWy"),ze=n.n(qe),Ye=n("eWFs"),Qe=n("wMVj"),Ge={onTemplateInput:function(e,t,n,i){var a=$("."+n),r=i-t.value.length;a.textContent=r,a.className=s.default.class(n,{error:r<=0})},onButtonMouseDown:function(e,t){ye.default.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),a=i.value,r=i.selectionStart,o=i.selectionEnd;i.value=a.slice(0,r)+n+a.slice(o);var s=r+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,a){var r=$(".MailTemplatePage__NameInput .TextInput__native"),o=$(".MailTemplatePage__TextTextarea");E.default.setLoading(t,!0),Object(H.ajaxRequest)("/mail",{act:"save_template",name:r.value,text:o.value,hash:i,id:n},(function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),r=$(".MailTemplatePage__ErrorText");return E.default.setLoading(t,!1),i.hidden=!1,void(r.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var o=store.mail.cur.templates,s=n?o.findIndex((function(e){return e.id===n})):-1;-1!==s?o.splice(s,1,e.result):o.push(e.result)}Qe.default.go(a)}}),(function(){E.default.setLoading(t,!1)}))},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=Ge;var Ke=n("9b/I"),Xe=function(e){var t=window.lang,n=Object(A.MailHat)({type:"page",left:l.default.html({class:"mailHat__back",inner:Object(M.default)(Object(Ke.getBackOutline28Icon)()),href:"/mail"}),center:Object(A.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),i=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},l.default.wrap(Object(f.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[Object(E.default)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:o.default.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:l.default.wrap(n)},{class:"messenger__content",inner:[{class:"messenger__body",inner:i}]}]}};Object.assign(Xe,{rejectAll:function(e,t){E.default.setLoading(t,!0),Xe.onRejectAll(t)},onRejectAll:befall()});var Je=Xe;var Ze=Je;window.MessageRequestsPage=Je;var et,tt,nt=n("V2dH"),it=n("iWgD"),at=n("HGMY"),rt=n("zq7H"),ot=n("9M99"),st=n("hw56"),lt=n("H5mD"),ct=n("aiw/"),ut=n("W38l"),dt=n("HdGT"),_t=n("gF8j"),ft=Object(g.default)();function pt(){tt=null,et&&et.stop()}function ht(e,t){et&&(et.is_idle?tt[e]=t:setTimeout(t,0))}function mt(){var e=tt;tt={},Object.keys(e).forEach((function(t){(0,e[t])()}))}var vt=null,gt=null;function At(e){if(gt&&(clearTimeout(gt),gt=null),vt&&(vt=Object.assign({},vt,{fails:0})),"online"===e.type&&vt){var t=vt;vt=null,bt(t)}}function bt(e){if(!1!==navigator.onLine)return Object(Ne.mailRequest)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then((function(t){e.onResult(t)})).catch((function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));vt=Object.assign({},e,{fails:n}),gt=setTimeout((function(){gt=null,bt(vt)}),1e3*i)}else vt=Object.assign({},e,{fails:0})}));vt=Object.assign({},e,{fails:0})}window.addEventListener("online",At),window.addEventListener("offline",At);var yt=n("UlUB"),wt=n("ZMWW"),Ot=n("BZzM"),St=n("N4ZS"),kt=n("r/ag"),Ct=n("j80l"),Et=n("vk58"),jt=n("j1wj"),Tt=n("zvhO"),It=!1;uVK.onReady(mn),ue.onQueryChange(An),ue.onQueryClear(bn),Ye.default.onTap(Qt),C.onUnreadClick(Bt),C.onBackClick(Un),C.onBackToDialogClick(Vn),C.onCancelEditing(Di),h.default.onAttachedMsgsRemove(Yt),h.default.onToBottomClick(xn),h.default.onMessage(Vt),dt.onMessage(Ut),dt.onStopped($t),dt.onMessageRemove(Wt),dt.onCaptcha(Yi),Be.default.onClick(pi),Be.default.onRestoreClick(mi),Be.default.onReplyClick(gi),Be.default.onForward(bi),Voting.onHtmlUpdate(Li),ue.onMainScroll(Pn),ue.onConvoScroll(Ln),ue.onSearchMsgsClick(gn),ue.onConvoScroll(ce.expandPeerBefore),ue.onConvoAtTop(In),ue.onConvoAtBottom(Mn),m.default.onCloseClick(ai),m.default.onRemoveClick(ri),m.default.onImportantClick(ui),m.default.onReplyClick(_i),m.default.onForwardClick(fi),m.default.onSpamClick(ci),m.default.onPinClick(ni),m.default.onEditClick(ii),Re.default.onConfirmDelete(si),PinnedMsg.onHideClick(Si),Ze.onRejectAll(Hi),im.onNewMsg(qt),im.onEditMsg(zt),im.onMultiTyping(Wn),im.onRecordingAudio(Qn),im.onOnlineChange(Gn),im.onMsgReadByMe(Kn),im.onMsgReadByOther(Xn),im.onMsgImportantRemove(Kt),im.onMsgImportantAdd(Gt),im.onMsgRemove(Xt),im.onMsgListen(Jt),im.onConvoSortIdChanged(Zt),im.onPeerKeyboard(tn),im.onPeerBanner(un),im.onPeerConvert(dn),im.onPeerAdmin(_n),im.onMsgRequestChange(fn),im.onDialogImportant(nn),im.onDialogMarkedUnread(rn),im.onDialogAdTag(an),im.onUnreadCount(on),im.onIncomingCall(sn),im.onKeyboardCallback(cn),im.onResync(ln),ft(qi),AudioMessagePlayer.events.on("listened",zi),nav.onPopState(Jn),nav.onBeforeGo(Zn),nav.onBeforeGo2(ei),page.onChange(ti),uVK.onReady(ji),page.onChange(ji),uVK.onReady(Ti),page.onChange(Ti),page.onChange(Ht),page.onChange(xi),uVK.onReady(Ht),uVK.onReady(wi),uVK.onReady(xi),uVK.onOrientationChange(Ft),ce.loadMailPage(Bi),ce.onShowPinnedMsgClick=Oi,ce.onHidePinnedMsgClick=Si,ce.onMarkDialogAsUnreadClick=ki,ce.onBannerButtonClick=Ci,ce.onBannerTextClick=Ei,ce.onCall=ea,ce.goToMsg=vi;var Mt=!1,Dt=0,Pt=[],xt=[],Lt=Object(yt.throttle)((function(){if(!Pt.length)return;var e=store.mail,t=e.members,n=e.cur,i=Pt,a=xt;Pt=[],xt=[],ajaxRequest("/mail",{act:"get_members",members:i},(function(e){Object.assign(t,e),a.forEach((function(e){e===n.peerId&&nt.default.redraw(),Ye.default.redrawTyping(e)}))}))}),3e3);function Bt(){ue.scrollMainBodyToTop()}function Rt(){Object(we.preventDocumentScroll)();var e=ue.getMainBody();e&&Object(we.setScrollView)(e);var t=$(".leftMenu__searchItems");t&&Object(we.setScrollView)(t,{topBanner:!1,overscrollY:!1})}function Nt(){Object(we.preventDocumentScroll)({topBanner:!1}),ue.setupConvoBody()}function Ft(){ye.default.safari_mobile&&document.activeElement.blur()}function Ht(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame((function(){ce.scrollToMsg(e)})):requestAnimationFrame(ue.scrollConvoToBottom)}function Ut(e){var t=store.mail.cur;Object(st.addPendingMsg)(e),t.peerId&&(0===e.sendId.indexOf("edit")?Nn(e):(at.removeMsg(e),at.addMsg(e),$i()))}function Vt(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&Nn(e)}function $t(){Object(st.failAllPendingMsgs)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map((function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?Nn(t):i.push(t))})),at.setMsgs(i)}}else Object.keys(n.failed).forEach((function(e){Ye.default.redrawLastMsg(e)}))}function Wt(e){var t=store.mail.presend.msgs[e];t&&(Object(st.removePendingMsg)(t),Object(st.removeFailedMsg)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&f.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&at.removeMsg(t),$i()))}function qt(e,t){Rn(e,t)}function zt(e){Rn(e)}function Yt(){var e=store.mail,t=e.cur;e.peers;Object(st.setPeerDraft)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],h.default.uiRedrawAttachments(t.peerId)}function Qt(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs;if(n){var a=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[a]||[])];return vn(e)}}function Gt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,r=t.rolls,o=i[e];if(o&&(o.isImportant=!0,r.folder.important=r.folder.important.concat(e).filter(unique).sort(desc),Be.default.toggleImportant(e,!0),"important"===n.folder)){var s=a.folder.slice();a.folder=a.folder.concat(e).filter(unique).sort(desc),f.default.redrawFolder(s)}}function Kt(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,r=n.scraps,o=n.rolls,s=a[e];if(s&&(s.isImportant=!t,Object(Le.arrayRemove)(o.folder.important,e),Be.default.toggleImportant(e,!1),"important"===i.folder)){var l=r.folder.slice();Object(Le.arrayRemove)(r.folder,e),f.default.redrawFolder(l)}}function Xt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,r=t.rolls,o=t.peers,s=i[e];if(wt.SAKIntegration.isIntegrated&&wt.SAKIntegration.sendMessage("remove_msg",{msg:s}),s&&!n.msgRemoved[e]){delete i[e],Object(Le.arrayRemove)(r.peer[s.peerId],e),n.peerId===s.peerId&&(Object(Le.arrayRemove)(a.peer,e),Be.default.remove(e,!0),n.msgSelected[e]&&(delete n.msgSelected[e],m.default.setCount(Object.keys(n.msgSelected).length),ce.redrawMailActions()),a.peer.length?f.default.checkDivider():f.default.redrawPeer()),s.isImportant&&n.countImportant--;var l=o[s.peerId];l.groupCallMsg===e&&(l.groupCallMsg=void 0);var c=l.isIncomingMR,u=l.isRejectedMR;s.isUnread&&s.authorId!==n.viewerId&&(l.countUnread=l.countUnread-1,c||u||l.countUnread<=0&&(n.countUnread=n.countUnread-1),h.default.redrawToBottom(),C.redrawCounter()),r.peer[s.peerId].length?en(s,e):ajaxRequest("/mail",{act:"get_last_msg",peer_id:s.peerId,user_id:n.userId},(function(t,n){n&&(storeMethods.injectMail(t),r.peer[s.peerId].push(n)),en(s,e)}),(function(){en(s,e)}))}}function Jt(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}))}}function Zt(e,t){var n=t.majorSortId,i=t.minorSortId,a=store.mail,r=a.peers,o=a.scraps,s=a.cur,l=r[e]||{};if(n&&(l.majorSortId=n),i&&(l.minorSortId=i),!s.peerId){var c=o.folder.slice();o.folder=o.folder.sort(yi),f.default.redrawFolder(c)}}function en(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),r=n.rolls,o=n.peers,s=o[e.peerId],l=s.isIncomingMR,c=s.isRejectedMR;r.peer[e.peerId].length||(l||c?Object(Le.arrayRemove)(r.mrs,e.peerId):(Object(Le.arrayRemove)(r.folder.all,e.peerId),Object(Le.arrayRemove)(r.folder.unread,e.peerId),Object(Le.arrayRemove)(r.folder.unrespond,e.peerId)),"mrs"===i.page?Object(Le.arrayRemove)(a.mrs,e.peerId):"important"!==i.folder&&Object(Le.arrayRemove)(a.folder,e.peerId)),r.peer[e.peerId]=r.peer[e.peerId].filter(unique).sort(asc),l||c?r.mrs=r.mrs.filter(unique).sort(yi):(0===s.countUnread&&(r.folder.unread=r.folder.unread.filter((function(t){return t!==e.peerId}))),r.folder.all=r.folder.all.filter(unique).sort(yi),r.folder.unread=r.folder.unread.filter(unique).sort(yi),i.groupId&&(r.folder.unrespond=r.folder.unrespond.filter(unique).sort(yi))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(yi),f.default.redrawMRs()):"important"===i.folder?(Object(Le.arrayRemove)(a.folder,t),f.default.redrawFolder()):"all"===i.folder?(a.folder=a.folder.filter(unique).sort(yi),f.default.redrawFolder()):"unread"===i.folder?(0===o[e.peerId].countUnread&&Object(Le.arrayRemove)(a.folder,e.peerId),a.folder=a.folder.filter(unique).sort(yi),f.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(yi),f.default.redrawFolder())}function tn(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var a=Object(st.getKeyboardState)(e);if(!(Date.now()-a.updateTime<=500)){var r=a.updateTime;ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){r===a.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&h.default.renderKeyboardIfNeeded({update:!0}))}))}}}function nn(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),Ye.default.redrawImportant(e,t)}function an(e){ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){storeMethods.injectMail(t),Ye.default.updateAdTag(e)}))}function rn(e,t){var n=store.mail,i=n.rolls,a=n.peers,r=n.scraps,o=n.cur,s=a[e];if(s){s.isMarkedUnread=t;var l=function(n){return t?n.concat(e):n.filter((function(t){return t!==e}))};if(i.folder.unread=l(i.folder.unread).filter(unique).sort(yi),"unread"===o.folder){var c=r.folder.slice();r.folder=l(r.folder).filter(unique).sort(yi),f.default.redrawFolder(c)}Ye.default.redrawUnread(e)}}function on(e){var t;nav.getQuery("community")||(t=e,setNotify(t),menu.refreshSingleCounter(rt.COUNTERS_POS_MESSAGES,t));var n=store.mail.cur;n&&(n.countUnread=e,C.redrawCounter(),Ji(e)),navigator.setAppBadge&&navigator.setAppBadge(e)}function sn(e){wt.SAKIntegration.isIntegrated&&wt.SAKIntegration.sendMessage("incoming_call",e)}function ln(){im.pause(),hn((function(){im.resume()}))}function cn(e,t,n,i){void 0===i&&(i={}),function(e,t,n){void 0===n&&(n={});if(store.mail&&store.mail.cur&&"msg"!==store.mail.cur.page&&store.mail.cur.peerId!==e)return;switch(n.type){case"show_snackbar":if(n.text){var i=store.mail.members[t],a=(store.mail.peers[e],!1);e>2e9&&i&&(a=i.avatar),Snackbar.init({position:$e.SNACKBAR_POSITION_MAIL,text:Object(ot.emojiToHTML)(htsc(n.text)),avatar:a,avatar_position:"left"})}break;case"open_app":var r=makeUrl("/app"+n.app_id,{from:nav.cur.slice(1)});nav.hard_go(r+"#"+n.hash);break;case"open_link":var o=Object(St.wrapAwayIfExternal)(n.link,!0),s=store.mail.members[t],c=Object(Ct.parseURL)(n.link),u=c.host||c.hostname||o;u.startsWith("xn--")&&(u=ze.a.toUnicode(u));var d=l.default.elem(Object(kt.default)({scrollable:!0,header:{title:lang.mobile_mail_callback_popup_title},content:[l.default.wrap(lang.mobile_mail_callback_popup_text.replace("{name}",s.name).replace("{domain}",u)),{class:"Popup__buttons",inner:Object(Et.default)({inner:[Object(E.default)({inner:[lang.mobile_open],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"regular",url:o,open_in_new_tab:!0}),Object(E.default)({inner:[lang.mobile_cancel],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"secondary"})]})}]}));kt.default.open(d,!0)}}(t,n,i),Object(st.stopCallbackButtonWaiting)(e)}function un(e){Date.now()-Dt<=500||ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&ce.redrawBanner()}))}function dn(e,t){im.pause(),ajaxRequest("/mail",{act:"get_peers",peer_ids:[t]},(function(n){Object(st.replacePeer)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(f.default.redrawFolder(),t===i.peerId?Sn(t):vn("/mail?act=show&peer="+t,{replace:!0})):i.folder&&f.default.redrawFolder(),im.resume()}))}function _n(e,t,n){var i=store.mail,a=i.cur,r=i.peers;if(a){var o=r[e];o&&(t===a.userId&&(o.isAdmin=n),n&&!Object(Le.arrayContains)(o.adminIds,t)?o.adminIds.push(t):!n&&Object(Le.arrayContains)(o.adminIds,t)&&Object(Le.arrayRemove)(o.adminIds,t))}}function fn(e,t){var n=store.mail,i=n.cur,a=n.rolls,r=n.scraps;i&&("created"!==t&&It||("created"===t&&It&&(It=!1),"created"===t?pn(e,(function(t,n){Object(st.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(yi)),i.folder&&(f.default.redrawFolder(),ce.redrawMRsHint()),i.peerId===e&&Sn(e)})):"canceled"===t||"rejected"===t?pn(e,(function(t,n){Object(st.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(Le.arrayRemove)(a.mrs,e),i.folder&&(f.default.redrawFolder(),ce.redrawMRsHint()),i.peerId===e?Sn(e):"mrs"===i.page&&(Object(Le.arrayRemove)(r.mrs,e),f.default.redrawMRs())})):"accepted"===t&&pn(e,(function(t,n){Object(st.addPeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(Le.arrayRemove)(a.mrs,e),i.folder&&(f.default.redrawFolder(),ce.redrawMRsHint()),i.peerId===e?Sn(e):"mrs"===i.page&&(Object(Le.arrayRemove)(r.mrs,e),f.default.redrawMRs())}))))}function pn(e,t){im.pause(),ajaxRequest("/mail",{act:"mrs_get_peer",peer_id:e},(function(e,n){t(e,n),im.resume()}))}function hn(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,r=t.rolls;r.folder[n.folder]=[],a.folder=[],ue.setMainLoading(!0),ajaxRequest("/mail",{act:"all"===n.folder?null:n.folder,offset:0},(function(t,o){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder||Object.keys(t.msgs).forEach((function(e){e=toInt(e);var n=t.msgs[e].peerId;r.peer[n]=(r.peer[n]||[]).concat(e).filter((function(e){return!!i[e]})).filter(unique).sort(asc)}));var s="important"===n.folder,l=s?desc:yi,c=Object.keys(s?t.msgs:t.peers).map(toInt).sort(l).filter((function(e){return-1===a.folder.indexOf(e)})),u=[].concat(c).filter(unique).sort(l);r.folder[n.folder]=u,a.folder=first(20,u),store.mail.reached.folder[n.folder]=o,f.default.redrawFolder(),C.redrawCounter(),ue.setMainLoading(!1),e&&e()}}))}function mn(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||Ri()}function vn(e,t){void 0===t&&(t={});var n=yn(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function gn(){vn("/mail?q="+store.mail.cur.query+"&tab=messages")}function An(e){var t=An;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var a="msgs"===n.tab?"&tab=messages":"",r=makeUrl("/mail?q="+e+a);yn(r),i?vn(r):t.timer=setTimeout((function(){vn(r,{replace:!0})}),300)}else vn("/mail",{replace:!0})}}function bn(){ue.setMainLoading(!1),ue.setConvoLoading(!1),An.clearTimer(),vn("/mail",{replace:!0})}function yn(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),a=store.mail,r=a.cur,s=a.scraps;if(r){var c=i.act,u=i.peer,_=i.chat,p=i.email,h=i.m,m=toInt(i.msg)||toInt(i.id)||null,v="messages"===i.tab?"msgs":"peers",g=i.q||"",b=+i.community||0;if(Zn())return Zi(n,i,e),!0;if(!Object(Ne.isNewMailPage)(n,i))return clog("[mail nav] Exit Mail"),void Ni();if((r.groupId?-r.groupId:0)===b){Zi(n,i,e),m&&(Mt=!0),f.default.clearSystemMessage2();var y=u?toInt(u):_?toInt(_)+2e9:p?-toInt(p)-2e9:null,w="unread"===c||"important"===c||"unrespond"===c||"ad_tag"===c?c:"all",O=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(c),S=!O&&!!r.page,k=r.query!==g||r.tab!==v;r.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&Object(st.saveFolderScroll)(r.folder,ue.getMainBody().scrollTop),S&&(r.page=null),k&&y&&("peers"===r.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===r.tab&&(store.mail.cur.mvk_entrypoint="message_search")),r.peerId&&!y&&g)clog("[mail nav] Peer back to Search"),r.query=g,r.peerId=null,r.tab=v,kn(),ue.setQuery(g),Tn();else if(k&&r.peerId===y)r.query=g,r.tab=v,s.search=[],r.tab!==v&&(store.mail.reached.search.msgs={}),ce.redrawView(),ue.setQuery(g),f.default.redrawSearch(),g?(clog("[mail nav] Search update"),Tn()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],ce.redrawView(),f.default.redrawSearch(),ue.setQuery("")}(),0===s.folder.length&&jn());else if(O)clog("[mail nav] Enter Page: "+c),r.page=c,r.peerId&&(r.peerId=null,kn()),r.backUrl=Fi({peerId:y}),ce.redrawView(),function(e){var t=store.mail.cur,n=ue.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=l.default.html(Ze({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(i=Object(A.MailHat_page)(),a=Object(d.default)({mix:"messenger__body",inner:[_e()]}),o.default.html(re(),i,a)),ajaxRequest(e,{},(function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e})));var i,a}(e);else{if(r.peerId&&r.peerId===y)return!0;r.peerId!==y||S&&y?y?(clog("[mail nav] Enter Dialog"),r.backUrl=Fi({peerId:y}),Sn(y,m)):(clog("[mail nav] Exit Dialog"),kn(),wn(w),jn()):y&&h?(clog("[mail nav] Peer System Msg"),store.mail.peers[y].systemMessageCode=toInt(h),f.default.updateClass("peer"),f.default.redrawSystemMessage(),ue.scrollConvoToBottom()):(r.folder!==w||S&&w)&&(clog("[mail nav] Enter Folder"),wn(w),jn())}return!0}}}function wn(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,a=n.scraps,r=n.rolls;i.folder=e,On()?hn():(t.restoreScroll?a.folder=(r.folder[e]||[]).concat():a.folder=first(20,r.folder[e]),f.default.folderSetItems(a.folder),ce.redrawView(),C.redraw()),t.restoreScroll?ue.getMainBody().scrollTop=Object(st.restoreFolderScroll)(e):ue.getMainBody().scrollTop=0}function On(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,a=t.folder[n.folder];return!a||("important"===n.folder?a.some((function(e){return!i[e]})):a.some((function(e){return!(t.peer[e]&&t.peer[e].length>0)})))}function Sn(e,t){var n=store.mail,i=n.cur,a=n.msgs,r=n.peers,o=n.scraps,s=n.rolls,l=n.reached;if(r[e]){var c=s.peer[e]||[];if(t||!(r[e].countUnread>1)||r[e].isIncomingMR||r[e].isRejectedMR){i.peerId=e,o.peer=[],wi(),t?(o.peer=[t],s.peer[e]=[],l.peer.before[e]=!1,l.peer.after[e]=!1):(o.peer=last(20,c),_()),store.mail.reached.peer.after[e]=!0,f.default.updateClass("peer"),ce.redrawView(),ue.redrawConvoLayer(),ji(),C.startStatusUpdate(),We.default.checkStickers(),f.default.peerSetItems(o.peer),Nt(),dt.ready().then((function(){h.default.init()})),t||Cn(e);var u=r[e];t&&(f.default.updateClass("peer"),ce.scrollToMsg(t)),t?In(t):In(),Object(Ot.resizePosters)(),requestAnimationFrame((function(){t||(ue.scrollConvoToBottom(),dt.ready().then((function(){ue.scrollConvoToBottom()}))),AudioMessagePlayer.redrawWaves(),requestAnimationFrame((function(){t||ue.scrollConvoToBottom()}))})),u.banner&&"birthday"===u.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{ue.setConvoLoading(!0),window._preventedCheckTop=!0,Mt=!0,i.peerId=e,o.peer=[],wi(),Ye.default.redrawUnread(e),ce.redrawView(),ue.redrawConvoLayer(),ji(),C.startStatusUpdate(),_(),f.default.peerSetItems([]),Nt(),dt.ready().then((function(){h.default.init()}));var d={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};ajaxRequest("/mail",d,(function(t,n,i){if(store.mail.cur){var r=t.rolls.peer[e];if(storeMethods.injectMail(t),l.peer.after[e]=n,l.peer.before[e]=i,c=s.peer[e]||[],(Object(Le.arrayIntersects)(r,c)||n&&0===c.length)&&(s.peer[e]=c.concat(r).filter(unique).sort(asc)),store.mail.cur.peerId===e){h.default.preventShowToBottom(),o.peer=r.slice(),geByClass1("mailScrap__items_peer").innerHTML="",f.default.updateClass("peer"),f.default.peerSetItems(r),AudioMessagePlayer.redrawWaves(),Cn(e);var u=r.find((function(e){return a[e].isUnread}));ce.scrollToMsg(u,!0,!1),requestAnimationFrame((function(){window._preventedCheckTop=!1,Mt=!1,ue.setConvoLoading(!1)}))}}}))}}else ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},(function(n){storeMethods.injectMail(n),r[e]?Sn(e,t):window.location.reload()}));function _(){i.forwardFromId&&(di(),i.forwardFromId=null)}}function kn(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;C.cancelStatusUpdate(),Di(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],wi(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),ce.redrawView(),C.redraw(),h.default.reset(),ue.cleanConvoBody(),Rt(),requestAnimationFrame((function(){m.default.setCount(0),ce.redrawMailActions(),nt.default.redraw(),requestAnimationFrame((function(){f.default.peerSetItems(i.peer)}))}))}function Cn(e){ht("read_dialog"+e,(function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0||n.isMarkedUnread?ajaxRequest("/mail",{act:"read_dialog",peer_id:e,mark_conversation_as_read:n.isMarkedUnread,hash:n.hashRead},(function(){Kn(null,e)})):setTimeout((function(){Kn(null,e)}),500)}(e)}))}function En(e,t){ht("read_dialog"+t,(function(){!function(e,t){var n=store.mail.peers;if(!n)return;Kn(null,t),ajaxRequest("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},(function(){}))}(e,t)}))}function jn(){var e=jn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,r=n.rolls,o=n.reached,s=i.folder,l=a.folder,c=r.folder[s],u="folder_"+s,d=o.folder[s]&&last(l)===last(c);if(ue.setMainLoading(0===l.length&&!d),!t[u]&&!d){var _="important"===s,p=On(),h=_?desc:yi,m=[];if(0===l.length)m=first(20,c);else{var v=c.indexOf(last(l));m=v>=0?c.slice(v+1,v+21):[]}if(m.length&&!p){var g=l.concat(m).filter(unique).sort(h);a.folder=g,f.default.folderAddItems(m)}else{t[u]=!0;var A="all"===s?null:s,b=p?0:l.length;ajaxRequest("/mail",{act:A,offset:b},(function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach((function(e){store.mail.reached.peer.after[e]=!0})),"all"!==s&&"unread"!==s||Object.keys(e.msgs).forEach((function(t){t=toInt(t);var n=e.msgs[t].peerId;r.peer[n]=(r.peer[n]||[]).concat(t).filter(unique).sort(asc)}));var d=Object.keys(_?e.msgs:e.peers).map(toInt).sort(h).filter((function(e){return-1===l.indexOf(e)})),m=c.concat(d).filter(unique).sort(h);r.folder[s]=m,n&&(o.folder[s]=n),t[u]=!1,i.folder===s&&(a.folder=m,f.default.updateClass("folder"),f.default.folderAddItems(d),ue.setMainLoading(!1),p&&(f.default.folderSetItems(a.folder),ce.redrawView(),C.redraw()))}}))}}}function Tn(){var e=Tn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,r=n.rolls,o=n.reached,s=i.tab,l=i.query,c="search_msgs_"+s+"_"+l,u=a.search,d=r.search[s][l]||[],_=o.search[s][l]&&last(u)===last(d);if(ue.setMainLoading(0===u.length&&!_),!t[c]&&!_){var p=[];if("peers"===s&&(d.length||(d=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),a=QuickSearch.getQueryREs(t.query),r=[];return a.forEach((function(e){i.forEach((function(t){n[t].title.match(e)&&r.push(t)}))})),r.filter(unique).sort(yi)}()),d.length))if(0===u.length)p=first(20,d);else{var h=d.indexOf(u);p=h>=0?d.slice(h+1,h+41):[]}if(p.length&&(a.search=u.concat(p).filter(unique).sort(yi),f.default.redrawSearch(),f.default.updateClass("search"),ue.setMainLoading(!1)),!p.length||"peers"===s){var m="msgs"===s?{act:"search",q:l,offset:a.search.length,messages:1}:{act:"search",q:l};e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){t[c]=!0,ajaxRequest("/mail",m,(function(e,n){if(store.mail.cur){t[c]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),_="peers"===s?yi:desc,p=d.concat(u).filter(unique).sort(_);r.search[s][l]=p,n&&(o.search[s][l]=n),i.tab===s&&i.query===l&&(ue.setMainLoading(!1),a.search=a.search.concat(u).filter(unique).sort(_),f.default.redrawSearch(),f.default.updateClass("search"))}}))}),300)}}}function In(e){if(!$(".load_before_closed")){var t=In,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,r=i.scraps,o=i.rolls,s=i.reached;if(a){var l=a.peerId,c=r.peer,u=o.peer[l]||[],d="peer_before_"+l,_=s.peer.before[l]&&c[0]===u[0],p=a.msgReply[l];if(ue.setConvoLoading(c.length<1&&!_),!n[d]&&!_){var m=ue.getConvoBody(),v=!Object(Le.arrayIntersects)(c,u),g=first(c),A=g?u.indexOf(g):-1,b=0===c.length?last(10,u):A>=0?u.slice(A-20,A):[];if(b.length&&!e){if(m.scrollTop>6e3&&!v)return;if(window._preventedCheckTop)return;var y=r.peer.slice(),w=c.concat(b).filter(unique).sort(asc);r.peer=w,f.default.peerAddItemsBefore(b.filter((function(e){return-1===y.indexOf(e)}))),AudioMessagePlayer.redrawWaves(),f.default.updateClass("peer"),ue.setConvoLoading(!1)}else{if(!l)return;var O={act:"show",peer_id:l,msg:c[0],direction:e?"around":"before",reply_msg_id:p},S=c[0];n[d]=!0,ajaxRequest("/mail",O,(function(t,i,_){if(store.mail.cur){e&&setTimeout((function(){Mt=!1}),10);var p=a.peerId>0&&a.peerId<2e9;store.mail.flags.isPeerProfileEnabled&&p&&(store.mail.peers[l].peerProfileData=t.peers[l].peerProfileData,ue.renderMessengerPeerProfile({tags:store.mail.peerProfileTags,tagsData:t.peers[l].peerProfileTagsData,data:t.peers[l].peerProfileData})),n[d]=!1,t.peers=[],storeMethods.injectMail(t);var g=Object.keys(t.msgs).map(toInt).filter((function(e){return-1===c.indexOf(e)})),A=c.concat(g).filter(unique).sort(asc);if(_&&(s.peer.before[l]=!0),i&&(s.peer.after[l]=!0),u=o.peer[l]||[],(Object(Le.arrayIntersects)(A,u)||_&&0===u.length)&&(o.peer[l]=(o.peer[l]||[]).concat(A).filter(unique).sort(asc)),store.mail.cur.peerId===l){if(h.default.preventShowToBottom(),m.scrollTop>6e3&&!v)return;var b=r.peer.slice();r.peer=A,f.default.updateClass("peer"),S?(f.default.peerAddItemsBefore(g.filter((function(e){return-1===b.indexOf(e)&&e<S})),!0),f.default.peerAddItemsAfter(g.filter((function(e){return-1===b.indexOf(e)&&e>S})),!0)):f.default.peerAddItemsBefore(g,!0),e&&(ce.scrollToMsg(e),ue.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),g.forEach((function(e){CasperTimer.init(e)})),ue.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),ce.expandPeerBefore(),setTimeout(ce.expandPeerBefore,100),e&&di(),h.default.redrawReply()}}}))}}}}}function Mn(){var e=Mn,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,r=n.rolls,o=n.reached;if(!Mt&&i){var s=i.peerId,l=a.peer,c=r.peer[s]||[],u="peer_after_"+s;if(!(t[u]||o.peer.after[s]&&last(l)===last(c))){var d=ue.getConvoBody(),_=!Object(Le.arrayIntersects)(l,c),p=function(){return d.scrollHeight-d.scrollTop-d.offsetHeight},h=last(l),m=h?c.indexOf(h):-1,v=m>=0?c.slice(m+1,m+21):[];if(!v.length||nav.getQuery("msg")||nav.getQuery("id")){if(!s)return;var g={act:"show",peer_id:s,msg:last(l),direction:"after"};t[u]=!0,ajaxRequest("/mail",g,(function(e,n){if(store.mail.cur){t[u]=!1,e.peers=[],storeMethods.injectMail(e);var i=Object.keys(e.msgs).map(toInt).filter((function(e){return-1===l.indexOf(e)})).sort(asc),d=l.concat(i).filter(unique).sort(asc);if(n&&(o.peer.after[s]=n),c=r.peer[s]||[],(Object(Le.arrayIntersects)(d,c)||n&&0===c.length)&&(r.peer[s]=(r.peer[s]||[]).concat(d).filter(unique).sort(asc)),store.mail.cur.peerId===s){if(p()>6e3&&!_)return;n&&f.default.updateClass("peer"),a.peer=d,f.default.updateClass("peer"),f.default.peerAddItemsAfter(i),AudioMessagePlayer.redrawWaves()}}}))}else{if(p()>6e3&&!_)return;var A=l.concat(v).filter(unique).sort(asc);a.peer=A,f.default.peerAddItemsAfter(v),f.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}An.clearTimer=function(){var e=An;e.timer&&(clearTimeout(e.timer),e.timer=null)};var Dn=!1;function Pn(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.rolls,r=t.reached,o=e.scrollTop,s=e.scrollHeight,l=e.offsetHeight;if(n){var c=n.folder,u=i.folder,d=a.folder[c],_=!(r.folder[c]&&last(u)===last(d))&&l+20>=s;if(!n.query&&o<=20&&i.folder.length&&!_){if(Dn){Dn=!1;i.folder.slice();i.folder=first(20,a.folder[n.folder]),f.default.folderCutItems(20)}}else(o>20||_)&&(Dn=!0,s-o-l<window.innerHeight&&(n.query?Tn():jn()))}}function xn(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,a=e.reached,r=n.peer,o=i.peer[t.peerId]||[];if(o.length&&last(r)===last(o)&&a.peer.after[t.peerId])ue.scrollConvoToBottom(),h.default.hideToBottom(),f.default.updateClass("peer");else{var s=t.peerId;ajaxRequest("/mail",{act:"show",peer_id:s},(function(e,t){if(store.mail.cur){var r=e.rolls.peer[s];i.peer[s]=r.slice(),storeMethods.injectMail(e),a.peer.after[s]=!0,store.mail.cur.peerId===s&&(h.default.preventShowToBottom(),n.peer=r.slice(),geByClass1("mailScrap__items_peer").innerHTML="",f.default.peerAddItemsBefore(r),f.default.updateClass("peer"),ue.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}}))}}function Ln(e){var t=Ln;t.timer||(t.timer=setTimeout((function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.msgs,r=t.peers;if(!n)return;var o=i.peer.find((function(e){return a[e]&&a[e].isUnread&&a[e].authorId!==n.viewerId})),s=e.scrollTop,l=e.scrollHeight-s-e.offsetHeight;if(o){var c=Be.default.getElem(o),u=e.scrollHeight-c.offsetTop;l-u<=100&&Cn(n.peerId)}e._prevScroll||(e._prevScroll=0),l<300&&$(".mailScrap_reachedAfter")?h.default.hideToBottom():s>e._prevScroll-5||n.peerId&&r[n.peerId].countUnread?h.default.showToBottom():h.default.hideToBottom();e._prevScroll=s}(e)}),50))}function Bn(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function Rn(e,t){var n,i=e.peerId,a=e.id,r=e.authorId,o=e.attaches,s=e.adminId,l=e.isService,c=e.isStealth,u=e.isOut,d=e.keyboard,_=e.ttl,f=e.ts,p=e.text,h=store.mail,m=(h.cur,h.peers),v=(h.msgs,h.members),g=m[i]&&m[i].pinnedMsgId===a,A=Object(Ne.getMsgSendId)(e),b=Object(st.getPendingMsg)(A,i),y=!(!b&&!e.replaced);if(wt.SAKIntegration.isIntegrated&&wt.SAKIntegration.sendMessage("add_msg",{peerId:i,attaches:o,title:m[i]?m[i].title:""}),b?(ut.mark(A,"opt_to_lp"),n=function(e){return!!e.length}(o)):n=l||o.length||g||!m[i]||!v[r]||s&&!v[s],b){var w=function(e){var t=store.mail.cur;if(Object(st.removePendingMsg)(e),dt.remove(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return at.getMsg(e)}(b),O=Object.assign({},b,{id:a,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:Bn(e),ts:f,ttl:_,text:Fn(p)});if(storeMethods.injectMsg(O),Nn(O,{existingElem:w},t),!n)return void ut.clean(A)}if(!d||!d.inline){if((d||n)&&!u&&!e.edited)Object(st.getKeyboardState)(i).updateTime=Date.now();!d||n||u||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,a=e.keyboard,r=store.mail.peers[t];Object(st.clearCallbackButtons)(t),r&&(r.keyboard=Object(Ne.prepareKeyboard)({keyboard:a,authorId:n,msgId:i}))}({peerId:i,authorId:r,msgId:a,keyboard:d})}if(n)return im.pause(),void bt({msgId:a,forcePinned:g,onTryError:function(e){var t=e.type;A&&(ut.error(A,"server_load_attach",t),ut.clean(A))},onResult:function(e){var n=e[0],r=e[1];A&&(ut.mark(A,"attach"),ut.clean(A)),store.mail.cur&&(storeMethods.injectMail(n),r&&function(e,t){var n=t.unpin,i=t.pinned,a=store.mail,r=a.cur,o=a.peers;if(n){o[e].pinnedMsg="",o[e].hasPinnedMsg=!1;var s=Ii();delete s[e],Mi(s),r.peerId===e&&(ce.redrawPinnedMsg(),ji())}else i&&(o[e].pinnedMsg=i,o[e].hasPinnedMsg=!0,r.peerId===e&&(ce.redrawPinnedMsg(),ji()))}(i,r),Nn(n.msgs[a],{isStealth:c,isServerMsg:!0,isReplace:y},t),im.resume())}});var S=function(e){var t,n=e.peerId,i=e.id,a=e.authorId,r=e.isOut,o=e.text,s=e.ts,l=e.flags,c=e.adminId,u=e.isService,d=e.ttl,_=e.isExpired,f=store.mail,p=f.cur,h=(f.peers,f.msgs),m=f.members,v=Object(Ne.formatTime)(s,p.timeShift),g=h[i],A="";o&&(A=o.replace(/<br>/g,"\n").replace(Ne.MENTION_DOMAIN_REGEXP,"@$3").replace(Ne.MENTION_REGEXP,"@$1 ($3)"));t=e.replaced?!!g&&g.edited:!!e.edited;var b=o,y=Fn(o,l),w=e.keyboard;w=w&&w.inline?Object(Ne.prepareKeyboard)({keyboard:w,authorId:a,msgId:i}):null;var O={id:i,peerId:n,authorId:a,ts:s,date:v,dateShort:v,text:y,textInput:A,body:b,isUnread:!g||g.isUnread,edited:t,canEdit:Bn(e),isOut:r,isService:u,keyboard:w,attaches:{},forwards:[],hasReply:!!e.hasReply,ttl:d,isExpired:Boolean(_)};c&&(O.adminName=c===p.userId?lang.mobile_mail_you:m[c].name,O.adminUrl=m[c].url);return O}(e);storeMethods.injectMsg(S),Nn(S,{isStealth:c,isReplace:y},t)}function Nn(e,t,n){var i=void 0===t?{}:t,a=i.isStealth,r=i.isServerMsg,o=i.isReplace,s=i.existingElem,l=store.mail,c=l.cur,u=l.peers,d=(l.msgs,l.members,l.rolls),_=l.scraps,p=l.reached,m=e.peerId,v=(e.keyboard,e.authorId),g=e.isOut,A=e.id,b=!g,y=u[m]&&0===u[m].countUnread&&b,w=o||!!e.edited,O=u[m],S=O.isIncomingMR,k=O.isRejectedMR,E=ue.getConvoBody(),j=!1;e.isUnread&&(j=c.viewerId===m||c.peerId===m&&b&&E.scrollHeight-E.scrollTop-E.offsetHeight<400&&!!$(".mailScrap_reachedAfter")),j&&b&&!S&&!k&&En(A,m);var T=u[m];if(n&&T&&(T.minorSortId=n),T&&(e.groupCall?T.groupCallMsg=A:T.groupCallMsg===A&&(T.groupCallMsg=void 0)),!w){var I=last(d.peer[m]||[]);d.peer[m]=(d.peer[m]||[]).concat(A).filter(unique).sort(asc),a||S||k||(d.folder.all=d.folder.all.concat(m).filter(unique).sort(yi),p.peer.after[m]||(p.peer.after[m]=!0,p.peer.before[m]=!1));var M=u[m];if(b&&(m===c.peerId&&h.default.renderKeyboardIfNeeded({update:!0}),a||(S||k||(d.folder.unread=d.folder.unread.concat(m).filter(unique).sort(yi)),r||(M.countUnread||(M.countUnread=0),M.countUnread+=1)),m!==c.peerId&&a||h.default.redrawToBottom()),!a&&!S&&!k)if(y&&(c.countUnread+=1,C.redrawCounter()),c.groupId&&(b?d.folder.unrespond=d.folder.unrespond.concat(m).filter(unique).sort(yi):Object(Le.arrayRemove)(d.folder.unrespond,m)),"all"===c.folder){var D=_.folder.slice();_.folder=_.folder.concat(m).filter(unique).sort(yi),f.default.redrawFolder(D)}else if("unread"===c.folder&&v!==c.viewerId){var P=_.folder.slice();_.folder=_.folder.concat(m).filter(unique).sort(yi),f.default.redrawFolder(P)}else if("unrespond"===c.folder){var x=_.folder.slice();b?_.folder=_.folder.concat(m).filter(unique).sort(yi):Object(Le.arrayRemove)(_.folder,m),f.default.redrawFolder(x)}if(S&&(d.mrs=d.mrs.concat(m).filter(unique).sort(yi),"mrs"===c.page)){var L=_.mrs.slice();_.mrs=_.mrs.concat(m).filter(unique).sort(yi),f.default.redrawMRs(L)}if(c.peerId!==m||!Object(Le.arrayIntersects)(_.peer,d.peer[m])&&0!==_.peer.length||last(_.peer)!==I)s&&s.remove();else{_.peer.slice();_.peer=_.peer.concat(A).filter(unique).sort(asc);var B=Hn((function(){s?f.default.peerAddElemAfter(A,s):f.default.peerAddItemsAfter([A])}));b&&!B&&h.default.showToBottom(),v===c.viewerId&&f.default.removeDivider()}var R=Object(it.uTyping_getPeerTyping)(m);R&&R.users.length&&(Object(st.removePeerTypingUser)(m,v),m===c.peerId&&nt.default.redraw(),Ye.default.redrawTyping(m))}var N=A===Object(Ye.uConvo_getLastMsgId)(m);w&&(Object(st.clearCallbackButtons)(m,A),N?Hn((function(){return f.default.peerReplaceItems([A])})):f.default.peerReplaceItems([A])),!a&&N&&(Ye.default.redrawLastMsg(m),Ye.default.redrawUnread(m),StickersAnimation.checkSettingsAndLoad(e.id)),CasperTimer.init(e.id),m===c.peerId&&AudioMessagePlayer.redrawWaves(),e.attaches&&e.attaches.gift&&We.default.checkStickers({force:!0,ignore_hash:!0})}function Fn(e,t){return void 0===t&&(t=0),e=Object(Ne.wrapLinks)(e,t),e=Object(Ne.wrapMention)(e),e=Object(ot.emojiToHTML)(e)}function Hn(e){var t=ue.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&ue.scrollConvoToBottom(),i}function Un(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,Rt(),e)history.back();else vn(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):(e.tab||e.peerId,"/mail")}(),{replace:!0})}}function Vn(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach((function(e){delete t[e]})),Be.default.unselectAll(),ce.redrawMailActions(),n&&Sn(n)}var $n={};function Wn(e,t,n){var i=store.mail,a=i.cur,r=i.peers,o=r?r[e]:null;if(o&&!o.isIncomingMR&&!o.isRejectedMR){var s=Object(st.filterPeerTypingUser)({type:"text",users:t,count:n},a.viewerId);Object(st.setPeerTyping)(e,s);var l=$n[e];l&&clearTimeout(l),s.count&&s.users.length&&($n[e]=setTimeout((function(){$n[e]=null,Wn(e,[],0)}),7e3),Vi(s.users,e)),e===a.peerId&&nt.default.redraw(),Ye.default.redrawTyping(e)}}var qn,zn,Yn={};function Qn(e,t,n){var i=store.mail,a=i.cur,r=i.peers;if(r?r[e]:null){var o=Object(st.filterPeerTypingUser)({type:"audio",users:t,count:n},a.viewerId);Object(st.setPeerTyping)(e,o);var s=Yn[e];s&&clearTimeout(s),o.count&&o.users.length&&(Yn[e]=setTimeout((function(){Yn[e]=null,Qn(e,[],0)}),7e3),Vi(o.users,e)),e===a.peerId&&nt.default.redraw(),Ye.default.redrawTyping(e)}}function Gn(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,a=e.lastActionTime,r=store.mail,o=r.cur,s=r.peers[t];s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),a&&(s.lastActionTime=a),Ye.default.redrawOnline(t),o.peerId===t&&C.redrawOnline())}function Kn(e,t){var n=store.mail,i=n.cur,a=n.peers,r=n.msgs,o=n.scraps,s=n.rolls;if(i){var l=i.peerId===t?o.peer:[],c=s.peer[t]||[],u=a[t];if(c.concat(l).forEach((function(e){var t=r[e];t&&t.isUnread&&t.authorId!==i.viewerId&&(delete t.isUnread,Be.default.markAsRead(e))})),u?u.countUnread&&(i.countUnread-=1,u.countUnread=0):i.countUnread-=1,Object(Le.arrayRemove)(s.folder.unread,t),"unread"===i.folder){var d=o.folder.slice();Object(Le.arrayRemove)(o.folder,t),f.default.redrawFolder(d)}C.redrawCounter(),h.default.redrawToBottom(),Ye.default.redrawUnread(t)}}function Xn(e,t){var n=store.mail,i=n.cur,a=n.msgs,r=n.rolls,o=n.scraps,s=r.peer[t]||[];if(a[e])for(var l=s.indexOf(e);l>=0;){var c=a[s[l]];c.authorId===i.viewerId&&c.isUnread&&(delete c.isUnread,Be.default.markAsRead(c.id)),l--}else last(s)&&e<=last(s)&&s.forEach((function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,Be.default.markAsRead(t.id))}));i.peerId===t&&o.peer.forEach((function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,Be.default.markAsRead(t.id))})),Ye.default.redrawUnread(t)}function Jn(){if(Zn())return!0;var e=store.mail.cur;if(e&&(e.backUrl=null),e&&e.forwardFromId)return Vn(),!0;ye.default.safari_mobile&&document.activeElement.blur();var t=qs2obj(location.search.slice(1)).act;if(!$(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==t)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var n=new RegExp(/z=photo/).test(location.search);if($(".uMessenger")&&!n&&!ge("z_photoview")&&!ge("StoriesView")){var i=yn(location.pathname+location.search);return i&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),i}}function Zn(){var e=Zn;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout((function(){e.noAlert=!1}),10),!0}function ei(e,t,n,i){void 0===i&&(i={});var a=store.mail.cur;if(wt.SAKIntegration.isIntegrated&&!t._sak_embed_force){if(!wt.SAKIntegration.isNewMail)return ta(t),wt.SAKIntegration.sendMessage("nav",{isNewMail:Object(Ne.isNewMailPage)(e,t),path:e,query:t,url:n}),!0;if(!Object(Ne.isNewMailPage)(e,t))return ta(t),wt.SAKIntegration.sendMessage("nav",{isNewMail:!1,path:e,query:t,url:n}),a||setTimeout((function(){location.reload()})),!0}if(!("/mail"===n&&a&&a.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?vn(n):void 0}function ti(){window.isNewMail&&(store.mail.cur?Object(Ne.isNewMailPage)(location.pathname,location.search)?Ri():Ni():An.clearTimer())}function ni(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,a=t.msgSelected,r=toInt(Object.keys(a)[0]),o=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},o.pinnedMsgId=r,o.hasPinnedMsg=!0,Be.default.unselectAll(),ce.redrawMailActions(),ajaxRequest("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:r,_ajax:1})}function ii(){var e,t=store.mail,n=t.cur,i=t.msgs,a=(t.peers,t.hash),r=(t.replies,t.pendingReplies,n.msgSelected),o=toInt(Object.keys(r)[0]),s=n.peerId,l=Object(st.getPeerDraft)(n.viewerId,n.peerId),c=i[o],u=function(e){c.hasReply||l&&l.editing&&l.editing.id==o&&l.msgs&&(n.msgAttached[s]=l.msgs),c.hasReply?n.msgReply[s]=c.reply:n.msgReply[s]=null,h.default.redrawReply(),h.default.onAttachedMsgsRemove(),h.default.uiRedrawAttachments(s),h.default.setModifiers({editing:!0}),C.setModifiers({editing:!0}),ce.redrawMailActions(),ai(),h.default.setText(e)};if(n.editing==o)return e=l&&l.editing&&l.editing.id==o?l.editing.text||"":c.textInput,void u(e);n.editing=o,Pi(),ajaxRequest("/mail?act=edit_message_start",{hash:a.edit,edit_msg_id:o,peerId:s,_ajax:1},(function(e,t){Object(st.pushPeerAttachments)(n.peerId,e),u(t)}))}function ai(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach((function(t){delete e[t]})),Be.default.unselectAll(),m.default.setCount(0),ce.redrawMailActions()}function ri(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(oi);1!==Object.keys(t.msgSelected).length||n?Re.default.open({canDeleteForAll:n}):li()}function oi(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),a=vk.id,r=n[e],o=nav.getQuery().community,s=i[r.peerId];return!!r&&(r.authorId!==a&&r.authorId!==-o?s.isAdmin&&-1===s.adminIds.indexOf(r.authorId):!(r.peerId===a&&!o)&&(333!==r.peerId&&(!(Date.now()/1e3-r.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function si(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),a=n.peerId;Xt(e),ajaxRequest("/mail",{act:"delete_for_all",peer:a,ids:e+"",hash:i[a].hashRemove},(function(){})),ce.redrawMailActions()}(e),Di(!0)):li(!1,Re.default.isDeleteMessagesForAll()),Re.default.close()}function li(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,a=(n.hash,n.msgs,n.peers),r=i.peerId,o=i.msgRemoved,s=i.msgSelected,l=Object.keys(s);l.forEach((function(n){delete s[n=+n],t?Xt(n):(o[n]=!e||"spam",e?Be.default.spam(n):Be.default.remove(n))})),ajaxRequest("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:r,ids:l.join(","),hash:a[r].hashRemove},(function(){})),ce.redrawMailActions()}function ci(){li(!0)}function ui(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,a=t.msgSelected,r=Object.keys(a),o=r.some((function(e){return!i[e].isImportant}))?1:0;r.forEach((function(e){delete a[e],i[e].isImportant!=!!o&&(o?t.countImportant++:t.countImportant--),i[e].isImportant=!!o,Be.default.toggleImportant([e],!!o)})),ajaxRequest("/mail",{act:"mark_important",ids:r,hash:n.important,val:o},(function(){})),Be.default.unselectAll(),ce.redrawMailActions()}function di(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,Object(st.setPeerDraft)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},Be.default.unselectAll(),m.default.setCount(0),h.default.redrawReply(),h.default.uiRedrawAttachments(t),ce.redrawMailActions()}function _i(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,a=t.peerId;if(!Object(Ne.isContactPeer)(a)){if(!n.replies)return di();var r=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[a]=r,i[r]=Be.default.getReplyDataFromHTML(r),Object(st.setPeerDraft)(t.viewerId,t.peerId,{reply:r,msgs:void 0},t.editing),ajaxRequest("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:r}),t.msgAttached[a]=[],t.msgSelected={},Be.default.unselectAll(),m.default.setCount(0),h.default.redrawReply(),h.default.uiRedrawAttachments(a),ce.redrawMailActions(),h.default.openKeyboard("text")}}function fi(){var e=store.mail.cur;if(e){var t=e.msgSelected,n=Object.keys(t);Object(Ne.isContactPeer)(e.peerId)||hi(n)&&(e.forwardFromId=e.peerId,e.query="",e.tab="peers",ue.setQuerySilently(""),kn({keepSelected:!0}),wn("all",{restoreScroll:!1}),jn())}}function pi(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=t.msgs,r=t.flags,o=n.msgRemoved,s=n.msgSelected,l=i[n.peerId];if(h.default.hideStickersPanel(),!o[e]){s[e]?delete s[e]:s[e]=!0;var c=Object.keys(s),u=c.length,d=1===u&&c[0]==i[n.peerId].pinnedMsgId,_=c.reduce((function(e,t){return e&&a[t].isImportant}),!0),f=c.some((function(e){return a[e].ttl}));m.default.setCount(u),m.default.setModifiers({pinned:d,important:_}),m.default.setLabels({pinned:d,important:_}),Object(Ne.isContactPeer)(n.peerId)?m.default.toggleQuickButtons(!1):m.default.toggleQuickButtons(!0),r.replies&&(1!==u||l.isIncomingMR?m.default.setReplyAvailable(!1):m.default.setReplyAvailable(!0));var p=toInt(Object.keys(s)[0]),v=1==u&&a[p];if(m.default.setEditAvailable(v&&v.canEdit&&!l.unableToWrite),m.default.setImportantAvailable(u>0&&n.viewerId>0),m.default.setForwardAvailable(hi(c)),l.canPin&&function(e){var t=store.mail.msgs[e];if(!t)return!1;return!t.noPin}(p)){var g=toInt(Object.keys(s)[0]);m.default.togglePin(1===u&&g!==l.pinnedMsgId)}else m.default.togglePin(!1);m.default.setForwardAvailable(!0),f&&(m.default.setImportantAvailable(!1),m.default.togglePin(!1),m.default.setForwardAvailable(!1)),ce.redrawMailActions()}}}function hi(e){var t=store.mail.msgs;return 0===e.filter((function(e){return t[e]&&t[e].noForward})).length}function mi(e){var t=store.mail,n=t.cur,i=t.hash,a=t.msgs[e],r="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],Be.default.restore(e),ajaxRequest("/mail",{act:r,id:e,hash:i.restore},(function(){})),a.isImportant&&(n.countImportant++,Gt(e)),f.default.redrawFolder()}function vi(e){var t=store&&store.mail&&store.mail.cur;if(t&&e){var n=store.mail.msgs[e],i=!n;if((!n||n.peerId&&n.peerId===t.peerId)&&!t.msgRemoved[e])ce.scrollToMsg(e)||(i=!0),i&&ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},(function(t){storeMethods.injectMail(t);var n=store.mail,i=n.msgs,a=n.cur;a.peerId&&i[e]&&!i[e].isDeletedForAll&&Sn(a.peerId,e)}))}}function gi(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var a=store.mail.forwards[n];if(a.peerId&&a.peerId===i.peerId&&!i.msgRemoved[e])ce.scrollToMsg(e)||ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},(function(i){storeMethods.injectMail(i);var a=store.mail,r=a.msgs,o=a.cur;o.peerId&&(!r[e]||r[e].isDeletedForAll?Ai(e,t,n):Sn(o.peerId,e))}));else Ai(e,t,n)}else Ai(e,t,n)}function Ai(e,t,n){var i=nav.getQuery();t&&"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}));var a=i&&i.chat?Object(Be.Msg_makePinnedReplyLink)(i.chat,n):Object(Be.Msg_makeReplyLink)(e,t,n);nav.go(a,null,{force:!0})}function bi(e){var t,n=store.mail.cur;n&&hi([e])&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),fi())}function yi(e,t){var n=store.mail,i=n.rolls,a=n.presend,r=n.msgs,o=n.peers,s=i.peer[t]||[0],l=Wi(a.pending[e],(function(e){return-1===e.indexOf("edit")})),c=Wi(a.pending[t],(function(e){return-1===e.indexOf("edit")})),u=last(s),d=l&&a.msgs[l].ts||0,_=c&&a.msgs[c].ts||0;if(_||(_=u&&r[u].ts||0),d)return _-d;var f=o[e]&&o[e].majorSortId||0,p=o[t]&&o[t].majorSortId||0,h=o[e]&&o[e].minorSortId||0,m=o[t]&&o[t].minorSortId||0;return f!==p?p-f:m-h}function wi(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach((function(t){return t.classList.toggle("messenger_noPullToRefresh",e)}))}}function Oi(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){Number(t.dataset.id);var n=Ii();delete n[e],Mi(n),ji()}}function Si(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=Ii();i[e]=n,Mi(i),ji()}}function ki(){var e=store.mail.cur.peerId,t=store.mail.hash;rn(e,!0),ajaxRequest("/mail",{act:"mark_dialog_as_unread",peer_id:e,hash:t.markDialogAsUnread},(function(t){t.error&&rn(e,!1)})),Un()}function Ci(e,t){var n,i=store.mail,a=i.cur,r=i.peers[a.peerId],o=r.banner;void 0!==t&&(n=r.banner&&r.banner.buttons[t],"birthday"===o.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",a.peerId)),ajaxRequest("/mail",{act:"banner_callback",hash:r.hashBanner,peer_id:a.peerId,callback_data:n&&n.callback_data}),Dt=Date.now(),r.banner=null,ce.redrawBanner()}function Ei(e){var t=$(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function ji(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=$(".pinnedMsg"),a=Ii()[n],r=i?intval(i.dataset.id):null;ce.setPinnedVisibility(r&&a!==r)}}}function Ti(){if(store.mail.cur&&store.mail.cur.peerId){var e=$(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=Ii();delete n[t],Mi(n)}}}function Ii(){return lsGet("messenger.pinHidden")||{}}function Mi(e){lsSet("messenger.pinHidden",e)}function Di(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,Pi(),!0!==e&&ajaxRequest("/mail?act=edit_message_cancel",{peerId:t.peerId}),Object(st.popPeerAttachments)(t.peerId),Object(st.setPeerDraft)(t.viewerId,t.peerId,{});var n=Object(st.getPeerDraft)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,h.default.setText(n&&n.text||""),h.default.setModifiers({editing:!1}),C.setModifiers({editing:!1}),h.default.uiRedrawAttachments(t.peerId),h.default.redrawReply();var i=ue.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&ue.scrollConvoToBottom()}}function Pi(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function xi(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,ii())}}function Li(e){var t=e.closest("."+Be.default.class);if(t){var n=Be.default.getId(t);store.mail.msgs[n].textFull=Be.default.getTextHtml(t)}}function Bi(e){vn(e)}function Ri(){if(store.mail.cur){if(window.isCustomScroll&&Object(we.restoreDocumentScroll)(),(store.mail.cur||store.mail.page)&&!store.mail.cur.peerId){Rt();var e=ue.getMainBody();e&&Pn(e)}store.mail.cur.peerId&&Nt();var t,n,i=Object(jt.getTimeFromStart)()-ajax.navStart;if(Object(Tt.isNumber)(i)&&i>=50)statlogsValueEvent("mvk_mail_loading_time",i,store.mail.cur.folder,null==(t=store.mail.rolls.folder.all)?void 0:t.length);dt.ready().then(Ui).then((function(){$i(),store.mail.cur.peerId&&(h.default.init(),Kn(0,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||ue.scrollConvoToBottom()})),im.on(),et||((et=new _t.default({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",mt),et.on("unidle",ft)),tt={},et.start(),n=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=n.mvk_entrypoint||"notifications"===n.from&&"notifications"||"",ce.startPolling(),addEvent(window,"resize",Ot.resizePosters),navigator.setAppBadge&&navigator.setAppBadge(store.mail.cur.countUnread),ct.onOpenCallback(Qi),ct.onCloseCallback(Gi),wt.SAKIntegration.onMessage.on("embed",Xi),Ji(store.mail.cur.countUnread)}}function Ni(){if(wt.SAKIntegration.onMessage.off("embed",Xi),store.mail.cur){if(ct.onOpenCallback(Qi),ct.onCloseCallback(Gi),!document.body.classList.contains("vk__page_mail"))return im.off(),pt(),void storeMethods.resetMail();Object(we.restoreDocumentScroll)(),ue.cleanConvoBody(),im.off(),pt(),ce.stopPolling(),C.cancelStatusUpdate(),f.default.resetPrevScraps(),storeMethods.resetMail()}}function Fi(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var a="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+a}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var r="";"all"!==n.folder&&(r="?act="+n.folder),i="/mail"+r}return i}function Hi(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,It=!0,store.mail.rolls.mrs=[],t.forEach((function(e){Object(st.removePeer)(e)})),ajaxRequest("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},(function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,It=!1,void Ze.cancelRejeectLoading();ce.redrawView(),vn("/mail")}),(function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,It=!1,Ze.cancelRejeectLoading()}))}function Ui(){store.mail.cur&&Object(st.queueToPresendMsgs)(dt.getItems())}function Vi(e,t){var n=store.mail.members;(e=e.filter((function(e){return!n[e]}))).length&&(Pt=Pt.concat(e),xt.push(t),Lt())}function $i(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(yi),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(yi),f.default.redrawFolder())}function Wi(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function qi(){im.abortWaiting()}function zi(e){var t=+e.getAttribute("data-msg");if(t&&!Object(Ne.isForwardedMessageId)(t)&&store.mail.cur){var n=store.mail.msgs[t],i=n&&store.mail.peers[n.peerId];i&&!n.listened&&n.authorId!==store.mail.cur.viewerId&&n.peerId===store.mail.cur.peerId&&Object(Ne.mailRequest)("/mail",{act:"listen_audiomsg",msg_id:t,hash:i.hashRead})}}function Yi(e,t){Ve.showCaptcha(e,t)}function Qi(){qn&&clearTimeout(qn),qn=setTimeout((function(){return addClass($(".messenger__layer_convo"),Ki())}),200)}function Gi(){qn&&clearTimeout(qn),qn=setTimeout((function(){return removeClass($(".messenger__layer_convo"),Ki())}),200)}function Ki(){return zn||(zn="messenger__layer_convo--iosKeyboard",lt.isIPad&&lt.isIOSChrome&&lt.iosMajor>=11&&(zn="messenger__layer_convo--iosKeyboardChrome"),zn)}function Xi(e,t){("nav"===e&&t.url&&(vn(t.url)||nav.go(t.url)),"reload_current_chat"===e)&&Sn(store.mail.cur.peerId)}function Ji(e){if(wt.SAKIntegration.isIntegrated){var t=Boolean(nav.getQuery("community"));wt.SAKIntegration.sendMessage("message_unread_counter",{isCommunity:t,count:e})}}function Zi(e,t,n){wt.SAKIntegration.isIntegrated&&(ta(t),wt.SAKIntegration.sendMessage("nav_info",{isNewMail:!0,path:e,query:t,url:n}))}function ea(){var e=store.mail.cur;if(e){var t=e.peerId,n=Object(Ne.isChatPeer)(t),i=store.mail.peers[t];if(i)if(i.groupCallMsg){var a=i.groupCallMsg,r=store.mail.msgs[a],o=Promise.resolve(r);r||(o=new Promise((function(e){ajaxRequest("/mail",{act:"get_msgs",msgs:[a]},(function(n){if(storeMethods.injectMail(n),t===store.mail.cur.peerId){var i=store.mail.msgs[a];e(i)}}))}))),o.then((function(e){e&&e.groupCall&&wt.SAKIntegration.sendMessage("call_join",{callData:e.groupCall,peerId:t})}))}else wt.SAKIntegration.sendMessage("call",{isGroup:n,peerId:t,peer:i})}}function ta(e){e&&(delete e._sak_embed_force,delete e._sak_embed_at,delete e._sak_embed_origin,delete e._sak_embed_name,delete e.forced_color_scheme_mode)}t.default=ce;window.uMessenger=ce,window.Messenger=ue},"4bPz":function(e,t,n){"use strict";n.r(t);var i=n("+cqQ");window.uVK={onReady:Object(i.default)(),onResize:Object(i.default)(),onOrientationChange:Object(i.default)()},onDOMReady((function(){if(window.isNewMail&&document.body){window.uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}}))},"4fRq":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},"4qiT":function(e,t){var n={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.store.offset?this.store.offset:this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push((function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)})))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,a=t.content,r=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),r&&window.scrollTop()+2*window.innerHeight>a.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),(function(t){e.elems.content.innerHTML+=t}))},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_link",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,(function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")}))},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,a){e.preventDefault(),this._closeUnfold(e);var r=+domData(t,"is-bookmarked"),o=r?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:o,item_type:5,item_oid:n,item_id:i,hash:a},{onDone:function(e,n,i){domData(t,"is-bookmarked",r?0:1),r?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,a){var r=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:a},{onDone:function(){r.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){a.updateList()}})}};window.AuthorPage=n},"6Mr/":function(e,t,n){"use strict";n.r(t),n.d(t,"TOOLTIP_ID_VIDEO_FILTER",(function(){return r}));var i=n("Ubt6"),a=n("nj7l");n.d(t,"setShown",(function(){return a.setShown})),n.d(t,"canShow",(function(){return a.canShow})),n.d(t,"close",(function(){return a.close})),n.d(t,"initShownTooltips",(function(){return a.initShownTooltips}));var r="mvk:video_filters";t.default=i.default,window.Tooltip={close:a.close,setShown:a.setShown,initShownTooltips:a.initShownTooltips,initEnabledTooltips:a.initEnabledTooltips}},"75Qd":function(e,t,n){"use strict";n.r(t);n("XCiN");var i,a,r=n("OcsD"),o=n("aJgW"),s=n("CQvH"),l=n("a0wW"),c=n("z9sQ"),u=n("+cqQ"),d=n("TYsd"),_=n("Cbap"),f=n("tgcV"),p=n("FbVm"),h=n("r0fY"),m=n("T24x"),v=new p.ProductionStatCollector,g=new p.NavigationStatCollector(v);m.default.onChanged((function(){return g.addStatEvent(g.getModule(),p.NavigationProductionStatEventTypes.GO)})),function(e){e.PAYMENT_FORM="payment_form",e.PAYMENT_FORM_CLICK_OFFER="payment_form_click_offer",e.PAYMENT_FORM_CLICK_PAY="payment_form_click_pay",e.PAYMENT_FORM_CLICK_CLOSE="payment_form_click_close",e.PAYMENT_FORM_CHANGE_CLICK_CHANGE="payment_form_change_click_change",e.CLICK_SHOW_MORE="click_show_more",e.WIDGET_VIEW="widget_view",e.DESCRIPTION_VIEW="description_view"}(i||(i={})),function(e){e.PAYMENT_START="payment_start",e.DATA_ACCESS="data_access",e.RESULT_PAYMENT_SUCCESS_OK="result_payment_success_ok",e.RESULT_PAYMENT_SUCCESS_WAITING="result_payment_success_waiting",e.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT="result_payment_success_waiting_timeout",e.RESULT_RESUB_SUCCESS_WAITING="result_resub_success_waiting",e.RESULT_RESUB_SUCCESS_WAITING_OK="result_resub_success_waiting_ok",e.RESULT_PAYMENT_UNAVAILABLE="result_payment_unavailable",e.RESULT_PAYMENT_CANCEL="result_payment_cancel",e.RESULT_ERROR="result_error",e.CHANGE_START="change_start",e.RESULT_CHANGE_ERROR="result_change_error",e.RESULT_CHANGE_SUCCESS_OK="result_change_success_ok",e.RESULT_CHANGE_SUCCESS_WAITING="result_change_success_waiting",e.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT="result_change_success_waiting_timeout",e.RESULT_CHANGE_UNAVAILABLE="result_change_unavailable",e.UNKNOWN="donut_payment_screen_unknown"}(a||(a={}));var A=function(){return(A=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},b=new(function(){function e(){this.productionStatCollector=new p.ProductionStatCollector,this.actionStatCollector=new p.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEventAction=function(t){return this.actionStatCollector.logEvent(e.createDonutActionStatEvent(t))},e.prototype.logEventActionView=function(e){return this.logEventAction(A(A({},e),{event_type:i.PAYMENT_FORM}))},e.createDonutActionStatEvent=function(e){var t;return(t={type:h.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM})[h.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM]=e,t},e}()),y=n("HLtZ");function w(e){var t=function(e){try{return JSON.parse(e)}catch(n){var t={environment:"parseJsonError",breadcrumb:{message:"Uncaught json parse error",data:{json:e},category:"custom"}};return Object(y.logError)(n,t),{}}}(e),n=t.type_property,i=t.params;n===h.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM&&b.logEventAction({event_type:i.event_type,source:i.source,owner_id:i.owner_id})}var O=n("ZMWW"),S=n("qHA9");window.SAKIntegration=O.SAKIntegration,window.SAKIntegrationInit=function(e){e.isNewMail=Object(S.isNewMailPage)(location.pathname,location.search),O.SAKIntegration.init(e)};var k=n("BZzM"),C=(n("eGQV"),n("uQjJ"),n("jk6M")),E=(n("wcVR"),n("kr3z")),j=n("wx14"),T=n("Y6JH"),I=n("V4qE"),M=n("UxAg"),D=n("5Hhy"),P={isUploading:!1,onBeforeRemove:Object(u.default)(),onRemove:Object(u.default)("removeElem"),onStart:Object(u.default)(),onError:Object(u.default)("response"),onComplete:Object(u.default)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),(function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}})),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),a=geByTag1("input",i),r=intval((a&&a.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var o=attr("add_post_btn","data-value");o&&val("add_post_btn",o)}else r&&each(geByTag("input",t),(function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==r?this.disabled=!0:e>r&&(this.name="attach"+(e-1)+(n[2]||""))}}))}},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=P.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),a=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),a){toggleClass("cp_attachBtnEl_sel",a,e>0);var r=geByClass1("inline_upload",a);if(r||(r=geByClass1("inline_upload",a.parentNode)),r){var o=attr(r,"data-max-attaches")||10;r.disabled=e>=o}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!P._processUploadQueue||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(d.default.html(t))},attachedTpl:function(e){void 0===e&&(e={});var t=e,n=t.id,i=t.type,a=["medias_row","mr_x_wrap","thumb_upload"];i&&a.push("attachment_type_"+i);var r=Object(D.getDocument24Icon)(),o={inner:[{inner:[{inner:[{inner:[Object(T.default)({icon:r})],class:"medias_link_icon",tag:"span"}],class:"medias_link_icon",tag:"span"},{inner:[{inner:[e.label],class:"medias_link_labeled medias_link_title",tag:"span"}],class:"medias_link_texts",tag:"span"}],class:"mr_label medias_link",tag:"span"},{inner:[{class:"tu_progress",id:"item_progress_"+n,tag:"div"}],class:"tu_progress_wrap",id:"item_progress_wrap_"+n,tag:"div"},{inner:[{class:"tu_progress",id:"item_cancel_"+n,tag:"div"}],class:"tu_cancel_wrap",id:"item_cancel_wrap_"+n,onclick:"return mediaUpload.reset(this, event, '"+n+"');",tag:"div"}],id:"upload_item_"+n,class:a,tag:"div"};return ceFromString(d.default.html([o]))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)P.onUploadError.call(t,e);else{var a=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(a)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),r=P.getLastAttachId()+1,o=ge("upload_item_"+t.id);if(o&&o.classList.add("thumb_uploaded"),a?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=Object(M.$)('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n)if(e.src)var s=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(a&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(s,n),t.iw&&t.ih){if(t.iw>t.ih==s.width>s.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(s,"width",i)}reflow(s),setStyle(s,"opacity",1)},src:e.src});else{var l=ge("upload_image_"+t.id);setStyle(l,"opacity",1)}var c=t.attach_type||"photo",u=(e.hash,e.photo_raw);t.attach_type&&"photo"!==t.attach_type&&(u=e.owner_id+"_"+e.id),o&&(o.appendChild(ce("input",{type:"hidden",name:"attach"+r,value:u})),o.appendChild(ce("input",{type:"hidden",name:"attach"+r+"_type",value:c}))),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,P._processUploadQueue||(P.isUploading=!1,P.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,P.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),Snackbar.init({text:"blog"===cur.module?lang.mobile_jobs_upload_error:lang.mobile_unknown_error,type:I.SNACKBAR_TYPE_ERROR}),this.id&&P.reset(null,null,this.id),P.uploadQueueNext(),P.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=e.file_attr_name||"photo",i=JSON.parse(e.upload_params);e.xhr=uploadFile(e.upload_url,Object(j.default)(((t={})[n]=e.file,t),i),{onProgress:bind(P.onUploadProgress,e),onComplete:bind(P.onUploadComplete,e),onError:bind(P.onUploadError,e)})})),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){readFile(e.file,(function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});P.readerQueueNext()}))})),addFile:function(e){var t,n=ge("attached_wrap"),i=geByClass1("pi_medias",n),a=i?geByClass("medias_thumb",i):[],r=i?geByClass1("medias_row",i):null,o=a[a.length-1],s=e.attach_type||"photo";if(t="photo"===s?P.attachedPhotoTpl(e.id):P.attachedTpl({id:e.id,type:s,label:e.file?e.file.name:""}),n){if(window.ThumbsEdit&&ThumbsEdit.initialized)readFile(e.file,(function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,a=n.height;window.fakeImg=n;var r=getImageOrientation(t);t="/images/blank.gif";var o=!1;r>4&&r<9&&(o=!0);var s=["photo",e.id,{sizes:{temp:[t,o?a:i,o?i:a]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}}));else{if(!i){var l=geByClass1("AddedAttach",n);i=ce("div",{className:"pi_medias"}),append(i,l||n)}o?after(t,o):r?before(t,r):append(t,i)}P._processReaderQueue||P.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),P._processUploadQueue=!0;var e=P.uploadQueueRemove();if(!e)return clog("empty upload"),P._processUploadQueue=!1,void(P.isUploading=!1);P.uploadFile(e)},readerQueueNext:function(){clog("next reader"),P._processReaderQueue=!0;var e=P.readerQueueRemove();if(!e)return clog("empty reader"),void(P._processReaderQueue=!1);P.readFile(e)},queueInsert:function(e){var t=srand();return P.getUploadDataById(t)?P.queueInsert(e):(P._uploadData[t]=extend(e,{id:t}),P._uploadQueue.push(t),P._readerQueue.push(t),P._uploadData[t])},uploadQueueRemove:function(){var e=P._uploadQueue.shift();return!!e&&P.getUploadDataById(e)},readerQueueRemove:function(){var e=P._readerQueue.shift();return!!e&&P.getUploadDataById(e)},getUploadDataById:function(e){return P._uploadData[e]||!1},delUploadDataById:function(e){delete P._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return P.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),a=submitBtn(i),r=ge("attach_photo_btn"),o=attr(e,"data-upload-url"),s=attr(e,"data-upload-params"),l=domData(e,"file-attr-name"),c=domData(e,"attach-type"),u=attr(e,"data-done-url"),d=attr(e,"data-max-attaches")||10,_=P.getAttachesCount();return o&&u?(each(n,(function(){var e={attach_type:c,file_attr_name:l,upload_url:o,upload_params:s,done_url:u,file:this,uploaded:!1,attached:!1};if(_>=d)return!1;P.queueInsert(e),P.addFile(e),_++})),removeEvent(i,"submit",P.checkUploading),addEvent(i,"submit",P.checkUploading),removeEvent(a,"click",P.checkUploading),addEvent(a,"click",P.checkUploading),removeEvent(r,"click",P.checkUploading),addEvent(r,"click",P.checkUploading),P.refreshUploadState(_),replace(clone(e),e),P._processUploadQueue||P.uploadQueueNext(),window.isNewMail&&P.onStart(),P.isUploading=!0,!1):P.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&P.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),P.refreshAttachIds(e);var a=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(a)}else{var r=n,o=P.getUploadDataById(r);if(!o)return!1;o.attached?o.delete_url&&(ajax.post(o.delete_url,{_ajax:1}),P.refreshAttachIds(e)):(o.xhr&&o.xhr.abort&&o.xhr.abort(),o.loaded||P.uploadQueueNext()),i?i():remove("upload_item_"+r),P.delUploadDataById(r)}return P.refreshUploadState(),window.isNewMail&&P.onRemove(e),Replies.abortTimer("editing"),!1},onUnfoldItemClick:function(e,t){var n=Object(M.$)('[type="file"]',t);e.target!==n&&n.click()}};window.mediaUpload=P;var x=n("cGUQ"),L=n("PU8N"),B=function(e,t,n,i,a,r,o,s,l,c,u){var d=s||i,_=l||a,f=c||r||t.naturalWidth,p=u||o||t.naturalHeight;e.beginPath(),e.arc(d+n,_+n,n,Math.PI,Math.PI+Math.PI/2),e.lineTo(d+f-n,_),e.arc(d+f-n,_+n,n,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(d+f,_+p-n),e.arc(d+f-n,_+p-n,n,2*Math.PI,Math.PI/2),e.lineTo(d+n,_+p),e.arc(d+n,_+p-n,n,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,i,a,r,o,s,l,c,u),e.restore()},R=function(e,t,n,i,a,r){var o={};if("number"==typeof r)o={tl:r,tr:r,br:r,bl:r};else{var s={tl:0,tr:0,br:0,bl:0};for(var l in s)o[l]=o[l]||s[l]}e.save(),e.beginPath(),e.moveTo(t+o.tl,n),e.lineTo(t+i-o.tr,n),e.quadraticCurveTo(t+i,n,t+i,n+o.tr),e.lineTo(t+i,n+a-o.br),e.quadraticCurveTo(t+i,n+a,t+i-o.br,n+a),e.lineTo(t+o.bl,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o.bl),e.lineTo(t,n+o.tl),e.quadraticCurveTo(t,n,t+o.tl,n),e.closePath(),e.restore()};function N(e,t,n){var i=Object.assign({},{pollStickerX:157,pollStickerY:1075,pollStickerWidth:760,pollStickerHeight:391,pollStickerOffset:45},n||{}),a=i.pollStickerX,r=i.pollStickerY,o=i.pollStickerWidth,s=i.pollStickerHeight+i.pollStickerOffset;return{type:"poll",poll_id:t,poll_owner_id:e,clickable_area:[{x:a,y:r},{x:a+o,y:r},{x:a+o,y:r+s},{x:a,y:r+s}]}}var F={title:"",titleColor:"#000",titleAlign:"center",titleFontSize:58,titleFont:"TT Commons",voteButtonText:window.getLang("stories_poll_sticker_vote_button_text"),voteButtonTextAlign:"center",voteButtonTextColor:"#fff",voteButtonFontSize:49,voteButtonFont:"TT Commons",voteButtonBackgroundColor:"#3F8AE0",width:760,height:391,radius:50,offset:45,backgroundColor:"#fff",backgroundCircleColor:"#fff",backgroundCircleSize:90,foregroundCircleColor:"#3F8AE0",foregroundCircleSize:72};function H(e){return Object(L.loadImage)("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDJhMiAyIDAgMTE0IDB2MjBhMiAyIDAgMTEtNCAwVjJ6bTggMTJhMiAyIDAgMTE0IDB2OGEyIDIgMCAxMS00IDB2LTh6TTIgOGEyIDIgMCAwMC0yIDJ2MTJhMiAyIDAgMTA0IDBWMTBhMiAyIDAgMDAtMi0yeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==").then((function(t){return new Promise((function(n){var i=Object.assign({},H.defaultOptions,e||{}),a=i.title,r=i.titleColor,o=i.titleAlign,s=i.titleFontSize,l=i.titleFont,c=i.voteButtonText,u=i.voteButtonTextAlign,d=i.voteButtonTextColor,_=i.voteButtonFontSize,f=i.voteButtonFont,p=i.voteButtonBackgroundColor,h=i.width,m=i.height,v=i.radius,g=i.offset,A=i.backgroundColor,b=i.backgroundCircleColor,y=i.backgroundCircleSize,w=i.foregroundCircleColor,O=i.foregroundCircleSize,S=document.createElement("canvas"),k=S.getContext("2d");S.width=h,S.height=m+g,k.fillStyle=A,R(k,0,g,h,m,v),k.fill(),k.fillStyle=b,k.beginPath(),k.arc(h/2,y,y,0,2*Math.PI,!1),k.fill(),k.fillStyle=w,k.beginPath(),k.arc(h/2,y,O,0,2*Math.PI,!1),k.fill();k.drawImage(t,h/2-27,y-36,54,72),k.save(),k.font="500 "+s+"px "+l,k.fillStyle=r,k.textAlign=o,k.fillText(a,h/2,230),k.restore(),k.save();var C=h-75,E=(h-C)/2,j=m+g-103-35;k.fillStyle=p,R(k,E,j,C,103,29),k.fill(),k.restore(),k.save();var T=h/2,I=m+g-103+30;k.font="500 "+_+"px "+f,k.fillStyle=d,k.textAlign=u,k.fillText(c,T,I),k.restore(),n(S)}))}))}H.defaultOptions=F;var U={newAvatarUrl:"",oldAvatarUrl:"",newAvatarStrokeWidth:17,newAvatarStrokeColor:"#fff",oldAvatarStrokeWidth:17,oldAvatarStrokeColor:"#fff",baseWidth:1080,baseHeight:1920,displayWidth:375,backgroundColor:"rgba(0, 0, 0, .16)",newAvatarInBackgroundBlur:160,avatarWidth:500,title:window.getLang("stories_new_avatar_story_title_header"),titleColor:"#fff",titleTextAlign:"center",titleFont:"TT Commons",titleFontSize:69,titleLineHeight:87,titleShadowOffsetX:0,titleShadowOffsetY:4,titleShadowBlur:12,titleShadowColor:"rgba(0, 0, 0, 0.24)",pollStickerX:157,pollStickerY:1075,blobImageType:"image/jpeg",blobQuality:1};function V(e,t){var n=Object.assign({},V.defaultOptions,e||{}),i=n.newAvatarUrl,a=n.oldAvatarUrl,r=n.newAvatarStrokeWidth,o=n.newAvatarStrokeColor,s=n.oldAvatarStrokeWidth,l=n.oldAvatarStrokeColor,c=n.baseWidth,u=n.baseHeight,d=n.displayWidth,_=n.backgroundColor,f=n.newAvatarInBackgroundBlur,p=n.avatarWidth,h=n.title,m=n.titleColor,v=n.titleTextAlign,g=n.titleFont,A=n.titleFontSize,b=n.titleLineHeight,y=n.titleShadowOffsetX,w=n.titleShadowOffsetY,O=n.titleShadowBlur,S=n.titleShadowColor,k=n.pollStickerX,C=n.pollStickerY,E=n.pollStickerOptions,j=n.blobImageType,T=n.blobQuality;E=Object.assign({},{title:window.getLang("stories_new_avatar_story_poll_sticker_title")},E||{});var I=d*(u/c),M=t||document.createElement("canvas"),D=M.getContext("2d");return M.width=c,M.height=u,M.style.width=d+"px",M.style.height=I+"px",new Promise((function(e,t){Object(L.loadImages)([i,a]).then((function(n){var i=n[0],a=n[1];D.clearRect(0,0,M.width,M.height),D.fillStyle=_,D.fillRect(0,0,M.width,M.height),D.save(),D.filter="blur("+f+"px)";var c,u,d,I,P,x,R,N,F,U=(c=i.naturalWidth,u=i.naturalHeight,d=M.width,I=M.height,(F=c/u)>d/I?(R=I,N=I*F):(N=d,R=d/F),{width:N,height:R,offsetLeft:(d-N)*(P=void 0===(P=.5)?.5:P),offsetTop:(I-R)*(x=void 0===(x=.5)?.5:x)});if(D.drawImage(i,U.offsetLeft,U.offsetTop,U.width,U.height),D.restore(),"none"!==D.filter){var V=Object(L.getAverageRGB)(D);D.fillStyle="rgb("+V.r+", "+V.g+", "+V.b+")",D.fillRect(0,0,M.width,M.height)}D.save(),D.shadowOffsetX=y,D.shadowOffsetY=w,D.shadowBlur=O,D.shadowColor=S,D.font="600 "+A+"px/"+b+"px "+g,D.fillStyle=m,D.textAlign=v;var $=null==h?void 0:h.split("{br}");null==$||$.forEach((function(e,t){var n=b*t,i=M.width/2,a=M.height/2-b*$.length/2+n-395;D.fillText(e,i,a)})),D.restore();var W=(M.width-p)/2,q=Math.min(a.width,a.height),z=Math.min(i.width,i.height);D.save(),B(D,a,p/2,0,0,q,q,W-165,665,p,p),D.lineWidth=s,D.strokeStyle=l,D.stroke(),B(D,i,p/2,0,0,z,z,W+165,665,p,p),D.lineWidth=r,D.strokeStyle=o,D.stroke(),D.restore(),H(E).then((function(t){D.drawImage(t,k,C),null==M||M.toBlob(e,j,T)})).catch(t)})).catch(t)}))}V.defaultOptions=U;var W=n("fdw3"),q=n("bKAG"),z={newAvatarStoryOptions:{},onUploadedDone:Object(u.default)("resp"),fallback:function(e,t){var n=window.nav,i=e.nextSibling;return!!i&&!n.go(i)},onUploadProgress:function(e){window.photoview.updateUpload({progress:e.loaded/e.total})},onUploadComplete:function(e){var t=window.photoview,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)z.onUploadError.call(this,e);else{this.xhr=null,this.photo_res=n,this.photo_size=i.size;var a=this.static_url+i.x_src,r=i.size[0],o=i.size[1],s=Math.min(r,o);if(t.onClose=bind(z.onClose,this),t.openCrop({src:a,max_scale:s/200,onSelect:bind(z.onCropSelected,this)}),z.newAvatarStoryOptions.shouldCreateNewAvatarStory){var l;if(i.photo.sizes2&&i.photo.sizes2.length>0){var c=i.photo.sizes2.findIndex((function(e){return e[3]===i.size[0]&&e[4]===i.size[1]}));i.photo.urls2&&i.photo.urls2[c]&&(l=this.static_url+i.photo.urls2[c])}l=l||a,z.initNewAvatarStory(vk.id,l)}}},onUploadError:function(e){var t=window.photoview;clog("upload error.",e.target.responseText),t.close()},onClose:function(e){this.xhr&&this.xhr.abort&&this.xhr.abort()},onCropSelected:function(e,t,n){var i=window.photoview,a=this,r=a.photo_res,o=a.photo_size,s=o[0],l=o[1],c=Math.min(s,l),u=Math.round(e*s),d=Math.round(t*l),_=Math.round(n*c);if(a.upload_edit_url)var f=a.upload_edit_url;else f=a.base_url+"upload.php?"+Object(x.toQueryString)({act:"owner_photo_edit",_query:r,_origin:location.protocol+"//"+location.host},!0);a.xhr=ajax.plainpost(f,{_crop:[u,d,_].join(",")},(function(e){z.onCropSuccess.call(a,e)}),(function(e){z.onCropCancel.call(a)}),!0),i.updateCrop({saving:!0})},onCropSuccess:function(e){var t=window.photoview,n=this;new Promise((function(e){z.newAvatarStoryOptions.shouldCreateNewAvatarStory?z.saveNewAvatarStory().then((function(){return e(!0)})).catch((function(){return e(!1)})):e()})).then((function(i){n.xhr=ajax.post("/photos.php?act=done_photo",{_ajax:1,_query:e,_from:n.from,is_snackbar_disabled:Boolean(i)},{onDone:function(e){z.onUploadedDone(e),t.close()},onFail:function(){z.onCropCancel.call(n)}})}))},onCropCancel:function(){window.photoview.updateCrop({saving:!1})},prepareInput:function(e){e.files&&e.files.length&&(e.value="")},start:function(e,t){var n=window.photoview;if(!e||!canUploadFile())return z.fallback(e,t);var i=e.files[0]||!1,a=attr(e,"data-upload-url"),r=attr(e,"data-base-url"),o=attr(e,"data-static-url"),s=attr(e,"data-from"),l=JSON.parse(attr(e,"data-new-avatar-story-data"))||{};if(!i)return!1;if(!a)return z.fallback(e,t);var c={upload_url:a,base_url:r,static_url:o,file:i,from:s};return z.newAvatarStoryOptions=Object(j.default)({},l),c.xhr=uploadFile(a,{photo:i},{onProgress:bind(z.onUploadProgress,c),onComplete:bind(z.onUploadComplete,c),onError:bind(z.onUploadError,c)}),readFile(i,(function(e){n.updateUpload({thumb:e})})),replace(clone(e),e),n.onClose=bind(z.onClose,c),n.openUpload({src:null}),!1},initNewAvatarStory:function(e,t){var n;z.getNewAvatarStoryUploadResult=Object(f.addStatic)((n={},n[z.newAvatarStoryOptions.newAvatarStoryFontsCssPath]=null,n)).then((function(){return Promise.all([Object(L.loadFontFacePromise)("TT Commons",{weight:500}),Object(L.loadFontFacePromise)("TT Commons",{weight:600})])})).then((function(){return Promise.all([V({newAvatarUrl:t,oldAvatarUrl:z.newAvatarStoryOptions.currentPhoto,title:Object(W.getLang)("mobile_stories_new_avatar_story_title_header"),pollStickerOptions:{title:Object(W.getLang)("mobile_stories_new_avatar_story_poll_sticker_title"),voteButtonText:Object(W.getLang)("mobile_stories_poll_sticker_vote_button_text")}}),(n=z.newAvatarStoryOptions.newAvatarStoryCreatePollHash,new Promise((function(e,t){window.ajax.post(Object(L.isMvk)()?"stories.php":"al_stories.php",{act:"create_new_avatar_poll",hash:n},{onDone:e,onError:t,onFail:t})}))).then((function(e){return e||Promise.reject()})).then((function(t){return Object(q.getStoryUploadUrl)({clickable_stickers:JSON.stringify({original_width:1080,original_height:1920,clickable_stickers:[N(e,t)]}),hash:z.newAvatarStoryOptions.newAvatarStoryUploadUrlHash,entry_point:q.StoryEntryPoint.CHANGE_AVATAR,ref:window.cur.module})}))]).then((function(e){var t=e[0],n=e[1];return window.StoryPublisher.uploadStoryBlobToServer(t,n)}));var n}))},saveNewAvatarStory:function(){return z.getNewAvatarStoryUploadResult.then((function(e){var t=e.response;return Object(q.saveStoryOnServer)(t&&t.upload_result,z.newAvatarStoryOptions.newAvatarStorySaveHash).then((function(e){var t=e.story,n=t.owner_id,i=t.id;I.init({type:I.SNACKBAR_TYPE_SUCCESS,text:{inner:[{inner:Object(W.getLang)("mobile_stories_new_avatar_story_success_box_text"),attrs:{style:"margin-bottom: 8px;"}},{tag:"a",class:"link",href:"/story"+n+"_"+i,onclick:"window.ownerPhotoUpload.openNewAvatarStory(event, "+n+", "+i+")",inner:Object(W.getLang)("mobile_stories_new_avatar_story_success_box_open_story")}]}})})).catch((function(e){I.init({type:I.SNACKBAR_TYPE_ERROR,text:e&&e.message||Object(W.getLang)("global_error")})}))}))},openNewAvatarStory:function(e,t,n){e.metaKey||e.ctrlKey||(e.preventDefault(),window.Stories.init(t+"/"+t+"_"+n,{source:q.StorySource.PROFILE_SNACKBAR}))},getCropFromTag:function(e,t,n){if(!e)return!1;if(3==e.length)var i=+e[0],a=+e[1],r=+e[2];else{i=+e[0]*t/1e4,a=+e[1]*n/1e4,r=+e[2]*t/1e4;var o=+e[3]*n/1e4;if(r>o&&(i+=(r-o)/2,r=o),r<200){var s=(200-r)/2;i-=s,a-=s,r=200}r=Math.min(Math.max(r,200),Math.min(t,n)),i=Math.min(Math.max(i,0),t-r),a=Math.min(Math.max(a,0),n-r)}return[i/t,a/n,r/Math.min(t,n)]},crop:function(e){if(!e||!e.size&&!e.url)return!1;var t=window.photoview,n={upload_edit_url:e.upload_url};if(e.size){n.photo_size=e.size;var i=Math.min(e.size[0],e.size[1]);t.onClose=bind(z.onClose,n),t.openCrop({src:e.thumb,max_scale:i/200,rect:z.getCropFromTag(e.rect,e.size[0],e.size[1]),onSelect:bind(z.onCropSelected,n)})}else{var a=ce("img",{src:e.url,onload:function(){n.photo_size=[a.width,a.height];var i=Math.min(a.width,a.height);t.updateCrop({src:e.thumb,max_scale:i/200,rect:z.getCropFromTag(e.rect,a.width,a.height),onSelect:bind(z.onCropSelected,n)})}});t.onClose=bind(z.onClose,n),t.openCrop({src:!0})}return!0},generateNewAvatarStory:V,drawPollSticker:H};window.ownerPhotoUpload=z;n("+YbT");var Y=n("DM2o"),Q=n("2W9W");var G=n("wTbK"),K=n("t7Ww"),X=n("w1cP");var J,Z=function(){return[Object(K.ModalMenuHeaderCloseButton)({onClose:["DarkSchemeModal.closeAndSendStat","click_close_button","this"]}),Object(K.ModalMenuIcon)({inner:[{inner:[Object(T.default)({icon:Object(X.getImgDarkThemeIcon)()})],class:"DarkSchemeModal__icon",tag:"div"}]}),Object(K.ModalMenuTitle)({inner:[d.default.wrap(Object(W.getLang)("mobile_dark_scheme_modal_title"))]}),Object(K.ModalMenuBody)({inner:[{inner:[d.default.wrap(Object(W.getLang)("mobile_dark_scheme_modal_description"))],class:"DarkSchemeModal__description",tag:"div"},{inner:[d.default.wrap(Object(W.getLang)("mobile_dark_scheme_modal_description_additional"))],class:"DarkSchemeModal__descriptionAdditional",tag:"div"}]}),Object(K.ModalMenuBtn)({inner:[Object(W.getLang)("mobile_dark_scheme_modal_button")],url:"/settings?act=appearance",theme:"regular",size:"large",isBtn:!0,onclick:["DarkSchemeModal.goToAppearance","this","event"]})]};function ee(e){G.default.close(e)}function te(e){if(!J){var t={event:e,_ajax:1};E.default.post("/promo?act=dark_scheme_guide_close",t),J=!0}}var ne={open:function(){var e=d.default.elem(Object(G.default)({class:"DarkSchemeModal",on_overlay_click:["DarkSchemeModal.closeAndSendStat","click_overlay"],body:Z()}));o.colorScheme.applyScheme(e,o.ColorSchemeName.Dark),J=!1,G.default.open(e,!0,"",{onClose:function(){te("close")}}),Object(Y.statlogsValueEvent)("mvk_dark_scheme_guide","shown")},close:ee,closeAndSendStat:function(e,t){te(e),ee(t)},goToAppearance:function(e,t){return te("click_button"),ee(e),nav.go(e,t)}};window.DarkSchemeModal=ne;var ie=n("W9Tc"),ae=n("wMVj"),oe=n("BoyB"),le=n("YU/R"),ue=n("Fkq0"),de=n("h8oe"),_e=n("z9Td"),fe=n("RJa5"),pe=n("IetZ"),he=function(){function e(){}return e.getContainerElement=function(){return document.querySelector("."+e.CONTAINER)},e.getSection=function(t){return document.querySelector("."+e.BASE_SELECTOR+"__"+t)},e.getAllSections=function(){return Array.from(document.querySelectorAll("."+e.BASE_SELECTOR))},e.setSectionContent=function(e,t){var n=document.querySelector("."+e);n&&(n.innerHTML=t)},e.onSearchLoaded=function(t,n,i,a,r){e.toggleSearch(a,r)},e.onSearchFiltered=function(t,n){e.toggleSearch(t,n)},e.toggleSearch=function(t,n){e.getAllSections().forEach((function(e){var i=n===e?!!t:!t,a=e.querySelector(".show_more");a instanceof HTMLElement&&(i?delete a.dataset.disabled:a.dataset.disabled="1"),Object(r.toggle)(e,i)}))},e.handlePagination=function(t,n){var i=e.getSection(n.name),a=window.cdf(t);if(i&&a){var r=void 0,o=i.querySelectorAll(".AudioBlock"),s=o[o.length-1];(r=s instanceof HTMLElement&&s.dataset.view_type&&["list","music_chart_list"].includes(s.dataset.view_type)?s.querySelector(".AudioBlock__content"):i)&&r.append(a)}},e.BASE_SELECTOR="AudioSection",e.CONTAINER="AudioSerp",e}();function me(e){var t=!1,n={onStart:function(){Object(r.addClass)("wia_item--loading",this.link)},onDone:function(){var i=e.onDone&&e.onDone.apply(this,arguments);if(i){var a=i.wdHTML,o=i.data,s=i.onDoneEnd;if(a){var l=Wd.elem(a);Object(r.replace)(l,this.link.parentNode),o&&!t&&Snackbar.init({text:o.title,action:{url:o.href,text:o.undo_title,callback:function(e,i){var a=i.id;e.preventDefault(),t=!0,ajax.click(l.querySelector("a"),n),Snackbar.close(a)}}}),t=!1}s&&s()}}};return n}var ve={onDone:function(e,t,n,i){var a=Object(r.ge)(e)||Object(r.geByClass1)("like_box","z")||Object(r.geByClass1)("like_box")||Object(r.geByClass1)("wall_item_for_like_"+e);if(a&&e){var o,s,l=Object(r.geByClass1)("item_repost",a);if(Object(r.hasClass)("wall_item",a)||Object(r.hasClass)("market_item",a)||a.parentNode.classList.contains("PhotoviewPage")||a.parentNode.classList.contains("VideoPage")?s=Object(r.geByClass1)("wi_like_wrap",a):Object(r.hasClass)("ReplyItem",a)?o=Object(r.geByClass1)("ReplyItem__likeWrap",a):s=Object(r.geByClass1)("item_like",a),o||(o=Object(r.geByClass1)("like_wrap",a)),s&&(s.innerHTML=t||"",Object(r.toggleClass)("is_empty",s,!t),Object(r.toggle)(s,t)),l&&(l.innerHTML=n||"",Object(r.toggle)(l,n)),o){var c=Object(r.ceFromString)(i);a.classList.contains("wall_item")||a.classList.contains("BookmarksItem_video")||!c.classList.contains("like_wrap")?Object(r.val)(o,i||""):Object(r.val)(o.parentNode,i||"");var u=Object(ue.marketItemIdToObject)(e);if(u){var d=o.querySelector(".item_like");d&&Object(de.trackMarketEvent)({event:d.classList.contains("item_sel")?fe.ECommGoodsEvent.LIKE_ITEM:fe.ECommGoodsEvent.UNLIKE_ITEM,ownerId:u.ownerId,itemId:u.itemId,instant:!0,platform:_e.PLATFORM_MVK})}}}},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:nav.hard_go(e[0])}}},Ae={onDone:function(e,t,n,i,a){var o=window,s=o.photo;if(ve.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){Object(r.ce)("div",{innerHTML:t});var c=Object(r.ce)("div",{innerHTML:i});l.likes=Object(r.val)(u),l.likes_cnt=Object(r.intval)((Object(r.attr)(Object(r.geByClass1)("v_like",c),"data-like_count")||"").replace(/\D+/g,"")),l.likes_me=a,l.liked_people=t,l.like_buttons=i;var u=Object(r.ce)("div",{innerHTML:l.actions}),d=Object(r.geByClass1)("like_wrap",u);Object(r.val)(d,i),s.save(l)}}},onFail:ve.onFail},be={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:I.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:I.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var i=t.get(this.photo_id);i&&(i.tag_info="",t.save(i));var a=Object(r.geByClass1)("photo_view"),o=Object(r.geByClass1)("pv_tag_wrap",a);Object(r.val)(o,"")}}},ye=me({onStart:function(e){console.log(this,e)},onDone:function(e,t,n,i){var a=photo.get(t);a&&(a.isDeleted=n,photo.save(a)),Object(M.$)(".PhotoviewPage").classList.toggle("PhotoviewPage--deleted",n);return{wdHTML:e,data:i,onDoneEnd:function(){var e=Object(M.$)("#photo_actions"),t=$$(".ContextMenu__list li",e);Array.from(t).forEach((function(e){n&&"delete"!==domData(e,"name")&&Object(r.hide)(e),n||Object(r.show)(e)})),a&&(a.actions=e.innerHTML,photo.save(a))}}}}),we={onDone:function(e,t){var n=window.isNewMail&&Object(M.$)(".messenger")&&this.link.closest(".msg");if(Object(r.val)(e,t),n){var i=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[i].textFull=n.$(".msg__text").innerHTML}}},Oe={onDone:function(e){this.link&&(Object(r.after)(cdf(e),Object(r.gpeByClass)("pic_body_wrap",this.link)),Object(r.hide)(this.link))}},Se=me({onStart:function(){Object(r.addClass)("cm_item_loading",this.link)},onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};this.link&&Object(r.val)(this.link.parentNode,e)}}),ke={onDone:function(e,t,n){if(void 0===n&&(n={}),e){var i=window.photo;Object(r.remove)(e+"_msg");var a=Object(r.ge)(e);if(a){if(n.remove)re(a),re(e+"_msg");else if(t){var o=Object(r.ce)("div",{id:e+"_msg",className:(a.className||"")+" post_message_item"}),s=n.no_wrap?t:'<div class="pi_cont">'+t+"</div>";Object(r.val)(o,s),Object(r.after)(o,a),Object(r.hide)(a),Object(r.geByClass1)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else Object(r.show)(e);if(this.photo_id){var l=i.get(this.photo_id);if(l){var c=Object(r.geByClass1)("photoview"),u=Object(r.geByClass1)("comments_wrap",c);l.comments_html=Object(r.val)(u)}}}}}},Ce={onDone:function(e,t,n,i){if(e){Object(r.remove)(e+"_msg");var a=Object(r.ge)(e);if(a)if(t){var o=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=Object(r.ce)("div",{id:e+"_msg",className:o+"_item "+o+"_message_item"}),l=i||"message_item_cont";Object(r.val)(s,'<div class="'+l+'">'+t+"</div>"),Object(r.after)(s,a),Object(r.hide)(a)}else!1===t?(a.classList.add("_deleted"),Object(r.hide)(a)):Object(r.show)(a)}}},Ee={onDone:function(e,t,n){if(e){var i=Object(r.ge)(e),a=Object(r.getY)(i)||Object(r.getY)(e+"_msg"),o=Object(r.getH)(i)||Object(r.getH)(e+"_msg"),s=a+(u<320?o:0)-Object(r.scrollTop)();if(Object(r.remove)(e+"_msg"),i){var l=Object(r.hasClass)("wall_item",i)||Object(r.hasClass)("post",i)?"wall":"post";if(n){var c=Object(r.ce)("div",{id:e+"_msg",className:l+"_item post_message_item"});Object(r.val)(c,'<div class="pi_cont">'+n+"</div>"),Object(r.after)(c,i)}if(t){Object(r.each)(Object(r.geByClass)(l+"_item"),(function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),i=Object(r.attr)(this,"data-copy"),a=!!i&&i.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||a&&a[1]==t)&&Object(r.toggleClass)("post_item_ignored",this,n)}));var u=Object(r.getCw)(),d=(a=Object(r.getY)(i)||Object(r.getY)(e+"_msg"),o=Object(r.getH)(i)||Object(r.getH)(e+"_msg"),a+(u<320?o:0)-s);Object(r.geByClass1)("wall_item")===i&&(d=0),Object(r.scrollTop)(d);var _=Object(M.$)(".ContextMenu",i);_&&le.default.close(_)}}}}},je={onDone:function(e,t){if(e){var n=Object(r.ge)(e);if(Object(r.remove)(e+"_msg"),n&&t){var i=Object(r.hasClass)("wall_item",n)||Object(r.hasClass)("post",n)?"wall":"post",a=Object(r.ce)("div",{id:e+"_msg",className:i+"_item post_message_item"});Object(r.val)(a,'<div class="pi_cont">'+t+"</div>"),Object(r.after)(a,n)}Object(r.toggleClass)("post_item_ignored",n,t)}}},Te={onDone:function(e,t,n){if(e){var i=Object(r.ge)(e);if(Object(r.remove)(e+"_msg"),i){if(n){var a=Object(r.ce)("div",{id:e+"_msg",className:"wall_item post_message_item"});Object(r.val)(a,'<div class="pi_cont">'+n+"</div>"),Object(r.after)(a,i)}Object(r.toggleClass)("post_item_ignored",i)}}}},Ie={onStart:function(){var e=Object(r.gpeByClass)("show_more_wrap",this.link),t=Object(r.geByClass1)("show_more",e)||this.link,n=Object(r.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),i=Object(r.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent"});Object(r.attr)(n,"data-href",Object(r.getHref)(t)),i.appendChild(n),Object(r.before)(i,e),Object(r.remove)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=Object(r.ge)("show_more_wrap"),i=cdf(e);Object(r.before)(i,n),Object(r.remove)(n),ajax.prepare_click("mcont"),Object(r.onBodyScrollForce)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),ajax.onPostsLoad(),Gif.onUpdate(),window.UnauthorizedFeed&&UnauthorizedFeed.onUpdate(),Object(k.resizePosters)()}},Me={onStart:Ie.onStart,onDone:function(e){Ie.onDone.apply(null,arguments),Object(pe.cutTextToHighlight)(".SearchItemServicesInfo__textMatch")}},De={onStart:Ie.onStart,onDone:function(e,t){Ie.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},Pe={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=Object(r.geByClass1)("photos_page","mcont"),a=Object(r.ge)("show_more_wrap"),o=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var s=cdf(e);i&&i.appendChild(s),Object(r.before)(o,a),Object(r.remove)(a),ajax.prepare_click("mcont"),Object(r.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),Object(k.resizePosters)()}},xe={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=Object(r.geByClass1)("audios_block",Object(r.geByClass1)("audios","mcont")),a=Object(r.ge)("show_more_wrap"),o=cdf(t),s=cdf(e);i&&i.appendChild(s),Object(r.before)(o,a),Object(r.remove)(a),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},Le={onStart:Ie.onStart,onDone:function(e,t){var n=window.cur,i=e[0],a=e[1],o=Object(r.ge)("show_more_wrap");ajax.tAlProcess=Date.now(),he.handlePagination(i,t),Object(r.remove)(o);var s=he.getSection(t.name);s&&s.appendChild(cdf(a)),ajax.prepare_click("mcont"),Object(r.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=Date.now()}},Be=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(r.ge)(e);i&&i.parentNode&&t&&Object(r.replace)(cdf(t),i.parentNode)}}),Re=me({onDone:function(e,t,n){return void 0===n&&(n={}),n.snackbar&&Snackbar.init(n.snackbar),{wdHTML:e,data:t}}}),Ne={onStart:function(){Object(r.addClass)("mva_item_loading",this.link)},onDone:function(e,t){Object(r.removeClass)("mva_item_loading",this.link),ownerPhotoUpload&&ownerPhotoUpload.newAvatarStoryOptions.shouldCreateNewAvatarStory&&(ownerPhotoUpload.newAvatarStoryOptions={}),e.upload_url||t&&nav.hard_go(t),ownerPhotoUpload&&ownerPhotoUpload.crop(e)||t&&nav.hard_go(t)},onFail:function(){Object(r.removeClass)("mva_item_loading",this.link)}},Fe={onStart:function(){var e=this.link,t=Object(r.gpeByClass)("notify_lite",e);if(t)return Object(r.remove)(t);for(;e=e.parentNode;)if(Object(r.hasClass)("notify_item",e)){Object(r.hasClass)("notify_panel",e.parentNode)?Object(r.remove)(e.parentNode):Object(r.remove)(e);break}}},He={onStart:function(){var e=Object(r.geByClass)("pagination","mcont");Object(r.each)(e,(function(e,t){Object(r.before)(Object(r.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t,n){var i=window.mail,a=Object(r.ge)("messages"+t);a&&(Object(r.val)(a,e),i.onMessagesRepainted(!0),!this.save&&Object(r.scrollToEl)()),this.save&&i.saveDialog({messages:e},t),this.clear&&(Object(r.val)(Object(r.geByTag1)("textarea","write_form"),""),Object(r.remove)(Object(r.geByClass1)("pi_medias","write_form"))),Object(r.removeClass)("cp_attach_btn_sel",Object(r.geByClass1)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},Ue={onStart:function(){var e=Object(r.geByClass)("pagination","mcont");Object(r.each)(e,(function(e,t){Object(r.before)(Object(r.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t){var n=window.mail,i=Object(r.ge)("dialogs");i&&(Object(r.val)(i,e),!this.no_scroll&&Object(r.scrollToEl)(),n.cacheDialogsPage()),n.save(t)}},Ve={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},$e={onStart:function(){var e=Object(r.gpeByClass)("friendsList__showMoreBtnWrap",this.link),t=Object(r.geByClass1)("friendsList__showMoreBtn",e)||this.link,n=Object(r.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),i=Object(r.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent friendsList__showMoreBtnWrap"});Object(r.attr)(n,"data-href",Object(r.getHref)(t)),i.appendChild(n),Object(r.before)(i,e),Object(r.remove)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout((function(){ajax.post(t,{_ajax:1},{onDone:$e.onDone.bind(e),onFail:$e.onFail.bind(e)})}),500)},onDone:Ie.onDone},We=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(r.ge)(e);i&&i.parentNode&&t&&Object(r.replace)(cdf(t),i.parentNode)}}),qe=me({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(r.geByClass)(e);if(i.length&&t)for(var a=0,o=i.length;a<o;a++)i[a].parentNode&&Object(r.replace)(cdf(t),i[a].parentNode)}}),ze={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,i,a){if(e){var o=Object(r.geByClass)(e);if(o.length&&t)for(var s=0,l=o.length;s<l;s++)o[s].parentNode&&Object(r.replace)(cdf(t),o[s].parentNode);Share.setBookmarkState(i,a),n&&Bookmarks.showSuccessSnack(n);var c=Object(ue.parseBookmarkedProductClass)(e);c&&Object(de.trackMarketEvent)({event:a?fe.ECommGoodsEvent.ADD_ITEM_TO_BOOKMARKS:fe.ECommGoodsEvent.REMOVE_ITEM_FROM_BOOKMARKS,ownerId:c.ownerId,itemId:c.itemId,instant:!0})}}},Ye=me({onDone:function(e,t,n,i,a,o){if(!e)return{wdHTML:a,data:o};var s=Object(r.ge)(e);if(!s)return{wdHTML:a,data:o};var l=Object(r.geByClass1)("wia_close",s);if(l&&(Object(r.val)(l,n),l.href=t),!Object(r.hasClass)("single_wall_item",s))return{wdHTML:a,data:o};var c=Object(r.ge)("nc_form"),u=Object(r.geByClass1)("wall_replies");return c?Object(r.toggle)(c,!!i):i&&(u?domInsert(u,i):(domInsertAfter(Object(r.ce)("div",{innerHTML:i}),s),u=Object(r.geByClass1)("wall_replies"))),Object(r.toggleClass)("closed_comments",u,!i),{wdHTML:a,data:o}}}),Qe={onStart:function(){var e=domPN(this.link),t=Object(r.geByClass1)("Loading",e);t||(t=Object(r.ceFromString)(Object(oe.default)({})),append(t,e)),Object(r.addClass)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,i){var a,o=domPN(this.link),s=Object(r.hasClass)("RepliesThreadNext_prev",o),l=0,c=cdf(e);if(domChildren(c).forEach((function(e){Object(r.ge)(e.id)&&re(e)})),s?(a=Object(r.gpeByClass)("wall_replies",o),l=Object(r.getH)(a),Object(r.after)(c,o)):Object(r.before)(c,o),i?(this.link.href=i,Object(r.removeClass)("RepliesThreadNext_loading",o)):re(o),Gif.onUpdate(),Object(k.resizePosters)(),n&&(cur.replyNames=Object(r.extend)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),s){var u=Object(r.getH)(a)-l;Object(r.scrollTop)(Object(r.scrollTop)()+u)}Object(r.onBodyScrollForce)()},onFail:function(){var e=domPN(this.link),t=Object(r.geByClass1)("i_loading",e);Object(r.hide)(t),Object(r.show)(this.link),Object(r.removeClass)("RepliesThreadNext_loading",e)}},Ge={onDone:function(e,t,n){var i=Object(r.geByClass1)("RepliesWrap");i.innerHTML=e,Gif.onUpdate(),Object(k.resizePosters)(),n&&Object(r.extend)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),Object(r.scrollTop)(Object(r.getH)(i)+Object(r.getY)(i))}},Ke={onDone:function(e,t,n,i){if(e){var a=Object(r.ge)(e);if(a){if(i)Object(r.geByClass)("ReplyItem__message_type_"+i,a).forEach((function(e){re(e)}));var o=Object(r.geByClass1)("ReplyItem__wrap",a),s=Object(r.geByClass)("ReplyItem__message",a),l=s.pop();if(t){var c=cdf(t);Object(r.hide)(l||o),Object(r.after)(c,l||o),Object(r.geByClass1)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else i||(re(l),l=s.pop()),Object(r.show)(l||o);if(n){var u=Object(r.ge)("RepliesThread"+n);u&&Object(r.toggle)(u,!t)}}}}};window.Like=ve,window.PhotoLike=Ae,window.PhotoTag=be,window.PhotoDelete=ye,window.Poll=we,window.CopyHistory=Oe,window.ToggleMenu=Se,window.Comment=ke,window.ItemDelete=Ce,window.FeedIgnore=Ee,window.FeedIgnoreItem=je,window.FeedIgnoreComments=Te,window.Wall=Ie,window.SearchServices=Me,window.Bookmark=De,window.BookmarkToggle=ze,window.Photos=Pe,window.Audios=xe,window.AudioSection=Le,window.FixPost=Be,window.ContextMenuCommonAction=Re,window.ProfileMove=Ne,window.Notify=Fe,window.Dialog=He,window.Dialogs=Ue,window.LoginCheckAuthCodePage=Ve,window.WallSubscribe=We,window.FeedSubscribe=qe,window.ImportedFriends=$e,window.CloseComments=Ye,window.RepliesNext=Qe,window.RepliesLast=Ge,window.ReplyAction=Ke,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=Object(r.ge)("mini_apps_"+e.dataset.section);t&&t.remove()}})}};var Xe={onSeen:Object(r.se)(),_seen:{},_saved:{},_saveTimer:null,_sendTimer:null,_cleanTimer:null,LS_ADS_EVENTS:"ads.events",postsGetRaws:function(e,t){var n,i=(e=ge(e)).id||"",a=attr(e,"data-copy")||"",r={};if("block_"===i.substr(0,6)){r[i]=1,r.block=i.substr(6);var o=attr(e,"data-contain");o&&(o=o.split(",")).forEach((function(e){e=e.split(":"),r[e[0]]=intval(e[1])||1}))}else(n=i.match(/^wall(adsite.*)$/))?r[n[1]]=1:(n=i.match(/^wall(-?\d+_\d+)$/))&&(r[n[1]]=1,(n=a.match(/^(-?\d+_\d+)$/))&&(r[n[1]]=-1));var s=attr(e,"data-ad-view");return s&&(r["ad_"+s]=1),r.height=t.offsetHeight,r.index=indexOf(domPN(t).children,t)-1,r},seen:function(e){var t,n,i,a,r,o,s,l,c=window.vk;((null==(t=window.UnauthorizedFeed)?void 0:t.isActive)||c.id)&&e.length&&(window._postsExtras||(window._postsExtras={}),e.forEach((function(e,t){o=e.index,l=e.block,s=e.height,Object.keys(e).forEach((function(t){"index"!==t&&"block"!==t&&"height"!==t&&"viewportHeight"!==t&&(i=e[t],a=Xe._seen[t],-1===(r=Xe._saved[t])||-1===a||1===i&&(r||a)||(n=Xe._seen[t]=i,_postsExtras[t]={index:o,block:l,height:s,viewportHeight:getCh()}))}))})),n&&(clearTimeout(Xe._saveTimer),Xe._saveTimer=setTimeout(Xe.save,2500),clearTimeout(Xe._sendTimer),Xe._sendTimer=setTimeout(Xe.send,5e3)),Xe.onSeen("1"))},save:function(){if(!lsCheck()||isEmpty(Xe._seen))return Xe._seen;var e,t,n,i,a,r=window.vk,o=Math.floor((r.ts+Math.floor((vkNow()-r.started)/1e3))/3600),s=lsGet("posts_sent")||{},l=lsGet("posts_seen")||{},c=lsGet("posts_extras")||{};for(t in window._postsExtras||(window._postsExtras={}),Xe._seen)a=Xe._seen[t],_postsExtras[t]&&(c[t]={index:_postsExtras[t].index,block:_postsExtras[t].block,height:_postsExtras[t].height,viewportHeight:_postsExtras[t].viewportHeight},delete window._postsExtras[t]),"ad"!==(n=t.split("_"))[0]&&"adsite"!==n[0]&&"block"!==n[0]&&(n[0]=intval(n[0]),n[1]=intval(n[1])),i=(s[n[0]]||{})[n[1]],n[0]!=r.id&&(!i||-1==a&&i>0)&&(l[n[0]]||(l[n[0]]={}),(!l[n[0]][n[1]]||-1==a&&l[n[0]][n[1]]>0)&&(e=l[n[0]][n[1]]=o*a)),Xe._saved[t]=a;Xe._seen={},e&&(lsSet("posts_seen",l),lsSet("posts_extras",c))},getSeenData:function(){var e,t,n,i={},a={},r=[];if(lsCheck())i=lsGet("posts_seen"),a=lsGet("posts_extras")||{};else for(e in n=Xe.save()){var o=n[e],s=e.split("_");s[0]=intval(s[0]),s[0]&&(s[1]=intval(s[1])),i[s[0]]||(i[s[0]]={}),(!i[s[0]][s[1]]||-1==o&&i[s[0]][s[1]]>0)&&(i[s[0]][s[1]]=o)}for(e in i){for(t in n=[],i[e]){var l=i[e][t]>0?t:-t,c=a[e+"_"+t],u="";c?(u+=":"+(c.index||""),u+=":"+(c.block||""),u+=":"+(c.height||""),u=(u+=":"+(c.viewportHeight||"")).replace(/:+$/,"")):u="","block"!==e||cur._pstatbref||(cur._pstatbref=attr(ge(e+"_"+t),"data-ref")),n.push(l+u)}n.length&&r.push(e+"_"+n.join(","))}return r.length?{seen:i,data:r.join(";")}:""},onSend:function(e){if(!lsCheck())return extend(Xe._saved,Xe._seen);var t,n,i=lsGet("posts_seen")||{},a=lsGet("posts_sent")||{};for(t in e){for(n in e[t])a[t]||(a[t]={}),-1!=a[t][n]&&(a[t][n]=e[t][n]),(i[t]||{})[n]&&delete i[t][n];i[t]&&isEmpty(i[t])&&delete i[t]}lsSet("posts_seen",i),lsSet("posts_sent",a),clearTimeout(Xe._cleanTimer),Xe._cleanTimer=setTimeout(Xe.clean,1e4)},send:function(){var e,t,n=window.cur,i=window.vk,a=Xe.getSeenData();if(a.data){if(!i.id&&!(null==(e=window.UnauthorizedFeed)?void 0:e.isActive))return Xe.clear();var r="";(null==(t=window.UnauthorizedFeed)?void 0:t.isActive)?r="unauthorized":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur?n&&n.module?r=n.module:nav&&"/feed"==nav.cur&&(r="feed"):r="feed_podcasts";var o={_ajax:1,act:"ping",_pstat:a.data,_pstatref:r};n._pstatbref&&(o._pstatbref=n._pstatbref),ajax.post("/",o,{onDone:function(){Xe.onSend(a.seen)}}),delete n._pstatbref}},clean:function(){var e,t,n,i=window.vk,a=Math.floor((i.ts+Math.floor((vkNow()-i.started)/1e3))/3600),r=lsGet("posts_sent")||{};for(e in r){for(t in r[e])a-((n=r[e][t])>0?n:-n)>24&&delete r[e][t];isEmpty(r[e])&&delete r[e]}lsSet("posts_sent",r),Xe.cleanAdsEvents()},clear:function(){lsSet("posts_seen",{}),lsSet("posts_sent",Xe._saved=Xe._seen={}),lsSet(Xe.LS_ADS_EVENTS,Xe._lsAdsEvents={})},getStatsObj:function(e){return e=ge(e),hasClass("_stats_cont",e)?e:gpeByClass("_stats_cont",e)},getAdsEvents:function(){var e=Xe._lsAdsEvents;return e||(e=Xe._lsAdsEvents=lsGet(Xe.LS_ADS_EVENTS)||{}),e},cleanAdsEvents:function(){var e=Xe.getAdsEvents(),t=(new Date).getTime()/1e3|0,n=!1;each(e,(function(i,a){t-a>=3600&&(delete e[i],n=!0)})),n&&lsSet(Xe.LS_ADS_EVENTS,e)},checkPixelEvent:function(e,t){var n=e.getAttribute("data-ad-block-uid"),i=-1!==indexOf(["load","impression"],t);if(!n||!i)return!0;try{var a=hashCode(""+t+n),r=Xe.getAdsEvents();if(r[a])return!1;var o=(new Date).getTime()/1e3|0;r[a]=o,lsSet(Xe.LS_ADS_EVENTS,r)}catch(e){try{console.log(e.message)}catch(e){}}return!0},getPixelElements:function(e,t){var n=[];return each(geByClass(t,e),(function(){attr(this,"data-src")&&n.push(this)})),n},sendPixels:function(e){each(e,(function(){attr(this,"src",attr(this,"data-src")),attr(this,"data-src",!1),addClass("_cntr",this)}))},viewed:function(e){if(e=Xe.getStatsObj(e)){var t=Xe.getPixelElements(e,"_cntr_view");t.length&&Xe.checkPixelEvent(e,"impression")&&Xe.sendPixels(t)}},clicked:function(e){if(e=Xe.getStatsObj(e)){attr(e,"data-clicked","1");var t=Xe.getPixelElements(e,"_cntr_click");t.length&&Xe.sendPixels(t),checkPostsSeen()}}};Xe._sendTimer||(Xe._sendTimer=setTimeout(Xe.send,1e4)),window.pStats=Xe;n("Gzds"),n("kYGI");var Je=n("Qz23"),Ze=n("dONA"),et=n("zq7H"),tt=!1,nt={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return!1},opened:function(){return Object(r.hasClass)("lm_opened",window.bodyNode)},toggle:function(e,t){return Object(r.checkEvent)(e),!0},open:function(e){window.zlayer;return Object(r.checkEvent)(e),!0},close:function(e){return Object(r.checkEvent)(e),!0},fix_size:function(e){var t=Object(r.ge)("l"),n=Object(r.ge)("m"),i=Object(r.ge)("mhead"),a=i&&i.offsetHeight||0,o=nt._st||0;t&&n&&(e?n.style.minHeight="0":(o=o>a?o:0,n.style.minHeight=t.offsetHeight+o+"px"),!nt.fixed||Object(r.getCw)()<320?e?n.style.marginTop="0":(t.style.minHeight=Object(r.getCh)()+"px",n.style.marginTop=-o+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},hasMenu:function(){return window.al&&window.al.menu},isMenuHasItems:function(){return nt.hasMenu()&&Object(r.isArray)(window.al.menu)&&window.al.menu.length||Object(r.isObject)(window.al.menu)&&Object.keys(window.al.menu).length},refreshCounters:function(e){if(!nt.hasMenu())return!0;if(!e)return!0;if(Object(r.isArray)(e)&&!e.length)return!0;if(Object(r.isObject)(e)&&!Object.keys(e).length)return!0;if(Object(r.isArray)(e)&&!Object(r.isArray)(window.al.menu))return!1;if(Object(r.isObject)(e)&&!Object(r.isObject)(window.al.menu))return!1;if(Object(r.isArray)(e)&&e.length!=window.al.menu.length)return!1;if(Object(r.isObject)(e)&&Object.keys(e).length!=Object.keys(window.al.menu).length)return!1;void 0!==e[et.COUNTERS_POS_NOTIFICATIONS]&&Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[et.COUNTERS_POS_NOTIFICATIONS]),void 0!==e[et.COUNTERS_POS_MESSAGES]&&Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[et.COUNTERS_POS_MESSAGES]);var t=e[et.COUNTERS_POS_NOTIFICATIONS];"number"==typeof t&&isFinite(t)&&(Bell.setCount(t),window.store&&(store.notificationsCount=t));var n=window.al,i=Object(M.$)(".main_menu",document.getElementById("l"));return Object.entries(e).forEach((function(e){var t=e[0],a=e[1];if(void 0===a)return!0;var o=n.menu[t],s=Object(M.$)(".mmi_"+o[0],i),l=Object(M.$)(".mm_item",s),c=Object(M.$)(".mmi_wrap",s),u=Object(M.$)(".mm_counter",c);Object(r.attr)(l,"data-href",!1),a?(o[3]&&Object(r.attr)(l,"href",o[3]),u?Object(r.val)(u,a):Object(r.append)(Object(r.ce)("em",{className:"mm_counter",innerHTML:a}),c)):(o[2]&&Object(r.attr)(l,"href",o[2]),Object(r.remove)(u)),ajax.prepare_click(l)})),!0},refreshSingleCounter:function(e,t){var n;nt.hasMenu()&&(Object(r.isArray)(window.al.menu)&&((n=new Array(al.menu.length))[e]=t),Object(r.isObject)(window.al.menu)&&(n={},Object.entries(window.al.menu).forEach((function(i){i[0];var a=i[1];parseInt(a,10)===parseInt(e,10)?n[a]=t:n[a]=void 0}))),nt.refreshCounters(n))},refreshNotifications:function(e){window.store&&(store.menuNotifications=e);var t=Object(M.$)(".mmi_apps .mmi_wrap");if(t){var n=Object(M.$)('[data-id="menu-apps-notification"]',t);!e[et.COUNTERS_POS_APPS]&&n&&n.remove(),e[et.COUNTERS_POS_APPS]&&!n&&(t.innerHTML+=d.default.render(Object(Ze.default)({id:"menu-apps-notification"})))}},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&Object(r.val)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&Object(r.val)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&Object(r.val)("lm_bottom_notify",e.bn),e.lm&&Object(r.val)("l",e.lm),e.counters&&nt.refreshCounters(e.counters),e.notifications&&nt.refreshNotifications(e.notifications),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||Object(r.remove)("vk_topbar")},initEvents:function(){var e=nt.getStickedScrollingHandler();e&&(Object(r.onBodyScroll)(e),e(Object(r.scrollGetY)())),Object(r.onBodyResize)((function(){var t=Object(r.ge)("vk_wrap"),n=t&&t.offsetWidth,i=Object(r.hasClass)("_hfixed",window.bodyNode);n>=882&&nt.close(),nt.fix_size(!nt.opened(),i),e&&e(Object(r.scrollGetY)())}))},init:function(){nt.fixed=Object(r.hasClass)("_hfixed",window.bodyNode),nt.initEvents(),Object(r.addEvent)(window,"orientationchange",(function(){var e=Object(r.ge)("vk_wrap").offsetWidth,t=nt._st||0;e>=882&&t>44&&nt.close()}));var e=Object(M.$)(".leftMenu__content");e&&Object(Je.setScrollView)(e,{topBanner:!!C.default.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=Object(r.ge)("vk_wrap");nt.opened()&&Object(r.getW)(t)<882&&Object(r.preventEvent)(e)},qsOpened:!1,qsOpen:function(){nt.qsOpened||(nt.qs_st=Object(r.scrollTop)(),Object(r.addClass)("qs_opened","vk_wrap"),Object(r.addClass)("qs_opened",window.bodyNode),Object(r.getW)("vk_wrap")<882&&Object(r.scrollTop)(0),nt.qsOpened=!0)},qsClose:function(){nt.qsOpened&&(Object(r.removeClass)("qs_opened","vk_wrap"),Object(r.removeClass)("qs_opened",window.bodyNode),Object(r.getW)("vk_wrap")<882&&Object(r.scrollTop)(nt.qs_st||0),nt.qsOpened=!1)},initSearch:function(){tt||(tt=!0,Object(r.addEvent)("lm_search_items","mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(r.addEvent)(Object(M.$)(".head_search",document.getElementById("l")),"mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(r.addEvent)(document,"mousedown touchstart",(function(e){Object(r.ge)("vk_wrap");nt.qsOpened&&(nt.qsClose(),Object(r.elblur)("lm_search_field"))}),{passive:!0}))},closeSearch:function(){return!0},cancelSearch:function(){return!0},headerAction:function(e,t){return Object(r.getW)("vk_wrap")>=882?nav.go(e,t):nt.toggle()},getStickedScrollingHandler:function(){var e=Object(M.$)(".leftMenu__content"),t=document.body;if(e&&t&&t.classList.contains("_hfixed")&&!t.classList.contains("_touch")){var n,i=Object(r.scrollGetY)(),a=Object(r.scrollGetY)(),o=!1,s=function(t,n){void 0===n&&(n=0),e.style.position=t,e.style.top=n+"px",e.style.bottom=""};return function(t){if(!(t<0||t+window.innerHeight>document.body.scrollHeight||Object(r.getCw)()<882)){var l=e.getBoundingClientRect(),c=Math.round(l.top),u=Math.floor(l.height);if(0!==u){var d=document.body,_=document.documentElement;if(u+56>=Math.max(d.scrollHeight,d.offsetHeight,_.clientHeight,_.scrollHeight,_.offsetHeight))s("absolute");else if(!(u+56>_.scrollHeight)){if((t>i||t===i&&t>0)&&(n="down"),t<i&&(n="up"),i=t,u<window.innerHeight)return s("fixed"),void(a=t+c-56);switch(n){case"down":o=u+c<=window.innerHeight;break;case"up":o=0<=c-56}var f,p;o?("down"===n?(f="fixed",void 0===p&&(p=0),e.style.position=f,e.style.top="",e.style.bottom=p+"px"):s("fixed"),a=t+Math.round(e.getBoundingClientRect().top)-56):s("absolute",a)}}else s("absolute")}}}}};window.menu=nt;var it=n("wTgh"),at=n("cZev"),rt=function(){var e={},t={},n=null,i=!1,a={},o={},s={},l=null;function c(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),(function(){var e=+attr(this,"data-id");e&&t.push(e),i=rt.getPeerByMsg(e),replaceClass("_unread","_read",this)})),i){var a=ge("messages"+i);a&&e[i]&&(e[i].messages=val(a))}if(t.length)rt.sendMarkAsRead(n,t);else{var r=e[n].last_msg;rt.sendMarkAsRead(n,r?[r]:[]),rt.updateMarkAsUnread(n,!1)}}}function u(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!C.mobPlatforms[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function d(e){(0,e.updater)(document.body),each(e.caches,(function(t,n){var i=n.storage,a=n.getter,r=function(e,t){var n,i=t.split("."),a=i.length,r=e;for(n=0;n<a;n++)if(!(r=r[i[n]]))return null;return r}(i,a);if(r){var o="string"==typeof r;o&&(r=ce("div",{innerHTML:r})),e.updater(r),function(e,t,n){var i,a,r=t.split("."),o=r.length-1,s=e;for(a=0;a<o;a++)s=s[i=r[a]]||(s[i]={});s[r[o]]=n}(i,a,o?r.innerHTML:r)}}))}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0})),!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];rt.actualizeMessagesCornerCounter(n)}catch(e){}}})})),{wrapLinks:it.wrapLinks,wrapMention:st,onShowDialogFromCache:Object(r.se)(),onShowWritePageFromCache:Object(r.se)(),onShowDialogsPageFromCache:Object(r.se)(),onMessagesRepainted:Object(r.se)(),init:function(t,a){var r=window.im;window.cur.destroy.push((function(){AudioMessagePlayer.detachPlayer()})),a&&(cur.ref=a.ref,cur.refSource=a.ref_source),t&&(n=t,a&&(rt.saveDialog(a,t),e[t])),i||(i=!0,addEvent(document,C.isTouch?"touchstart":"mousedown",c)),setTimeout((function(){r.on()}))},unpinMessage:function(t){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.remove("head_actions_has_pinned")})),e.$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.classList.add("pinnedMsg_hidden")}))}})},pinMessage:function(t,n){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.add("head_actions_has_pinned")})),$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.outerHTML=n}))}})},clear:function(){nav.clear();var r=window.im;e={},t={},a={},n=null,removeEvent(document,C.isTouch?"touchstart":"mousedown",c),i=!1,r.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,(function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,rt.saveDialog(n,t)}))},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,(function(e,t){a[t]=n}))},getPeerByMsg:function(e){return a[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=ot("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=l||"",a=e.value||"";i.length==a.length&&i==a||(rt.myTyping(t,n),l=a)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();s[e]&&n-s[e]<5e3||(s[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(o[e]||(o[e]={}),o[e][t]=vkNow()):o[e]=vkNow(),rt.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),a=geByClass1("di_current_peer",i),r=geByClass1("di_typing",i);if(i){var s=[],l=vkNow();if(e>2e9)each(o[e]||{},(function(e,n){t(r,"data-u"+e)&&n&&l-n<6e3&&s.push(e)}));else{var c=o[e];t(r,"data-u"+e)&&c&&l-c<6e3&&s.push(e)}if(s.length){if(1==s.length){var u=s[0],d=t(r,"data-u"+u),_=t(r,"data-s"+u);val(r,'<i class="i_typing"></i>'+(n.mobile_mail_typing[_]||"").replace("{user}",d))}else{each(s,(function(e,n){s[e]=t(r,"data-u"+n)}));var f=s.pop();val(r,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",s.join(", ")).replace("{last_user}",f))}a.offsetWidth&&setStyle(r,"minWidth",a.offsetWidth),addClass("di_typing_now",i),setTimeout((function(){addClass("di_typing_animated",i)}),10),setTimeout((function(){rt.updateTyping(e)}),2e3)}else val(r,""),setStyle(r,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),(function(e,t){u(t,n)})),e[t]){if(e[t].write_form){var a=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,a),(function(e,t){u(t,n)})),e[t].write_form=val(a)}if(e[t].messages){a=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",a)),e[t].messages=val(a)}}},updateImportantMessages:function(n,i,a){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+a;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),d({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===a)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var a=e[n];a&&a.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:a.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})),a&&a.messages)){var t=ce("div",{innerHTML:a.messages}),n=geByClass1("_msg"+i,t),r=$('.audio-msg-track[data-msg="'+i+'"]',n);r&&r.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),a.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),mark_conversation_as_read:0===n.length,hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,(function(e,n){rt.markAsRead(t,n)}))}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var a=geByClass1("_msg"+n,i);hasClass("_read",a)||removeClass("mi_unread",a);var r=e[t];if(r&&r.messages){var o=ce("div",{innerHTML:r.messages});a=geByClass1("_msg"+n,o);hasClass("_read",a)||removeClass("mi_unread",a),r.messages=val(o)}}},markPeerAsRead:function(n,i,a){var r=ge("messages"+n);if(r&&(each(geByClass("msg_item",r),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),(c=e[n])&&c.messages)){var o=ce("div",{innerHTML:c.messages});each(geByClass("msg_item",o),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),c.messages=val(o)}var s=ge("dialogs"),l=a?"di_unread_outbox":"di_unread_inbox";if(s)(c=geByClass1("_peer"+n,s))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c)));else if(t.page){var c;o=ce("div",{innerHTML:t.page});(c=geByClass1("_peer"+n,o))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c))),t.page=val(o)}d({caches:[{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(l,t)&&(removeClass(l,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var a=e[t];if(a&&a.messages){var r=ce("div",{innerHTML:a.messages});remove(geByClass1("_msg"+n,r)),a.messages=val(r)}}ajax.click(ot(nav.path),extend({no_scroll:!0},Dialogs))},updateMarkAsUnread:function(e,t){d({caches:[{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(n){var i=$("._peer"+e,n);if(i){i.classList.toggle("di_unread_inbox",t);var a=$(".di_head",i);if(t){var r=$(".di_chat_user",i),o=document.createElement("span");o.classList.add("di_unread_cnt"),o.innerHTML="&nbsp;",a.insertBefore(o,r)}else{var s=$(".di_unread_cnt",i);s&&s.remove()}}}})},addMessage:function(t,n,i,r){if(t<2e9?delete o[t]:o[t]&&delete o[t][i],rt.updateTyping(t),!0!==r){if(t&&n&&(a[n]=t),!geByClass1("_msg"+n)){var s=e[t];if(s&&s.messages){s.msgs&&s.msgs.push(n);var l=ce("div",{innerHTML:s.messages});(u=geByClass1("di_activity",l))?(after(cdf(r),u),s.messages=val(l)):s.messages=r+s.messages,(c=ge("messages"+t))&&(val(c,s.messages),rt.onMessagesRepainted(!0))}else{var c,u;if(c=ge("messages"+t))(u=geByClass1("di_activity",c))?after(cdf(r),u):val(c,r+val(c))}}}else if(ge("dialogs")&&"/mail"==nav.path){var d=nav.getQuery();d.act||d.offset||d.q||ajax.click(ot(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,a){var r=ge("messages"+t),o=e[t];if(o&&o.messages){var s=ce("div",{innerHTML:o.messages}),l=geByClass1("_msg"+n,s);l&&(l.outerHTML=a),o.messages=val(s),val(r,o.messages)}else geByClass1("_msg"+n).outerHTML=a},getMsgHTML:function(t,n,i,a,r,o,s,l){var c=window,u=c.vk,d=c.lang,_=2&n?u.id:s&&s.from||i;if(!_)return!1;if(!ge("messages"+i))return!0;if(s.attach1||s.fwd||s.geo||s.emoji)return!1;if(s.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var f="_u"+_,p=geByClass1(f,"mcont","a"),h=stripTags(attr(p,"data-name")||val(p)||""),m=getHref(p),v=geByClass1(f,"mcont","img"),g=v&&v.src||"";if(!h||!m||!g)return!1;i=intval(i),t=intval(t),r=r&&-1==r.toString().indexOf(" ... ")&&i<2e9?r:"";var A,b,y,w=1&n?" mi_unread":"";return!(2&n)&&1&n&&(w+=w?" _unread":""),o=rt.wrapLinks(o,n),o=rt.wrapMention(o),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+ot("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,f).replace(/{{href}}/g,m).replace("{{msgClass}}",w).replace("{{edited}}",l?'<span class="mi_edited">'+d.mobile_mail_edited+"</span>":"").replace("{{photo}}",g).replace("{{time}}",(A=new Date(1e3*a),b=A.getHours(),y=A.getMinutes(),b+":"+(y<10?"0":"")+y)).replace("{{dataName}}",escapeAttr(h)).replace("{{name}}",h.split(" ").shift()).replace("{{mi_title}}",r?'<div class="mi_title">'+r+"</div>":"").split("{{text}}").join(o)},updateStickers:function(){window.cur;var t=window.post,i=e[n];if(i){var a=i.write_form?(at.default.getStickerPanel()||"").split("mail-0").join("mail"+n):"",r=ge("stickers_panel");r&&(replace(cdf(a),r),r=null,t.stickersInit())}},showDialog:function(i,a,r){window.cur;var o=window,s=o.MessagesActions,c=o.Mention,u=o.Dialog,d=window.post;if(s.hasFwdMessages())return s.attachFwdMessages(a),!1;t.scroll_top=scrollTop();var _=e[a];if(_){var f=ce("div",{innerHTML:val("m")}),p=geByClass1("mhb_back",f);if(p&&_.header){var h=ce("div");val(h,_.header),before(h.firstElementChild,p),remove(p)}var m=_.write_form?(at.default.getStickerPanel()||"").split("mail-0").join("mail"+a):"";val(geByClass1("pcont",geByClass1("mcont",f)),_.write_form+m+(a?'<div id="messages'+a+'" class="messages bl_cont">'+(_.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",f.innerHTML),d.stickersInit(),ajax.refreshLinks(_.fv_link,_.app_link),alLoadingFix(),n=a,_;var v=getHref(i);nav.go(v,null,{push_only:!0,no_push:r}),a?(l=null,rt.updateTyping(a),ajax.click(v,extend({save:a},u),{scroll:!0})):rt.onShowWritePageFromCache(!0),rt.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(_&&_.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var g=geByClass1("MentionContainer"),A=parseJSON(attr(g,"data-mentions"))||[];return A.length&&c.init({url:!1,appendTo:g,defaultItems:A,items:A,preferDomain:!0}),AudioMessagePlayer.events.on("listened",rt.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),rt.onShowDialogsPageFromCache(!0);else{var i=ot(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ot("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function ot(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,a=n&&-1===e.indexOf("community=")?"community="+n:"",r=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return a?e+(e.indexOf("?")>=0?"&":"?")+a+r:e}function st(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,(function(e,t,n,i,a){return'<a href="/'+(t+n)+'" class="mem_link">'+a+"</a>"}))}window.mail=rt,window.makeUrl=ot,window.Scroller=function(e,t){var n,i,a,r,o,s=t&&t.ignoreMouseWheel,l=t&&t.noAutoScroll,c=!isUndefined(document.ontouchmove),u=!0,d=!1,_=!1,f=!1,p=!1,h=0,m=0,v=!1,g=0,A=!1,b=!1,y=!1,w=!1;function O(e){var t=e.touches,n=getX(i),a=getY(i);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-a}}function S(e){v||(v=[]),v.push([vkNow(),e]),v=v.slice(-20)}function k(){v=!1}function E(){if(!v||v.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=v.pop(),i=v.length-1;i>=0;i--){if((a=e-v[i][0])>150)break;t=v[i]}if(!t||!n)return[0,0,0];var a,r=n[1].x-t[1].x,o=n[1].y-t[1].y,s=Math.sqrt(r*r+o*o);return(a=n[0]-t[0])?[s/a,r/a,o/a]:[0,0,0]}function j(e){"touchstart"==e.type?u=!e.touches||1==e.touches.length:"touchmove"==e.type?u=!1:"click"==e.type&&(u||(cancelEvent(e),u=!0))}function T(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||w&&e.touches&&e.touches.length>1)){if(k(),_){if(m<=1)return}else if(getW(i)-getW(a)>=0)return;f=O(e),S(p=f),y=!0,setStyle.animate(a)}}function I(e){if(f&&(w||y)){thover&&thover.cancel(e);var t=O(e);if(S(p=t),y){var n=f.x-t.x,r=f.y-t.y;if(Math.abs(n)>=Math.abs(r)&&(cancelEvent(e),w=!0),y=!1,w){var o=getY(i),s=getH(i),c=scrollTop(),u=getCh();!l&&(o-7<c?scrollTop(o-7):o+s+7>c+u&&scrollTop(o+s+7-u))}}if(w)if(cancelEvent(e),_){var v=getW(i);n=f.x-t.x;(h<=0&&n<0||h>=m-1&&n>0)&&(n/=3);var A=-h-n/v,b=d?100*A+"%":A*v;setStyle.transform(a,{translate:[b,0]})}else{var k=getW(i)-getW(a);n=f.x-t.x;if(k>0&&(k=0),(A=g-n)<k)b=k-(k-A)/3;else if(A>0)b=0+(A-0)/3;else b=g-n;x(b),setStyle.transform(a,{translate:[b,0]})}}}function M(e){if(f&&w){if(cancelEvent(e),_){var t=4.7*E()[1],n=f.x-p.x,r=getW(i),o=Math.abs(n)>=r/2;(h>0&&(o&&n<0||t>1)||h<m-1&&(o&&n>0||t<-1))&&(h+=n>0?1:-1);var s=-h,l=d?100*s+"%":s*r;f=!1,k(),L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}else{var c=function(){if(!v)return!1;var e=E(),t=e[0],n=e[1];if(k(),!t)return!1;var i=t/4.7,a=n*i-4.7*i*i/2;return i*=530,a*=140,clog("dx",a,"t",i),!(t<.1||!a)&&{dx:a,t:i}}(),u=getW(i)-getW(a);n=f.x-p.x,s=g-n;c&&(s+=c.dx),u>0&&(u=0),g=s<u?u:s>0?0:s;var A={duration:200,func:"ease"};c&&(A={duration:c.t,func:"cubic-bezier(0, 1, 1, 1)"}),x(g),setStyle.animate(a,"transform",A),setStyle.transform(a,{translate:[g,0]})}w=!1}}function D(e){if(!(s||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),_){if(m<=1)return}else if((n=getW(i)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===A&&(A=0),A+=t,!_){var n=getW(i)-getW(a),r=g-A;if(n>0&&(n=0),r<n)var o=n-(n-r)/3;else if(r>0)o=0+(r-0)/3;else o=g-A;x(o),setStyle.transform(a,{translate:[o,0]})}clearTimeout(b),b=setTimeout((function(){if(_){(h>0&&A<0||h<m-1&&A>0)&&(h+=A>0?1:-1);var e=-h,t=getW(i),n=d?100*e+"%":e*t;L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var r=getW(i)-getW(a);r>0&&(r=0),(e=g-A)<r?g=r:e>0?g=0:g-=A,x(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]})}A=!1}),200)}}function P(e){if(_){var t=h;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),r=+attr(n,"data-i");h=r<0?0:r>m-1?m-1:r}f=!1,k(),w=!1;var o=getW(i),s=-h,l=d?100*s+"%":s*o;L(),t!=h&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}}function x(e){if(!_){e=e||g;var t=getW(i)-getW(a);toggleClass("sw_left",i,e<0),toggleClass("sw_right",i,e>t)}}function L(){if(_){var e=geByClass1("sp_ppt_sel",n);e&&e===o[h]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",o[h]))}}extend(this,{init:function(){i=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",i),_?(r=geByClass1("sp_pages_pts",n),o=geByClass("sp_ppt",r),m=(geByClass("scroller_page",a)||[]).length,h=0,L()):x(g=0),v=!1,setStyle.transform(a,{translate:[0,0]}),c?(addEvent(i,"touchstart touchmove click",j),addEvent(i,"touchstart",T),addEvent(i,"touchmove",I),addEvent(i,"touchend touchcancel",M)):(addEvent(i,"mousewheel",D),addEvent(r,"click",P)),d||onBodyResize(P)},destroy:function(){c?(removeEvent(i,"touchstart touchmove click",j),removeEvent(i,"touchstart",T),removeEvent(i,"touchmove",I),removeEvent(i,"touchend touchcancel",M)):(removeEvent(i,"mousewheel",D),removeEvent(r,"click",P)),d||onBodyResize("__clear",P)},onShow:function(){_?L():x(g)},canClick:function(){return u}}),n=e,(t=t||{}).byPage?(_=!0,d=!C.default.android):(_=!1,d=!1,this.showElem=function(e){if(!_){var t=getX(e)-getX(i),n=t+g,r=n+getW(e),o=getW(i),s=!1;n<0?s=0-t+20:r>o&&(s=o-getW(e)-t-20);var l=getW(i)-getW(a);if(l>0&&(l=0),s<l)s=l;else if(s>0)s=0;clog(t,g,n,r,0,o,s),!1!==s&&(x(g=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]}))}})};var lt=n("izth"),ct=function(){var e=null,t={},n=1,i=null,a=!1,r=!1;function o(){n<64&&(n*=2)}function s(e,t){!1===e&&(e=getNotify()+(t||1)),setNotify(e),menu.refreshSingleCounter(et.COUNTERS_POS_MESSAGES,e)}function l(e){return Object.keys(e).some((function(e){return-1!==e.indexOf("attach")}))||e.fwd||e.emoji||e.geo}function c(e,t,n){var i=toInt(e.from_admin)||null,a=toInt(nav.getQuery("community"));return i&&a?a:2&t?window.vk.id:toInt(e.from)||n}function d(){return Number(nav.getQuery("offset"))>0}function _(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:Object(u.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(u.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(u.default)("msgId","dialogId"),onMsgReadByOther:Object(u.default)("msgId","dialogId"),onOnlineChange:Object(u.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(u.default)("dialogId","authorId"),onMultiTyping:Object(u.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(u.default)("msgId"),onMsgImportantAdd:Object(u.default)("msgId"),onMsgRemove:Object(u.default)("msgId"),onMsgRestore:Object(u.default)("msgId"),onPeerKeyboard:Object(u.default)("peerId"),onPeerBanner:Object(u.default)("peerId"),onDialogImportant:Object(u.default)("peerId","isImportant"),onDialogMarkedUnread:Object(u.default)("peerId","isMarkedUnread"),onUnreadCount:Object(u.default)("count"),onResync:Object(u.default)(),isLongPollingEnabled:function(){return!!a},init:function(t){e||(Object(lt.setDocumentDomain)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady((function(){append(e,window.bodyNode),!0}))),ct.refreshParams(t),setTimeout(ct.check,1e3)},on:function(){clog("[longpoll] start"),a=!0,setTimeout(ct.check,1e3)},off:function(){clog("[longpoll] pause"),a=!1},refreshParams:function(e){extend(t,e||{}),extend(ct,t)},getKey:function(){if(i)try{i.abort()}catch(e){}i=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(ct.refreshParams({key:e}),ct.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(ct.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),o()}})},check:function(){if(a&&!r)if(ct.makeRequest)try{ct.makeRequest((function(e,t){if(r=!1,a)if(window.vk.__debug)ct.checked(parseJSON(t))&&(ct.check(),n=1);else try{ct.checked(parseJSON(t))&&(ct.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(ct.check,1e3*n),o()}}),(function(){r=!1,setTimeout(ct.check,1e3*n),o()})),r=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(ct.check,1e3)},checked:function(e){var i,a,r,u=e.failed;if(1==u||t.ts>=e.ts+256){if(ct.refreshParams({ts:e.ts}),u)return!0}else{if(2==u)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(ct.getKey,1e3*n),o(),!1;if(u)return void clog("[longpoll]",e)}if(ct.refreshParams({ts:e.ts}),e.updates){var f=[],p=!1;for(var h in e.updates){if(116==e.updates[h][0])var m=e.updates[h][1],v=[e.updates[h][0],m.id,m.flags,m.peer_id,m.date,m.title||"",m.message,m.kludges,m.random_id];else v=e.updates[h];var g=intval(v[0]),A=intval(v[1]),b=intval(v[2]),y=intval(v[3]);if(1===b){if(10===g){mail.updateImportantDialog(A,!1);continue}if(12===g){mail.updateImportantDialog(A,!0);continue}}if(b&1<<20){if(10===g){mail.updateMarkAsUnread(A,!1);continue}if(12===g){mail.updateMarkAsUnread(A,!0);continue}}if(8&b){if(2===g){if(window.isNewMail){ct.onMsgImportantAdd(A);continue}mail.updateImportantMessages(y,A,1);continue}if(3===g){if(window.isNewMail){ct.onMsgImportantRemove(A);continue}mail.updateImportantMessages(y,A,-1);continue}}if(51!=g)if(61!=g)if(62!=g)if(8!=g)if(9!=g)if(6!=g&&7!=g)if(80!=g||!A||nav.getQuery("community"))if(52!=g){if(y)if(4!=g&&5!=g&&116!=g)if(0!=g)if(2!=g);else{if(128&b){if(window.isNewMail){ct.onMsgRemove(A);continue}mail.markAsDeleted(y,A)}window.isNewMail&&64&b&&ct.onMsgRemove(A)}else{if(window.isNewMail){ct.onMsgRemove(A);continue}mail.markAsDeleted(A)}else{var w=5==g||116==g;if(window.isNewMail){var O=v,S=O[1],k=O[3],C=O[4],E=O[6],j=O[7],T=void 0===j?{}:j,I=O[8],M=l(T),D=(i=void 0,a=void 0,r=void 0,i=new Date(1e3*C),a=i.getHours(),r=i.getMinutes(),a+":"+(r<10?"0":"")+r),P=toInt(T.from_admin)||null,x=(toInt(nav.getQuery("community")),c(T,b,k)),L=!!T.source_act,B=T.keyboard?_(T.keyboard):null;if(w){var R={peerId:k,msgId:S,authorId:x,text:E,date:D,hasAttachments:M,flags:b,adminId:P,randomId:I};116==g?R.refreshed=1:R.edited=Math.floor(Date.now()/1e3),ct.onEditMsg(R)}else ct.onNewMsg({peerId:k,msgId:S,authorId:x,text:E,date:D,hasAttachments:M,flags:b,adminId:P,randomId:I,isService:L,keyboard:B});continue}var N=window.vk,F=2&b?N.id:v[7]&&v[7].from||y,H=v[7]&&v[7].source_act;p||(p=!!need("PinnedMsg").getByMsgId(A));var U=v[7].from_admin||H||p?null:mail.getMsgHTML(A,b,y,v[4],v[5],v[6],v[7],116!=g?w:"");if(U&&(w?mail.replaceMessage(y,A,F,U):d()||mail.addMessage(y,A,F,U),2&b||nav.getQuery("community")||s(!1,1)),"chat_kick_user"===H&&v[7].source_mid==N.id){var V=v[3];mail.unpinMessage(V)}U&&"chat_pin_message"!==H&&"chat_unpin_message"!==H||f.push({peer:y,msg_id:A,from_id:F,source_act:H,edited:w})}}else{var $=v,W=$[1],q=$[2];if(!window.isNewMail)continue;11==W&&ct.onPeerKeyboard(q),10==W&&ct.onPeerBanner(q)}else s(A);else{if(window.isNewMail){var z=v[1],Y=v[2];6===g?ct.onMsgReadByMe(Y,z):ct.onMsgReadByOther(Y,z);continue}mail.markPeerAsRead(A,b,7==g)}else{if(window.isNewMail){ct.onOnlineChange({userId:-A,isOnline:!1,lastActionTime:y});continue}mail.updateOnline(-A,0)}else{if(window.isNewMail){ct.onOnlineChange({userId:-A,isOnline:!0,onlinePlatform:7===(b||7)?"desktop":"mobile"});continue}mail.updateOnline(-A,b||7)}else{if(window.isNewMail){var Q=2e9+b,G=A;ct.onTyping(Q,G);continue}mail.typing(2e9+b,A)}else{if(window.isNewMail){var K=A,X=A;ct.onTyping(K,X);continue}mail.typing(A)}}if(f.length){var J=[];each(f,(function(e,t){J.push(t.msg_id)}));var Z={_ajax:1,act:"get_messages",msgs:J.join(","),community:nav.getQuery("community")};p&&(Z.force_pinned=1),ajax.post("/mail",Z,{onDone:function(e,t){var n=window.cur,i=d();each(f,(function(t,n){var a=e[n.msg_id],r=n.peer;a.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,a.text):mail.addMessage(n.peer,n.msg_id,n.from_id,a.text)),a.unpin&&mail.unpinMessage(r),a.pinned&&mail.pinMessage(r,a.pinned)})),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}(),ut=ct,dt=n("WwUR");window.isNewLongpoll?window.im=dt.default:window.im=ut;n("gNTM"),n("eoxF");var _t=n("j80l"),ft=n("Fbxv"),pt={};function ht(e){var t,n,i;ht.getQueryREs=ne;var a,o,s,l,c,d,_,f,p,h,m,v,g,A=!1,b=[],y={},w={},O={},S={},k=!1,C=null,E=null,I=null,D=0,P=[],x=null,L=null,B=null,R=!1,N=!1,F=10,H=[],U=!0,V=!1,$=!1,W=!1,q={},z=[],Y=!1,Q="",G=!1,K=0,X=0,J=!1,Z={},ee=e&&"au_search_field"===e.field&&Object(r.attr)(Object(r.ge)(e.field),"data-newsearch"),te=Wd.elem({class:["show_next_wrap","show_next_wrap_transparent"],inner:{class:"show_more_loading",inner:{tag:"i",class:"i_loading",inner:""}}});function ne(e){var t,n,i;e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var a=N,o=[e,n=Object(r.parseRusKeys)(e,a)||e,i=Object(r.parseLatKeys)(e,a)||e,Object(r.parseLat)(n),Object(r.parseCyr)(i)],s={},l=[],c=0,u=o.length;c<u;c++)o[c]&&!s[o[c]]&&(s[o[c]]=!0,t=(t=Object(r.escapeRE)(o[c])).replace(/[её]/gi,"[её]").replace(/(e|yo)/gi,"(?:e|yo)"),l.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return l}function ie(e){return void 0===e&&(e=""),"_"+e+(q&&Object(r.len)(q)?JSON.stringify(q):"")}function ae(e,n,i,o){if(clearTimeout(E),!i)return E=setTimeout((function(){ae(e,n,!0)}),10),!1;var s=Object(r.val)(e)||"";if(C===s&&!o)return!1;var l,c=ie(s),u=w[c],m=[];if(!ee&&!u&&s.length>2&&w["_"+s.slice(0,-2)]){var v="_"+s.slice(0,-2);w[v]&&S[v]&&!w[v].length&&(!W||W&&!O[v])&&(S[c]=!0,u=w[c]=[],W&&(O[c]=""))}o&&(delete S[c],delete w[c],delete O[c]);var g=0;if(!u){u=[];if(mt.isCachedPage)g=(Object(r.geByClass1)("_si_container",a)||a).childNodes.length;if(!s&&b.length)for(var A=D,T=D+Math.min(Math.max(F,g),b.length);A<T;A++)u.push([b[A]]);else{var M={},P=0;for(A=0,T=b.length;A<T;A++){var x=b[A];if(y[x]){if(M[x]=!0,(l=oe(m,y[x][0]))&&(u.push([x,l]),++P>=30))break;0}}if(P<30)for(var x in y)if(!M[x]&&(l=oe(m,y[x][0]))){if(u.push([x,l]),++P>=30)break;0}}S[c]=S[c]||!s&&b.length||u.length>2*F,S[c]=S[c]||W&&u.length>F}var L=!f||!!s;(!S[c]&&(U||W)||o)&&!_&&L&&function e(n,i,o){var s=ee?800:200;if(clearTimeout(I),!o)return I=setTimeout((function(){e(n,i,!0)}),s),!1;window.ajax.post(t,Object(r.extend)({_ajax:1,q:i},q),{onDone:function(e,t,o){var s;"string"==typeof p?(s=Wd).handle2.apply(s,[[p],null].concat(Array.prototype.slice.call(arguments),[i,a])):p&&p.apply(void 0,Array.prototype.slice.call(arguments).concat([i,a]));for(var l,c=ie(i),u=w[c]||[],_={},f=ne(i),h=0;h<u.length;h++)_[u[h][0]]=!0;for(var m=0;m<t.length;m++){var v=t[m];_[v]||((l=oe(f,e[v][0]))||R||!i)&&u.push([v,l])}S[c]=!0,w[c]=u,W&&(O[c]=o||""),y=Object(r.extend)(e,y),Z._cache=y,U=!V||Object(r.len)(y)<V,C===i?(se(u,O[c]),Object(r.onBodyScrollForce)()):delete w[c],U||Object(r.removeClass)("input_loading",n),d&&(U=!1,V=Object.keys(y).length)},onFail:function(){var e=ie(i);delete w[e],Object(r.removeClass)("input_loading",n)}}),Object(r.geByClass1)("al_loading",a)||Object(r.addClass)("input_loading",n)}(e,s),w[c]=u;var B=C!==s;if(C=s,se(u,O[c]),"string"==typeof h?Wd.handle2([h],null,s,a):h&&h(s,a),($||!C||B)&&(K=Math.max(F,g)),Y&&k){var N=Object(_t.parseURL)(nav.cur),H=Object(r.qs2obj)(N.search.replace("?","")),Q=Object.keys(H).reduce((function(e,t){return z.includes(t)?e[t]=q[t]:z.includes(t)||(e[t]=Object(r.isUndefined)(e[t])?H[t]:e[t]),e}),Object(r.extend)(Object(r.copy)(q),{q:s})),G=_t.default.make(nav.path,Object(j.default)({act:Q.act},Q)),X=Object(r.extend)(nav.page_get(nav.cur)||{},{page:Object(r.ge)("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}});nav.set({replace:!0,nav:Object(r.extend)({},nav,{cur:nav.path,path:nav.path||"",push:G||""})}),page.save(G,X)}return Object(r.onBodyScrollForce)(),!1}function re(){var e=a&&a.querySelector(".show_next_wrap");e&&e.remove()}function oe(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([№])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var a=0;a<n.length;a++)for(var r=0,o=e.length;r<o;r++)if(-1!==n[a].search(e[r]))return e[r];return!1}function se(e,t,n){var i="";if(L&&a){var s=Object.keys(H).filter((function(e){return!!H[e]})).map((function(e){return e+""}));s.length&&""===C&&(e=e.filter((function(e){return!s.includes(String(e[0]))})),s.forEach((function(t){e.unshift([t,!1])})));for(var u=function(t){var n=e[t],a=n[0],r=n[1];if(!y[a])return"continue";var o=y[a].slice(1);if(r)for(var s in P){var l=P[s];o[l]&&(o[l]=o[l].replace(r,'$1<em class="found">$2</em>'))}i+=L.apply({id:a,q:C,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(r,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,(function(e,i,a){return a&&t[a-1]?n.highlight(t[a-1]):i&&t[i-1]?t[i-1]:""}))}},o)},d=0;d<e.length;d++)u(d);if(!i&&!S[ie(C)]&&(U||W)&&!_){re(),Object(r.removeClass)("_si_container_loading",a);var f=Wd.html({class:"al_loading qs_loading",inner:Object(T.default)(Object(ft.getLoading40Icon)())});i=C?f:'<div id="al_loading"></div>'}if(!i&&B&&(i=B(C)),Object(r.removeClass)("input_loading",o),n&&(i+=n),t||i!==g||G){var p=x?x(i,C,$,t):i+(t||"");Object(r.val)(a,p)}if(g=i,l){var h=Object(M.$)('[data-prefix="'+Q+'"]');h&&h.classList.toggle("qs_with_clear",!!C)}c&&Object(r.toggle)(c,!!C),!C&&Object(r.alLoadingFix)(),Object(M.$)(".al_loading",a)&&(J=!0),m&&m(C)}}Object(r.extend)(this,{go:function(e){return!o||(ae(o,e,!0,!0),o.blur(),Object(r.cancelEvent)(e),!1)},redraw:function(){var e=ie(C);se(w[e],O[e]),Object(r.onBodyScrollForce)()},clear:function(e,t){return Object(r.val)(o,""),t?Object(r.elfocus)(o):Object(r.elblur)(o),this.setSearchParams({}),this.go(e),Object(r.cancelEvent)(e),!1},blur:function(){Object(r.elblur)(o)},toggleAttach:function(e,t){H[e]=t},setSearchParams:function(e){var t=Object(r.copy)(q);if(isArray(e)){var n=nav.getQuery()||{};q=Object(r.extend)(q,e.reduce((function(e,t){var i=n[t];return i&&(e[t]=i),e}),{}))}else q=e;var i=JSON.stringify(t)!==JSON.stringify(q);this.onSearchParamsChange(q,t,i);var a=Object(M.$)('[data-prefix="'+Q+'"]');if(a){var o=Object(M.$)(".filter_btn",a);o&&(Object(r.toggle)(o,!!C),k&&i&&(y={}))}},getSearchParams:function(){return q},onSearchParamsChange:Object(u.default)(),init:function(e){var u=this;if(e=e||{},a=Object(r.ge)(e.container)||null,o=Object(r.ge)(e.field)||null,s=Object(r.ge)(e.btn)||null,l=Object(r.ge)(e.clear_btn)||null,c=Object(r.ge)(e.filter_btn)||null,C=null,!k||t!=e.action||!e.init_once){w={},O={},S={},t=e.action||"",A=null!==e.next_from,i=e.next_from,n=e.al_action||t,b=e.top_items||[],y=e._cache||{},G=e.forceRerender||!1,P=e.hl_fields||[],x=e.tpl||null,L=e.item_tpl||null,B=e.null_tpl||null,R=e.soft_filter||!1,N=e.need_invalid_keys||!1,F=e.top_len||10,V=e.load_limit||!1,p=e.onLoaded||!1,h=e.onFiltered||!1,m=e.onRendered||!1,v=e.onFocusChanged||!1,$=e.al_need||!1,D=!$&&e.init_offset||0,W=e.global_search||!1,_=e.no_search_query||!1,f=e.search_non_empty_query||!1,d=e.load_once||!1,Y=e.updateQuery||!1,z=e.availableSearchParams||[],Q=e.prefix||"";var g=e.action+e.container;pt[g]?Z=pt[g]:(Z._cache=y,Z.top_items=b,pt[g]=Z),mt.isCachedPage&&(b=Z.top_items,y=Z._cache,i=Z.next_from),z.length&&(this.setSearchParams(z),window.onDOMReady((function(){u.setSearchParams(z),Object(r.onBodyResize)((function(){u.setSearchParams(z)}))})))}var E=null;t&&a&&o&&L&&(U=!0!==t&&(!V||Object(r.len)(y)<V),Object(r.addEvent)(o,"focus",(function(e){e&&e.preventDefault();clearTimeout(E),v&&v.call({q:C},!0),function t(n){!n&&ae(o,e,!0),E=setTimeout(t,100)}(!0)})),Object(r.addEvent)(o,"keydown keypress change blur",(function(e){"blur"==e.type&&(clearTimeout(E),v&&v.call({q:C},!1)),ae(o,e,"keydown"!=e.type&&"keypress"!=e.type)})),e._new||s&&!Object(r.attr)(s,"onclick")&&Object(r.attr)(s,"onclick","return qsearch.go(event);"),!$||k&&e.init_once||(K=F,X=Object(r.len)(y),Object(r.initAutoScroll)((function(){var e=(Object(r.geByClass1)("_si_container",a)||a).childNodes;return e[K]||e[e.length-1]}),(function(){var e=Object(r.geByClass1)("_si_container",a)||a;if(!J&&!C)if(A?!!i:K+F>X&&U)J=!0,a&&a.append(te),Object(r.addClass)(e,"_si_container_loading"),window.ajax.post(n,{_ajax:1,offset:X,next_from:i,q:C},{onDone:function(n,a,o,s){i=o;var l,c=s?s.needLoad:void 0,u=s&&s.html||"";"string"==typeof p?(l=Wd).handle2.apply(l,[[p],null].concat(Array.prototype.slice.call(arguments))):p&&p.apply(void 0,arguments);var d=Object(r.len)(n);if(J=!1,re(),Object(r.removeClass)(e,"_si_container_loading"),V||(b=b.slice(0,X).concat(a),Z.top_items=b),X+=d,y=Object(r.extend)(n,y),Z._cache=y,Z.next_from=i,U=!0!==t&&(!V&&d||Object(r.len)(y)<V),!1===c&&(U=!1),!C){K+=F;for(var _=[],f=0,h=Math.min(K,b.length);f<h;f++)_.push([b[f]]);se(_,O._,u),Object(r.onBodyScrollForce)()}},onFail:function(){J=!1,re(),Object(r.removeClass)(e,"_si_container_loading")}});else if(K<b.length){K+=F;for(var o=[],s=0,l=Math.min(K,b.length);s<l;s++)o.push([b[s]]);se(o,O._),Object(r.onBodyScrollForce)()}}))),e.common_cache&&(e.common_cache&&e.common_cache._gq_cache&&(O=e.common_cache._gq_cache),e.common_cache._q_loaded&&(S=e.common_cache._q_loaded)),!e.skip_init_filter&&ae(o,null,!0),k=!0)}}),e&&this.init(e)}var mt=new ht;window.QuickSearch=ht,window.QuickSearchCache=pt,window.qsearch=mt;var vt={onClose:Object(u.default)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){vt.inited||(vt.inited=!0,vt.initEvents())},initEvents:function(){var e=function(e){vt.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==vt.opened&&toggleClass("z_opened",window.bodyNode,vt._opened),vt._opened},toggle:function(e,t){return!!checkEvent(e)||(vt.opened()?vt.close(e,t):vt.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||(vt.opened()||(thover.clear(),vt.init(),vt._st=scrollTop(),vt._lastNav=!1,addClass("z_opened",window.bodyNode),vt._opened=!0,vt.fixHeight(vkNow()+2e3,!0),scrollTop(0)),!1)},close:function(e,t){return!!checkEvent(e)||!!vt.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),vt._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},vt._opened=!1,vt._destroy&&(vt._destroy(),vt._destroy=!1),scrollTop(vt._st,1),vt._st=!1,vt.onResize=null,vt.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(vt.width=e.offsetWidth,vt.height=e.offsetHeight,vt.onResize&&vt.onResize())},fixHeight:function(e,t){if((vt._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),i=getCh();(vt._lastWidth!=n||vt._lastHeight!=i||t)&&(vt._lastWidth=n,vt._lastHeight=i,setStyle("z","height",i),vt.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(vt._fixTo),vt._fixTo=setTimeout(vt.fixHeight,50,e)}},create:function(e,t){val("z",e),vt._destroy=t}};window.zlayer=vt;var gt=n("rc7J"),At=n("GVTI"),bt=n("vhZE");window.photo=function(){var e,t,n,i,a,r,o,s,l,c,u=4,d=!1,_={},f={},p={},h=null,m=null,v=!1,g=null,A=null,b=!0,y=0,w=!1;function S(){if(!(e=$(".PhotoviewPage")))return nav.al_go(nav.cur),!1;if(geByClass1("pv_summary",e),geByClass1("photo_msg",e),o=geByClass1("pv_tag_wrap",e),n=geByClass1("PhotoviewPage__thumb",e),t=geByClass1("pv_nav",n),r=geByClass1("PhotoviewPage__photo",e),a=$(".PhotoviewPage__photo img",n),geByClass1("pv_footer",e),d=hasClass("pv_touch_full",e),t){var u=geByClass1("pv_nav_left",t),_=geByClass1("pv_nav_z",t),f=geByClass1("pv_nav_right",t);s=geByClass1("pv_nav_link",u),c=geByClass1("pv_nav_link",_),l=geByClass1("pv_nav_link",f),attr(s,"onclick","return photo.prev(event);"),attr(l,"onclick","return photo.next(event);"),attr(i,"onclick",!d&&"return photo.next(event);"),ajax.prepare_click([s,l,i])}return removeEvent(window,"orientationchange",P),addEvent(window,"orientationchange",P),removeEvent(window,"keydown",x),addEvent(window,"keydown",x),removeEvent(window,"resize",L),addEvent(window,"resize",L),bt.default.onClear("__clear",L),bt.default.onClear(L),!0}function k(){var t=window.photoview;return!!t&&(w||(w=!0,t.onPhotoChange=function(e,t){y=e,R(e,t)},t.onUpdate=function(){},t.onClose=function(t){if(uRegisterFloatBtn.show(),!function(e){var t=qs2obj(nav.params);if(delete t.z,!e.local&&!e.crop){if(nav.tryHistoryBack())return!1;var n=nav.path+obj2qs(t)+nav.hash;nav.go(n,null,{push_only:!0})}return!0}(t))return!0;var n=qs2obj(nav.params);e&&n.list==m&&B(y,!0)}),!0)}function C(e){var t=window.photoview,n=[];return each(e,(function(e,t){if(!t)return!0;n.push(_[t.id]=t)})),h&&t&&t.saveSource(M(h)),n}function E(e){return _[e]||{}}function T(e,t,n){if(null!==t){f[e]||(f[e]=new Array(n||len(t))),C(t);var i=f[e];v&&i.reverse(),extend(i,t),v?(h=copy(i),i.reverse()):h=i}else delete f[e]}function I(e){if("string"!=typeof e)return e;var t=f[e]||[];return v?copy(t).reverse():t}function M(e){var t=I(e),n=new Array(t.length),i=qs2obj(nav.params);for(var a in delete i.z,t){var r=h[a],o="",s="";r.hash&&(s=obj2qs({hash:r.hash,mp4:!0})),r.isDoc?(o="doc"+r.id+s,n[a]={id:r.id,photo_url:"/"+o,src:r.original_src,isDoc:!0,hasVideo:r.hasVideo}):(o="photo"+r.id+"?list="+m+(v?"&rev=1":"")+(A?"&from="+A:""),n[a]={id:r.id,photo_url:"/"+o,like_url:"/like?act="+(r.likes_me?"del":"add")+"&object=photo"+r.id+"&from="+encodeURIComponent(o)+"&list="+m+"&hash="+r.like_hash,likes_me:r.likes_me,src:r.original_src,max_src:r.max_src,tags:r.tags,caption:r.caption,likes_cnt:r.likes_cnt,replies_cnt:r.replies_cnt,market_tags:r.market_tags,restriction:r.restriction})}return n}function D(e,t){for(var n in t||(t=h),t)if(h[n].id==e)return+n;return-1}function P(){nav.hash||onDOMReady((function(){if(geByClass1("photo_view")){var e=scrollTop();n&&getY(n)<e&&scrollToEl(n)}}))}function x(e){if(zlayer.opened())return!1;switch(e.which){case 37:e.preventDefault(),photo.prev();break;case 39:e.preventDefault(),photo.next()}}function L(t){e&&document.body.contains(e)&&(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||isVisible($("#stickers_panel"))||B(y,!0))}function B(t,_,f){var m=window.cur,w=window.lang,O=h[t],S=1==h.length;if(O){nav.hash?scrollToHash(nav.hash):P();var k={};g&&(k.list=g),v&&(k.rev=1),A&&(k.from=A);var C=obj2qs(k),E="photo"+O.id+C,T=O.photo,I=(F(t-1)||{}).id,M=(F(t+1)||{}).id;if(S||(r&&(r.href="/photo"+M+C),s&&(s.href="/photo"+I+C),l&&(l.href="/photo"+M+C),ajax.prepare_click([s,l,i])),d){var D="photo"+O.id+"/"+g+(v?"/rev":""),x=extend({},k,{z:D}),B="/photo"+O.id+obj2qs(x);if(zlayer._lastNav){var R=zlayer._lastNav;(x=qs2obj(R.params)).z=D,B=R.path+obj2qs(x)+R.hash}c&&(c.href=B),ajax.prepare_click(c),attr(c,"onclick","return photo.fullscreen('"+escapeAttr(B)+"', event);")}if(a&&a.src!=T){a.onload=null,remove(a);var N;N=Wd.html(Object(At._PhotoviewPage_tags)(O.tags)),val(r,'<img src="'+(T||"/images/blank.gif")+'" alt="" class="ph_img" />'+N),a=geByTag1("img",r)}toggleClass("photo_deleted",e,!!O.deleted),toggleClass("pv_one_photo",n,1==h.length),val(o,O.tag_info||"");var U=(at.default.getStickerPanel()||"").split("photo-0_0").join("photo"+O.id),V=O.comments_html||"";U&&(V=V.split("\x3c!--stickers_panel--\x3e").join(U)),e.classList.toggle("PhotoviewPage--deleted",!!O.isDeleted),e.childNodes[0].setAttribute("id","photo"+O.id);var q=$(".wi_like_wrap",e);q&&(q.innerHTML=O.liked_people||"",q.classList.toggle("is_empty",!O.liked_people));var z,Y=$(".PhotoviewPage__restrictedInfo"),Q=!!(O.restriction&&"block"===O.restriction.type||O.restriction&&"blur"===O.restriction.type&&!bt.default.isCleared("photo"+O.id));Q&&(z=Object(j.default)({},O.restriction,{forceText:!0,raw:"photo"+O.id,width:getW(r),height:getH(r)}),a.complete||a.onload||(a.onload=L)),e.classList.toggle("pv_touch--hideZOpen",Q),toggle(Y,Q),r.classList.toggle("PhotoviewPage__photo--block",!(!z||"block"!==z.type)),r.classList.toggle("PhotoviewPage__photo--blur",!(!z||"blur"!==z.type)),Q&&Y&&(Y.innerHTML=Wd.html(Object(bt.default)(z)));var G=$(".wi_buttons",e);val(G,O.like_buttons||"");var K=$(".AlbumInfoRow",e);K&&(K.outerHTML=Wd.html(Object(gt.default)({url:O.album_href,author_url:O.author_href,avatar:O.avatar,title:Wd.wrap(O.album_title),subtitle:Wd.wrap(O.album_info_subtitle),withoutBottomBorder:!O.has_replies})));var X=$(".PhotoviewPage__description",e);if(X){O.description&&O.description,X.innerHTML=O.description,X.classList.toggle("PhotoviewPage__description--empty",!O.description)}var J=$(".PhotoviewPage__caption",e);if(J){var Z="";O.caption&&(Z+=O.caption),val(J,Z)}var ee=$(".Replies");ee&&(ee.outerHTML=O.replies_html);var te=$(".RepliesField"),ne=at.default.getStickerPanel();te&&O.reply_field_html&&ne&&(te.outerHTML=O.reply_field_html.replace("\x3c!--stickers_panel--\x3e",ne));var ie=$("#mhead .HeaderSubtitle__subtitle");ie&&(ie.innerHTML=w.mobile_photos_photo_header.replace("%s",y+1).replace(/%s|{count}/,h.length));var ae=ge("photo_actions");if(ae&&(ae.innerHTML=Wd.render(O.actions)),post.stickersInit(),m.replyTo=0,ajax.refreshLinks(O.fv_link,O.app_link),photo.closeTags(),!_){var re="/"+E;nav.go(re,null,{no_push:_,push_only:!0,replace:f}),page.save(re,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}setTimeout((function(){var e=Object(W.getState)("autoload")||{};Replies.init(e.enable||!1,O.author_id||O.owner_id)}))}b||(H(),function(){for(var e=0,t=y+1;e<u;e++){var n=F(e+t),i=n&&n.photo;if(i&&!p[i]){var a=p[i]=new Image;a.src=i,a.onload=function(){p[i]=!0}}}}())}function R(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,r=n.hasVideo,o=window.photoview,s=h[e];h.length;if(s){var l=qs2obj(nav.params);if(l.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+g+(v?"/rev":""),t.no_open||o.open(e,M(h),{local:t.local,showControls:t.showControls,isDoc:i,hasVideo:r}),!t.local&&!t.crop){var c=nav.path+obj2qs(l)+nav.hash;nav.go(c,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0})}}t.local||t.crop||H(!0,i)}var N=!1;function F(e){return e>0?e%=h.length:e=(100*h.length+e)%h.length,h[e]}function H(e,t){if(void 0===t&&(t=!1),!N){for(var n=window.photoview,i=!1,a=1,r=0;r<5;r++){if(!(s=F(o=r+y))||!s.owner_id){i=o,a=1;break}}if(!1===i)for(r=-1;r>-3;r--){var o,s;if(!(s=F(o=r+y))||!s.owner_id){i=o,a=-1;break}}if(!1!==i){var l=F(y);if(l){N=!0,show(void 0);var c=window.cur,u=l.owner_id||(l.id||"").split("_")[0],d=Gif.isMp4Supports()&&l.hasVideo,_=o==y&&l.id?(t?"/doc":"/photo")+l.id+(l.hash?"?hash="+l.hash:"")+(d?(l.hash?"&":"?")+"mp4":""):"/photos.php",f={_ajax:1,oid:u,list:m,offset:i,direction:a,rev:v?1:0};at.default.getStickerPanel()||(f.need_stickers=1),nav.getQuery("community")&&(f.community=nav.getQuery("community")),ajax.post(_,f,{onDone:function(t,i,a,r){hide(void 0),N=!1,a&&(c.replyNames||(c.replyNames={}),extend(c.replyNames,a)),r&&extend(c,r),T(m,t,i||h.length),e?n&&n.saveSource(M(m),!1,!0):B(y,!0)}})}}}}function U(e,t,n,i,a){if(h=[],e){var r=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e);r&&each(geByTag("img",r),(function(){var e=domData(this,"id"),t=JSON.parse(domData(this,"restriction")),n=domData(this,"src_big");if(!e||!n)return!0;var i=(n=n.split("|"))[0],a=+n[1]||0,r=+n[2]||0;h.push({id:e,original_src:i,width:a,height:r,restriction:t})}))}h.length||h.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a})}function V(){addClass("pv_icons_hide",n)}return{save:C,get:E,saveSource:T,getSource:I,clear:function(){removeEvent(window,"resize",L),removeEvent(window,"orientationchange",P),removeEvent(window,"keydown",x)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!S())return!0;if(v=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),v=!0),A=i||null,t)m=t;else{var r=E(e);m=r.album?"album"+r.album:""}if(g=m,h=I(m),-1===(y=D(e,h))){if(!(r=E(e)).id)return!1;h=[r],y=0}b=h.length<2,!1;var o=h[y]&&e!=h[y].id;return B(y,a&&!o,o),!1},prev:function(e){return!!checkEvent(e)||!(N&&!F(y-1))&&(!S()||(b?photo.close():(--y<0&&(y=h.length-1),B(y),V(),!1)))},next:function(e){return!!checkEvent(e)||!(N&&!F(y+1))&&(!S()||(b||(++y>=h.length&&(y=0),B(y),V()),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",n)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("PhotoviewPage","m");if(!e)return!1;setTimeout((function(){removeClass("pv_hidden_icons",e),setTimeout((function(){addClass("pv_icons_hide",e)}),2e3)}),10)},selectTag:function(e,t,i){if(i&&!hasClass("pv_photo_tags_selected",n))return!0;var a=ge("pv_tag"+e),r=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),o=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",a)||(removeClass("pv_tag_selected",r),addClass("pv_tag_selected",a)),hasClass("pv_tag_label_selected",o)?nav.go(o,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",o),addClass("pv_photo_tags_selected",n),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",n))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),i=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),i&&removeClass("pv_tag_label_selected",i),removeClass("pv_photo_tags_selected",n),cancelEvent(e),!1},init:function(e,t,n,i,a,r,o){u=isUndefined(o.preload)?1:o.preload,v=!!a,photo.saveSource(e,t,n),onDOMReady((function(){photo.open(i,e+(a?"/rev":""),null,r,!0)}))},zopen:function(e,t,n,i,a){if(void 0===a&&(a={}),checkEvent(t))return!0;if(O.SAKIntegration.isIntegrated)return O.SAKIntegration.sendMessage("photo",{id:n+"_"+(a.key||"")}),!1;var r=a,o=r.isDoc,s=r.hasVideo,l=r.hash;if(k(),v=!1,"/rev"==i.substr(-4)&&(i=i.slice(0,-4),v=!0),delete qs2obj(nav.params).z,A=a.from||!1,i)m=i;else{var c=E(n);m=c.album?"album"+c.album:""}if(g=m,(h=I(m))[0]&&h[0].isDoc&&h[0].hasVideo!==s&&(h=[]),h.length||U(e,n,o,s,l),-1===(y=D(n,h))&&(U(e,n,o,s,l),y=D(n,h)),-1===y){if(!(c=E(n)).id)return!0;h=[c],y=0}b=h.length<2,!1;var u=h[y]&&n!=h[y].id;return R(y,{no_push:a.no_push&&!u,replace:u,local:a.local,showControls:a.showControls,isDoc:o,hasVideo:s,hash:l}),uRegisterFloatBtn.hide(),cancelEvent(t),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}();var yt=function(){function e(){}return e.follow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.add("MusicAuthorCover__followBtn__followed"),a.onclick=function(r){r.preventDefault(),e.unfollow(t,n,i,a)}},onFail:function(){return unlockButton(a)}})},e.unfollow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.remove("MusicAuthorCover__followBtn__followed"),a.classList.contains("MusicAuthorCover__followBtn__canFollow")&&(a.onclick=function(r){r.preventDefault(),e.follow(t,n,i,a)})},onFail:function(){return unlockButton(a)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}(),wt=n("29dZ"),Ot=function(){function e(){}return e.follow=function(t,n,i){wt.default.setDisabled(i,!0),ajax.post("curator.php",{_ajax:1,act:"follow",hash:n,curator_id:t},{onDone:function(n){wt.default.setDisabled(i,!1),i.classList.add("MusicAuthorCover__followBtn__followed"),i.onclick=function(a){a.preventDefault(),e.unfollow(t,n,i)}},onFail:function(){return wt.default.setDisabled(i,!1)}})},e.unfollow=function(t,n,i){wt.default.setDisabled(i,!0),ajax.post("curator.php",{_ajax:1,act:"unfollow",hash:n,curator_id:t},{onDone:function(n){wt.default.setDisabled(i,!1),i.classList.remove("MusicAuthorCover__followBtn__followed"),i.onclick=function(a){a.preventDefault(),e.follow(t,n,i)}},onFail:function(){return wt.default.setDisabled(i,!1)}})},e}(),St=n("lkNA"),kt=n("rEJs"),Ct=0,Et=1,jt=2,Tt=3,It=4,Mt=5,Dt=6,Pt=8,xt=9,Lt=10,Bt=11,Rt=12,Nt=13,Ft=14,Ht=15,Ut=16,Vt=17,$t=18,Wt=19,qt=20,zt=21,Yt=22,Qt=24,Gt=25,Kt=2,Xt=4,Jt=32,Zt=128,en=512,tn=1024;function nn(e){if(!e)return!1;var t=isObject(e)?e.extra:e[Rt];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}var an=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,i=function(e){return t&&t(e)};if(this._admanLoaded)i();else{var a=0;Object(St.loadScript)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,i()},onError:function(){window.abp?(n._admanLoaded=!0,i()):(3===(a+=1)&&(n._admanLoaded=!0),i("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,r){var o=this;this.loadAdman((function(s){if(!window.AdmanHTML)return o._sendEvent("no_adman",n,e.AD_TYPE,s),a&&a();o._adman=new AdmanHTML;var l=o._adsConfig||vk.audioAdsConfig||window.audioAdsConfig,c={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:rn(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other,sign:l.sign||""};extend(c,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(c.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(c.preview=1,c.vk_id=398724832),o._adman.setDebug(!!c.preview),o._adman.onError((function(){return a&&a()})),o._adman.onReady((function(){if(o._adman){var t=o._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(o._play(!0,n),a&&a()):(o._sendEvent("received",n),i?(o._sendEvent("rejected",n,e.AD_TYPE,r),o.deinit(),a&&a()):(o._sendEvent("ready",n),o.player.notify(kt.events.AD_READY),o._play(!1,n,a))):(i||o._sendEvent("not_received",n),a&&a())}})),o._adman.init({slot:3514,wrapper:o.isMvk?ce("div"):se("<div></div>"),params:c,browser:{adBlock:!!window.abp,mobile:!1}}),o._sendEvent("requested",n)}))},t._sendEvent=function(e,t,n,i){var a=this,r=n?"/"+n:"",o=i?"/"+i:"";this._adEvents.push(e+"/"+t+r+o),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout((function(){ajax.post(a.adsStatUrl,{act:"ad_event",events:a._adEvents.join(","),v:a.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),a._adEvents=[]}),500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted((function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(kt.events.PROGRESS,0),a.player.notify(kt.events.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())})),this._adman.onStarted((function(){t||(a.player.setIsPlaying(!0),a.player.notify(kt.events.PLAY),a.player.notify(kt.events.PROGRESS,0),a.player.notify(kt.events.AD_STARTED),a.updateVolume(),a._sendEvent("started",n),window.statlogsValueEvent&&statlogsValueEvent("audio_web_ad_link","show"))})),this._adman.onPaused((function(){a.player.setIsPlaying(!1),a.player.notify(kt.events.PAUSE)})),this._adman.onPlayed((function(){a.player.setIsPlaying(!0),a.player.notify(kt.events.PLAY)}));var r=[.25,.5,.75];if(this._adman.onTimeRemained((function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(kt.events.PROGRESS,a._adsCurrentProgress,a._duration),each(r,(function(e,t){if(a._adsCurrentProgress>=t)return r.shift(),a._sendEvent("progress_"+intval(100*t),n),!1}))})),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(kt.events.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.stop=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.stop())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(kt.events.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),a=this._isAllowed(t),r=a.type,o=a.reason,s=function(){return n&&n()};switch(r){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,o),s()}},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if(nn(t))return{type:e.ALLOW_DISABLED};if(window.browser&&window.browser.safari)return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled)return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t){this.checkPlay(e,t)},e}();function rn(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}an.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",an.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},an.AD_TYPE="preroll",an.ALLOW_DISABLED=1,an.ALLOW_ALLOWED=2,an.ALLOW_REJECT=3,an.REJECT_REASON_UNKNOWN="unknown",an.REJECT_REASON_LIMIT="track_limit_exceeded",an.REJECT_REASON_SECTION="section_not_allowed";var on=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case kt.events.AD_COMPLETED:case kt.events.AD_STARTED:this.audioplayer.notify(e,n);break;case kt.events.PAUSE:case kt.events.PLAY:this.audioplayer.notify(e,n.fullId);break;case kt.events.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=Object(r.ssGet)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}(),sn=n("Po+v");function ln(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function i(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function r(e,t){0>e?e=0:e>v-1&&(e=v-1);for(var n=O.dots.length-1;n>=0;n--)a(O.dots[n],E.activeDot);return i(O.dots[e],E.activeDot),k=e,o(-e*O.width,void 0===t?C.speed:t),_(),C.onSlideChange&&C.onSlideChange(e),e}function o(e,t){var n=t?t+"ms":"";A.style.webkitTransitionDuration=A.style.MozTransitionDuration=A.style.msTransitionDuration=A.style.OTransitionDuration=A.style.transitionDuration=n,l(e)}function s(e,t){if(w&&clearInterval(w),t){var n=+new Date,i=O.left;w=setInterval((function(){function a(e,t){return(t-e)*s+e}var r,o,s=(+new Date-n)/t,c=[0,.7,1,1];return s>=1?(l(e),void clearInterval(w)):(r=e-i,o=a(a(a(c[0],c[1]),a(c[1],c[2])),a(a(c[1],c[2]),a(c[2],c[3]))),void l(Math.floor(o*r+i)))}),15)}else l(e)}function l(e){A.style.webkitTransform="translate("+e+"px,0) translateZ(0)",A.style.msTransform=A.style.MozTransform=A.style.OTransform=A.style.transform="translateX("+e+"px)",O.left=e}function c(e){A.style.left=e+"px",O.left=e}function u(){var e=k+1;return e>v-1&&(e=0),r(e)}function d(){y=!0,_()}function _(){y&&(b&&clearTimeout(b),b=setTimeout((function(){u()}),C.slideshowInterval))}function f(){b&&clearTimeout(b)}function p(){y=!1,b&&clearTimeout(b)}function h(){O.width=e.offsetWidth,A.style.width=O.width*v+"px";for(var t=0;v>t;t++)O.slides[t].style.width=O.width+"px";o(-k*O.width)}function m(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var v,g,A,b,y,w,O={slides:[],dots:[],left:0},S=200,k=0,C={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(C,t);var E={inactive:C.cssPrefix+"inactive",active:C.cssPrefix+"active",mouse:C.cssPrefix+"mouse",drag:C.cssPrefix+"drag",slides:C.cssPrefix+"slides",dots:C.cssPrefix+"dots",activeDot:C.cssPrefix+"active-dot",mouseClicked:C.cssPrefix+"mouse-clicked"},j={transforms:n("transform"),transitions:n("transition")};return function(){var t=C.slidesContainer||e,n=C.dotsContainer||e;if(!(C.disableIfOneSlide&&t.children.length<=1)){(!j.transforms||window.opera)&&(l=c),(!j.transitions||window.opera)&&(o=s),i(A=C.slidesContainer||document.createElement("div"),E.slides);for(var u=0,_=t.children.length;_>u;u++){var b=t.children[u],y=document.createElement("li");O.slides.push(b),y.setAttribute("tabindex","0"),y.setAttribute("role","button"),y.innerHTML="<span></span>",function(t,n){m(n,"click",(function(){r(t),C.stopSlideshowAfterInteraction&&p()})),m(n,"keyup",(function(e){13==e.keyCode&&(r(t),C.stopSlideshowAfterInteraction&&p())})),m(n,"mouseup",(function(){i(n,E.mouseClicked)})),m(n,"blur",(function(){a(n,E.mouseClicked)}),!0),m(b,"focus",b.onfocusin=function(){e.scrollLeft=0,setTimeout((function(){e.scrollLeft=0}),0),r(t)},!0)}(u,y),O.dots.push(y)}v=O.slides.length,100/v,i(e,E.active),a(e,E.inactive),C.mouseDrag&&i(e,E.mouse),O.width=e.offsetWidth,A.style.width=O.width*v+"px";for(u=0;v>u;u++)O.slides[u].style.width=O.width+"px",A.appendChild(O.slides[u]);if(C.slidesContainer||e.appendChild(A),C.dots&&v>1){i(g=document.createElement("ul"),E.dots);for(u=0,_=O.dots.length;_>u;u++)g.appendChild(O.dots[u]);C.dotsPrepend?n.insertBefore(g,n.firstChild):n.appendChild(g)}m(window,"resize",h),m(window,"orientationchange",h),setTimeout((function(){r(C.startSlide,0)}),0),C.slideshow&&d(),cn(A,{mouse:C.mouseDrag,start:function(){i(e,E.drag)},move:function(e,t,n){f(),n.x=n.x/(!k&&n.x>0||k==v-1&&n.x<0?Math.abs(n.x)/O.width*2+1:1),o(n.x-O.width*k)},end:function(t,n,i){if(i.x){var o=Math.abs(i.x)/O.width,s=Math.floor(o)+(o-Math.floor(o)>.25?1:0);s+=i.time<S+S*s/1.8&&Math.abs(i.x)-s*O.width>(s?-O.width/9:20)?1:0,i.x<0?r(k+s,C.touchSpeed):r(k-s,C.touchSpeed),C.stopSlideshowAfterInteraction&&p()}a(e,E.drag)}}),setTimeout((function(){C.onSetup&&C.onSetup(v)}),0)}}(),{slideTo:function(e,t){return r(parseInt(e,10),t)},next:u,prev:function(){var e=k-1;return 0>e&&(e=v-1),r(e)},start:d,stop:p,pause:f,getCurrentPos:function(){return k},getSlidesNumber:function(){return v},recalcWidth:h}}function cn(e,t){function n(e,t,n,a){return t?(e.addEventListener?e.addEventListener(t,n,!!a):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,a)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function a(e){}function r(e){if((m={x:(_?e.clientX:e.touches[0].clientX)-h.x,y:(_?e.clientY:e.touches[0].clientY)-h.y,time:Number(new Date)-h.time}).time-g[g.length-1].time){for(var t=0;t<g.length-1&&m.time-g[t].time>80;t++);v={x:(m.x-g[t].x)/(m.time-g[t].time),y:(m.y-g[t].y)/(m.time-g[t].time)},g.length>=5&&g.shift(),g.push({x:m.x,y:m.y,time:m.time})}}function o(e,t){b=!0,O[_=t](e)||(n(document,w[_][1],s),n(document,w[_][2],l),n(document,w[_][3],l),u.preventDefault,h={x:_?e.clientX:e.touches[0].clientX,y:_?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,m={x:0,y:0,time:0},v={x:0,y:0},g=[{x:0,y:0,time:0}],u.start(e,h))}function s(e){!u.preventScroll&&d||O[_](e)||(r(e),(Math.abs(m.x)>u.clickTolerance||Math.abs(m.y)>u.clickTolerance)&&(b=!1),void 0===d&&3!==_&&(d=Math.abs(m.x)<Math.abs(m.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,h,m,v)))}function l(e){_&&r(e),!b&&e.target&&e.target.blur&&e.target.blur(),i(document,w[_][1],s),i(document,w[_][2],l),i(document,w[_][3],l),u.end(e,h,m,v)}var c=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:c,move:c,end:c,click:c};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,_,f=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,h={},m={},v={},g=[],A=[],b=!0,y=f?1:p?2:0,w=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],O=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return A.push(n(e,w[y][0],(function(e){o(e,y)}))),A.push(n(e,"dragstart",a)),u.mouse&&!y&&A.push(n(e,w[3][0],(function(e){o(e,3)}))),A.push(n(e,"click",(function(e){b&&u.click(e)}))),{getClicksAllowed:function(){return b},kill:function(){for(var e=A.length-1;e>=0;e--)A[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each((function(){e(this).data("Peppermint",ln(this,t))})),this}}(window.jQuery),window.Peppermint=ln,window.EventBurrito=cn;var un=ln,dn=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){Object(r.statlogsValueEvent)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=sn.default.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach((function(n){n.addEventListener("click",(function(n){Object(r.gpeByClass)("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):Object(r.gpeByClass)("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()}))})),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",(function(){return e.sendStat("click_more")})),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",(function(){e.sendStat("continue_free"),t.close()})),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",(function(){t.slider.next(),e.sendStat("next_1screen")})),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",(function(){return e.sendStat("get_offer")}))},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=un(this.screens,{dots:!0,speed:500})},t.close=function(){sn.default.close(this.popup)},e}(),_n=n("r/ag"),fn=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=C.default.version.split(".")[0];if(C.default.safari_mobile&&n<=7)return window.addEventListener("pagehide",(function(){return e._hidden()})),void window.addEventListener("pageshow",(function(){return e._visible()}));var i=C.default.android&&C.default.safari&&n<5,a=!i&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)})),window.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)}))):document.addEventListener?(window.addEventListener("focus",(function(){return e._visible()}),1),window.addEventListener("blur",(function(){return e._hidden()}),1)):(document.attachEvent("onfocusin",(function(){return e._visible()})),document.attachEvent("onfocusout",(function(){return e._hidden()})))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach((function(e){return e()}))},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach((function(e){return e()}))},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();function pn(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var i=["AudioPopup"];e.popupClass&&i.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new _n.default({content:a,class:i.join(" ")})}fn.prefixes=["webkit","o","ms","moz",""];var hn=n("J8bf"),mn=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt(Object(hn.getCookie)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(pn({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,Object(hn.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(_n.default.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new fn,this.pageVisibility.onVisible((function(){e.isIdle=!1})),this.pageVisibility.onHidden((function(){e.isIdle=!0,e.onIdle()}))},e}();mn.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",mn.REMOVE_RESTRICTION_LINK="/offermusic",mn.EXPLANATION_LINK="https://vk.cc/9uFgyl";var vn,gn=n("L9Nh"),An=(vn=function(e,t){return(vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}vn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),bn=function(e){function t(t){return e.call(this,t)||this}return An(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,gn.QueueManager.addQueue({key:e.key,ts:e.timestamp},(function(e,n){return t.queueHandler(n)})),gn.QueueManager.start())},t}((function(e){this.queueHandler=e}));var yn=0,wn=function(){function e(){this.audioQueueListener=new bn(this.handleAudioQueueMessage),this.subscriptionQueueListener=new bn(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),gn.QueueManager.initialized){var n=window.audio.getCurrent(),i=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);n&&!i&&window.ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(e){var n,i,a=(i={},(n=e)&&n.length&&n.filter((function(e){return!!e})).map((function(e){return e.queues&&e.queues[0]})).forEach((function(e){return i[e.type]=e})),i);a.audio&&t.audioQueueListener.connect(a.audio),a.subscription&&t.subscriptionQueueListener.connect(a.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout((function(){return t.connect(!0)}),3e4))},onFail:function(){return yn<3&&(yn++,setTimeout((function(){return t.connect()}),5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var n=window.audio.playing(),i=0;i<t.events.length;i++){var a=t.events[i].data;if("start"===a.type&&window.audio.getDeviceId()!==a.uuid&&!e.startPlaybackBox&&n){window.audio.pause(),e.showMultipleStreamPopup(a);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach((function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}}))},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);_n.default.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",(function(){_n.default.close()})),e.startPlaybackBox=!0},e.createPopup=function(e){return d.default.elem(pn({title:Object(W.getLang)("mobile_audio_start_playback_title"),description:Object(W.getLang)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:Object(W.getLang)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}(),On="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",Sn=n("xk4V"),kn=n.n(Sn),Cn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},En=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach((function(e){return n.subscribe(e,t)})),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},e.prototype.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},e.prototype.emit=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this.precheck&&!this.precheck.apply(this,Cn([e],n))||(this.onAnyCallBack&&setTimeout((function(){return t.onAnyCallBack.apply(t,Cn([e],n))})),this.subscriptions[e]&&this.subscriptions[e].forEach((function(e){return setTimeout((function(){return e.apply(void 0,n)}))})))},e}(),jn="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",Tn={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var i=jn+jn,a=e.length;a--;)~(n=i.indexOf(e[a]))&&(e[a]=i.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var a=n;for(t=Math.abs(t);a--;)t=(n*(a+1)^t+a)%n,i[a]=t}return i}(e,t),a=0;for(e=e.split("");++a<n;)e[a]=e.splice(i[n-1-a],1,e[a])[0];e=e.join("")}return e},i:function(e,t){return Tn.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),(function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))})),n.join("")}};function In(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":Mn(i[1]);if(i=Mn(i[0]),"string"!=typeof a||!i)return e;for(var r=(a=a?a.split(String.fromCharCode(9)):[]).length;r--;){if(t=(n=a[r].split(String.fromCharCode(11))).splice(0,1,i)[0],!Tn[t])return e;i=Tn[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function Mn(e){if(!e||e.length%4==1)return!1;for(var t,n,i=0,a=0,r="";n=e.charAt(a++);)~(n=jn.indexOf(n))&&(t=i%4?64*t+n:n,i++%4)&&(r+=String.fromCharCode(255&t>>(-2*i&6)));return r}function Dn(e,t){var n="";return e.forEach((function(i,a){var r="/audio?performer=1&q="+encodeURIComponent(i.name),o=window.getWebHost?window.getWebHost():"";i.id&&(r="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+o+r+'">'+i.name+"</a>":i.name,a<e.length-1&&(n+=", ")})),n}function Pn(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[Nt]||"").split("/"),n=(e[Ft]||"").split(","),i=function(e,t){void 0===t&&(t=!0);var n="",i=!nn(e)&&t;if(isArray(e[Vt])&&(n=Dn(e[Vt],i)),isArray(e[$t])&&(n+=" feat. ",n+=Dn(e[$t],i)),!n){var a=e[It]?e[It].replace(/<\/?em>/g,""):"";if(i)n='<a class="artist_link" data-performer="'+a+'" href="'+("/audio?performer=1&q="+encodeURIComponent(a))+'">'+a+"</a>";else n=a}return n}(e,!1);return{id:intval(e[Ct]),owner_id:intval(e[Et]),ownerId:e[Et],fullId:e[Et]+"_"+e[Ct],title:e[Tt]||"",subTitle:e[Ut],performer:i,mainArtists:e[Vt],featArtists:e[$t],authorLink:e[Pt],duration:intval(e[Mt]),lyrics:intval(e[xt]),url:e[jt],flags:e[Lt],context:e[Bt],extra:e[Rt],accessKey:e[Qt],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[Lt]&Jt,canAdd:!!(e[Lt]&Kt),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[Lt]&Xt),isExplicit:!!(e[Lt]&tn),isUMA:!!(e[Lt]&Zt),isReplaceable:!!(e[Lt]&en),ads:e[Ht],album:e[Wt],albumId:intval(e[Dt]),albumPart:intval(e[Yt]),trackCode:e[qt],restrictionStatus:e[zt],chartInfo:e[Gt]}}var xn,Ln,Bn=n("Bj12"),Rn=function(){function e(){}return e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(Bn.saveNetworkStats)(e):Object(y.logError)(new Error("NetworkStatCollector: invalid event."))},e}();!function(e){e.TYPE_NETWORK_AUDIO_ITEM="type_network_audio_item"}(xn||(xn={})),function(e){e.FRAGMENT_LOADED="fragment_loaded",e.FRAGMENT_STALLED="fragment_stalled"}(Ln||(Ln={}));var Nn=function(){function e(e){this.networkStatCollector=e}return e.prototype.logEvent=function(e,t,n){var i,a=((i={network_type:t,network_effective_type:n,type:xn.TYPE_NETWORK_AUDIO_ITEM})[xn.TYPE_NETWORK_AUDIO_ITEM]=e,i);this.networkStatCollector.logEvent(a)},e}();function Fn(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection}function Hn(){var e=Fn();return e&&e.type||"unknown"}function Un(){var e=Fn();return e&&e.effectiveType||"unknown"}var Vn={getConnection:Fn,getConnectionType:Hn,getConnectionEffectiveType:Un,getConnectionTypeID:function(){return{unknown:0,bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7}[Hn()]||0},getConnectionEffectiveTypeID:function(){return{unknown:0,"slow-2g":1,"2g":2,"3g":3,"4g":4}[Un()]||0}};function $n(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}var Wn,qn=n("Xrg9"),zn=function(){return(zn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Yn=function(){function e(e,t){var n=this;this.fullyLoaded=!1,this.url="",this.audioElement=new Audio,this.audioElement.crossOrigin="anonymous",this.audioElement.preload="auto",this.volume=e.volume,this.addEventListeners(e),t&&this.setUrl(t).then((function(){n.audioElement.load()}));var i=new Rn;this.audioNetworkStatCollector=new Nn(i)}return Object.defineProperty(e.prototype,"isFullyLoaded",{get:function(){return this.fullyLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.audioElement.error||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"played",{get:function(){return this.audioElement.played},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"src",{get:function(){return this.url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hls",{get:function(){return this.hlsInstance||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return isFinite(this.audioElement.duration)?this.audioElement.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.audioElement.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audioElement.currentTime},set:function(e){this.audioElement.currentTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.audioElement.volume},set:function(e){this.audioElement.volume=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{set:function(e){this.audioElement.playbackRate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentProgress",{get:function(){return isNaN(this.audioElement.duration)?0:Math.max(0,Math.min(1,this.audioElement.currentTime/this.audioElement.duration))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentBuffered",{get:function(){return this.audioElement.buffered.length?Math.min(1,this.audioElement.buffered.end(0)/this.audioElement.duration):0},enumerable:!0,configurable:!0}),e.prototype.play=function(){return $n(this.audioElement).catch((function(e){switch(e.code){case e.NOT_SUPPORTED_ERR:case e.ABORT_ERR:break;default:throw e}}))},e.prototype.pause=function(){this.audioElement.pause()},e.prototype.addEventListeners=function(e){var t=this;this.audioElement.addEventListener("pause",(function(){return e.onPause()})),this.audioElement.addEventListener("play",(function(){return e.onPlay()})),this.audioElement.addEventListener("progress",(function(){if(e.onBufferUpdate(),!t.hlsInstance){var n=t.audioElement.buffered;n.length&&Math.abs(n.end(n.length-1)-t.audioElement.duration)<1&&(t.fullyLoaded=!0)}})),this.audioElement.addEventListener("timeupdate",(function(){e.onProgressUpdate&&e.onProgressUpdate()})),this.audioElement.addEventListener("ended",(function(){e.onEnd&&e.onEnd()})),this.onFail=e.onFail||function(){},this.audioElement.addEventListener("error",(function(){t.onFail()})),this.audioElement.addEventListener("canplay",(function(){e.onCanPlay&&e.onCanPlay()})),this.audioElement.addEventListener("durationchange",(function(){e.onDurationChange&&e.onDurationChange()}))},e.isHlsUrl=function(e){return In(e).includes(".m3u8")},e.prototype.setUrl=function(t){var n=this,i=In(t);return this.url=i,e.isHlsUrl(i)&&!e.shouldUseNativeHls()&&"function"==typeof window.MediaSource?this.initHls(i).catch((function(){return n.onFail()})):(this.hlsInstance&&this.hlsInstance.destroy(),this.audioElement.src=i,this.audioElement.load(),Promise.resolve())},e.shouldUseNativeHls=function(){var e=window.browser.version.split(".")[0],t=parseInt(e);return window.browser.safari||window.browser.msie_edge&&t>11&&t<78},e.prototype.initHls=function(t){var n=this;return e.loadHls().then((function(e){var i=e.default;return new Promise((function(e){var a=!1,r=!!qn.default.get("_audio_hls_debug");n.hlsInstance&&n.hlsInstance.destroy();var o=new i({debug:r,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});o.on(i.Events.BUFFER_EOS,(function(){return n.fullyLoaded=!0})),o.on(i.Events.ERROR,(function(e,t){t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(a=!0),(r||t.fatal)&&console.log("audio hls error",e,t),t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(o.stopLoad(),o.startLoad()),t.fatal&&n.onFail({type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0})})),o.on(i.Events.FRAG_BUFFERED,(function(e,t){var i=function(){try{return window.isMVK?window.audio.getCurrent():Pn(window.getAudioPlayer().getCurrentAudio())}catch(e){return{id:0,ownerId:0}}}(),r={owner_id:i.ownerId,audio_id:i.id,fragment_id:t.frag.sn.toString(),fragment_duration:Math.ceil(1e3*t.frag.duration).toString(),time_to_first_byte:Math.ceil(t.stats.tfirst-t.stats.trequest).toString(),time_to_first_frame:Math.ceil(t.stats.tload-t.stats.trequest).toString(),buffering_time:Math.ceil(t.stats.tbuffered-t.stats.trequest).toString()};a&&n.audioNetworkStatCollector.logEvent(zn(zn({},r),{event_type:Ln.FRAGMENT_STALLED}),Vn.getConnectionType(),Vn.getConnectionEffectiveType()),a=!1,Object(ie.partConfigEnabled)("network_audio_fragment_loaded")&&n.audioNetworkStatCollector.logEvent(zn(zn({},r),{event_type:Ln.FRAGMENT_LOADED}),Vn.getConnectionType(),Vn.getConnectionEffectiveType())})),o.loadSource(t),o.attachMedia(n.audioElement),n.hlsInstance=o,e()}))}))},e.loadHls=function(){return n.e("hls").then(n.t.bind(null,"ulZh",7))},e}(),Qn=function(){function e(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t.getCurrentTime=function(){return this._currentAudioEl.currentTime},t.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode(On)},t.isCurrent=function(e){return e===this._currentAudioEl},t._createAudioNode=function(e){var t=this,n=new Yn({onBufferUpdate:function(){t.isCurrent(n)&&t.opts.onBufferUpdate(t.getCurrentBuffered())},onProgressUpdate:function(){t.isCurrent(n)&&t.opts.onProgressUpdate(t.getCurrentProgress(),t.getPlayedTime(),t.getCurrentTime())},onEnd:function(){t.isCurrent(n)&&n.src!==On&&t.opts.onEnd()},onSeeked:function(){t.isCurrent(n)&&t.opts.onSeeked()},onSeek:function(){t.isCurrent(n)&&t.opts.onSeek()},onFail:function(e){t._prefetchAudioEl===n?t._prefetchAudioEl=t._createAudioNode():t.isCurrent(n)&&n.src!==On&&(t._hlsError=e,t.opts.onFail&&t.opts.onFail())},onDurationChange:function(){t.isCurrent(n)&&t._seekOnReady&&n.duration>0&&(t.seek(t._seekOnReady),t._seekOnReady=!1)},onCanPlay:function(){t.isCurrent(n)&&t.opts.onCanPlay&&t.opts.onCanPlay()},onPause:this.opts.onPause,onPlay:this.opts.onPlay,volume:this.hasOwnProperty("_volume")?this._volume:this.opts.defaultVolume},e);return n},t.onReady=function(e){e()},t.prefetch=function(e){this._prefetchAudioEl&&this._prefetchAudioEl.url===In(e)||(this._prefetchAudioEl=this._createAudioNode(e))},t.seek=function(e){var t=this._currentAudioEl;t.duration>0&&t.src&&t.src!==On?t.currentTime=t.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t.setPlaybackRate=function(e){this._currentAudioEl.playbackRate=e},t.getCurrentProgress=function(){return this._currentAudioEl.currentProgress},t.getCurrentBuffered=function(){return this._currentAudioEl&&this._currentAudioEl.currentBuffered},t.getDuration=function(){return this._currentAudioEl&&this._currentAudioEl.duration},t.isFullyLoaded=function(){return this._currentAudioEl.isFullyLoaded},t.setUrl=function(e,t){var n,i=this;if(void 0===t&&(t=function(){}),!e)return t&&t(!1);var a=In(e),r=this._currentAudioEl;if(this._currentAudioEl.src&&this._currentAudioEl.src!==On&&(this._seekOnReady=!1),this._currentAudioEl.src===a)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));if(this._prefetchAudioEl){if(this._prefetchAudioEl.src===a)return this._currentAudioEl.pause(),this._currentAudioEl.setUrl(On),this._prefetchAudioEl.readyState>=3&&setTimeout((function(){return i.opts.onCanPlay&&i.opts.onCanPlay()})),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=null,void(t&&t(!0));a!==On&&this._prefetchAudioEl.setUrl(On)}r.src!==a&&(n=r.setUrl(a).then((function(){return i._stopFrequencyAnalise()}))),n?n.then((function(){return t(!0)})).catch((function(){return t(!1)})):t(!0)},t.play=function(){this._stopFrequencyAnalise();var e=this._currentAudioEl;if(e.src){var t=e.play();return this._startFrequencyAnalise(),t}return Promise.resolve()},t.preparePlay=function(){if(browser.safari)return this._currentAudioEl.play()},t._startFrequencyAnalise=function(){var e=this;function t(e,t,n,i){return(n-t)*e/i+t}function n(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,r=null;this._freqUpdateInterval=setInterval((function(){var o;e._currentAudioEl.paused?o=[0,0,0,0]:(++i>3&&(i=0,a=r,r=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)],a||(a=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)])),o=[t(i,a[0],r[0],3),t(i,a[1],r[1],3),t(i,a[2],r[2],3),t(i,a[3],r[3],3)]),e.opts.onFrequency&&e.opts.onFrequency(o)}),50)},t._stopFrequencyAnalise=function(){clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])},t.pause=function(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()},t.stop=function(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t,n){var i=this;e=Math.max(0,Math.min(1,e));var a=this._currentAudioEl,r=0;if(t){var o=e-a.volume;r=o/(t/20||1)}else r=e<a.volume?-.06:.001;if(Math.abs(e-a.volume)<=.001)return this._setFadeVolumeInterval(),n&&n();var s=a.volume;this._setFadeVolumeInterval((function(){!t&&r>0&&(r*=1.35),s+=r;if(r<0?s<=e:s>=e)return i.setVolume(e),i._setFadeVolumeInterval(),n&&n();i.setVolume(s)}))},t.getErrorData=function(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentAudioEl.hls?1:0,url:this._currentAudioEl.src,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},e}();!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(Wn||(Wn={}));var Gn=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var n,i,a=new Promise((function(e,t){n=e,i=t}));return this.tasks.push({name:e,fn:function(){return t().then(n).catch(i)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),a},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter((function(t){return t.name!==e}))},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then((function(){return t.fn()})).then((function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null})))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise((function(t){return e.impl.onReady(t)}))},e.prototype.delay=function(e){return this.newTask(Wn.DELAY,(function(){return new Promise((function(t){return function(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}(t,e)}))}))},e.prototype.setUrl=function(e){var t=this;return this.newTask(Wn.URL,(function(){return new Promise((function(n){return t.impl.setUrl(e,n)}))}))},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(Wn.SEEK),this.newTask(Wn.SEEK,(function(){return new Promise((function(n){t.seekImmediate(e),n()}))}))},e.prototype.pause=function(){var e=this;return this.newTask(Wn.PAUSE,(function(){return new Promise((function(t){e.impl.pause(),t()}))}))},e.prototype.play=function(){var e=this;return window.browser.safari&&this.impl.play(),this.newTask(Wn.PLAY,(function(){return new Promise((function(t,n){e.impl.play().then(t).catch(n)}))}))},e.prototype.setVolume=function(e,t,n){var i=this;if(void 0===n&&(n=null),t){var a=e?Wn.VOL_UP:Wn.VOL_DOWN;return this.newTask(a,(function(){return new Promise((function(t){return i.impl.fadeVolume(e,n,(function(){return t()}))}))}))}return this.newTask(Wn.VOL_SET,(function(){return new Promise((function(t){i.impl.setVolume(e),t()}))}))},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(Wn.PLAYBACK_RATE,(function(){return new Promise((function(n){t.impl.setPlaybackRate(e),n()}))}))},e}();function Kn(e){return Object(r.geByClass)("audio_item_"+e)}function Xn(e){return Kn(e)[0]}function Jn(e){var t=Xn(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=Object(r.gpeByClass)("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var i=n.dataset.playlistId;return i||(console.log("no playlist Id found"),null)}var Zn=n("iwo4"),ei=window.audio||function(){var e=Object(r.ssGet)("audio_vol"),t="number"==typeof e?e:.8,n={onPause:function(){Object(Y.statlogsValueEvent)("mvk_audio_player_listening",h[m].id,ei.getCurrentProgress()),b&&(b=!1,ssSet("audio_play","0"),clearTimeout(O));s.emit(kt.events.PAUSE,I())},onPlay:function(){b||(b=!0,ssSet("audio_play","1"),clearTimeout(O),O=setTimeout(D,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void ei.pause();s.emit(kt.events.PLAY,I())},onBufferUpdate:function(e){s.emit(kt.events.BUFFERED,I(),e,ei.duration())},onEnd:function(){if(l>0)return;s.emit(kt.events.ENDED,I()),w?(w=!1,ei.next()):y=!0},onProgressUpdate:function(e,t,n){if(ti.isPlaying())return;if(!e&&n)try{e=n/ei.duration()}catch(e){}s.emit(kt.events.PROGRESS,I(),e,ei.duration(),t),e>.01&&(E=t);ssSet("audio_pos",e),!w&&a.getDuration()-a.getCurrentTime()<.5&&(w=!0);if(e>.8&&C){var i=function(){var e=m+1;if(e&&h&&e<h.length)return h[e];return null}();i&&a.isFullyLoaded()&&(C=!1,function(e){e&&e.url&&a.prefetch(e.url)}(i))}y&&(y=!1,ei.next())},defaultVolume:t},i=!(browser.safari||browser.chrome&&browser.version<50),a=new Qn(n),o=new Gn(a),s=new En,l=0,c=null,d={},_=new wn,f=!1,p=srand(),h=[],m=null,v={},g="",A=null,b=!1,y=!1,w=!1,O=null,S=!1,k=!1,C=!1,E=0;function j(e,t){if(void 0===t&&(t=!1),!ei.support)return!1;var n;if(b&&ei.pause(),s.emit(kt.events.DESELECT,T()),(n=ei.canRepeat!==Zn.audioRepeat.ONE||t?m+e:m)>=h.length||n<0){if(ei.canRepeat!==Zn.audioRepeat.ALL&&ei.canRepeat!==Zn.audioRepeat.ONE)return!1;n=n>=h.length?0:Math.max(0,h.length-1)}Object(Y.statlogsValueEvent)("mvk_audio_player_listening",h[m].id,ei.getCurrentProgress());var i=h[n];ei.play(i.fullId).then((function(t){t||j(e>0?e+1:e-1)})).catch((function(){}))}function T(){return h[m]||!1}function I(){return T().fullId||!1}function M(e){return function(e){return new Promise((function(t,n){c&&c(),c=n;var i=[];if(d=d||{},e)if(e.url)t(e);else{var a=v[e.fullId];if(a>=0)for(var r=a;r<a+3;r++){var o=h[r];o&&!o.url&&!d[o.fullId]&&o.urlHash&&(i.push(o.fullId+"_"+o.actionHash+"_"+o.urlHash),d[o.fullId]=!0)}ajax.post("/audio",{act:"reload_audio",ids:i.join(",")},{onDone:function(i){i?(i.forEach((function(n){var i=Pn(n),a=h[v[i.fullId]];a&&(a.url=i.url),Kn(i.fullId).forEach((function(e){try{var t=JSON.parse(e.dataset.audio);t[jt]=i.url,e.dataset.audio=JSON.stringify(t)}catch(e){}})),i.fullId===e.fullId&&(e.url=i.url,t(e)),delete d[i.fullId]})),n()):n()},onFail:n})}else n()})).catch((function(){return d={}}))}(e).then((function(e){o.clearTask(Wn.URL);var t=e.url;if(!t)throw new Error;return o.setUrl(t).then((function(t){t?l=0:(o.clearAllTasks(),s.emit(kt.events.FAILED),b&&l<2&&(e.pause(),e.next(),l++))}))}))}function D(){if(b){var e=lsGet("audio_current_player");p!=e?ei.pause():O=setTimeout(D,100)}}function P(e){ssSet("audio_query",e),S&&Object(hn.setCookie)(S+"q",encodeURIComponent(e),1)}return{support:!0,canRepeat:Zn.audioRepeat.ALL,shuffled:!1,onInit:Object(u.default)(),init:function(e){!k&&ei.support&&(k=!0,e.cookie&&(S=e.cookie,e.cookie_path||"/"),onDOMReady((function(){!function(e){var t=Object(r.ssGet)("audio_id"),n=Object(r.ssGet)("audio_pos"),i=Object(hn.getCookie)(S+"_playlist");e.playlist&&e.playlist.length&&(i&&ei.setPlaylistId(i),ei.playlist((e.playlist||[]).map(Pn),{q:e.playlist_q||""})),t&&ei.select(t).then((function(){n<1&&ei.setPosition(n,!0)})).catch((function(){}))}(e),ei.onInit()})))},subscribe:function(e,t){return s.subscribe(e,t)},unsubscribe:function(e,t){return s.unsubscribe(e,t)},notify:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];s.emit.apply(s,[e].concat(n))},getCurrent:T,getCurrentId:I,operate:function(e){if(!ei.support)return!1;!e||h[m]&&e===I()?b?ei.pause():ei.play():(Object(Y.statlogsValueEvent)("mvk_audio_player_listening",T().id,ei.getCurrentProgress()),ei.play(e))},setPlaylistId:function(e){e!==A&&(A=e,s.emit(kt.events.PLAYLIST_CHANGED))},playing:function(){return b},select:function(e){if(!ei.support)return Promise.reject();if(!e)return Promise.reject();h.length||s.emit(kt.events.EMPTY_PLAYLIST,e);var t=h[v[e]];return t?(I()&&s.emit(kt.events.DESELECT,T()),M(t).then((function(){m=v[e],C=!0,s.emit(kt.events.SELECT,h[m]);var t,n=Jn(e);n&&A!==n&&ei.setPlaylistId(n),t=I(),ssSet("audio_id",t),S&&(Object(hn.setCookie)(S,t,1),Object(hn.setCookie)(S+"_playlist",A,1))})).catch((function(){return Promise.reject()}))):(s.emit(kt.events.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){ei.play(e)},getCurrentPlaylistId:function(){return A},play:function(e){var t=this;if(ei.support)return new Promise((function(n){var r=e===I();return b&&r?(ei.pause(),n(!0)):ti.isPlaying()?(e&&!r?(ei.select(e).catch((function(){})),ti.resume()):b?ti.pause():ti.resume(),n(!0)):(b=!0,!e||r?(t._play(),n(!0)):(a.setUrl(On),void ei.select(e).then((function(){if(s.emit(kt.events.PLAY_REQUESTED,e),!Object(ie.partConfigEnabled)("mvk_audio_ads")||!i)return t._play(),n(!0);o.clearAllTasks(),ti.startPlay(h[v[e]],(function(){return t._play(),n(!0)}))})).catch((function(){return b=!1,I()&&ei.select(I()),n(!1)}))))}))},_play:function(){T()&&(o.play().then((function(){ssSet("audio_play","1"),_.connect()})).catch((function(){b=!1,s.emit(kt.events.PAUSE)})),lsSet("audio_current_player",p))},clearCurrentPlaylist:function(){if(!ei.support)return!1;b&&!ti.isPlaying()&&ei.pause(),T()&&s.emit(kt.events.DESELECT,T()),h=[],g="",m=null,ei.setPlaylistId(null),v={},P(g)},pause:function(){if(!ei.support)return!1;b&&(ti.isPlaying()?ti.pause():a.pause(),b=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=kn()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return ei.isAdsPlaying()?ti.getCurrentProgress()*ti.getDuration():a.getCurrentTime()},getCurrentProgress:function(){return ei.isAdsPlaying()?ti.getCurrentProgress():a.getCurrentProgress()},setPosition:function(e,t){if(!ei.support)return!1;var n=0;t?n=e:e&&ei.duration()&&(n=e/ei.duration()),o.seek(n).then((function(){ssSet("audio_pos",n),s.emit(kt.events.SEEK,I(),n,ei.duration())}))},volume:function(e){if(!ei.support)return!1;if(void 0===e)return t;var n=Math.min(1,Math.max(0,e));t=n,o.setVolume(t),ssSet("audio_vol",t),ti.updateVolume(),s.emit(kt.events.VOLUME,I(),t)},loaded:function(){return a.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return ti.getDuration();var e=a.getDuration(),t=h[m]&&h[m].duration;return e||t||0},played:function(){return a.getPlayedTime()},getListenedTime:function(){return E},next:function(e){return void 0===e&&(e=!1),j(1,e)},prev:function(e){return void 0===e&&(e=!1),j(-1,e)},shuffle:function(){var e=ei.isPlaying()&&!ei.isAdsPlaying(),t=ei.getPosition(),n=ei.getCurrentId();ei.pause(),ei.shuffled=!ei.shuffled,ei.shuffled?(h.forEach((function(e,t){return e.position=t})),h.sort((function(){return Math.random()-.5}))):h.sort((function(e,t){return e.position-t.position})),v=h.reduce((function(e,t,n){return e[t.fullId]=n,e}),{}),n&&(ei.select(n),ei.setPosition(t),e&&requestAnimationFrame((function(){return ei.play()})))},repeat:function(){switch(ei.canRepeat){case Zn.audioRepeat.NONE:ei.canRepeat=Zn.audioRepeat.ALL;break;case Zn.audioRepeat.ALL:ei.canRepeat=Zn.audioRepeat.ONE;break;case Zn.audioRepeat.ONE:ei.canRepeat=Zn.audioRepeat.NONE;break;default:ei.canRepeat=Zn.audioRepeat.NONE}},playlist:function(e,t){return!!ei.support&&(void 0===e?h:(b&&!ti.isPlaying()&&ei.pause(),T()&&s.emit(kt.events.DESELECT,T()),h=e,g=t&&t.q||"",m=null,v={},each(e,(function(e,t){return v[t.fullId]=e})),void P(g)))},addToPlaylist:function(e,t){var n={},i=t||h.length;h.forEach((function(e){return n[e.fullId]=!0})),e.forEach((function(e){n[e.fullId]||(t?h.splice(i,0,e):h.push(e))}))},playlist_q:function(){return g},setIsPlaying:function(e){b=e},isAdsPlaying:function(){return ti.isPlaying()},isPlaying:function(){return b},initSplash:function(){f||(window.audioRestrictionSplash=new dn,f=!0)},playNothing:function(){a.setUrl(On,(function(){}))},events:kt.events}}();window.Artist=yt,window.Curator=Ot;var ti=new an(new on(ei),null,!0);ei.ads=ti,window.audio=ei,window.AudioBackgroundRestriction=mn,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",(function(){Object(ie.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new mn)})),document.addEventListener("DOMContentLoaded",(function(){"audio"===cur.module&&ei.initSplash()})),window.page.onChange((function(){"audio"===cur.module?ei.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()}));var ni,ii,ai=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,(function(i,a){if(a.event===e&&a.listener===t)return n=i,!1})),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(kt.events.PLAY,e,t)},t.listenPause=function(e,t){this.listen(kt.events.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(kt.events.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(kt.events.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(kt.events.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(kt.events.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(kt.events.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(kt.events.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(kt.events.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}(),ri=n("BJj/"),oi=((ni={}).start=1,ni.stop=2,ni.volume=3,ni.rewind=4,ni.play_further=5,ni.added=6,ni.removed=7,ni.recommendation_removed=8,ni.show_album=9,ni.share_audio=10,ni.broadcast=11,ni.curator=12,ni),si=((ii={}).default=1,ii.next_track=2,ii.prev_track=3,ii.auto=4,ii.interruption=5,ii.pause=6,ii.new=7,ii.close_app=8,ii.queue=9,ii.pause=10,ii.upload=11,ii.on=12,ii.off=13,ii.follow=14,ii.unfollow=15,ii),li=function(){function e(e){if(this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,vk.id)this.uniqueUserId=null;else{var t=qn.default.get("audio_unique_unauth_id");t?this.uniqueUserId=t:(this.uniqueUserId=kn()(),qn.default.set("audio_unique_unauth_id",this.uniqueUserId))}this.debug=e.isDebug(),this.onVolume=Object(ri.debounce)(this.onVolume.bind(this),300),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return"auto";var e=this.playerAdapter.getSequence();if(e)return e>0?"next_track":"prev_track";var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?"pause":"new"},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.currentAudioId!==this.pausedAudioId,a=this.playerAdapter.getListenedTime();!n&&i&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,a=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=a,this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition,listened:a}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this,t=this.playerAdapter.getAudioId();if(this.canOperate()&&t){var n=this.collectListenedData();this.sendListenedDataDelayed(1e3,n),setTimeout((function(){if(!(e.currentAudio&&t!==e.currentAudio.fullId||vkNow()-e.playedTime<150)){e.pausedAudioId=t;var n=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:"stop",subtype:n?"queue"===n?"queue":"interruption":"pause"})}}),100)}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:"volume",subtype:"default"})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent(Object(j.default)({type:"rewind",subtype:"default"},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason="session_end"),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:"stop",subtype:"auto"}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],a=n[1];this.sendAudioEvent({type:"play_further",subtype:"default",ownerId:i,audioId:a})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n="new",i=this.playerAdapter.getSequence(),a=e.fullId.split("_"),r=a[0],o=a[1];this.playerAdapter.isAutoPlayed()?n="auto":i&&(n=i>0?"next_track":"prev_track"),this.sendCurrentAudioEvent({type:"stop",subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:r,audioId:o}),this.wasEnded=!0,this.collectListenedData(e),this.collectListenedDataSwitch();var s=this.listenedData;this.listenedData=null,this.sendListenedData(s)}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:"stop",subtype:"close_app"}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if("session_end"===this.listenedData.end_stream_reason)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(e){void 0===e&&(e=null);var t=e||this.currentAudio;if(this.canOperate()&&t){var n=t.fullId,i=t.trackCode||this.playerAdapter.getAudioTrackCode(),a=this.getListenedTime(),r=t.urlHash;if(r||console.log("no url hash"),a&&r){var o={audio_id:n,listened:a,context:this.playerAdapter.getContext(),hash:r};return window.cur&&vk.widget&&(o.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(o.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(o.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(o.shuffled=1)),i&&(o.track_code=i),this.playerAdapter.isRepeatCurrentAudio()?o.repeat="one":this.playerAdapter.isRepeatAll()&&(o.repeat="all"),this.playerAdapter.isAutoPlayed()&&(o.auto=1),this.playerAdapter.hasPrevAudio()&&(o.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(o.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(o.end_stream_reason="stop_btn"),o.state=document.hidden?"background":"app",this.listenedData=o,this.sendListenedDataDelayed(1e4,o),o}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&(this.uniqueUserId&&(t.unique_id=this.uniqueUserId),this.playerAdapter.sendListenedData(t))},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout((function(){return n.sendListenedData(t)}),e)},t.serializeEvent=function(e){var t=[oi[e.type],si[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(""),e.targetOwnerId?t.push(e.targetOwnerId):t.push(0),this.uniqueUserId?t.push(this.uniqueUserId):t.push(""),e.positionTo?t.push(e.positionTo):t.push(null),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),Y.statlogsValueEvent.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent(Object(j.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),{},this.getCurrentAudioParams(),{},e))},t.sendAudioEvent=function(e){var t=Object(j.default)({},e,{},this.getEnvParams());!vk.id&&this.uniqueUserId&&(t.uniqueUnauthId=this.uniqueUserId),this.sendEvent(t)},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}(),ci=n("dI71"),ui=function(e){function t(){return e.apply(this,arguments)||this}Object(ci.default)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?2:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return Jn(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],a=t[2],r=t[3];return n&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+r:a:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);"other"===t&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context="other"},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?"search":"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?"group_list":"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?"search":0===e.indexOf("wall")?"group_list":0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":"other"},n.getContext=function(){return this.context||"other"},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,playlist_id:e.playlist_id,end_stream_reason:e.end_stream_reason,auto:e.auto,unique_user_id:e.unique_id})},t}(ai),di=n("jE6c"),_i=n("TZ9a"),fi=n("YR85"),pi=n("N25v"),hi=n("cZvj"),mi=n("QdNn");function vi(e){var t="ai_controls";e.position&&(t+=" ai_has_position");var n=e.can_del?"true":"false",i="return window.audioplayer.morePopup(event, '"+e.audio_id+"', '"+e.access_key+"', "+n+");",a=e.is_authenticated?"audioplayer.setPosition(this, event);":null,r=e.is_authenticated?"audioplayer.sliderMove(event);":null,o=e.is_authenticated?"audioplayer.sliderUp(event);":null,s="aic_line";return e.is_authenticated||(s+=" aic_line_blocked"),{inner:[{inner:[gi(e),e.has_actions_menu?{inner:[{class:"i_pointer",tag:"i"},{class:"ai_menu_toggle_button",onClick:i,"aria-label":Object(W.getLang)("mobile_more"),tag:"button"}],class:"ai_menu_wrap",tag:"div"}:null,{inner:[e.position?{inner:[e.position],class:"ai_position",tag:"div"}:null,e.duration?{inner:[e._duration_title],class:"ai_dur","data-dur":e.duration,onClick:"audioplayer.switchTimeFormat(this, event);",tag:"time"}:null,{inner:[{inner:[Wd.wrap(e.title),e.subtitle?{inner:[Wd.wrap(e.subtitle)],class:"ai_subtitle",tag:"span"}:null],class:"ai_title",tag:"span"},e.title?{inner:[Wd.wrap(" &ndash; ")],class:"divider",tag:"span"}:null,{inner:[Wd.wrap(e.artist)],class:"ai_artist",tag:"span"}],class:"ai_label",tag:"div"},{type:"hidden",value:e.url,tag:"input"}],class:"ai_body",tag:"div"}],class:"ai_info",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{class:"aic_ln aic_load_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:s,onTouchStart:e.is_mobile?a:null,onMouseDown:e.is_mobile?null:a,onTouchMove:e.is_mobile?r:null,onTouchEnd:e.is_mobile?o:null,onTouchCancel:e.is_mobile?o:null,onMouseMove:e.is_mobile?null:r,onMouseUp:e.is_mobile?null:o,onClick:"cancelEvent(event);",tag:"div"}],class:"aic_progress_wrap",tag:"td"},{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_line",onTouchStart:e.is_mobile?"audioplayer.setVolume(this, event);":null,onMouseDown:e.is_mobile?null:"audioplayer.setVolume(this, event);",onTouchMove:e.is_mobile?"audioplayer.sliderMove(event);":null,onTouchEnd:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onTouchCancel:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onMouseMove:e.is_mobile?null:"audioplayer.sliderMove(event);",onMouseUp:e.is_mobile?null:"audioplayer.sliderUp(event);",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_volume_wrap",tag:"td"}],tag:"tr"}],class:"row_table",tag:"table"}],class:t,tag:"div"}],tag:"div"}}function gi(e){var t=e.is_playlist_forced?", true":"",n="audioplayer.playPause(event, '"+e.audio_id+"'"+t+");",i="",a=e.has_cover?Object(T.default)(Object(_i.getPlayOnCover24Icon)()):Object(T.default)(Object(fi.getPlay24Icon)()),r=e.has_cover?Object(T.default)(Object(pi.getPauseOnCover24Icon)()):Object(T.default)(Object(hi.getPause24Icon)());return e.has_cover&&!e.cover_style&&(i={inner:[Object(T.default)(Object(mi.getSongOutline28Icon)())],class:"ai_cover_placeholder",tag:"span"}),{inner:[i,{inner:[a],class:"i_play",tag:"span"},{inner:[r],class:"i_pause",tag:"span"}],class:"ai_play",style:e.cover_style,onClick:n,tag:"button"}}var Ai=function(e){var t=e.is_playlist_forced?", true":"",n=e.is_disabled?"":"audioplayer.playPause(event, '"+e.audio_id+"'"+t+")",i=e.classes||[],a={};a[e.audio_id]=!0;var r=[c.default.class("audio_item",a),e.is_no_progress&&"ai_noProgress",e.is_focus&&"ai_focus",e.is_explicit&&"audio_item_explicit",e.is_disabled&&"audio_item_disabled",(e.can_add||e.can_del)&&"ai_has_btn",!e.has_actions_menu&&"ai_no_menu",e.has_cover&&"ai_has_cover"];e.is_attachment&&r.push("ai_select");var o=Object(W.mergeArrays)(r,i).filter((function(e){return e})).join(" ");return e.is_attachment?{inner:[vi(e)],"data-id":e.audio_id,class:o,"data-audio":e.serialized,href:e.attachment_action,tag:"a"}:{inner:[vi(e)],"data-id":e.audio_id,"data-playlist-id":e.playlist_id,class:o,onClick:n,"data-audio":e.serialized,tag:"div"}},bi=window.audio,yi=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},i=!1,a=!1,r=!1,o=[],l=null;function c(e){if(e){$$("#lm_player").forEach((function(e){show(e)})),$$("#lm_audio").forEach((function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),bi.isAdsPlaying()&&U(e,!0)}));var t=Kn(e.fullId);t&&each(t,(function(t,n){bi.isAdsPlaying()?(H(e,!0),addClass("ai_playing",n)):(k(n,0),E(n,0),S(n,D(0,bi.duration()))),T(n,bi.volume()),addClass("ai_current",n)}))}else $$("#lm_player").forEach((function(e){hide(e)}))}function _(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}));var a=Kn(t);a&&(each(a,(function(e,t){S(t,I(i)),removeClass("ai_playing",t),removeClass("ai_current",t)})),n[t]&&delete n[t],bi.isAdsPlaying()&&H(e,!1))}function f(e,t,i,a){var r=Kn(e);if(r.length){var o=t*(i||0);each(r,(function(e,n){m||E(n,t),S(n,yi.getFormatedTime(o,i))})),o>1&&(n[e]=1)}}function p(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(n){if(n){var i=n.map((function(e){return Pn(e)}));bi.playlist(i),bi.setPlaylistId(e),t&&t(i)}}})}function h(e,t){void 0===t&&(t=!1);var n=Xn(e),i=gpeByClass("audios_list",n)||gpeByClass("AudioBlock",n),a=geByClass("audio_item",i),r=[],o=!1;each(a,(function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var a=Pn(i);r.push(a),a.fullId===e&&(o=!0)}})),bi.playlist(r,{q:attr(i,"data-query")}),t&&o&&o&&bi.play(e)}onDOMReady((function(){window.playerAdapter=new ui(bi);new li(window.playerAdapter)})),bi.subscribe(kt.events.PLAY,(function(e){var t=bi.getCurrent();t&&bi.playing()&&!bi.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:bi.getDeviceId()});e,$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}));var n=Kn(e);if(!n)return;each(n,(function(e,t){addClass("ai_playing",t),addClass("ai_current",t)})),o[o.length-1]!==e&&o.push(e);r?r=!1:(a=i,i=!1,yi.onPlay(e));R()})),bi.subscribe(kt.events.PLAY_REQUESTED,(function(e){F(e)})),bi.subscribe(kt.events.PAUSE,(function(e){$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)})),R();var t=Kn(e);if(!t.length)return;each(t,(function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)})),r||(yi.onPause(e),R())})),bi.subscribe(kt.events.SELECT,c),bi.subscribe(kt.events.DESELECT,_),bi.subscribe(kt.events.PROGRESS,f),bi.subscribe(kt.events.SEEK,f),bi.subscribe(kt.events.AD_STARTED,(function(e){H(e,!0),U(e,!0)})),bi.subscribe(kt.events.AD_COMPLETED,(function(e){H(e,!1),U(e,!1),f(e.id,0,0)})),bi.subscribe(kt.events.NOT_FOUND_PLAYLIST,h),bi.subscribe(kt.events.EMPTY_PLAYLIST,h),bi.subscribe(kt.events.ENDED,(function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,(function(e,t){E(t,1)})),i=!0,yi.onEnded(e))})),bi.subscribe(kt.events.VOLUME,(function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,(function(e,n){T(n,t)})),yi.onVolume(e,t))}));var m=null,v=null,g=!1,A=!1,b=!1;function y(e){if(m){b||(addEvent(document,C.isTouch?"touchmove":"mousemove",y),addEvent(document,C.isTouch?"touchend touchcancel":"mouseup",w),b=!0);var t=gpeByClass("audio_item",m),n=O(m,e);e&&cancelEvent(e);var i=Kn(attr(t,"data-id"));each(i,(function(e,t){g&&E(t,n),A&&(T(t,n),bi.volume(n))})),v=n}}function w(e){if(m){b=!1,removeEvent(document,C.isTouch?"touchmove":"mousemove",y),removeEvent(document,C.isTouch?"touchend touchcancel":"mouseup",w);var t=gpeByClass("audio_item",m),n=O(m,e)||v;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,(function(e,i){g&&(E(i,n),bi.setPosition(n,!0)),A&&T(t,n)})),g&&(r=bi.playing(),yi.onSeek(n)),m=v=null,g=A=!1}}function O(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,a=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,r=e.offsetWidth-i;return r?Math.max(0,Math.min(a/r,1)):0}function S(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function k(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function E(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function T(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function I(e){var t,n,i,a=e<0;return t=(n=(e=Math.round(a?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),a&&(t="-"+t),t}function D(e,n){return I(t&&n?e-n:e)}function P(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function x(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function L(e,t,n){void 0===n&&(n=null),t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),r=geByClass1("ai_add",a);val(r,t?lang.global_delete_audio:lang.global_add_to_audio),V[e]=t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function B(e,t,n){void 0===n&&(n=null),t?P(e):x(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),r=geByClass1("ai_del",a);val(r,t?lang.global_add_to_audio:lang.global_delete_audio),V[e]=!t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function R(){var e=window.audio.getCurrentId(),t=Kn(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach((function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)})),each(geByClass("_AudioPlayStatus"),(function(e,t){var n=i&&t.dataset.playlistId===bi.getCurrentPlaylistId();toggleClass(t,"playing",n)}))}function N(e,t,n){if(window.isArticleWebView)return Article.audioPlay(bi.getCurrentId(),bi.playlist()),cancelEvent(e),!1;var i=window.lang;if(bi.support){var a=Xn(t);if(a&&hasClass("ai_deleted",a)&&!hasClass("ai_current",a))return!0;n&&t!==bi.getCurrentId()||Jn(t)!==bi.getCurrentPlaylistId()?h(t,!0):bi.operate(t)}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function F(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=Kn(e);bi.playing()?(each(i,(function(e,t){addClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}))):(each(i,(function(e,t){removeClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}))),null!==t&&null!==n&&each(i,(function(e,i){k(i,t/n),addClass("ai_current",i)}))}function H(e,t){var n=Xn(e.fullId);toggleClass("ad_mode",n,t);var i=geByClass1("ai_title",n);val(i,t?Object(W.getLang)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t)}function U(e,t){geBySel(".audio_item.al_player").forEach((function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?Object(W.getLang)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t),toggleClass("ad_mode",n,t),toggle(geByClass1("ai_artist"),!t)}}))}var V={},$={};return page.onChange((function(){V={},$={}})),{init:function(t){e||(e=!0,onDOMReady((function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&bi.playlist().length&&yi.openPlayer(geByClass1("AudioPlayerMini"),!0)})))},initAudio:function(){each(geByClass("ai_current"),(function(e,t){_(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return Pn(t)}(t))}));var e=bi.loaded(),t=bi.getPosition(),n=bi.duration(),i=n?t/n:0;F(bi.getCurrentId(),e,n),c(bi.getCurrent()),f(bi.getCurrentId(),i,n),setTimeout((function(){R()}),1)},getDOMFromAudio:function(e,t,n,i){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var a=Pn(e);if(!a)return"";var r=Object(di.htsc)(a.ownerId+"_"+a.id),o=a.coverUrl_p||a.coverUrl_s,s=e,l=[];if(function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(r)){if(n)return"";l.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(r)&&l.push("ai_added"),r===bi.getCurrentId()&&(bi.playing()&&l.push("ai_playing"),l.push("ai_current"));var c=!!vk.id&&(!a.isClaimed||a.canDelete);vk.id||l.push("ai_no_menu");var u=new Ai({is_playlist_forced:t,is_disabled:a.isClaimed,audio_id:r,is_authenticated:!!vk.id,login_redirect_url:"",is_explicit:a.isExplicit,can_add:a.canAdd,can_del:a.canDelete,serialized:JSON.stringify(s),classes:l,has_cover:i,cover_style:o?"background-image: url("+o+")":"",has_actions_menu:c,position:a.chartInfo?a.chartInfo.position:"",duration:a.duration,is_mobile:C.isTouch,_duration_title:I(a.duration),title:a.title,subtitle:a.subtitle,artist:a.performer,url:a.url});return d.default.html(u)},morePopup:function(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),null===t){var a=bi.getCurrent()||{};t=a.fullId,n=a.accessKey,i=a.canDelete,$[t]=a}var r="";r=void 0!==V[t]?V[t]?Object(W.getLang)("global_delete_audio"):Object(W.getLang)("global_add_to_audio"):i?Object(W.getLang)("global_delete_audio"):Object(W.getLang)("global_add_to_audio"),G.default.open(d.default.elem(Object(G.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[{tag:"ul",class:"ContextMenu__list",inner:[!i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:r,onclick:"return audioplayer.add('"+t+"', '"+n+"', event, this);"}]},i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:r,onclick:"return audioplayer.del('"+t+"', event, this);"}]}]}]})),!0),e&&cancelEvent(e)},add:function(e,t,n,i){void 0===t&&(t=null),void 0===i&&(i=null);var a=Xn(e);if(!hasClass("ai_ajax",a)){var r=a?Pn(JSON.parse(a.dataset.audio)):$[e]||{};$[e]||($[e]=Object(j.default)({},r));var o=!1;a?(o=hasClass("ai_added",a),$[e].deleteid=attr(a,"data-deleteid"),$[e].deleteHash=attr(a,"data-delete-hash")):void 0!==V[e]&&(o=V[e]),r.deleteid=r.deleteid||$[e].deleteid,r.deleteHash=r.deleteHash||$[e].deleteHash,r.restoreHash=r.restoreHash||$[e].restoreHash,L(e,!o,i),addClass("ai_ajax",a),yi.onAdd(),i&&(i.disabled=!0),ajax.post("/audio",{_ajax:1,act:o?"delete":"add",audio:o?r.deleteid:r.fullId,hash:o?r.deleteHash:r.addHash,access_key:t,track_code:r.trackCode,source_playlist_id:Jn(r.fullId)},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",a),t?($[e].deleteid=t,$[e].deleteHash=n,attr(a,"data-deleteid",t),attr(a,"data-delete-hash",n)):L(e,o,i),i&&(i.disabled=!1)},onFail:function(){removeClass("ai_ajax",a),L(e,o,i);var n=Array.prototype.slice.call(arguments),s=n.shift();switch(s){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(o?r.deleteHash:r.addHash)+"&access_key="+t)}i&&(i.disabled=!1)}}),n&&cancelEvent(n)}},del:function(e,t,n){void 0===n&&(n=null);var i=Xn(e),a=!1;i?a=hasClass("ai_deleted",i):void 0!==V[e]&&(a=!V[e]),B(e,!a,n);var r=i?Pn(JSON.parse(i.dataset.audio)):$[e]||{};$[e]||($[e]=Object(j.default)({},r)),a?x(e):P(e),yi.onDel(),n&&(n.disabled=!0),r.deleteid=r.deleteid||$[e].deleteid,r.deleteHash=r.deleteHash||$[e].deleteHash,r.restoreHash=r.restoreHash||$[e].restoreHash,ajax.post("/audio",{_ajax:1,act:a?"restore":"delete",audio:e,playlist_id:Jn(e),hash:a?r.restoreHash:r.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||B(e,a,n),n&&(n.disabled=!1)},onFail:function(){B(e,a,n);var t=Array.prototype.slice.call(arguments),i=t.shift();switch(i){case 2:nav.go("/audio?act="+(a?"restore":"delete")+"&audio="+e+"&hash="+(a?r.restoreHash:r.deleteHash))}n&&(n.disabled=!1)}}),t&&cancelEvent(t)},playPause:N,getFormatedTime:D,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),S(Xn(bi.getCurrentId()),D(bi.getPosition(),bi.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){m||bi.isAdsPlaying()||(m=e,g=!0,y(t))},setVolume:function(e,t){m||(m=e,A=!0,y(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,a=n.getCurrentPlaylistId(),r=nav.params;a&&!r.includes("playlist_id")&&(r=(r?r+"&":"")+"playlist_id="+a);var o=i+(r?"?":"")+r+"#player";return nav.al_go(o,null,{local:!0,target:e,nav:{push:o,path:i,params:r,hash:"#player"},no_push:t})},getCurrentElem:function(){return Object(M.$)(".ai_current")},playFirst:function(e,t){e&&cancelEvent(e);var n=bi.getCurrent(),i=gpeByClass("_audioPlaylist",t),a=n?n.fullId:null;if(!a||!geByClass1("ai_current",i)){var r=(i||ge("mcont")).$(".audio_item");a=r&&r.getAttribute("data-id")}a&&N(e,a)},hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return o},isAutoPlayed:function(){return a},playBlock:function(e,t,n){bi.getCurrentPlaylistId()!==e?p(e,(function(t){if(t.length){var i=t[0].fullId;bi.select(i).then((function(){bi.play(i),n.classList.add("playing"),n.dataset.playlistId=e}))}})):bi.operate()},playShuffledBlock:function(e,t){e.preventDefault(),p(t.dataset.blockId,(function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}}))},openModal:function(e,t){var n=t.parentElement.querySelector(".Popup");return G.default.open(n,!0),l=Object(s.expandPopup)(t),cancelEvent(e),!1},closeModal:function(e){G.default.close(e),l&&l()},onAdd:Object(u.default)(),onDel:Object(u.default)(),onPlay:Object(u.default)(),onPause:Object(u.default)(),onProgress:Object(u.default)(),onVolume:Object(u.default)(),onSeek:Object(u.default)(),onPlaylistChanged:Object(u.default)(),onEnded:Object(u.default)(),sliderMove:y,sliderUp:w}}();window.audioplayer=yi,window.Section=he;var wi=n("vR9X");var Oi=function(e){var t=e.y<.5,n=100*e.x,i=100*e.y;return{class:"Photo__marketTag",attrs:{"data-url":e.url,style:"left: "+n+"%; top: "+i+"%"},inner:[{class:"Photo__marketTagInner "+(t?"Photo__marketTagInner--down":""),inner:[{class:"Photo__marketTagTitle",inner:e.title},{class:"Photo__marketTagPrice",inner:Wd.wrap(e.price)},{class:"Photo__marketTagIcon",inner:Object(T.default)(Object(wi.getGotoArrowBlackIcon)())}]},{class:"Photo__marketTagArrow "+(t?"Photo__marketTagArrow--down":"")}]}},Si=n("Weg4");var ki=function(e){return{class:"Photo__marketShowMoreButton",attrs:{"data-items-json":e.items},inner:[{class:"Photo__marketShowMoreButtonIcon",inner:Object(T.default)(Object(Si.getMarket16Icon)())},getLang("mobile_photos_show_market_items")]}};var Ci=function(e){return{tag:"a",attrs:{"data-is-fave":e.isFave?"fave":""},class:"PhotoMarketItem__fave "+(e.isFave?"PhotoMarketItem__fave--added":""),onclick:["ItemsList._toggleFave","event","this",e.type,e.typeInt,e.ownerId,e.itemId,e.href,e.faveHash]}};var Ei=function(e){return{class:"PhotoMarketItem",attrs:{"data-item-id":e.item_id},inner:[{class:"PhotoMarketItem__thumb",tag:"img",src:e.thumb},{class:"PhotoMarketItem__title",inner:e.title},{class:"PhotoMarketItem__price",inner:Wd.wrap(e.price)},Ci({type:e.type,typeInt:e.type_int,isFave:e.is_fave,itemId:e.item_id,ownerId:e.owner_id,href:e.href,faveHash:e.fave_hash})]}};function ji(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return Ti(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ti(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function Ti(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Ii=function e(t){for(var n,i=[],a=ji(JSON.parse(unescape(t.itemsJSON)));!(n=a()).done;){var r=n.value,o=e._faveCache[r.item_id];void 0===o&&(o=r.is_fave),i.push({onclick:["ItemsList._goToItem",r],class:"PhotoItemsList__item",inner:Ei(Object.assign({},r,{is_fave:o}))})}for(var s=0;s<10;s++)i.push({class:"PhotoItemsList__item PhotoItemsList__item--filler"});return{class:"PhotoItemsList",inner:[{class:"PhotoItemsList__header",inner:[{class:"PhotoItemsList__closeIcon",onclick:t.onClose},getLang("mobile_photos_market_items_title")]},{class:"PhotoItemsList__body",inner:i}]}};Ii._faveCache={},Ii._onClose=function(){Ii._itemsPopup&&(_n.default.close(Ii._itemsPopup),delete Ii._itemsPopup)},Ii._goToItem=function(e){-1===cur.destroy.indexOf(Ii._onClose)&&cur.destroy.push(Ii._onClose),nav.go(e.url)},Ii._toggleFave=function(e,t,n,i,a,r,o,s){e.stopPropagation();var l=t.dataset.isFave;ajax.post("/bookmarks.php",{_ajax:1,item_type:i,act:l?"bookmark_remove":"bookmark_add",hash:s,item_oid:a,item_id:r,link_url:o},{onDone:function(e){e&&(Ii._faveCache[r]=!l,Object(M.$)(".PhotoItemsList").$$(".PhotoMarketItem").forEach((function(e){e.dataset.itemId===r.toString()&&(e.$(".PhotoMarketItem__fave").outerHTML=Wd.html(Ci({type:n,typeInt:i,isFave:!l,ownerId:a,itemId:r,href:o,faveHash:s})))})))}})},Ii._openItemsPopup=function(e){var t=Object(G.default)({class:"Photo__marketItemsModal",body:Ii({itemsJSON:e,onClose:["ItemsList._onClose"]})});Ii._itemsPopup=_n.default.open(Wd.elem(t),!0)},window.ItemsList=Ii;var Mi=Ii,Di=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,Pi=!Di&&!!l.default.getFlag(l.FLAG_MP4);onDOMReady((function(){Li.onUpdate(),page.onChange((function(){Li.onUpdate()}))}));var xi={gifs:[],currentAutoplayElement:null,ignore:[]},Li={isBadBrowser:Di,isMp4Supports:function(){return Pi},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var i=function(e){return Object(r.ceFromString)(d.default.html(Object(sn.default)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[Object(wt.default)({onClick:'Gif.confirm(this, "'+e.raw+'")',use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:d.default.wrap(getLang("mobile_continue"))}),Object(wt.default)({onClick:"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"secondary",inner:d.default.wrap(getLang("mobile_cancel"))})]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(i,t),void sn.default.open(i,!0)}var a=Object(j.default)({},nav.getQuery(),{z:"doc"+n.raw+"/"+(n.hash||"")});nav.path,Object(r.obj2qs)(a),nav.hash;photo.zopen(null,null,n.raw,"",{no_push:!1,isDoc:!0,hasVideo:n.hasVideo,hash:n.hash})},init:function(e){zlayer.create(Bi()),zlayer.open()},close:function(){var e=Object(j.default)({},nav.getQuery());delete e.z;var t=nav.path+Object(r.obj2qs)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,sn.default.close(e),Object(r.geBySel1)('[data-media="'+t+'"]').click()},autoplayTest:function(){l.default.detectAutoplay().then((function(e){Pi=l.default.getFeatures().mp4&&e&&l.default.getFlag(l.FLAG_MP4)&&!Di}))},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from(xi.gifs||[]).forEach((function(a){var r=getXY(a)[1],o=r>=e&&r<=t,s=Math.abs(n-r);o&&(i[s]=a)}));var a=i[Math.min.apply(Math,Object.keys(i))];a?a.classList.contains("current_gif")||-1===xi.ignore.indexOf(a)&&(post.toggleGif(a,!1,!1,!0),xi.currentAutoplayElement=a):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){l.default.getFlag(l.FLAG_GIF_AUTOPLAY)&&(xi.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll(Object(r.throttle)(Li.activateGIF,200)))},getState:function(){return xi},setState:function(e,t){xi[e]=t}};function Bi(e){void 0===e&&(e=!1);var t='<img class="zpv_img" alt="">';return e&&(t='<video class="zpv_img" alt="" autoplay preload="metadata" crossorigin="anonymous" poster="/images/blank.gif" webkit-playsinline playsinline controls loop muted>'),'\n    <div id="z_photoview">\n      <div class="zpv_siblings">\n        <div id="zpv_left" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n        <div id="zpv_right" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n      </div>\n      <div class="zpv_body">\n        <div id="zpv_center" class="zpv_thumb_item">\n          '+t+'\n        </div>\n      </div>\n      <div class="zpv_close_msg_wrap">\n        <div class="zpv_close_msg"> '+lang.mobile_zphoto_move_to_close+'</div>\n      </div>\n      <div class="zpv_controls">\n        <div class="mhead zpv_header">\n          <a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a>\n          <div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div>\n        </div>\n      </div>\n      <div class="zpv_tags"></div>\n      <div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div>\n    </div>\'\n  '}window.Gif=Li;var Ri=n("wJa3");function Ni(e){return void 0===e&&(e={}),Object(_n.default)({on_overlay_click_native:"QRPhotoPosting.back();",class:"QRPhotoPosting",content:[{class:"QRPhotoPosting__img",inner:Wd.wrap(e.svg)},{class:"QRPhotoPosting__title",inner:Wd.wrap(e.title)}]})}function Fi(){return{inner:[Object(T.default)({icon:Object(Ri.getQr24Icon)()})],class:"QRPhotoPosting__button",onclick:"QRPhotoPosting.show();",tag:"div"}}var Hi,Ui=n("wZQE"),Vi=n.n(Ui);function $i(e){var t=/photo(-?\d+)_(\d+)/i.exec(e||nav.cur);return Object(W.isArray)(t)||(t=["",0,0]),{album:Object(r.intval)(t[1]),photo:Object(r.intval)(t[2])}}function Wi(e){return-86529522===$i(e).album&&Object(ie.partConfigEnabled)("mvk_photo_fest_qr_sharing")?Fi():""}function qi(e){var t=Object(M.$)("#z_photoview .zpv_values"),n=d.default.elem(Wi(e));Object(r.append)(n,t)}window.QRPhotoPosting=Ni,Object(r.extend)(Ni,{show:function(){var e=$i(),t="https://vk.com/fest?publish_photo="+e.photo,n=Vi.a.createQR(t,271,"QRPhotoPosting__svg",{isShowLogo:!0});Hi=_n.default.open(d.default.elem(Ni({svg:n,title:window.lang.mobile_photo_qr_popup_title})),!0),nav.go(nav.path+"?z=publish_photo"+e.photo,null,{push_only:!0,nav_init:!1,nav_incr:!0})},close:function(){Hi&&_n.default.close(Hi)},back:function(){window.history?window.history.back():window.location="/"},getQRPhotoButton:Wi,QRPhotoPosting:Ni,QRPhotoPostingButton:Fi,appendQRPhotoButton:qi});var zi=n("he4e"),Yi=window.ajax,Qi=window.thover,Gi=window.nav,Ki=(window.page,window.PhotoLike),Xi=window.zlayer,Ji=window.photo,Zi=function(){var e=!1,t=!1,n=!1,i=!1,a=!1,r=!1,o=!1,s=!1,l=!1,c=!1,_=!1,f=!1,p=!1,h=!1,m=!1,v=!1,g=!1,A=!1,b=!1,y=!1,w=!1,O=!1,S=!1,k=!0,C=!1,E={},T=1,I=3,M=1.5,D=20,P=250,x=0;function L(e){var t=getCw()/2,n=getCh()/2;if(e.touches){for(var i=0,a=0,r=0,o=Math.min(2,e.touches.length);i<o;i++)a+=e.touches[i].pageX,r+=e.touches[i].pageY;return o?{pageX:a/o-t,pageY:r/o-n}:{pageX:-t,pageY:-n}}return{pageX:e.pageX-t,pageY:e.pageY-n}}function B(e,t){var n=null,i=(domData(e,"fake-size")+"").split(",");if(i[0]>0&&i[1]>0)return{width:i[0],height:i[1]};var a=t?attr(_,"data-original-src")||_.src:e.src;if(E[a])return E[a];if(t&&(e=function(){var e=ce("img");return e.src=attr(_,"data-original-src")||_.src,e}()),void 0!==e.naturalWidth)n={width:e.naturalWidth,height:e.naturalHeight};else if("VIDEO"===e.tagName)n={width:e.clientWidth,height:e.clientHeight};else{(new Image).src=e.src,n={width:e.width,height:e.height}}return n.width&&n.height&&(E[a]=n),n}function R(e){var t=attr(e,"data-id");return N((tn(Gt).tags||{})[t]||[])}function N(e){return e[0]?{coords:{x:e[0][0],y:e[0][1],w:e[0][2],h:e[0][3]},name:e[1],href:e[2],al:e[3]}:{}}function F(e){setStyle(t,"overflow",e?"visible":"hidden")}var H=null,U=null;function V(e,n,i,r,o,s,l,c,u){if(!x||u){var d=!1,f=!!c&&function(){d||(d=!0,c())};s?(t&&setStyle.animate(t,"transform",{duration:s,func:l},f),_&&setStyle.animate(_,!1===o?"transform":"transform, opacity",{duration:s,func:l},f),h&&setStyle.animate(h,!1===o?"transform":"transform, opacity",{duration:s,func:l},f),m&&setStyle.animate(m,!1===o?"transform":"transform, opacity",{duration:s,func:l},f),v&&setStyle.animate(v,!1===o?"transform":"transform, opacity",{duration:s,func:l},f),a&&setStyle.animate(a,!1===o?"transform":"transform, opacity",{duration:s,func:l},f),Re=!0):Re&&(t&&setStyle.animate(t),_&&setStyle.animate(_),h&&setStyle.animate(h),m&&setStyle.animate(m),v&&setStyle.animate(v),a&&setStyle.animate(a),Re=!1),setStyle.transform(t,{translate:[n,0]}),setStyle.transform(_,e,[i,r]),Lt(e,i,r),!1!==o&&(setStyle(_,"opacity",o),be||ye?(setStyle(h,"opacity",o),we=!0):(setStyle(m,"opacity",o),ke=!0),setStyle(v,"opacity",o),function(e,t){var n=window.lang;if(e){var i=Xi.height,r=i/5,o=i/3.5,s=Math.abs(e),l=s>20?e+(e>0?20-e:-20-e)/M:e,c=0===t?0:Math.max(0,Math.min((s-20)/r,.75));t>0&&setStyle.transform(a,{translate:[0,l]}),setStyle(a,"opacity",c);var u=s>o,d=u?"":e>0?" zpv_close_move_down":" zpv_close_move_up",_=u?n.mobile_zphoto_release_to_close:n.mobile_zphoto_move_to_close;val(a,'<div class="zpv_close_msg'+d+'">'+_+"</div>"),(a.is_down&&e<0||!a.is_down&&e>0)&&Mt(e>0)}else setStyle.transform(a,{translate:[0,0]}),setStyle(a,"opacity",0)}(r,o)),It(e)}else H=[e,n,i,r,o,s,l,c,!0],U||$()}function $(){H&&(V.apply(window,H),H=null),clearTimeout(U),U=x?setTimeout($,1e3/x):null}function W(e,t,n){ft(!0),V(oe,ee,ae,re,Ne,e,t,n),Ne=!1}function q(e,t,n,i){V(e.currentScale,e.curBodyX,e.currentX,e.currentY,!1,t,n,i)}function z(e){e=function(e){if(!e)return e;var t={width:_.width||_.clientWidth,height:_.height||_.clientHeight},n=t.width/2,i=t.height/2;return[e[0]+n,e[1]+i]}(e||[0,0]),setStyle.transformOrigin(_,e)}function Y(){(C=Xt.max_src&&oe>2)?_.src!==Xt.max_src&&(attr(_,"data-original-src",Xt.src),attr(_,"data-src",Xt.max_src),an(Xt.max_src)):C||_.src===Xt.src||!_||O||S||(attr(_,"data-src",Xt.src),rn(Xt.src),_.style.width="")}var Q,G,K,X,J,Z,ee,te,ne,ie,ae,re,oe,se,le,ue,de,_e,fe,pe,he,me,ve,Ae,be,ye,we,Oe,Se,ke,Ce,Ee,je,Te,Ie,Me,De,Pe,xe,Le,Be,Re,Ne,Fe=!1,He=!1,Ue=null;function Ve(e){var t=e[1].pageX-e[0].pageX,n=e[1].pageY-e[0].pageY;return{distance:Math.sqrt(t*t+n*n),angle:180*Math.atan2(n,t)/Math.PI}}function $e(e){var t=Ve(e);if(Fe){var n=t.distance/Fe.scale,i=t.angle-Fe.rotation;i<-180&&(i+=360),i>180&&(i-=360),extend(Fe,{startDistance:n,startAngle:i})}else Fe={startDistance:t.distance,startAngle:t.angle,scale:1,rotation:0}}function We(e){return extend({originalEvent:e},e,function(e){if(!Fe)return{scale:1,rotation:0};if(e.length<2)return{scale:Fe.scale,rotation:Fe.rotation};var t=Ve(e),n=t.distance/Fe.startDistance,i=t.angle-Fe.startAngle;i<-90&&(i+=360),i>270&&(i-=360);var a={scale:n,rotation:i};return extend(Fe,a),a}(e.touches),L(e))}function qe(e){var t=e.touches;t&&(t.length>5||t.length<2?Fe&&(Tt(We(e)),Fe=!1):(Fe||Et(We(e)),$e(t)))}function ze(e){var t=e.touches;t&&(t.length>5||t.length<2?Fe&&(Tt(We(e)),Fe=!1):Fe&&jt(We(e)))}function Ye(e){var t=e.touches;t&&((t.length>5||t.length<2)&&Fe&&(Tt(We(e)),Fe=!1),Fe&&$e(t))}function Qe(e){preventEvent(e);var t=(e.detail?e.detail:e.wheelDelta)>0?1.05:.95,n=extend({originalEvent:e},e);He||(He=1,St(e),Et(extend(n,{scale:He}))),He*=t,jt(extend(n,{scale:He})),clearTimeout(Ue),Ue=setTimeout((function(){Tt(extend(n,{scale:He})),Ct(e),He=!1}),200)}function Ge(){Q=0,G=0,K=0,X=0,J=1,Z=!0,ee=0,te=0,ne=0,ie=1,ae=0,re=0,oe=1,se=!1,le=!1,ue=!1,de=!1,_e=!1,fe=!1,pe=!1,he=!1,me=!1,we=!1,Oe=!1,Se=!1,ke=!1,Ce=!1,Ee=!1,je=!1,!1,Pe=!1,xe=!1,Le=!1,Be=!1}function Ke(){return{lastScale:J,deltaX:Q,deltaY:G,pointX:K,pointY:X,curScale:ie,currentScale:oe,curX:te,curY:ne,currentX:ae,currentY:re,curBodyX:ee}}function Xe(e,t,n){n=n||Ke(),e=e||{};var i=extend({},n,e);if(isUndefined(e.deltaX)||isUndefined(e.deltaY)?isUndefined(e.pointX)||isUndefined(e.pointY)?isUndefined(e.lastScale)?isUndefined(e.currentScale)?isUndefined(e.curScale)||(i.currentScale=i.lastScale*i.curScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=i.currentScale/i.lastScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=1,i.currentScale=i.curScale*i.lastScale):(i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.pointX=i.curX+i.deltaX*i.curScale,i.pointY=i.curY+i.deltaY*i.curScale),isUndefined(e.curX)||(i.curX=e.curX,i.currentX=i.curX/i.currentScale),isUndefined(e.curY)||(i.curY=e.curY,i.currentY=i.curY/i.currentScale),t)return i;Q=i.deltaX,G=i.deltaY,K=i.pointX,X=i.pointY,J=i.lastScale,ie=i.curScale,oe=i.currentScale,te=i.curX,ne=i.curY,ae=i.currentX,re=i.currentY,ee=i.curBodyX}function Je(){var e=Xi.width||getCw(),t=Xi.height||getCh();if(S)var n=e,i=Math.min(P,n-2*D),a=i,r=i;else a=e,r=t;return{width:a,height:r}}function Ze(e){var t=Je().width,n=((_.width||_.clientWidth)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function et(e){var t=Je().height,n=((_.height||_.clientHeight)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function tt(){var e=1,t=I;if(S){e=1,t=(Yt?Yt[0]:{max_scale:I}).max_scale}else{var n=B(_,!0);e=T,t=Math.max(I,n.width/getCw(),(n.height||n.clientHeight)/getCh())}return Xt.restriction&&(e=1,t=1),{min:e,max:t}}function nt(e){var t=Xi.height||getCh(),i=Math.abs(Kt)>=10,a=Math.abs(e)>1,r=t/3.5,o=Math.abs(ne);return ne*e<0&&(i=!0),e=e||0,o>r||!i&&a?(function(e){var t=Xi.height||getCh(),i=2*Math.abs(re)>t?.85:1.7;Xe({curY:(e>1?t:e<-1?-t:ne>0?t:-t)/i}),Ne=0,W(150,"ease-in",it),setStyle(n,"width",0),Me=!0}(e),!0):(wt()&&(Ne=1,W(300),de=!1,ye&&(ye=!1,Rt(!0))),!1)}function it(){y&&Zi.close()}function rt(){!1!==Te&&(F(!1),cn(Te),setStyle.transform(f),setStyle.transform(p),V(1,0,0,0,1),z(),Te=!1)}function ot(){var e=1.05*(Xi.width||getCw());ae-=(e+ee)/oe,ee=-e,Te=Gt+1,Kt--,W(300,"ease-out",rt),$t(!1,!0),ye=!1,Zi.onPhotoChange&&Zi.onPhotoChange(Gt+1,{no_open:!0,local:w,crop:S})}function st(){var e=1.05*(Xi.width||getCw());ae+=(e-ee)/oe,ee=e,Te=Gt-1,Kt++,W(300,"ease-out",rt),$t(!1,!0),ye=!1,Zi.onPhotoChange&&Zi.onPhotoChange(Gt-1,{no_open:!0,local:w,crop:S})}function lt(){if(!xe)return!1;var e=function(){if(!xe||xe.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=xe.pop(),i=xe.length-1;i>=0;i--){if((a=e-xe[i][0])>150)break;t=xe[i]}if(!t||!n)return[0,0,0];var a,r=n[1].pageX-t[1].pageX,o=n[1].pageY-t[1].pageY,s=Math.sqrt(r*r+o*o);return(a=n[0]-t[0])?[s/a,r/a,o/a]:[0,0,0]}(),t=e[0],n=e[1],i=e[2];if(ut(),!t)return!1;var a=ue||de?5.1:4.7,r=t/a,o=n*r-a*r*r/2,s=i*r-a*r*r/2;if(r*=530,o*=140,s*=140,t<.1||!o&&!s)return!1;if(!de){var l={};ue||(l.curX=te+o,l.curY=ne+s),Xe(l);var c=Ze(oe);l={},te<c.min?l.curBodyX=Z?te-c.min:0:te>c.max&&(l.curBodyX=Z?te-c.max:0),Xe(l)}return ue?4.7*n:de?4.7*i:r}function ct(e){xe||(xe=[]),xe.push([vkNow(),e]),xe=xe.slice(-20)}function ut(){xe=!1}function dt(e,t){var n,i,a,r,o,s,l,c,u,d=(n=[e.curX,e.curY],i=e.currentScale,a=[t.curX,t.curY],r=t.currentScale,o=n[0],s=n[1],l=a[0],c=a[1],1!=(u=r/i)&&[o+(o-l)/(u-1),s+(s-c)/(u-1)]);if(!d)return!1;var _=d[0],f=d[1];return e.deltaX=_-e.curX,e.deltaY=f-e.curY,e.currentX=e.curX/e.currentScale+_-_/e.currentScale,e.currentY=e.curY/e.currentScale+f-f/e.currentScale,t.deltaX=_-t.curX,t.deltaY=f-t.curY,t.currentX=t.curX/t.currentScale+_-_/t.currentScale,t.currentY=t.curY/t.currentScale+f-f/t.currentScale,d}function _t(e,t,n){var i,a,r,o,s,l,c,u,d,f,p,h,m,v,g,A=Xi.width||getCw(),b=Xi.height||getCh(),y=!1,w=(Math.min(50,A/7),B(_)),O=A/w.width,S=b/w.height,k=Math.min(1,O,S),C=R(e).coords,E=geByClass1("zpv_tl",e),j=getW(E),T=getH(E),I=(Math.min((A-30)/Math.max(C.w*w.width*k/100,j),(b-30)/(C.h*w.height*k/100+T+5)),function(){a=w.width*k*n.currentScale,r=w.height*k*n.currentScale,o=A/2-a/2+n.currentX*n.currentScale,s=b/2-r/2+n.currentY*n.currentScale,u=o+C.x*a/100,d=s+C.y*r/100,l=C.w*a/100,c=C.h*r/100,i=u+l/2-j/2,d+c+5,p=Math.min(u,i),f=Math.max(l,j),m=p+f,v=(h=d)+(c+T+5),g={}});return n=(n=Xe(g,t,n))||Ke(),I(),p<15?(g.curX=n.curX+(15-p),y=!0):m>A-15&&(g.curX=n.curX-(m-A+15),y=!0),h<15&&(g.curY=n.curY+(15-h),y=!0),n=(n=Xe(g,t,n))||Ke(),I(),v>b-15&&(g.curY=n.curY-(v-b+15),y=!0),n=Xe(g,t,n),t?n:y}function ft(e){Be&&(Be=!1,z(),e||W(),Dt(be,!0),Pt(!be,!0),setTimeout((function(){Y()}),300))}function pt(e,t,n){var i={};return n=n||Ke(),i.lastScale=e,n=Xe(i,t,n),!!t&&n}function ht(e,t,n){var i={};if(n=n||Ke(),!Ot())return!!t&&n;i.curScale=e,n=(n=Xe(i,t,n))||Ke();var a=tt();return i={currentScale:n.currentScale},n.currentScale<a.min?i.currentScale=n.currentScale+(a.min-n.currentScale)/M:n.currentScale>a.max&&(i.currentScale=n.currentScale+(a.max-n.currentScale)/M),n=Xe(i,t,n),!!t&&n}function mt(e,t){if(!Ot())return!1;var n=!1,i={};t=t||Ke();var a=tt();return t.currentScale<a.min?(i.currentScale=a.min,n=!0):t.currentScale>a.max&&(i.currentScale=a.max,n=!0),t=Xe(i,e,t),e?t:n}function vt(e){if(!Ot())return!1;var t={pageX:0,pageY:0},n=Ke(),i=null,a=dt(n,i=wt(!0,i=yt(t,!0,i=mt(!0,i=ht(e=1==e?1/J:e,!0,i=At(t,!0,n))))));a&&(z(a),q(n),Be=!0),Be&&(Dt(!1,!0),Pt(!1,!0)),At(t),ht(e),mt(),yt(t),wt(),Be?q(i,300,!1,ft):W(300),pt(oe)}function gt(e){if(!Ot())return!1;var t=Ke(),n=null,i=dt(t,n=wt(!0,n=mt(!0,n=_t(e,!0,t))));i&&(z(i),q(t),Be=!0),_t(e)&&(Se||(Se=t)),Be&&(Dt(!1,!0),Pt(!1,!0)),mt(),wt(),Be?q(n,300,!1,ft):W(300),pt(oe)}function At(e,t,n){var i={};return n=n||Ke(),i.deltaX=(e.pageX-n.curX)/n.curScale,i.deltaY=(e.pageY-n.curY)/n.curScale,n=Xe(i,t,n),!!t&&n}function yt(e,t,n){var i={};n=n||Ke(),i.pointX=e.pageX,i.pointY=e.pageY;var a=Ze(n.currentScale),r=et(n.currentScale),o=(!se&&!r.max&&!r.min||ue||!Ot())&&!de;(de||S&&!se&&!a.max&&!a.min)&&(i.curX=0),o&&(i.curY=n.curY),n=Xe(i,t,n),i={};var s=!1;return(n=n||Ke()).curX<=a.min?_e?(s=!0,i.curBodyX=n.curX-a.min):(i.curX=n.curX+(a.min-n.curX)/M,i.curBodyX=Z?i.curX-a.min:0):n.curX>=a.max&&(fe?(s=!0,i.curBodyX=n.curX-a.max):(i.curX=n.curX+(a.max-n.curX)/M,i.curBodyX=Z?i.curX-a.max:0)),n.curY<r.min?o?i.curY=r.min:de||(i.curY=n.curY+(r.min-n.curY)/M):n.curY>r.max&&(o?i.curY=r.max:de||(i.curY=n.curY+(r.max-n.curY)/M)),n=Xe(i,t,n),t?n:s}function wt(e,t){var n=!1,i={},a=Ze((t=t||Ke()).currentScale),r=et(t.currentScale),o=!se&&!r.max&&!r.min||ue||!Ot()&&!de;return de&&(i.curX=0),o&&(i.curY=t.curY),t.curX<a.min?(i.curX=a.min,i.curBodyX=0,n=!0):t.curX>a.max&&(i.curX=a.max,i.curBodyX=0,n=!0),t.curY<r.min?(i.curY=r.min,n=!0):t.curY>r.max&&(i.curY=r.max,n=!0),t=Xe(i,e,t),e?t:n}function Ot(){return!b&&(!!S||!Xt.restriction&&Qt[Xt.src])}function St(e){if(scrollTop()||scrollTop(0),!Me){if(e&&"mousedown"==e.type&&preventEvent(e),e.touches&&e.touches.length||!g){if(rt(),!le&&!se){Pe=L(e);var t=Ze(oe);te<=t.min&&(_e=!1!==tn(Gt+1)),te>=t.max&&(fe=!1!==tn(Gt-1))}if(le||b)pe=he=me=!1,ve=!1;else{clearTimeout(Ae);var n=L(e);pe&&vkNow()-pe<500&&he&&(i=n,r=(a=he).pageX-i.pageX,o=a.pageY-i.pageY,Math.sqrt(r*r+o*o)<50)?(me=vkNow(),ve=!1):(pe=vkNow(),he=n,ve=vkNow())}b||(le=!0)}var i,a,r,o;se||(Z=!0,F(!0)),Ee=L(e),ut(),ct(Ee),At(Ee)}}function kt(e){if(!Me&&(preventEvent(e),le)){if(pe=he=me=!1,ve=!1,ct(Ee=L(e)),Le){if(!(Le<vkNow()))return void ut();Le=!1,At(Ee),W()}if(Pe&&!ue&&!de){var t=Math.abs(Ee.pageX-Pe.pageX),n=Math.abs(Ee.pageY-Pe.pageY),i=et(oe);if(!(n>5||t>5))return;n>5&&t<=5&&(1!=oe||se||b||S?(i.max||i.min)&&(_e=fe=!1):(de=!0,be&&(ye=!0),Rt(!1),Mt(Ee.pageY-Pe.pageY>0))),Pe=!1,At(Ee)}!yt(Ee)||ue||de||b||(ue=!0,Ee.pageX),function(){if(!de)return;var e=Math.abs(ne),t=Xi.height/2;Ne=1-.5*e/t}(),W(),ue&&Math.abs(ee)>getCw()&&Ct(extend({originalEvent:e},e,{touches:[]}))}}function Ct(e){if(!Me)if(De)De=!1;else{if(preventEvent(e),e.touches&&!e.touches.length||!g){var t=lt();if(ue)l=t,c=(Xi.width||getCw())/2,l=l||0,((ee<-c||l<-1)&&_e?(ot(),1):(ee>c||l>1)&&fe?(st(),1):(wt()&&W(300),0))&&(Ge(),F(!0));else if(de)nt(t);else if(me&&vkNow()-me<1e3){!function(e){if(!Ot())return!1;var t=tt(),n={pageX:K,pageY:X},i=(oe>1?1:t.max)/J,a=Ke(),r=null;r=wt(!0,r=yt(n,!0,r=ht(i,!0))),e&&(r=wt(!0,r=_t(e,!0,r)));var o=dt(a,r);o&&(z(o),q(a),Be=!0),Be&&(Dt(!1,!0),Pt(!1,!0)),ht(i),yt(n),wt(),e&&(_t(e),wt()),Be?q(r,300,!1,ft):W(300),pt(oe),Nt()}(r=e&&we&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target))),pe=he=me=!1}else wt()?W(300):t&&(wt(),W(t,"cubic-bezier(0, 1, 1, 1)"));if(setTimeout((function(){Y()}),300),ve)if(vkNow()-ve>700||e&&"touchcancel"==e.type)ve=!1;else{if(ve=!1,e)var n=hasClass("zpv_header",e.target)?e.target:gpeByClass("zpv_header",e.target),i=hasClass("zpv_zoom_btns",e.target)?e.target:gpeByClass("zpv_zoom_btns",e.target),a=hasClass("zpv_bottom_body",e.target)?e.target:gpeByClass("zpv_bottom_body",e.target),r=we&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target)),o=ke&&e.target.closest(".Photo__marketTag"),s=we&&e.target.closest(".Photo__marketShowMoreButton");e&&(n||i||a||r||o||s)?r?function(e,t){if(!Ie)return!1;if(!we)return!0;R(e);if(hasClass("zpv_tag_selected",e))return hasClass("zpv_tl_wrap",t.target)||gpeByClass("zpv_tl_wrap",t.target)?Gi.go(e,t):(gt(e),cancelEvent(t),!1);Oe&&(pe=he=me=!1),removeClass("zpv_tag_selected",Oe),Oe=e,Bt(e),addClass("zpv_tag_selected",Oe);be&&(ye=!0);Rt(!1),gt(e),cancelEvent(t)}(r,e):i?(pe=he=me=!1,hasClass("zpv_zoomin",e.target)||gpeByClass("zpv_zoomin",e.target)?function(e){!!Ie&&(Qi.highlight=!1,Qi.end(e),se||ue||tt().max<=oe||(cancelEvent(e),vt(S?1.25:1.45)))}(e):function(e){!!Ie&&(Qi.highlight=!1,Qi.end(e),se||ue||tt().min>=oe||(cancelEvent(e),vt(S?.8:1)))}(e)):o?Gi.go(o.dataset.url):s&&Mi._openItemsPopup(s.dataset.itemsJson):Oe?$t(e):S||(Ae=setTimeout((function(){Rt(),Dt(be),Pt(!be)}),500))}le=!1,ue=_e=fe=!1,ut()}var l,c;e.touches&&(e.touches.length>1||1==e.touches.length&&ue)&&At(Ee=L(e)),(e.touches&&!e.touches.length||!g)&&(Pe=!1)}}function Et(e){if(!Me&&(preventEvent(e),pe=he=me=!1,ve=!1,ut(),!ue&&!de)){ie=1,J=oe,se=!0,_e=fe=!1;var t=Ze(oe);(t.min>=-5||t.max<=5)&&(Z=!1,F(!1)),At(L(e)),Dt(!1,!0),Pt(!1,!0)}}function jt(e){Me||(preventEvent(e),pe=he=me=!1,ve=!1,ut(),ue||de||(je=L(e),ht(e.scale),yt(je),W(),Nt()))}function Tt(e){Me||(preventEvent(e),pe=he=me=!1,ve=!1,ut(),ue||de||(mt()&&((e.touches&&e.touches.length||!g)&&yt(je),wt(),W(100),Le=vkNow()+100),se=!1,Dt(be,!0),Pt(!be,!0)))}function It(e){var t=tt(),n=e<t.max,i=e>t.min;toggleClass("zpv_zb_disabled",l,!n),toggleClass("zpv_zb_disabled",c,!i)}function Mt(e){e?setStyle(a,{top:-35,bottom:"auto"}):setStyle(a,{top:"auto",bottom:-35}),a.is_down=e}function Dt(e,t){var n=we;if(e){if(!Ot())return;if(!be&&!ye||se)return}we=e,e&&Lt(oe,ae,re,t||n!==e),n!==e&&(e&&Bt(Oe),xt(h,e,t))}function Pt(e,t){var n=ke;Xt.restriction&&(e=!1,t=!0),ke=e,e&&Lt(oe,ae,re,t||n!==e),xt(m,e,t)}function xt(e,t,n){e&&setStyle.animate(e,!n&&"opacity",{duration:200,func:"linear"},(function(){setStyle(e,"visibility",t?"visible":"hidden")})),e&&setStyle(e,"visibility",t||!n?"visible":"hidden"),e&&setStyle(e,"opacity",t?1:0)}function Lt(e,t,n,i){if(!se){var a=Xi.width||getCw(),r=Xi.height||getCh(),o=B(_),s=a/o.width,l=r/o.height,c=Math.min(1,s,l),u=o.width*c*e,d=o.height*c*e,f=a/2-u/2+t*e,p=r/2-d/2+n*e;we&&(i&&h&&setStyle.animate(h),setStyle(h,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(h,{translate:[Math.round(f),Math.round(p)]})),ke&&(i&&m&&setStyle.animate(m),setStyle(m,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(m,{translate:[Math.round(f),Math.round(p)]}),Ce||(!function(){function e(e,t){var n=e.getBoundingClientRect(),i=m.getBoundingClientRect();n.left<i.left+t?e.style.left=i.left-n.left+t+"px":n.right>i.left+i.width-t&&(e.style.left=i.left+i.width-n.right-t+"px")}m&&Array.from(m.children).forEach((function(t){if(t.classList.contains("Photo__marketTag")){var n=t.$(".Photo__marketTagInner"),i=t.$(".Photo__marketTagArrow");e(n,10),e(i,20)}}))}(),Ce=!0)),i&&v&&setStyle.animate(v),setStyle(v,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(v,{translate:[Math.round(f),Math.round(p)]})}}function Bt(e){if(e){var t=B(_),n=Xi.width||getCw(),i=Xi.height||getCh(),a=n/t.width,r=i/t.height,o=Math.min(1,a,r),s=t.width*o*oe,l=t.height*o*oe,c=R(e).coords,u=geByClass1("zpv_tl",e),d=getW(u),f=getH(u),p=c.x*s/100,h=c.y*l/100,m=c.w*s/100,v=c.h*l/100,g=p+m/2-d/2,A=h+v+5,b=n>s?0-(n-s)/2:0,y=n>s?s+(n-s)/2:s,w=i>l?l+(i-l)/2:l,O=0,S=0;g<b+2?O=b+2-g:g+d>y-2&&(O=y-2-g-d),A+f>w-5&&(S=v>3*f?w-5-A-f:-v-f-10),setStyle.transform(u,{translate:[Math.ceil(O),Math.ceil(S)]})}}function Rt(e){if(void 0!==e){if(be===e)return;be=!e}else ye=!1;setStyle(n,"width","auto"),n&&setStyle.animate(n,"opacity",{duration:200,func:"linear"},(function(){setStyle.animate(n),setStyle(n,"width",be?"auto":0)})),be?(setStyle(n,"opacity",0),be=!1):(setStyle(n,"opacity",1),be=!0)}function Nt(){Xi.height<604&&!Oe&&!S&&(oe>1.25?(be&&(ye=!0),Rt(!1)):ye&&(ye=!1,Rt(!0)))}function Ft(e){Ie&&(le||se||ue||e&&e.touches&&e.touches.length>1||(cancelEvent(e),Zi.close()))}function Ht(e){if(!(le||se||ue||!e||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=Ze(oe);37==e.keyCode?(cancelEvent(e),te>=t.max&&!1!==tn(Gt-1)&&(F(!0),st())):39==e.keyCode?(cancelEvent(e),te<=t.min&&!1!==tn(Gt+1)&&(F(!0),ot())):27==e.keyCode&&Ft(e)}}function Ut(){S?dn():(sn(),cn(Gt),Vt())}function Vt(){Dt(we,!0),Pt(ke,!0),Lt(oe,ae,re)}function $t(e,t){return!(!Ie&&!t)&&(!Oe||(removeClass("zpv_tag_selected",Oe),Oe=!1,ye&&oe<=1.25&&(ye=!1,Rt(!0)),cancelEvent(e),!1))}function Wt(e){"touchstart"==e.type?Ie=!e.touches||1==e.touches.length:"touchmove"==e.type?(Ie=!1,preventEvent(e)):"click"==e.type&&(Ie||(cancelEvent(e),Ie=!0))}function qt(e){"touchstart"==e.type?Me=!0:"touchmove"==e.type?(Me=!0,preventEvent(e)):(Me=e.touches&&e.length,De=!Me)}function zt(){Yt&&Yt[Gt]&&Yt[Gt].restriction&&"blur"===Yt[Gt].restriction.type&&delete Yt[Gt].restriction,Ut()}var Yt=!1,Qt={},Gt=!1,Kt=!1,Xt=!1,Jt=!1,Zt=!1;function en(e,t,n,i){var a=t||len(e);if(e&&!n||(Yt=null),Yt||(Yt=new Array(a)),Yt.length!=a){var r=Yt;Yt=new Array(a),extend(Yt,r)}e=e.map((function(e){return e&&e.restriction&&"block"===e.restriction.type&&(e.src="/images/mobile/blank.gif"),e})),extend(Yt,e);var o=function(e){for(var t in Yt)if(Yt[t].id==e)return+t;return-1}(Xt.id);-1==o&&(o=Gt),i||cn(o)}function tn(e){return!(e>=Yt.length)&&(!(e<0)&&(Yt[e]||{src:!0}))}function nn(e,t,n){var i=B(e),a=Je();S&&(Yt[0].loaded=t,t&&(i.width>i.height?setStyle(e,{height:a.height}):setStyle(e,{width:a.width}),setStyle(e,{minWidth:0,maxWidth:"none"})),dn(!0));if(ln()){if(2*i.width>=a.width){var r=a.width/(i.width||i.clientWidth);if(i.height*r>=a.height)return;ie=r,J=r,oe=r,setStyle.transform(_,r)}"VIDEO"===e.tagName&&e.play()}show(e),_===e&&(Dt(t,!t),Pt(t&&!be,!t))}function an(e,t){if(void 0===t&&(t=!1),Qt[e])rn(e);else if(t){var n=ce("video",{src:e}),i=!1,a=function(){i||(i=!0,Qt[e]=!0,rn(e),n=null)};addEvent(n,"canplay",a),addEvent(n,"onload",a),n.load()}else{var r=new Image;r.addEventListener("load",(function t(){Qt[e]=!0,rn(e),sn(),Vt(),r.removeEventListener("load",t),r=null}),!1),r.src=e}}function rn(e){[_,f,p].forEach((function(t){var n=gpeByClass("zpv_thumb_item",t),i=attr(t,"data-src");i===e&&(t.src=i,nn(t,!0),"VIDEO"!==t.tagName&&removeClass("zpv_ti_loading",n),attr(t,"data-src",!1),ln()&&statlogsValueEvent("gif_play",0,"VIDEO"===t.tagName?"mp4":"gif"))}))}function on(e,t,n,i){void 0===i&&(i=!1);var a=gpeByClass("zpv_thumb_item",e);i&&(addClass("zpv_ti_loading",a),setTimeout((function(){setStyle(_,{display:"block"})}))),i&&(n=!1),t?!0!==t?e.src===t?nn(e,!0):Qt[t]?(e.src=t,nn(e,!0)):(n?(e.src=n,nn(e,!1)):hide(e),attr(e,"data-src",t),an(t,i),addClass("zpv_ti_loading",a)):(n?(e.src=n,nn(e,!1)):hide(e),addClass("zpv_ti_loading",a)):hide(e)}function sn(){if(y){!function(){window.lang;var e="";if(ln())e=getLang("mobile_gif_popup_title");else{e=getLang("mobile_photos_photoview_header")||"";var t=!1!==Te?Te:Gt;e=(e=e.replace("%s",t+1)).replace(/%s|{count}/,Yt.length)}val("zpv_summary",e)}(),It(oe);var e=tn(!1!==Te?Te:Gt);if(S||O||e&&!0!==e.src){if(!S&&!O){var t="";each(e.tags,(function(e,n){if(!e||0==e)return!0;var i=N(n),a=i.coords,r=i.href?' data-href="'+i.href+'" data-name="'+escapeAttr(i.name)+'"':"",o=i.al?(i.href?" al"+i.al:"")+" "+i.al:"";t+='<div class="zpv_tag'+o+'" style="left: '+a.x+"%; top: "+a.y+"%; width: "+a.w+"%; height: "+a.h+'%;" data-id="'+e+'"'+r+'><div class="fill"></div><div class="zpv_tl_wrap" id="zpv_tl_wrap"><div class="zpv_tl'+(i.href?"":" zpv_tl_plain")+'">'+htsc(i.name)+"</div></div></div>"}));var n,a="",s=e.market_tags&&e.market_tags.tags,l=s&&s.length&&!e.restriction,c="";l&&(c=d.default.html(ki({items:escape(JSON.stringify(s))})),s.forEach((function(e){a+=d.default.html(Oi(e))})));var u=B(_);e.restriction&&"blur"===e.restriction.type&&!Object(zi.isCleared)("photo"+e.id)?(Dt(!1,!0),Pt(!1,!0),n=Object(bt.default)(Object(j.default)({},e.restriction,{raw:"photo"+e.id,width:u.width,height:u.height}))):e.restriction&&"block"===e.restriction.type&&(n=Object(bt.default)(e.restriction)),val(h,t),val(m,a),val(v,n?d.default.html(n):null),val(r,'<div class="zpv_photo_desc">'+(e.caption||"")+"</div>"+c+'<div class="zpv_bottom_bg"></div>'),toggle(r,!!e.caption||!!l);var f="";if(w||Gi.getQuery("community")||!k)f="";else{var p=e.tags&&e.tags[0]||0;f="<tr>"+('<td class="row_table_column"><a href="'+e.like_url+'" class="item_button item_like'+(e.likes_me?" item_likes_me":"")+'" onclick="return photoview.likePhoto(this, \''+e.id+'\');"><i class="i_icon i_like"></i>'+(e.likes_cnt?'<b class="v_value v_like">'+formatNum(e.likes_cnt)+"</b>":"")+"</a></td>")+('<td class="row_table_column"><a href="'+e.photo_url+'#comments" class="item_button item_replies al_photo" onclick="return photoview.openPhoto(this, event, true);"><i class="i_icon i_replies"></i>'+(e.replies_cnt?'<b class="v_value v_replies">'+e.replies_cnt+"</b>":"")+"</a></td>")+('<td class="row_table_last_column"><a href="'+e.photo_url+'" class="item_button item_tags al_photo" onclick="return photoview.openPhoto(this, event);"><i class="i_icon i_tags"></i>'+(p?'<b class="v_value v_tags">'+p+"</b>":"")+"</a></td>")+"</tr>"}val(o,f),qi(e.photo_url),show(i)}}else hide(i)}}function ln(){return Xt.isDoc}function cn(e){if(y){Gt=Math.max(0,Math.min(e||0,Yt.length)),Xt=tn(Gt),Zt=tn(Gt-1),Jt=tn(Gt+1),_.classList.toggle("zpv_img--blur",!!Xt.restriction&&"blur"===Xt.restriction.type&&!Object(zi.isCleared)("photo"+Xt.id)),p.classList.toggle("zpv_img--blur",!!Jt.restriction&&"blur"===Jt.restriction.type&&!Object(zi.isCleared)("photo"+Jt.id)),f.classList.toggle("zpv_img--blur",!!Zt.restriction&&"blur"===Zt.restriction.type&&!Object(zi.isCleared)("photo"+Zt.id));var t=Je();[_,p,f].forEach((function(e,n){var i;0===n?i=Xt:1===n?i=Jt:2===n&&(i=Zt);var a=i.restriction&&"blur"===i.restriction.type&&(!window.CSS||!CSS.supports("filter: blur(20px) brightness(0.75) contrast(1.25)"));e.classList.toggle("zpv_img--blurUnsupported",!a),e.classList.toggle("zpv_img--block",i.restriction&&"block"===i.restriction.type);var r,o,s=domData(e,"fake-size");i.restriction&&"block"===i.restriction.type?(o=Math.max(Math.min(t.width,600),400),r="600,600"):(s||i.restriction&&"blur"===i.restriction.type)&&(o=Math.max(Math.min(t.width,600),400),r=t.width+","+o),i.restriction&&"block"===i.restriction.type||i.restriction&&!Object(zi.isCleared)("photo"+i.id)||(r=null,o=null),setStyle(e,{"min-height":o||null}),domData(e,"fake-size",r||null)})),on(_,Xt.src,"/images/mobile/blank.gif",Xt.hasVideo),on(p,Jt.src),on(f,Zt.src),sn(),Vt(),Zi.onUpdate&&Zi.onUpdate()}}function un(){if(y&&O&&Yt){var e=Yt[0];if(!e.loaded&&e.progress){var t=geByClass1("zpvu_progress","zpv_center");setStyle(t,{width:100*e.progress+"%",visibility:"visible"})}if(!e.read&&e.thumb){e.read=!0;var n=geByClass1("zpv_upload_box","zpv_center"),i=geByClass1("zpv_upload_img",n);setStyle(i,{backgroundImage:"url("+e.thumb+")"}),removeClass("zpv_thumb_uploading",n)}}}function dn(t){if(y&&S&&Yt){var n=Yt[0],i=!!n.saving;if(toggleClass("item_disabled","zpv_save_button",i||!n.loaded),toggleClass("item_disabled","zpv_cancel_button",i),toggleClass("zpv_crop_saving",e,i),b=i,t||on(_,n.src,"/images/mobile/blank.gif"),n.loaded&&n.rect&&!n.rect_inited){n.rect_inited=!0;var a=Je(),r=n.rect[0],o=n.rect[1],s=n.rect[2],l={};l.currentScale=1/s,Xe(l),mt(),wt(),l={};var c=(_.width||_.clientWidth)*oe,u=(_.height||_.clientHeight)*oe,d=r*c,f=o*u;l.curX=(c-a.width)/2-d,l.curY=(u-a.height)/2-f,Xe(l),wt(),W(0)}}}function _n(u,d){void 0===u&&(u=!1),void 0===d&&(d=!1),y||(ve=!1,Ae=!1,be=!0,ye=!1,Te=!1,Ie=!0,Me=!1,De=!1,Re=!1,Ne=!1,b=!1,w=!1,O=!1,S=!1,Ge(),function(u,d){void 0===u&&(u=!1),void 0===d&&(d=!1);var g=window.lang,A="";A=u?Bi(d):'<div id="z_photoview" scheme="space_gray"><div class="zpv_siblings"><div id="zpv_left" class="zpv_thumb_item"><img class="zpv_img" alt=""></div><div id="zpv_right" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_body"><div id="zpv_center" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_close_msg_wrap"><div class="zpv_close_msg">'+g.mobile_zphoto_move_to_close+'</div></div><div class="zpv_controls"><div class="mhead zpv_header"><a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a><div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div></div><div class="zpv_zoom_btns"><a class="zpv_zoom_btn zpv_zoomin"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a><a class="zpv_zoom_btn zpv_zoomout"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a></div><div class="zpv_bottom"><div class="zpv_photo_desc_wrap"></div><div class="zpv_bottom_body"><table class="zpv_values like_box row_table"></table></div></div></div><div class="zpv_restriction"></div><div class="zpv_tags"></div><div class="zpv_market_tags"></div><div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div></div>';var b="/images/mobile/zpv_icons"+(hasClass("x2",window.bodyNode)?"_2x":"")+".png?2";(new Image).src=b,Xi.create(A,fn),e=ge("z_photoview"),geByClass1("zpv_body",e),t=geByClass1("zpv_siblings",e),n=geByClass1("zpv_controls",e),s=geByClass1("zpv_zoom_btns",e),a=geByClass1("zpv_close_msg_wrap",e),i=geByClass1("zpv_bottom",e),r=geByClass1("zpv_photo_desc_wrap",e),o=geByClass1("zpv_values",i),l=geByClass1("zpv_zoomin",s),c=geByClass1("zpv_zoomout",s),h=geByClass1("zpv_tags",e),m=geByClass1("zpv_market_tags",e),v=geByClass1("zpv_restriction",e),geByClass1("zpv_crop",e),_=geByClass1("zpv_img","zpv_center"),f=geByClass1("zpv_img","zpv_left"),p=geByClass1("zpv_img","zpv_right"),"VIDEO"===_.tagName&&(_.controls=!1)}(u,d),function(){if(g=void 0!==document.ontouchmove,A=!1,bt.default.onClear(zt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);addEvent(t,"touchstart touchmove touchend touchcancel",qt),addEvent(n,"touchstart touchmove touchend touchcancel",qt),addEvent(e,"touchstart touchmove click",Wt),addEvent(e,"touchstart",St),addEvent(e,"touchmove",kt),addEvent(e,"touchend touchcancel",Ct),A?(addEvent(e,"gesturestart",Et),addEvent(e,"gesturechange",jt),addEvent(e,"gestureend",Tt)):(addEvent(e,"touchstart",qe),addEvent(e,"touchmove",ze),addEvent(e,"touchend touchcancel",Ye),addEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else addEvent(e,"mousedown",St),addEvent(e,"mousemove",kt),addEvent(window,"mouseup",Ct),addEvent(window,"mousewheel",Qe),addEvent(window,"keydown",Ht)}(),y=!0,reflow(e),scrollTop()||scrollTop(0))}function fn(){y&&(!function(){if(bt.default.onClear("__clear",zt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);removeEvent(t,"touchstart touchmove touchend touchcancel",qt),removeEvent(n,"touchstart touchmove touchend touchcancel",qt),removeEvent(e,"touchstart touchmove click",Wt),removeEvent(e,"touchstart",St),removeEvent(e,"touchmove",kt),removeEvent(e,"touchend touchcancel",Ct),A?(removeEvent(e,"gesturestart",Et),removeEvent(e,"gesturechange",jt),removeEvent(e,"gestureend",Tt)):(removeEvent(e,"touchstart",qe),removeEvent(e,"touchmove",ze),removeEvent(e,"touchend touchcancel",Ye),removeEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else removeEvent(e,"mousedown",St),removeEvent(e,"mousemove",kt),removeEvent(window,"mouseup",Ct),removeEvent(window,"mousewheel",Qe),removeEvent(window,"keydown",Ht)}(),e=t=n=a=!1,i=o=!1,s=l=c=!1,_=f=p=h=!1,v=!1,y=!1,Yt=null)}return{onShow:Object(u.default)(),onHide:Object(u.default)(),likePhoto:function(e,t){return!!Ie&&(Qi.highlight=!1,Qi.end(),window.Unauthorized?(window.Unauthorized.onActionClick(null,"like","photo"+t),!1):(Xt.likes_me?(Xt.likes_me=!1,--Xt.likes_cnt):(Xt.likes_me=!0,++Xt.likes_cnt),sn(),Yi.click(e,extend({photo_id:t},Ki))))},openPhoto:function(e,t,n){var i=window.cur;if(!Ie)return!1;var a=i.replyNames,r=at.default.getStickerPanel(),o=at.default.getStickers(),s=Gi.go(e,t,{local:!0,fast:!0,beforeAppend:function(e){val(geByClass1("mcont",e),'<div class="pcont"><div class="media_view photo_view"><div class="pv_summary"><div class="summary_loading" style="display: none;"><i class="i_loading"></i></div></div><div class="pv_tag_wrap"></div><div class="pv_body pv_touch pv_touch_full pv_hidden_icons"><a class="thumb_item"><div class="pv_photo_wrap" id="pv_photo_tags" onclick="return photo.closeTags(event);"><img src="/images/mobile/blank.gif" class="ph_img" alt="" /></div></a><div class="pv_nav"><table class="row_table pv_nav_cont"><tr><td class="pv_nav_left"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_z"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_right"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td></tr></table></div></div><div class="pv_footer"></div></div></div>'),val("m",e.innerHTML)}});if(extend(i,{replyNames:a,sticker_panel:r,stickers:o,processNav:function(e){var t;if(t=/^\/photo(-?\d+_\d+)$/i.exec(e.nav.path)){var n=qs2obj(e.nav.params),i=qs2obj(Gi.params);if(n.act)return!1;if(n.offset!=i.offset)return!1;if(n.list!=i.list&&!i.z)return!1;if(n.reply!==i.reply)return!1;if(n.reply_to!==i.reply_to)return!1;e.onPreNav&&e.onPreNav();var a=n.list||"",r=n.rev?"/rev":"";return!Ji.open(t[1],a+r,null,n.from,!0)}return!1}}),i.destroy.push((function(){Ji.clear()})),window.lang,!s&&!(s=Gi.go(e,t,{force:!0}))){if(Xi._lastNav){var l=Xi._lastNav,c=qs2obj(l.params);delete c.z,l.path+obj2qs(c)+l.hash}Ji.showIcons()}return!0},closePhoto:Ft,savePhoto:function(e,t){if(!Ie)return!1;if(Qi.highlight=!1,Qi.end(),hasClass("item_disabled",e))return!1;if(!S||!Yt)return!1;var n=Yt[0],i=Je(),a=_.width*oe,r=(_.height||_.clientHeight)*oe,o=(a-i.width)/2-te,s=(r-i.height)/2-ne,l=1/oe,c=o/a,u=s/r;return n.onSelect&&n.onSelect(c,u,l),!1},cancelPhoto:function(e,t){return!!Ie&&(Qi.highlight=!1,Qi.end(),!hasClass("item_disabled",e)&&Ft())},onClose:null,onUpdate:null,onPhotoChange:null,saveSource:en,_toggleTouches:function(e){Zi.opened()&&(b=!e,e||(le=!1))},opened:function(){return y},openCrop:function(t,n){n=n||{};var a=!y;O?O=!1:_n(),S=!0,b=!1,Yt=[t],a&&(Xi.open(),Xi.onResize=Ut),function(){if(y&&S){var t=window.lang;val("zpv_summary",t.mobile_zphoto_owner_crop_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_crop",e),It(oe),_.parentNode||(val("zpv_center",""),append(_,"zpv_center"));var n='<tr><td class="row_table_column"><a class="item_button" id="zpv_save_button" onclick="return photoview.savePhoto(this);"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" id="zpv_cancel_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(o,n),o.classList.add("zpv_values--upload"),show(i),dn()}}()},updateCrop:function(e){if(!Yt)return!1;e=extend(Yt[0]||{},e),Yt=[e],dn()},openUpload:function(t,n){n=n||{},_n(),O=!0,b=!0,Yt=[t],Xi.open(),Xi.onResize=Ut,function(){if(y&&O){var t=window.lang;val("zpv_summary",t.mobile_zphoto_upload_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_upload",e);remove(_),val("zpv_center",'<div class="zpva zpv_upload_box zpv_thumb_uploading"><div class="zpv_upload_img"></div><div class="zpvu_progress_wrap"><div class="zpvu_progress"></div></div></div>');var n='<tr><td class="row_table_column" width="50%"><a class="item_button item_disabled" onclick="return false;"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(o,n),o.classList.add("zpv_values--upload"),show(i),un()}}()},updateUpload:function(e){if(!Yt)return!1;e=extend(Yt[0]||{},e),Yt=[e],Xt=!1,un()},open:function(e,t,n){var i,r;Zi.onShow(),_n((n=n||{}).isDoc,n.hasVideo),w=n.local||!1,k=!1!==n.showControls,t&&en(t,!1,!1,!0),cn(e),Kt=0,Xi.open(),Xi.onResize=Ut,i=geByClass1("zpv_close_msg",a),r=getW(i),setStyle(a,{width:r||250})},close:function(){Zi.onHide(),Zi.onClose&&Zi.onClose({local:w})||Xi.close()}}}();window.photoview=Zi;n("ldCb");window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,a){var r=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:a},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(r)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,a,r,o,s,l){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i,a,r,o,s){var l={_ajax:1,act:"hide_internal_notification",reason:i,id:t,hash:n},c={},u=gpeByClass("_block",e),d=!0;if("decline"==i){var _=this.webActionsDeclineHandlers[r];d=this.runActionHandler(_,e,l,c,o,n),hide(u)}else{var f=this.webActionsAcceptHandlers[r];d=this.runActionHandler(f,e,l,c,o,n),lockButton(e),"add_custom_newsfeed"==r&&(Object(hn.setCookie)("remixcustom_feed_added",o),l.action=r,l.action_section=o.section,l.action_hash=o.hash)}return c.onDone=function(){"compact"===s&&"accept"===i||cur.destroy.push((function(){return remove(u)})),~this.withoutNavActions.indexOf(r)||nav.go(e,a)}.bind(this),c.onFail=function(){unlockButton(e)},Promise.resolve(d).then((function(e){(e||isUndefined(e))&&ajax.post("/index.php",l,c)})),!1})),runActionHandler:function(e,t,n,i,a,r){return!isFunction(e)||e(t,n,i,a,r)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}},function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?Object(hn.setCookie)("remixm_tabs_expanded","",-1):Object(hn.setCookie)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}(),window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",a=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!a,hash:n,audio_id:t,ref:cur.module}),attr(e,"aria-label",a?lang.mobile_bookmarks_actions_add:lang.mobile_bookmarks_actions_remove),a?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),i="";cur&&cur.module?i=cur.module:nav&&"/feed"===nav.cur?i="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(i="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,i),_n.default.open(n,!0)}};var ea=n("p5n7");function ta(e,t){var n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option"),r=$(".Btn__text",a);e?(n.style.display="inline-block",n.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},a.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},r.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):(a.onclick=function(n){return posting.openCopyright(n,!1,t,encodeURIComponent(e))},setStyle(a,"display","table"),r.innerHTML=getLang("mobile_wall_post_copyright_add_button"),hide(n)),val(i,e),post.checkCopyright()}var na={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var i=new RegExp("{link}(.*){/link}"),a=i.exec(getLang("mobile_wall_post_copyright_mb_text"))[1],o="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),s=getLang("mobile_wall_post_copyright_mb_text").replace(i,"<a onclick=\"Popup.close(this); nav.go('"+o+'\', null)" href="'+o+'">'+a+"</a>"),l=Object(sn.default)({class:"AddCopyrightPopup",header:{title:e?getLang("mobile_wall_post_copyright_mb_title_text_edit"):getLang("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(s)},Object(ea.default)({class:"AddCopyrightPopup__input",placeholder:getLang("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:e?getLang("mobile_wall_post_copyright_edit_button"):getLang("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?Btn({class:"Popup__button",inner:getLang("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});sn.default.open(Wd.elem(l),!0);var c=$(".AddCopyrightPopup__input input");c&&Object(r.elfocus)(c)},submit:function(e,t,n){var i=$(".Btn",n.parentNode);i.disabled=!0,ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(a){var r=$(".AddCopyrightPopup__error");a.status?(n.classList.remove("TextInput_error"),hide(r),ta(e,t),sn.default.close(n)):(n.classList.add("TextInput_error"),show(r),val(r,a.error)),post.saveDraft(null,t),i.disabled=!1}})},remove:function(e,t){t&&sn.default.close(t),ta("",e),e&&post.saveDraft(null,e)}};window.AddCopyrightPopup=na;var ia=na,aa={getHash:function(){var e=Object(M.$)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,i){cancelEvent(e);var a=!1;if("BUTTON"===e.target.tagName)a=e.target.disabled;else if("LABEL"===e.target.tagName){a=Object(M.$)("button",e.target).disabled}a||ia.open(t,n,i)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=Object(M.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),i=n.querySelector("input");ia.submit(i.value,e,n)},deleteSource:function(e,t,n){var i=Object(M.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),ia.remove(n,i)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,aa.getHash(),""+nav.path+obj2qs(n))}};window.posting=aa;n("wyHI");var ra={},oa=function(e,t,n,i){delete ra[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var sa,la={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(window.showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var a=attr(e,"data-sticker-id"),r=attr(e,"data-hash");return!(!a||!r)&&(!ra[a]&&(ra[a]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:a,hash:r},{onDone:oa.pbind(n,a,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};if(window.isMVK){var i=String(t);return o.colorScheme.isDarkScheme()&&(i=i.replace(/b$/,"")+"b"),rs(window.store.stickers.url_template,{id:e,size:i})}return getTemplate("stickers_sticker_url",n)}},ca=function(){var e,t,n,i=!1,a=!1,r={},o={},s={},l={};function c(e){var t=_(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function a(r){n++;var o=!0;i>=n&&(o=!1),o&&(d(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",a),t.stop())}))}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function d(e,t){l[u(e)]=t}function _(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=o[t];return n||!1}function f(e,t){var i=_(e);if(i)"function"==typeof t&&t(i);else{var a=attr(e,"data-uniq-id");if(!l[u(e)]){d(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),f=!1;if(c&&(f=(r[c]||s)&&h(e)),f){var p=attr(e,"data-animation-class")||"",m={container:e,renderer:"svg",loop:!0,autoplay:!1,name:a,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation "+p}};r[c]?m.animationData=r[c]:m.path=s;var v=geByClass1("svg_sticker_animation",e);if(v&&re(v),i=n.loadAnimation(m),!r[c])return void i.addEventListener("data_ready",(function(){r[c]=i.animationData,o[a]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(o[a]=i,"function"==typeof t&&t(i))}}}function p(){return t().then((function(e){return n=e,e}))}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);ca.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");ca.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(n));ca.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){f(t,(function(){c(t)}))})),i=!1}}else p().then((function(){ca.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame((function(){f(e,(function(){c(e)}))})):p().then((function(){ca.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!s[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(s[e]=setTimeout((function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(ca.loadAndPlaySticker(n),clearTimeout(s[e]),s[e]=!1)}),t))}},reloadStickers:function(){o={}},touchStartSticker:function(t){t.addEventListener("contextmenu",ca.preventContextMenu,!1),e=setTimeout((function(){ca.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function h(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}(),ua={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return ua.autoplay}};function da(){return qs2obj(nav.params)}function _a(e){return"dialogs"===e.tab||!e.q}function fa(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function pa(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,a){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(a?'<div class="si_slabel">'+a+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:C.default.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}ca.init({animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.Stickers=la,window.StickersAnimation=ca,window.StickersSettings=ua,window.StickersCache=at.default,im.clearSearchInput=function(e){if(preventEvent(e),_a(da())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+fa(!0))},im.onFilterKeyDown=function(e){setTimeout((function(){var t=window.lang,n=encodeURIComponent(e.value),i=da();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+fa():"/mail"+fa(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+fa()),_a(i)){var a,r=ge("mail_tabs"),o=ge("ma_search_items"),s=ge("dialogs"),l=i.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),sa&&clearTimeout(sa),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(r),show(o),hide(s),sa=setTimeout((function(){a="/mail?tab=dialogs&q="+n+(l?"&offset="+l:"")+fa(),"/mail"!==nav.path||da().act||nav.go(a,null,{push_only:!0})}),200);else{if(hide(r),hide(o),show(s),!nav.getQuery("community")){var c=geByClass1("mhb_back"),u=geByClass1("mh_header");val(u,t.mobile_mail_head_title),removeClass("mhi_back",u),c.outerHTML=c.outerHTML.replace("<a","<div").replace("</a>","</div>")}a="/mail"+(l?"?offset="+l:"")+fa(!l),nav.go(a,null,{push_only:!0})}}}),40)},mail.onShowWritePageFromCache(pa),mail.onShowDialogsPageFromCache(pa);var ha=n("vuIU"),ma="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",va=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(!('audio/mpeg; codecs="mp3"'!==(e=e||'audio/mpeg; codecs="mp3"')||!browser.safari&&!browser.safari_mobile||!browser.version.toString().startsWith("14"))||!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==ma?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",(function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)})),addEvent(t,"stalled",(function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))})),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",(function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())})),this.opts.onEnd&&addEvent(t,"ended",(function(){n._currentAudioEl==t&&n.opts.onEnd()})),this.opts.onSeeked&&addEvent(t,"seeked",(function(){n._currentAudioEl==t&&n.opts.onSeeked()})),this.opts.onSeek&&addEvent(t,"seeking",(function(){n._currentAudioEl==t&&n.opts.onSeek()})),addEvent(t,"error",(function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()})),addEvent(t,"canplay",(function(){n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))})),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,ma),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,ma);var a=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout((function(){a.opts.onCanPlay&&a.opts.onCanPlay()})),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,ma);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,ma),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;n.src&&$n(n).catch((function(){debugLog("Audio: url set failed (html5 impl)")}))},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,ma)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var a=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),a+=i;if(i<0?a<=e:a>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(a)}.bind(this))},Object(ha.default)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();va.STATE_HAVE_NOTHING=0,va.STATE_HAVE_FUTURE_DATA=3,va.HAVE_ENOUGH_DATA=4,va.AUDIO_EL_ID="ap_audio";var ga=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout((function(){n._checkFlashLoaded()}),50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout((function(){i._checkFlashLoaded()}),100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},Object(ha.default)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=ga,ga.PLAYER_EL_ID="flash_voice";void 0===window.isTouch&&(window.isTouch=!1);var Aa,ba=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var r=e.classList,o=0,s=r.length;o<s;o++)addClass(this._el,r[o]);else this._el.className=e.className;each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=Object(ri.debounce)(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),a=this._width;if((i=t?Math.min(Math.max(0,i),a):i)>=0&&i<=a){var r=i/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,r):r;var o=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(o.right-o.left)/2,top:this._slideEl.offsetTop-(o.bottom-o.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var a=n?e:this._unlogf(e);a=100*a+"%",setStyle(this._amountEl,{width:a}),setStyle(this._handlerEl,{left:a}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},Object(ha.default)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}(),ya=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window;var wa=!1,Oa=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var i={onEnd:function(){t.detach()},onFail:function(){i.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};Aa=!1,va.isSupported()?(va.isSupported('audio/ogg;codecs="opus"')&&!va.isSupported('audio/ogg;codecs="codec_check"')&&(Aa=!0),this._impl=new va(i)):browser.flash&&window.renderFlash&&(this._impl=new ga(i)),this.onPlayPause=function(e){return cancelEvent(e),t._clearMediaSession(),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new ba(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var t=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(t.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(t.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.prepend(this._el),this._clearMediaSession()},t._clearMediaSession=function(){var e=this;ya&&(navigator.mediaSession.setActionHandler("play",(function(){return e.play()})),navigator.mediaSession.setActionHandler("pause",(function(){return e.pause()})),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise((function(n,i){t._impl.onReady((function(){t._impl.setUrl(attr(e,Aa?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})}))}));this._impl.setUrl(attr(e,Aa?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&Object(Y.statlogsValueEvent)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval((function(){var t=e._impl.getCurrentProgress();e._updateProgress(t)}),100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[kt.events.PLAY_REQUESTED,kt.events.PLAY],(function(){delete window.ap.pausedByMsg,e.pause()})):window.audio&&window.audio.subscribe([kt.events.PLAY_REQUESTED,kt.events.PLAY],(function(){delete window.audio.pausedByMsg,e.pause()})),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",(function(){e.pause()})),window.Notifier.addRecvClbk("video_start","audio_msg",(function(){e.pause()})))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(wa=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&wa&&(wa=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&($n(window.audio).catch((function(){})),delete window.audio.pausedByMsg)},Object(ha.default)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!qn.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==qn.default.get("audio_time_left")},set:function(e){window.AudioPlayer?qn.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):qn.default.set("audio_time_left",e?"1":"0")}}]),e}(),Sa={avg:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}(),peak:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}(),quad:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},ka=function(){function e(e){this._normalizeAlgorithm=!1,Sa[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new Sa[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,Sa[e.algorithm]||(e.algorithm="peak"),this._algorithm=new Sa[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var a=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),a>0)for(var r=0;r<n.length;r++)n[r]=n[r]/a,this._truncateTo>0&&(n[r]=Math.min(this._truncateTo,Math.abs(n[r])))}return n},e}();var Ca=null;function Ea(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=0,i=0;i<t.length;i++){try{n=parseInt(window.getComputedStyle(t[i],null).getPropertyValue("width"))}catch(e){n=parseInt(t[i].currentStyle.width)}if(n>0)break}return n}function ja(e,t){var n,i,a;t=Math.round(t),e.length!=t&&(i=t,void 0===a&&(a="peak"),e=new ka({srcSampleRate:(n=e).length,dstSampleRate:i,normalizeAlgorithm:a,truncateTo:0}).push(n));for(var r="",o=0,s=0;s<e.length;s++)0===(o=Math.floor(8*e[s]*.95))&&(o=.5),r+="M"+(4*s+1)+","+(10-o)+"v"+2*o+"Z";return'<svg class="audio-msg-track--wave" width="'+4*e.length+'px"><path d="'+r+'"></path></svg>'}function Ta(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=Object(r.attr)(e[t],"data-wave");Object(r.hasClass)(e[t],"audio-msg-player")&&t>0&&(n=Object(r.attr)(e[t-1],"data-wave"));var i=Ea(e[t]);if(n&&i){n=n.split(",");for(var a=geByClass("audio-msg-track--wave",e[t]),o=ja(n,i/4),s=0;s<a.length;s++){var l=Object(r.ce)("div",{innerHTML:o}).firstChild;a[s].parentNode.replaceChild(l,a[s])}}}}function Ia(){return Ca||(Ca=new Oa({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),Ca}addEvent(window,"orientationchange",(function(){return setTimeout(Ta,500)})),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(Ta),window.mail.onMessagesRepainted(Ta)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t){var n=Ia(),i=n.attachTo(e);!0===i?n.play():i.then((function(){n.play()}))},detachPlayer:function(e){Ia().detach(e)},pauseGlobalMedia:function(){Oa.pauseGlobalMedia()},resumeGlobalMedia:function(){Oa.resumeGlobalMedia()},redrawWaves:Ta,getWave:ja};var Ma=n("hw56"),Da=Array.isArray,Pa={mail:{}},xa={injectStore:function(e){Pa.mail={};var t=e.mail,n=t.cur,i=t.rolls,a=t.reached;t.msgs,t.queue;Da(e.mail.msgs)&&(e.mail.msgs={}),Da(e.mail.replies)&&(e.mail.replies={}),i&&Da(i.peer)&&(i.peer={}),i&&Da(i.search.peers)&&(i.search.peers={}),i&&Da(i.search.msgs)&&(i.search.msgs={}),a&&Da(a.search.peers)&&(a.search.peers={}),a&&Da(a.search.msgs)&&(a.search.msgs={}),a&&Da(a.peer.before)&&(a.peer.before={}),a&&Da(a.peer.after)&&(a.peer.after={}),Pa.mail=e.mail,Pa.mail.pendingReplies={},Pa.mail.presend={},n&&(n.msgSelected={},n.msgRemoved={},n.msgAttached={},n.msgReply={},n.keyboards={},n.typings={},n.peerMembers={}),"notificationsCount"in Pa||(Pa.notificationsCount=e.notificationsCount),"menuNotifications"in Pa||(Pa.menuNotifications=e.menuNotifications),Array.isArray(n.drafts)?n.drafts={}:n.drafts&&(Object(Ma.loadDrafts)(n.viewerId),Object.keys(n.drafts).forEach((function(e){var t=n.drafts[e];Object(Ma.setPeerDraft)(n.viewerId,e,t)})))},injectMail:function(e){var t=Pa.mail,n=e,i=isObject(t.peers)&&isObject(n.peers)&&Object.assign({},t.peers);isObject(n.msgs)&&Object.assign(t.msgs,n.msgs),isObject(n.peers)&&Object.assign(t.peers,n.peers),isObject(n.members)&&Object.assign(t.members,n.members),isObject(n.replies)&&Object.assign(t.replies,n.replies),isObject(n.forwards)&&Object.assign(t.forwards,n.forwards),t.page=n.page,n.mrs&&(t.cur.countMR=n.mrs.count,t.rolls.mrs=n.mrs.rolls,t.reached.mrs=n.mrs.reached,t.scraps.mrs=n.mrs.rolls,Object.keys(n.msgs).forEach((function(e){var i=n.msgs[e],a=i.peerId;t.rolls.peer[a]=[i.id],t.reached.peer.after[a]=!0})),t.mrs=n.mrs),i&&Object.keys(i).forEach((function(e){t.peers[e]&&(t.peers[e].peerProfileData=i[e].peerProfileData)}))},injectMsg:function(e){var t;xa.injectMail({msgs:(t={},t[e.id]=e,t)})},resetMail:function(){Pa.mail={}}};window.storeMethods=xa,window.store=Pa;n("Mc5h");var La=n("O5lf"),Ba=n("9y81"),Ra=(n("AXyT"),n("gy8s"),n("KMpi"),n("AgBx"),{_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),Object(r.remove)(Object(r.geByClass1)(Ra.class.btn))},class:{btn:"FloatBtn"}});Ra.class=Object(j.default)({},Ra.class,{open:Ra.class.btn+"_open"});var Na=Ra,Fa={addContent:function(e,t){t&&Object(M.$$)(Ha(e)).forEach((function(e){var n=e.$(Ua)||e;e.classList.remove(Va),n.insertAdjacentHTML("beforeend",t)}))}};window.Pad=Fa;var Ha=function(e){return'.Pad[data-id="'+e+'"]'},Ua=".Pad__content",Va="Pad_empty";var $a=Object(r.need)("scrollToEl");Object(r.need)("page").onChange(qa);var Wa=function(e){return".Anchor#"+e};function qa(){var e=window.nav&&window.nav.cur;if(e){var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&Object(M.$)(Wa(t));n&&$a(n)}}window.Select={},Select._onChange=Ya;var za=function(e){return'.Select__option[value="'+e+'"]'};function Ya(e,t){var n=e.value,i=e.form,a=e.$(za(n));d.default.handle(t,{$select:e,$option:a,$form:i,value:n,name:e.name,label:a.textContent})}var Qa=n("Q8gl");window.LoadMore={setUrl:Za,destroy:er},LoadMore._strategy={replace:{onFail:cr,onSuccess:function(e){var t=e.response;Xa.outerHTML=t,er()}},padsExtend:{onFail:cr,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach((function(e){var t=n[e];Fa.addContent(e,t)})),i?Za(i):er()}}},LoadMore._onButtonClick=tr,onDOMReady(nr),page.onChange(nr);var Ga=".LoadMore",Ka=".LoadMore__button",Xa=null,Ja=null;function Za(e){Ja.setAttribute("href",e)}function er(e){Xa.remove(),Xa=null,Ja=null,ar()}function tr(){lr()||rr()}function nr(){if(Xa=Object(M.$)(Ga)){var e=window.cur;Ja=Xa.$(Ka),ir(0),Object(r.onBodyScroll)(ir),e.destroy.push(ar)}}function ir(e){if(Xa&&!lr()){var t=Object(r.getY)(Xa),n=Object(r.getCh)();t-(e+n)<2*n&&rr()}}function ar(){Object(r.onBodyScroll)("__clear",ir)}function rr(){sr(!0);var e=Ja.getAttribute("href");E.default.post(e,{_ajax:1},{onDone:function(e){return or(e,!0)},onFail:function(e){return or(e,!1)}})}function or(e,t){if(sr(!1),Xa){var n=t?"data-success-handler":"data-fail-handler";n=Xa.getAttribute(n),Wd.handle(n,{$loadMore:Xa,response:e}),Xa=null,Ja=null,ar(),nr()}}function sr(e){Ja&&Xa&&(wt.default.setLoading(Ja,e),Xa._loadMore_loading=e)}function lr(){return Xa&&Xa._loadMore_loading}function cr(e){console.error("LoadMore: failed to load more",e)}var ur=n("v+Uj");window.SliderTabs={},SliderTabs._onClick=yr,onDOMReady(br),page.onChange(vr),page.onRestore(gr);var dr="SliderTabs",_r="Slider__scroll",fr="SliderTabs__tab_selected",pr={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+_r,container:"."+dr},hr="",mr=0;function vr(){var e=Object(r.ge)(hr),t=Object(M.$)(pr.container);e?Object(M.$)(pr.scroll,e).scrollLeft=mr:t?Ar():(hr="",mr=0)}function gr(){setTimeout((function(){var e=Object(r.ge)(hr);if(e){var t=Array.from(Object(M.$$)(pr.tab,e));if(t)t.some((function(e){return e.getAttribute("href")===nav.cur}))&&t.forEach((function(e){e.getAttribute("href")===nav.cur?e.classList.add(fr):e.classList.remove(fr)}))}}))}function Ar(){var e=Object(M.$$)(pr.container),t=Math.min(Object(r.getCw)(),882);e.forEach((function(e){var n=Object(M.$)(pr.scroll,e),i=Object(M.$)(pr.active,e);if(i){var a=i.offsetWidth,o=Object(r.getX)(i);o+a>t&&(n.scrollLeft=o-t+a,console.log("$scroll.scrollLeft scrollAllToActiveTab",n.scrollLeft))}}))}function br(){Ar()}function yr(e,t){var n=Object(r.gpeByClass)(dr,t),i=Object(r.gpeByClass)(_r,t),a=Object(M.$)(pr.active,n);return a&&a.classList.remove(fr),t.classList.add(fr),mr=i.scrollLeft,hr=Object(r.attr)(n,"id"),!0}window.SearchPanel={setQuery:function(e,t){var n=Object(M.$)(kr(e));t=t||"",n.value!==t&&(n.value=t,Tr(n,t))}},SearchPanel._onInput=Er,SearchPanel._onClearClick=jr,SearchPanel._onFocus=Cr;var wr="SearchPanel_hasQuery",Or=".SearchPanel",Sr=".SearchPanel__input",kr=function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'};function Cr(){}function Er(e,t){var n=e.value;Tr(e,n),d.default.handle(t,{query:n})}function jr(e,t){var n=e.closest(Or).$(Sr);n.value="",n.oninput(),d.default.handle(t)}function Tr(e,t){e.closest(Or).classList.toggle(wr,!!t)}window.TabRow={setSelectedTab:function(e,t){var n=Object(M.$)(Mr(e)),i=Object(M.$)(Pr,n),a=Object(M.$)(Dr(t),n);i&&i.classList.remove(Ir),a&&a.classList.add(Ir)},setTabUrl:function(e,t,n){var i=Object(M.$)(Mr(e)),a=Object(M.$)(Dr(t),i);a&&a.setAttribute("href",n)}};var Ir="TabRow__tab_selected",Mr=function(e){return'.TabRow[data-id="'+e+'"]'},Dr=function(e){return'.TabRow__tab[data-id="'+e+'"]'},Pr=".TabRow__tab_selected";window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=Fr,SwitcherConfirm._onConfirmClick=Hr,SwitcherConfirm._onCancelClick=function(e){return Ur(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return Ur(e.$popup)};var xr=function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")},Lr=".SwitcherConfirm",Br=".SwitcherConfirm__popup",Rr=".SwitcherConfirm__confirm",Nr=".SwitcherConfirm__cancel";function Fr(e){var t=e.$control,n=t.closest(Lr),i=Object(M.$)(Br,n);_n.default.open(i),n.$popup=i,n.$control=t,n.checked=e.checked}function Hr(e,t){var n=t.$btn.closest(Lr),i=Object(M.$)(Rr,n),a=Object(M.$)(Nr,n),r=n.checked;n.isSaving=!0,wt.default.setLoading(i,!0),wt.default.setDisabled(a,!0),Wd.handle(e,{checked:r,onSuccess:function(){n.isSaving=!1,_n.default.close(n.$popup),wt.default.setLoading(i,!1),wt.default.setDisabled(a,!1),n.classList.toggle(xr(!0),r),n.classList.toggle(xr(!1),!r)}})}function Ur(e){var t=e.closest(Lr);t.isSaving||(Qa.default.setChecked(t.$control,!t.checked),_n.default.close(t.$popup))}var Vr=n("gZry"),$r=n("LBnd"),Wr=n("EKfs"),qr=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,i=e.title?e.title:"",a=e.subtitle?e.subtitle:"",r=e.verified?e.verified:"",o=e.mix?e.mix:"",s=e.type||null,l=e.online?e.online:"",u=!!e.actions&&e.actions,d=e.link?e.link:null,_=!!e.attrs&&e.attrs,f=!!e.linkAttrs&&e.linkAttrs,p=!!e.icon&&e.icon,h="artist"!==s||t?null:{class:"OwnerRow__placeholderWrapper",inner:Object(T.default)(Object(Wr.getMusicMicOutline28Icon)())};return{attrs:_,class:[c.default.class("OwnerRow",{actions:!!u}),o],inner:[{class:"OwnerRow__content",href:n,attrs:f,inner:[{class:"OwnerRow__left",inner:p||{style:p?null:t?"background-image: url('"+t+"')":null,class:"OwnerRow__img",inner:[l?[l.mobile?{inner:[{inner:[Object(T.default)({icon:Object(Vr.getOnlineMobileComposite16Icon)()})],class:"mlvi_default",tag:"span"},{inner:[Object(T.default)({icon:Object($r.getOnlineMobileCompositeMuted16Icon)()})],class:"mlvi_muted",tag:"span"}],class:"lvi mlvi OwnerRow__online OwnerRow__online--mobile","aria-label":Object(W.getLang)("mobile_accessibility_profile_online"),tag:"b"}:{class:"lvi OwnerRow__online","aria-label":Object(W.getLang)("mobile_accessibility_profile_online"),tag:"b"}]:null,h]}},{class:"OwnerRow__right",inner:[{class:c.default.class("OwnerRow__header",{verified:r}),inner:[{class:"OwnerRow__title",inner:i},r?{class:"OwnerRow__verified"}:null]},{class:"OwnerRow__subtitle",inner:a}]},d?{inner:[d],class:"OwnerRow__link",tag:"div"}:null]},u?{class:"OwnerRow__actions",inner:u}:null]}};var zr=qr;window.OwnerRow=qr;var Yr=function(e){var t=e.items?e.items:[];return{inner:[(t=t.filter((function(e){return e}))).map((function(e){var t=c.default.class("OwnerInfo__row",{extraMargin:e.extraMargin,gray:e.gray,black:e.black},"--");return{inner:[e.href?{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],href:e.href,class:"OwnerInfo__rowInfo",tag:"a"}:{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],class:"OwnerInfo__rowInfo",tag:"div"},e.right?{inner:[e.right],class:"OwnerInfo__rowRight",tag:"div"}:null],class:t,tag:"div"}}))],class:c.default.class("OwnerInfo",{noMargin:e.noMargin},"--"),tag:"div"}};window.OwnerInfo=Yr;var Qr=function(e){return{inner:[{inner:[{inner:[(e.items?e.items:[]).map((function(e){return{inner:[Wd.wrap(e)],class:"OwnerPhotoGallery__item",tag:"div"}}))],class:"OwnerPhotoGallery__table",tag:"div"}],class:"OwnerPhotoGallery__wrap",tag:"div"}],class:"OwnerPhotoGallery",tag:"div"}};window.OwnerPhotoGallery=Qr;var Gr=n("tlMv"),Kr=function(){function e(){}var t=e.prototype;return t.findElement=function(){var e=document.getElementsByClassName("UnsupportedBrowser");return e.length?(this._element=e[0],this._element):null},t.getElement=function(){return this._element?this._element:this.findElement()},t.show=function(){var e,t;this._previousActiveElement=document.activeElement,null==(e=this.getElement())||e.classList.add("UnsupportedBrowser--active"),null==(t=this.getElement())||t.focus(),Object(Y.statlogsValueEvent)("mvk_unsupported_browser_alert","shown")},t.hide=function(){var e,t;null==(e=this.getElement())||e.classList.remove("UnsupportedBrowser--active"),null==(t=this._previousActiveElement)||t.focus(),Object(Y.statlogsValueEvent)("mvk_unsupported_browser_alert","hidden")},e}();window.UnsupportedBrowser=new Kr;var Xr=n("UWnA");var Jr=function(){function e(){}return e.findButtonInEvent=function(e){return e.target.closest(".Btn")},e.onChange=function(t,n){if(void 0===n&&(n=""),"file"===n){var i=t.target.files;if(i&&i[0]){var a=Object(di.replaceEntities)(i[0].name),o=e.findButtonInEvent(t),s=Object(M.$)(".MobileInput__text",o);Object(r.val)(s,a)}}},e}();window.MobileInput=Jr;var Zr=n("QE8O");var eo=n("HsQo");n("QQoL"),n("rKUZ");var to=Object(r.need)("ajax"),no=Object(r.need)("onDOMReady"),io=Object(r.need)("onBodyResize");window.CookiePolicy={},no(so),CookiePolicy._onHideClick=co;var ao="body",ro="._hfixed",oo=".CookiePolicy";function so(){Object(M.$)(oo)&&(lo(),io(lo))}function lo(){if(Object(M.$)(ro)){var e=Object(M.$)(ao),t=Object(M.$)(oo).offsetHeight,n=parseInt(getComputedStyle(e).paddingBottom,10);e.style.paddingBottom=n+t+7+"px"}}function co(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(oo).style.display="none",io("__clear",lo),to.post(n,{_ajax:1})}var uo=Object(r.need)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=fo;var _o=".PrivacyPolicy__submit";function fo(e){var t=e.checked,n=Object(M.$)(_o);uo.setDisabled(n,!t)}n("nj7l");onDOMReady((function(){window.page.onChange((function(){Object(M.$$)(".ConfirmPopup").forEach((function(e){return _n.default.close(e)}))}))})),window.ConfirmPopup={onOverlayClick:function(e,t){var n=e.closest(".Popup");Object(M.$)('[data-key="no"]',n).click()},onButtonClick:function(e,t){t.preventDefault(),t.stopPropagation();var n=Object(_t.parseURL)(e.href),i=n.pathname+n.search,a=Object(_t.parseURL)(nav.prev_cur),o=a.pathname+a.search;if("no"===Object(r.domData)(e,"key")&&i===o&&"1"!==Object(r.domData)(e,"force")){var s=e.closest(".Popup");return history.back(),_n.default.close(s)}nav.go(i)}};var po=function(){function e(){}return e.hideDisclaimerAndPlay=function(){Object(M.$)(".VideoRestriction__boxWrap").remove(),Object(M.$)(".VideoRestriction__thumb").remove(),Object(M.$)(".vv_inline_video").play(),Object(M.$)(".VideoRestriction").setAttribute("class","")},e}();window.VideoRestriction=po;n("Qg0H");var ho=function(e){var t=e.bcg,n=t.type;return{class:c.default.class("VotingBcg",{type:n}),style:"photo"===n?mo(t):"gradient"===n?vo(t):"tile"===n?go(t):null,inner:"photo"===n?Ao(e):null}};function mo(e){return bo({"background-color":e.color})}function vo(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var a=e.points[t];n.push(a.color+" "+a.percent+"%")}return bo({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function go(e){return bo({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function Ao(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:bo({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:bo({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:bo({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function bo(e){var t,n=[],i=Object.keys(e),a=i.length;for(t=0;t<a;t++){var r=i[t],o=e[r];n.push(r+": "+o+";")}return n.join(" ")}var yo=ho;window.VotingBcg=ho;var wo=function(e,t){return{tag:"label",class:c.default.class("VotingForm__bcg",{light:"default"===t.type}),inner:[{class:"VotingForm__bcgPreview",inner:[yo({bcg:t,photoHeight:48}),{class:c.default.class("VotingForm__bcgTextGhost",{0:!0})},{class:c.default.class("VotingForm__bcgTextGhost",{1:!0})},{class:c.default.class("VotingForm__bcgTextGhost",{2:!0})},{class:c.default.class("VotingForm__bcgTextGhost",{3:!0})},{class:c.default.class("VotingForm__bcgTextGhost",{4:!0})},{class:c.default.class("VotingForm__bcgTextGhost",{5:!0})}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}};var Oo=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[Object(ea.default)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:d.default.wrap(Object(Ba.default)({icon:"close16"}))}]}};var So=Object(r.need)("Slider");window.VotingForm={},VotingForm._onInit=Fo,VotingForm._onAddOptionClick=No,VotingForm._onExpireChange=Uo,VotingForm._onOptionRemoveClick=Vo,VotingForm._onTitleKeyDown=Lo,VotingForm._onTitleInput=Bo,VotingForm._onOptionKeyDown=Ro,mediaUpload.onComplete(qo),mediaUpload.onStart(zo),mediaUpload.onError(Yo);var ko="VotingForm_uploading",Co="VotingForm_withExpire",Eo="VotingForm_maxOptions",jo=".VotingForm",To=".VotingForm_maxOptions",Io=".VotingForm__option",Mo=".VotingForm__options",Do=".VotingForm__upload",Po=".VotingForm__bcg",xo=".VotingForm__bcgRadio:checked";function Lo(e){13===e.keyCode&&e.preventDefault()}function Bo(e){var t=+attr(e,"maxlength"),n=Object(M.$)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function Ro(e){if(Lo(e),13===e.keyCode){if(!Object(M.$)(To))if(Object(M.$)(".VotingForm__option:last-child input")===document.activeElement)return Ho(),void Object(M.$)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(8===e.keyCode){if(1===Object(M.$$)(".VotingForm__option").length)return;var i=e.target;i.value||setTimeout((function(){var e=i.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",Wo(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}}))}}function No(){Ho(),Object(M.$)(".VotingForm__option:last-child input").focus()}function Fo(){var e=Object(M.$)(xo).closest(Po);So.scrollToElem(e)}function Ho(){var e=Object(M.$)(Mo),t=Oo({});e.insertAdjacentHTML("beforeend",Wd.html(t)),$o(),Wo()}function Uo(e){var t=e.$control,n=e.checked;t.closest(jo).classList.toggle(Co,n)}function Vo(e){e.closest(Io).outerHTML="",$o(),Wo()}function $o(){Array.from(Object(M.$$)('.VotingForm__option[data-created="0"] input')).forEach((function(e,t){e.setAttribute("name","answers["+t+"]")}))}function Wo(){var e=Object(M.$)(jo),t=Number(e.getAttribute("data-max-options")),n=Object(M.$$)(Io).length;e.classList.toggle(Eo,n===t)}function qo(e){if(Object(M.$)(jo)){var t=Object(M.$)(Do),n=Wd.html(wo("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),Qo()}}function zo(){var e=Object(M.$)(Do);e&&e.classList.add(ko)}function Yo(e){var t=Object(M.$)(jo);if(t){var n=t.getAttribute("data-upload-error-msg");Qo(),alert(n)}}function Qo(){var e=Object(M.$)(jo);Object(M.$)(Do).outerHTML=e.getAttribute("data-upload-html")}window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=Xo;var Go=".VotingStatsFilters__section_country",Ko=".VotingStatsFilters__section_city";function Xo(e){var t=e.$option,n=Object(M.$)(Go),i=Object(M.$)(Ko),a=t.getAttribute("data-city-section-html");i&&(i.outerHTML=""),a&&n.insertAdjacentHTML("afterend",a)}var Jo=window.Popup,Zo=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=as,AuthCheck._onResetSessionSubmit=os,AuthCheck._onCurBrowserDropClick=ss;var es=function(e){return".AuthCheck__popup_index_"+e},ts=function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},ns=".AuthCheck__dropConfirmationSubmit",is="AuthCheck__dropConfirmation_success";function as(e){var t=Object(M.$)(es(e));Jo.open(t)}function os(e,t){e.preventDefault();var n=e.target,i=Object(M.$)('iframe[name="'+e.target.target+'"]'),a=n.$(ns);n.submit(),Zo.setLoading(a,!0),addEvent(i,"load",(function(){Object(M.$)(ts(t)).classList.toggle(is),Jo.close(),Zo.setLoading(a,!1)}))}function ss(e){var t=e.$btn;Zo.setLoading(t,!0),ajax.click(t,{onDone:function(){Object(M.$)(ts("0")).classList.toggle(is),Jo.close(),Zo.setLoading(t,!1)}})}function ls(){var e=Object(M.$)(cs.intro),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push((function(){return t.destroy()}))}window.AppPasswords=new function(){this.showPopup=function(){return Popup.open(Object(M.$)(".AppPasswordsPopup"))},this.hidePopup=function(){return Popup.close(Object(M.$)(".AppPasswordsPopup"))}},window.AuthCheckIntro={},AuthCheckIntro._onMount=ls;var cs={intro:".AuthCheckIntro"};function us(){Object(M.$)(ds.self).classList.toggle(_s.restCodesShown)}window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=us;var ds={self:".ReservedCodes"},_s={restCodesShown:"ReservedCodes_restCodesShown"};window.Settings={_privacy:{}},Settings._privacy.onRadioChange=As;var fs=function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},ps=".Settings__privacySubmitRow",hs=".Settings__privacyForm",ms=".Settings__privacySelectForbiddenLink",vs="Settings__privacyPad_visible",gs="Settings__privacySubmitRow_visible";function As(e,t){if("none"===e)bs("allowed",!1),bs("forbidden",!1),ys(!0);else if("allowed"===e)bs("allowed",!0),bs("forbidden",!1),ys(!1);else if("forbidden"===e){bs("allowed",!1),bs("forbidden",!0),ys(!0);var n=Object(M.$)(hs),i=Object(M.$)(ms),a=t.name,r=t.value,o=n.getAttribute("action")+"&"+a+"="+r+"&forbid";i.setAttribute("href",o)}}function bs(e,t){Object(M.$)(fs(e)).classList.toggle(vs,t)}function ys(e){Object(M.$)(ps).classList.toggle(gs,e)}var ws=n("gNZk");window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("LoginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",(function(){return nav.go(n,null,{isForm:!0})}))},showResetSessionModal:function(e,t,n){var i=Object(G.default)({close:!0,items:[Object(K.ModalMenuBtn)({class:"ai_add",inner:getLang("mobile_settings_activity_session_reset_title"),onclick:"LoginHistory.resetSession('"+e+"', '"+t+"', '"+n+"');Popup.close(this);"})]});return G.default.open(d.default.elem(i),!0),!1},resetSession:function(e,t,n){ajax.post(e,{reset_data:t,hash:n})}},window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),Object(r.statlogsValueEvent)("settings_menu_click",e),t?ae.default.hard_go(e):ae.default.go(e),!1}};var Os=n("vOib");n("4qEP"),n("0oUU");window.Subscriptions={editSubscription:function(e,t){if(t.context_actions){var n=Wd.html(t.context_actions.map((function(e){return Object(le.ContextMenuItem)({title:e.title,href:e.href})}))),i=Wd.elem(Object(le.ContextMenu)({list:n}));i.parentNode.id="container",le.ContextMenu.open(i,"#container",{appendToBody:!0})}}};var Ss,ks,Cs=function(){function e(e){var t=e.selector,n=e.className;this.element=Object(M.$)(t),this.className=n}var t=e.prototype;return t.show=function(){this.element.classList.add(this.className)},t.hide=function(){this.element.classList.remove(this.className)},e}(),Es=function(e){function t(){return e.call(this,{selector:".Appearance__fixedSchemes",className:"Appearance__fixedSchemes--active"})||this}return Object(ci.default)(t,e),t}(Cs),js=function(e){function t(){return e.call(this,{selector:".Appearance__autoSwitcher",className:"Appearance__autoSwitcher--active"})||this}return Object(ci.default)(t,e),t}(Cs);function Ts(e){var t=e.mode;o.ColorScheme.isSchemesAutoSwitchingSupported()?ks.show():Ss.show(),t===o.ColorSchemeMode.Auto&&o.ColorScheme.isSchemesAutoSwitchingSupported()?Ss.hide():Ss.show();var n=Object(M.$)("[name='mode'][value='"+t+"']");n&&(n.checked=!0)}function Is(e,t){var n={mode:t,_ajax:1};E.default.post(e,n),o.colorScheme.setMode(t),Ts({mode:t})}window.Appearance={init:function(){if(o.ColorScheme.isSchemesSupported()){Ss=new Es,ks=new js;var e=o.colorScheme.getMode();o.ColorScheme.isSchemesAutoSwitchingSupported()||e!==o.ColorSchemeMode.Auto||(e=o.ColorSchemeMode.Light),Ts({mode:e})}},switchOnChange:function(e,t){var n=t.checked,i=o.colorScheme.isDarkScheme()?o.ColorSchemeMode.Dark:o.ColorSchemeMode.Light;Is(e,n?o.ColorSchemeMode.Auto:i)},radioOnChange:function(e,t){Is(e,t.value)}};n("yVza"),n("0hva");var Ms=n("EXR0"),Ds=n("GtpT"),Ps=n("k+Df"),xs=n("g3t9");var Ls=function(e){var t=window.lang,n=(e.albums||[]).map((function(e){var t=Object(_t.makeUrl)(e.url,{act:"add"});return Object(Ds.default)({onClick:["AddPhotoModal.go",t,"this"],album:e})}));return{inner:[Object(Ms.default)({inner:[t.mobile_photos_choose_album_modal_title],onClose:"AddPhotoModal.close(this)"}),n.length?Object(K.ModalMenuContent)({inner:[e.link.createAlbum?Object(wt.default)({inner:[t.mobile_photos_choose_album_modal_create_album],class:"AddPhotoModal__createAlbum",theme:"secondary",stretch:!0,onClick:["AddPhotoModal.go",e.link.createAlbum]}):null,{inner:[n],class:"ScrollView",tag:"div"}],class:"AddPhotoModal__content"}):Object(Ps.default)({separator:!0,separator_desktop:!0,text:t.mobile_photos_choose_album_modal_empty_text,more_type:"primary",more_text:e.link.createAlbum?t.mobile_photos_placeholder_album_action:null,more_url:e.link.createAlbum,more_onclick:["AddPhotoModal.go",e.link.createAlbum]})],class:"AddPhotoModal",tag:"div"}},Bs="AddPhotoModal";function Rs(e){var t=e.closest("."+Bs);G.default.close(t)}window.AddPhotoModal={open:function(){var e=Object(W.getState)("upload_albums"),t=Object(W.getState)("AddPhotoModal"),n=Object(G.default)({on_overlay_click:"AddPhotoModal.close(this)",class:Bs,attached:!0,body:Ls({link:{createAlbum:t.owner_id>0&&"/photos?act=select_album"},albums:e})});return G.default.open(Wd.elem(n),!0,"",{expandable:!0})},close:Rs,go:function(e,t){void 0===t&&(t=null),nav.go(e),t&&t.hasOwnProperty("$btn")?Rs(t.$btn):Rs(t)}},window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";Object(r.statlogsValueEvent)("lovina_promotion",t?1:0),window.nav.hard_go(n)}},window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=Object(M.$)(Ns.special);t&&t.classList.toggle(Fs,e)}};var Ns={special:window.AudioSpecialForYou.selector},Fs="AudioSpecialForYou_playing";var Hs=function(){function e(e){this.store=Stories.getStore(),this.data=e,this.raw_id=e.raw_id,this.can_remove=e.can_remove,this.can_report=e.can_report,this.can_bookmark=e.can_bookmark,this.canMarkNotInterested=e.canMarkNotInterested,this.isAds=e.isAds,this.trackCode=e.track_code,this.is_bookmarked=e.is_bookmarked,this.is_narrative=!!e.narrative,this.reportUrl=this.getReportUrl(),this.hideUrl=this.getHideUrl()}var t=e.prototype;return t.needMenu=function(){return this.can_remove||this.can_report||this.can_bookmark||this.canMarkNotInterested},t.getHideUrl=function(){var e=Stories.getHistoryURL(this.raw_id),t=Stories.getFrom();return this.isAds&&Object(ie.partConfigEnabled)("ads_new_reports_mvk_histories")?"/reports?act=hide_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:""},t.getReportUrl=function(){var e=Stories.getHistoryURL(this.raw_id),t=Stories.getFrom();return this.isAds&&Object(ie.partConfigEnabled)("ads_new_reports_mvk_histories")?"/reports?act=add_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:"/reports?act=add&object="+e+"&refrom="+t},t.render=function(){return Wd.html({inner:[{inner:[{class:"Story__icon Story__icon_menu",tag:"div"}],class:"StoryMenu__trigger",onClick:"Stories.showMenu();",tag:"div"},{inner:[this.can_bookmark?{inner:[{inner:[this.is_bookmarked?Object(W.getLang)("mobile_stories_menu_bookmarked_title"):Object(W.getLang)("mobile_stories_menu_bookmark_title")],class:"StoryMenu__button",onClick:"Stories.toggleBookmark(this);",tag:"div"}],class:"StoryMenu__row",tag:"div"}:null,this.can_remove?{inner:[{inner:[this.is_narrative?Object(W.getLang)("mobile_stories_menu_remove_narrative_title"):Object(W.getLang)("mobile_stories_menu_remove_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStory();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.can_report?{inner:[{inner:[Object(W.getLang)("mobile_stories_menu_report_title")],class:"Btn Btn_theme_none StoryMenu__button",href:this.reportUrl,onClick:"return nav.go(this, event);",tag:"a"}],class:"StoryMenu__row",tag:"div"}:null,this.canMarkNotInterested?{inner:[{inner:[Object(W.getLang)("mobile_stories_menu_not_interested_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.markCurrentStoryNotInterested('"+this.hideUrl+"');",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null],class:"StoryMenu__container",tag:"div"}],class:"StoryMenu",tag:"div"})},e}(),Us=n("my9s"),Vs=n("rN7a"),$s=n("LRIm"),Ws=n("jnUZ"),qs=n("Q+zI"),zs=n("TMW+"),Ys=function(){function e(e,t,n,i){if(this.store=Stories.getStore(),this.state={authorIndex:n,storyIndex:i},this.date=e.date,this.preview=e.preview_url,this.type=e.type,this.photo_url=e.photo_url,this.video_url=e.video_url,this.first_frame=e.first_frame,this.loaded=!1,this.videoSupport=!!window.HTMLVideoElement,this.views=e.views,this.replies=e.replies,this.link=e.link,this.unread=e.unread,this.raw_id=e.raw_id,this.is_expired=e.is_expired,this.isPrivate=e.is_private,this.isDeleted=e.is_deleted,this.isAds=e.isAds,this.isPromo=e.isPromo,this.promoCaption=e.promoCaption,this.track_code=e.track_code,this.can_comment=e.can_comment,this.canLike=e.canLike,this.can_share=e.can_share,this.can_remove=e.can_remove,this.can_report=!e.can_manage,this.can_ask=e.can_ask,this.can_ask_anonymous=e.can_ask_anonymous,this.canPause="video"!==this.type,this.seeking=!1,this.progress=0,this.needShowEmptyStats=e.needShowEmptyStats,this.accessKey=e.accessKey,this.isNewQuestions=e.isNewQuestions,this.isLiked=e.isLiked,this.name=t.name,this.authorId=t.id,this.firstName=t.firstName,this.avatar=t.photo,this.href=t.href,this.prometheus=t.verify.includes("page_top_author"),this.verified=t.verify.includes("page_verified"),this.authorIcon=this.prometheus||this.verified,this.content=null,this.paused=!0,this.stats=e.stats,this.narrative=e.narrative,this.app=e.app,this.isMetaStory=!!e.is_groups_meta_story||!!e.is_apps_meta_story,this.isGroupsMetaStory=!!e.is_groups_meta_story,this.isAppsMetaStory=!!e.is_apps_meta_story,this.isOneTime=e.isOneTime&&t.id!==vk.id,this.isOneTimeSeen=e.isOneTimeSeen,this.seenProgress=this.isOneTime?e.seenProgress:null,this.onAutoPlay=Object(u.default)(),this.onDestroy=Object(u.default)(),this.onVideoBuffering=Object(u.default)(),this.onVideoData=Object(u.default)(),this.onVideoPlayEvent=Object(u.default)(),this.onVideoPauseEvent=Object(u.default)(),this.onVideoEndedEvent=Object(u.default)(),this.reply=e.reply_to,this.reply){var a=this.reply.list;this.reply=extend(this.reply,{onclick:'Stories.openReplies("'+a+'");'})}this.duration=8e3,this.bookmark_add_hash=e.bookmark_add_hash,this.is_bookmarked=e.is_bookmarked,this.clickable_stickers=e.clickable_stickers,this.stickers=[],this.narrative&&(this.bookmark_add_hash=this.narrative.bookmark_hash,this.is_bookmarked=this.narrative.is_bookmarked),this.StoryMenu=new Hs(extend(e,{can_report:this.can_report,can_bookmark:!!this.bookmark_add_hash,is_bookmarked:this.is_bookmarked})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=Stories.getCurrentStoryIndex(),n=Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),Stories.setHistory(this.raw_id)):(this.destroy(),val(e,""))},t.setStartTime=function(){this.seenProgress&&(this.startTime=+(this.seenProgress/100*this.getDuration()).toFixed(1))},t.getStartTime=function(){return this.startTime||0},t.getProgressPercentByLeftTime=function(e){return 100-Math.min(Math.max(e,0)/this.getDuration()*100,100)||0},t.getDuration=function(){return this.duration},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=Stories.getFrom(!1);return _t.default.make(e,{from:t})},t.cantSee=function(){return this.isPrivate||this.is_expired||this.isOneTimeSeen||this.isDeleted},t.loadContent=function(e){var t=window.lang;if(this.cantSee()){Stories.hideLoading();var n="";this.is_expired?n=d.default.wrap(t.mobile_stories_error_expired):this.isDeleted?n=d.default.wrap(t.mobile_stories_error_deleted):this.isPrivate&&(n=d.default.wrap(t.mobile_stories_error_private));var i={class:"Story__contentError",inner:this.isOneTimeSeen?[Object(T.default)(Object(Vs.getBombOutline56Icon)()),{tag:"span",class:"Story__contentErrorText Story__contentErrorText--oneTimeSeen",inner:n}]:n},a=Stories.getCurrentAuthorEl();addClass(a,Xs),val(e,d.default.html(i)),Stories.restoreAudio()}else if("photo"===this.type){this.isMetaStory||Stories.showLoading(),this.img=new Image,this.onLoadImgBind=this.onLoadImg.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.img,"load",this.onLoadImgBind),addEvent(this.img,"load",this.onLoadStory),this.img.src=this.photo_url;var r={style:"background-image: url("+this.photo_url+")",class:"Story__content_image"};this.isGroupsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",d.default.html(this.renderGroupsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):this.isAppsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",d.default.html(this.renderAppsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):val(e,d.default.html(r)),Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&Stories.isAutoplaySupport())Stories.showLoading(),this.video=ce("video",{src:this.video_url,className:"Story__content_video"}),attr(this.video,"playsinline","playsinline"),attr(this.video,"webkit-playsinline","webkit-playsinline"),attr(this.video,"muted",!0),this.video.muted=!0,this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoFirstDataLoadedBind=this.onVideoFirstDataLoaded.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),this.onVideoSeekingBind=this.onVideoSeeking.bind(this),this.onVideoSeekedBind=this.onVideoSeeked.bind(this),addEvent(this.video,"ended",this.onVideoEndedBind),addEvent(this.video,"play",this.onVideoPlayBind),addEvent(this.video,"pause",this.onVideoPauseBind),addEvent(this.video,"canplaythrough",this.onCanPlayBind),addEvent(this.video,"waiting",this.onVideoWaitingBind),addEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),addEvent(this.video,"loadeddata",this.onVideoFirstDataLoadedBind),addEvent(this.video,"canplaythrough",this.onLoadStory),addEvent(this.video,"playing",this.onVideoPlayingBind),addEvent(this.video,"seeking",this.onVideoSeekingBind),addEvent(this.video,"seeked",this.onVideoSeekedBind),append(this.video,e),this.video.load(),Stories.restoreAudio(),Stories.pauseAudio();else{var o=Stories.getAuthorElems()[this.state.authorIndex];this.renderError(o,e,t.mobile_stories_inline_video_error)}},t.onLoadStory=function(){if(this.loaded=!0,this.clickable_stickers){var e=geByClass1("Story",this.authorElem);e&&this.renderStickersLayer.call(this,e)}if(this._loadingStartTime){this.loadingTime=Date.now()-this._loadingStartTime,Stories._sendViewerStartTime(this.raw_id,this.loadingTime),this._loadingStartTime=0;var t=this.isMetaStory?"group_feed_view":"view_story";Stories.sendAnalyticsEvent(t,{preloading_duration:this.loadingTime})}this.isMetaStory||this.isOneTime||Stories.markSeenStory()},t.isLoaded=function(){return this.loaded},t.onVideoSeeking=function(){this.seeking=!0,Stories.showLoading(),this.onVideoBuffer()},t.onVideoSeeked=function(){this.seeking=!1,this.onVideoPlay()},t.markSeen=function(){this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){!this.paused&&this.canPause&&(this.paused=!0,this.video&&!this.video.paused&&this.video.pause())},t.play=function(){this.paused&&(this.paused=!1,this.video&&this.video.play())},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.buffering=!1,Stories.hideLoading(),this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onLoadImg=function(){Stories.hideLoading(),this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoBuffer=function(){this.buffering=!0,Stories.showLoading(),this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoFirstDataLoaded=function(){var e=+(this.getStartTime()/1e3).toFixed(1);this.video.currentTime<e&&(this.video.currentTime=e)},t.onCanPlay=function(){Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var i=this,a={class:"Story__content_expired",inner:d.default.wrap(n)};val(t,d.default.html(a)),Stories.hideLoading(),this.type="broken",addClass(e,Xs),requestAnimationFrame((function(){i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})}))},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(W.isArray)(t))&&t.some((function(t){return t.type===e}))},t.getSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(W.isArray)(t))&&t.find((function(t){return t.type===e}))},t.render=function(){var e,t,n=window,i=n.lang,a=n.winToUtf;addEvent(window,"resize",this._onResizeHandle.bind(this));var r=C.isTouch?"ontouchstart":"onmousedown",o=C.isTouch?"ontouchend":"onmouseup";this._onLoadingStart();var s=this.hasSticker(Js.storyReply),l=this.date;return this.isPromo?l=this.promoCaption:this.isAds?l=i.mobile_stories_is_promo_title:this.narrative&&(l=i.global_type_narrative+" · "+this.narrative.title),d.default.html({class:"Story",inner:[{class:"Story__header",inner:[this.reply&&!s?{class:"Story__reply",inner:this.reply.is_deleted||this.reply.is_private||this.reply.is_expired?{class:"Story__replyDeleted",inner:{class:"Story__replyDeletedContainer",inner:[{class:Bem.class("Story__icon",{deleted:this.reply.is_deleted,private:this.reply.is_private||this.reply.is_expired})},{class:"Story__replyDeletedTitle",inner:this.reply.is_deleted?i.mobile_stories_reply_deleted_title:this.reply.is_expired?i.mobile_stories_reply_expired_title:i.mobile_stories_reply_private_title}]}}:{class:"Story__replyPreview",onclick:this.reply.onclick,style:"background-image: url("+this.reply.photo_url+")",inner:{class:"Story__replyTitle",inner:a(this.reply.name)}}}:null,{class:"Story__table",inner:[this.isGroupsMetaStory?null:{class:"Story__cell Story__cell_header",inner:[{class:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[{class:"Story__cell Story__cell_avatar",inner:{class:"Story__avatar",src:this.avatar,tag:"img"}},{class:"Story__cell Story__cell_title",inner:[{class:"Story__title",inner:[{class:"Story__name",inner:a(this.name)},this.authorIcon?{class:"Story__verified",inner:{class:Bem.class("Story__icon",{verified:this.verified,prometheus:this.prometheus})}}:null]},{class:"Story__date",inner:l}]}]}]},this.isGroupsMetaStory?{class:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:i.mobile_stories_groups_grid_title}:null,{class:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{class:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{class:"Story__icon Story__icon_close"}}}]}]},this.renderStoryFooter(),this.can_comment?{class:"Story__form Story__form_comment",inner:[(e={class:"Story__formOverlay"},e[r]="cancelEvent(event);",e[o]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:this.narrative?i.mobile_stories_comment_narrative_title:i.mobile_stories_comment_title},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:i.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{class:"Story__formFooter",inner:[{class:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:i.mobile_stories_comment_ok},{class:"Story__formCancel",inner:i.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={class:"Story__overlay"},t[r]="cancelEvent(event);",t[o]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{class:"Story__stickers"}:null,{class:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderStoryFooterStatsReplies=function(){return{class:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_replies Story__repliesIcon"}},{class:"Story__cell Story__repliesText",inner:this.replies}]}},t.renderStoryFooterStatsViews=function(){return{class:"Story__views Story__cell",onclick:"Stories."+(this.needShowEmptyStats?"showEmptyStats":"showViews")+'("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_views Story__viewsIcon"}},this.views?{class:"Story__cell Story__viewsText",inner:this.views}:null]}},t.renderStoryFooterStats=function(){return{class:Bem.class("Story__cell",{empty:Boolean(this.link)&&!this.replies&&!this.views,hidden:!(this.replies||this.views||this.link||this.needShowEmptyStats),stats:!0}),inner:this.replies||this.views||this.needShowEmptyStats?{class:Bem.class("Story__stats",{new_questions:this.isNewQuestions,new_hint:!this.isNewQuestions&&this.needShowEmptyStats}),inner:[this.replies?this.renderStoryFooterStatsReplies():null,this.views||this.needShowEmptyStats?this.renderStoryFooterStatsViews():null]}:null}},t.renderStoryFooterComments=function(){return{class:"Story__cell Story__cell_comment",inner:{class:"Story__commentButton",inner:{class:"Story__commentButtonText",inner:lang.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}},t.renderStoryFooterMoreLink=function(){return{class:"Story__cell Story__cell_moreLink",inner:{class:"Story__moreLink",inner:[{class:"Story__moreLinkText",inner:winToUtf(this.link.text)},{class:"Story__icon Story__icon_topArrow"}],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}},t.renderStoryFooterShare=function(){return{class:"Story__cell Story__cell_share",inner:{class:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.owner_id+"_"+this.narrative.id:this.raw_id)+'", '+!!this.narrative+");",inner:{class:"Story__icon Story__icon_share","data-skiponclick":1}}}},t.renderStoryFooterVerticalButtons=function(e){return{class:"Story__verticalButtons",inner:[e?{class:"Story__verticalButton Story__app "+(e.hasNewInteractions?"has_new":""),onclick:"Stories.clickToApp();",inner:Object(T.default)(Object($s.getServices48Icon)())}:null,this.canLike?{class:"Story__verticalButton Story__like"+(this.isLiked?" Story__like--set":""),onclick:"Stories.toggleLikeForCurrentStory(this)",inner:Object(T.default)(this.isLiked?Object(qs.getLikeShadow48Icon)():Object(zs.getLikeOutlineShadow48Icon)())}:null]}},t.renderStoryFooter=function(){var e=this.getSticker(Js.app);return{class:"Story__footer",inner:this.isMetaStory||this.is_expired?null:{class:"Story__table",inner:[this.renderStoryFooterStats(),this.link&&this.link.text?this.renderStoryFooterMoreLink():this.can_comment?this.renderStoryFooterComments():null,this.can_share?this.renderStoryFooterShare():null,this.needMenu?{class:"Story__cell Story__cell_menu",inner:d.default.wrap(this.storyMenuHTML)}:null,e||this.canLike?this.renderStoryFooterVerticalButtons(e):null]}}},t.renderAskForm=function(){var e,t=window.lang,n=C.isTouch?"ontouchstart":"onmousedown",i=C.isTouch?"ontouchend":"onmouseup";return{class:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={class:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:{class:"Story__formHeaderInner",inner:[{tag:"button",class:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_author_only,onclick:"Stories.changeAskAnonymous(event);","data-selected":1},{class:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{class:"QuestionSupport__tooltip"}}]}},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{class:"Story__formFooter",inner:[Object(wt.default)({class:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),Object(wt.default)({class:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,a=n.original_height,r=e.top,o=e.left,s=e.width,l=e.height,c=e.rotate,u=getSize(t),d=u[0],_=u[1],f=d,p=_;return _/d>1.77?f=i*_/a:p=a*d/i,"\n      top: "+(r*p-(p-_)/2)+"px;\n      left: "+(o*f-(f-d)/2)+"px;\n      width: "+s*f+"px;\n      height: "+l*p+"px;\n      transform: rotate("+c+"deg);\n    "},t.renderStickersLayer=function(e){var t,n,i=this,a=geByClass1("Story__stickers",e),o=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers,s=C.isTouch?"ontouchstart":"onmousedown",l=C.isTouch?"ontouchend":"onmouseup";a&&(a.innerHTML=""),a.appendChild(d.default.elem(((t={class:"Story__stickersDisableArea Story__stickersDisableArea--left"})[s]="Stories.onTouchStart(event);",t[l]="Stories.onTouchEnd(event, true);",t.ontouchcancel="Stories.onTouchEnd(event, true);",t))),a.appendChild(d.default.elem(((n={class:"Story__stickersDisableArea Story__stickersDisableArea--right"})[s]="Stories.onTouchStart(event);",n[l]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n))),o.forEach((function(t){var n,o=t.id,c=t.type,u=t.style;if([Js.hashtag,Js.mention,Js.question,Js.place,Js.music,Js.storyReply,Js.owner,Js.link,Js.marketItem,Js.post,Js.poll,Js.app,Js.sticker].includes(c)){var _=d.default.elem(((n={class:"Story__sticker"})[s]="Stories.onTouchStart(event);",n[l]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n.style=""+i._getStickerStyle(t,e),n));switch(Object(r.domData)(_,"id",o),Object(r.domData)(_,"type",c),u&&Object(r.domData)(_,"style",u),c){case Js.hashtag:Object(r.domData)(_,"hashtag",t.hashtag);break;case Js.mention:Object(r.domData)(_,"mentioned_photo_url",t.mentionedPhotoUrl),Object(r.domData)(_,"mentioned_owner_href",t.mentionedOwnerHref),Object(r.domData)(_,"mentioned_text",t.mentionedText);break;case Js.question:Object(r.domData)(_,"question",t.question);break;case Js.place:if(i.store.list==="place"+t.placeId)return;Object(r.domData)(_,"place_id",t.placeId);break;case Js.music:var f=Stories.getCurrentStory(),p=t.audioId,h=t.audioData,m=t.audioRestriction;if(m){var v=i.getVideo();if(v&&f.needMute){var g=Stories.getAuthorElems()[i.state.authorIndex];removeClass(g,Ks),v.muted=!0}a.appendChild(d.default.elem({class:"StoryRestriction",inner:{class:"StoryRestriction__inner",inner:[{class:"StoryRestriction__title",inner:m.title},m.buttonUrl?{class:"StoryRestriction__link",href:m.buttonUrl,inner:m.buttonText}:null]}})),Object(r.domData)(_,"disabled",1)}addClass(_,"audio_item"),addClass(_,"audio_item_"+p),Object(r.domData)(_,"id",p),Object(r.domData)(_,"audio",h);try{Object(r.domData)(_,"track-code",JSON.parse(h).track_code)}catch(e){}_.setAttribute("id","audio"+p);break;case Js.storyReply:Object(r.domData)(_,"owner-id",t.ownerId),Object(r.domData)(_,"story-id",t.storyId),Object(r.domData)(_,"link",t.link);break;case Js.owner:Object(r.domData)(_,"owner-id",t.ownerId),Object(r.domData)(_,"link",t.link);break;case Js.link:Object(r.domData)(_,"link",t.link),Object(r.domData)(_,"tooltip-text",t.tooltipText);break;case Js.marketItem:Object(r.domData)(_,"photoUrl",t.photoUrl),Object(r.domData)(_,"link",t.link),t.isRestricted&&Object(r.domData)(_,"isRestricted","isRestricted");break;case Js.post:Object(r.domData)(_,"post-owner-id",t.postOwnerId),Object(r.domData)(_,"post-id",t.postId);break;case Js.poll:Object(r.domData)(_,"pollId",t.pollId),Object(r.domData)(_,"pollOwnerId",t.pollOwnerId);break;case Js.app:Object(r.domData)(_,"app-id",t.appId),Object(r.domData)(_,"app-ref",t.appRef),Object(r.domData)(_,"app-hash",t.appHash);break;case Js.sticker:Object(r.domData)(_,"link","/stickers?stickers_id="+t.stickerPackId),Object(r.domData)(_,"tooltip-text",t.tooltipText)}a.appendChild(_),i.stickers.push(_)}}))},t._onResizeHandle=function(){var e=this,t=geByClass1("Story",this.authorElem),n=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers;Object(W.isArray)(n)&&n.forEach((function(n,i){e.stickers[i]&&setStyle(e.stickers[i],e._getStickerStyle(n,t))}))},t._createStickerLink=function(e,t){void 0===t&&(t={});var n=intval(Object(r.domData)(e,"disabled"));if(t.type&&!n){var i,a,o,s="a",l=!0,c="Stories__tooltipLink",u=function(){},_={type:t.type,style:Object(r.domData)(e,"style")};switch(t.type){case Js.hashtag:var f=Object(r.domData)(e,"hashtag")||"",p=f.replace("#","%23");i="/feed?section=search&q="+p,a=lang.mobile_stories_show_hashtag_link,o="search",_.text=f;break;case Js.mention:var h=Object(r.domData)(e,"mentioned_photo_url"),m=Object(r.domData)(e,"mentioned_owner_href"),v=Object(r.domData)(e,"mentioned_text");c+=" Stories__tooltipLink--mention",i=m,a=d.default.html([{class:"StoriesTooltipMention",inner:[{class:"StoriesTooltipMention__avatar",style:"background-image: url("+h+")"},{class:"StoriesTooltipMention__text",inner:v}]}]),o="profile";break;case Js.place:var g=Object(r.domData)(e,"place_id"),A=Stories.getFrom();i="/place"+g,a=lang.mobile_stories_go_to_place,this.store.list.includes("place")?l=!0:(i+="?from="+A,u=function(){s="div",l=!1,Stories._hideTooltips(!0),Stories.showLoading(),nav.go(i)}),o="place";break;case Js.music:s="div",a=lang.mobile_stories_music_more,u=function(){var t=Object(r.domData)(e,"id"),n=Object(r.domData)(e,"audio");Stories.openMusicStickerActions(t,n)};break;case Js.storyReply:case Js.owner:var b=this.reply,y=b.is_expired,w=b.list;if(t.type===Js.owner||y)a=Object(r.domData)(e,"owner-id")>0?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,i=Object(r.domData)(e,"link"),o="profile";else s="div",a=lang.mobile_stories_go_to_story,u=function(){Stories.openReplies(w)};break;case Js.link:a=Object(r.domData)(e,"tooltip-text"),i=Object(r.domData)(e,"link");break;case Js.marketItem:var O=Object(r.domData)(e,"photoUrl"),S=!!Object(r.domData)(e,"isRestricted");S&&(u=function(e){e.preventDefault(),window.AlertBox(getLang("mobile_stories_market_access_error_text"),getLang("mobile_stories_market_access_error_title"))}),a=d.default.html([O&&!S?{class:"Stories__marketItemThumb",tag:"img",src:O}:{class:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:Object(T.default)(Object(Ws.getItemStubIcon)())},{class:"Stories__marketItemText",tag:"span",inner:getLang("mobile_stories_market_item_more")}]),i=Object(r.domData)(e,"link");break;case Js.post:var k=Object(r.domData)(e,"post-owner-id"),C=Object(r.domData)(e,"post-id");a=lang.mobile_stories_go_to_post,i="/wall"+k+"_"+C;break;case Js.sticker:a=Object(r.domData)(e,"tooltip-text"),i=Object(r.domData)(e,"link")}return Stories._requestStickerStat("click",_),ce(s,{href:"a"===s?i:null,target:l?"_blank":null,innerHTML:a+d.default.html({inner:[Object(T.default)({icon:Object(Us.getGotoArrow8Icon)()})],class:"Stories__tooltipLinkIcon",tag:"span"}),className:c,onclick:function(e){u&&u(e),o&&Stories._requestStickerStat(o,_),[Js.hashtag,Js.mention,Js.place,Js.storyReply,Js.post,Js.link,Js.sticker].includes(t.type)&&Stories.sendAnalyticsEvent("click_to_tooltip",{clickable_sticker:{id:t.id,type:Zs[t.type]}})}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderAppsMetaStory=function(){var e="apps";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),a=!!n.length,r=t.items[0],o=t.id?"{ id: '"+t.id+"' }":"{}";a&&(r=n[0]);var s={tag:"span",class:"GridStoryPreview",style:"background-image: url("+r.preview_url+")",onclick:'Stories.openNarrative("'+r.raw_id+"/"+e+'", '+o+")",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+r.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(s)}))),{class:"MetaStory MetaStory--apps",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{tag:"a",href:this.app.url,target:"_blank",class:"MetaStory__appWrapper",inner:[{class:"MetaStory__appIcon",style:"background-image: url("+this.app.photoUrl+")"},{class:"MetaStory__appName",innerHTML:this.app.name},{class:"MetaStory__separator"},{tag:"span",class:"MetaStory__appLink",innerHTML:lang.mobile_stories_go_to_app}]}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.renderGroupsMetaStory=function(){var e="groups";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),a=!!n.length,r=t.items[0],o=t.id?"{ id: '"+t.id+"' }":"{}";a&&(r=n[0]);var s={tag:"span",class:"GridStoryPreview",style:"background-image: url("+r.preview_url+")",onclick:'Stories.openNarrative("'+r.raw_id+"/"+e+'", '+o+")",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+r.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(s)}))),{class:"MetaStory MetaStory--groups",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{class:"MetaStory__infoTitle",inner:lang.mobile_stories_groups_grid_title},{class:"MetaStory__infoDescription",inner:lang.mobile_stories_groups_grid_text}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.handleRecommendationsScroll=function(){event.stopPropagation&&event.stopPropagation(),event.stopImmediatePropagation&&event.stopImmediatePropagation();var e=geByClass1("MetaStory__recommendations"),t=geByClass1("MetaStory__recommendations-inner");if(t&&e){var n=Math.min(t.scrollTop/(this.scrollOffset/100),70)/100;setStyle(e,{backgroundColor:"rgba(0, 0, 0, "+n+")"}),t.scrollTop?(addClass(e,"scroll"),Stories.pauseStory()):(Stories.playStory(),removeClass(e,"scroll")),this.isGroupsMetaStory&&(this.blockHeaderEl||(this.blockHeaderEl=geByClass1("Story__gridTitle")),t.scrollTop>this.metaStoryGridMarginTop?removeClass(this.blockHeaderEl,"Story__gridTitle--hide"):addClass(this.blockHeaderEl,"Story__gridTitle--hide"))}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&removeEvent(this.video,"load",this.onLoadImgBind),this.video&&(removeEvent(this.video,"ended",this.onVideoEndedBind),removeEvent(this.video,"play",this.onVideoPlayBind),removeEvent(this.video,"pause",this.onVideoPauseBind),removeEvent(this.video,"canplaythrough",this.onCanPlayBind),removeEvent(this.video,"waiting",this.onVideoWaitingBind),removeEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),removeEvent(this.video,"playing",this.onVideoPlayingBind),removeEvent(this.video,"seeking",this.onVideoSeekingBind),removeEvent(this.video,"seeked",this.onVideoSeekedBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),Stories._hideTooltips()},e}(),Qs=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval((function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)}),this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}(),Gs=n("0hlj"),Ks="StoryAuthor_videoMuted",Xs="StoryAuthor--error",Js={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13},Zs=Object.entries(Js).reduce((function(e,t){return e[t[1]]=t[0],e}),{}),el=function(){function e(e,t){var n=this;this.store=Stories.getStore(),this.data=t,this.state={authorIndex:e};var i=this.getCurrentStoryIndex();this.setCurrentStoryIndex(i),this.story=new Ys(this.data.items[i],this.data.author,e,i),this.authorStoriesHTML=d.default.html(this.story.render()),this.progressItemElems=null,Stories.onRender((function(){n.updateStory()}))}var t=e.prototype;return t.getCurrentStory=function(){if(this.story)return this.story},t.destroy=function(){this.story&&this.story.destroy()},t.update=function(){var e=this.data.index;this.destroy(),this.story=new Ys(this.data.items[e],this.data.author,this.state.authorIndex,e),this.authorStoriesHTML=d.default.html(this.story.render())},t.updateHeader=function(){this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.progressItemElems=Array.from(geByClass("StoryAuthor__progressItem",this.authorElem)),this.drawFilledProgressItems()},t.updateStory=function(){var e=this;this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var t=geByClass1("Story__body",this.authorElem);this.story.update(t),this.story.onVideoData((function(n){n.authorIndex,n.storyIndex;var i=e.story.getDuration(),a=e.story.getType(),r=e.store.isStopped,o=e.story.getStartTime(),s=e.story.getProgressPercentByLeftTime(i-o);if(e.drawCurrentProgress(s),removeClass("StoryAuthor__progress--hide",$(".StoryAuthor__progress",e.authorElem)),e.countdown=new Qs(i-o,{tick:13,onTick:function(t){var n=e.story.getProgressPercentByLeftTime(t);e.drawCurrentProgress(n)},onEnd:function(){"video"!==a&&(e.drawCurrentProgress(100),Stories.nextStory(!0),removeClass(e.authorElem,"StoryAuthor_paused"))},onPause:function(){e.story.pause(),addClass(e.authorElem,"StoryAuthor_paused")},onStart:function(){e.story.play(),removeClass(e.authorElem,"StoryAuthor_videoHold"),removeClass(e.authorElem,"StoryAuthor_paused")}}),"photo"!==a&&"broken"!==a||r){if("video"===a){var l=e.story.getVideoState(),c=e.story.getVideo();addClass(t,"Story__body_video"),4!==l||r||c.paused||e.countdown.start()}}else e.countdown.start()})),this.story.onVideoEndedEvent((function(){e.drawCurrentProgress(100),e.story.progress=100,Stories.nextStory(!0)})),this.story.onVideoPauseEvent((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoBuffering((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoPlayEvent((function(){e.countdown&&!e.store.isStopped&&e.countdown.start()})),this.story.onAutoPlay((function(){var t=window.lang,n=e.story.getVideo();Stories.pauseAudio();var i=geByClass1("Story__body",e.authorElem),a=Stories.isGoodBrowser(),r=n.play();r?r.then((function(){e.story.canPause=!0})):e.story.canPause=!0,n.paused&&!a?e.story.renderError(e.authorElem,i,t.mobile_stories_inline_video_error):!e.countdown||e.store.isStopped||n.paused||e.story.buffering?a&&n.paused&&addClass(e.authorElem,"StoryAuthor_videoHold"):e.countdown.start(),n.muted&&addClass(e.authorElem,Ks),Stories._showFeatureTooltipIfNeeded()})),this.story.onDestroy((function(){e.countdown&&(e.countdown.stop(),e.countdown=null)})),Stories._showFeatureTooltipIfNeeded()},t.getCountDown=function(){if(this.countdown)return this.countdown},t.getFirstUnreadStoryIndex=function(){if(Stories._hasContext("all"))return 0;var e=this.data.items.findIndex((function(e){return!0===e.unread}));return-1!==e?e:0},t.getCurrentStoryIndex=function(){if(!this.data.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.data.index},t.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.data.index],n=geByClass1("StoryAuthor__progressItemCurrent",t),i=geByClass1("StoryAuthor__wick",t),a=e/100*t.clientWidth;setStyle.transform(n,void 0,[a,0]),this.story.isOneTime&&setStyle.transform(i,void 0,[a,0])}},t.drawFilledProgressItems=function(){var e=this.data.index;if(this.progressItemElems)for(each(this.progressItemElems,(function(e,t){removeClass(t,"StoryAuthor__progressItem_filled")}));e>=0;)addClass(this.progressItemElems[--e],"StoryAuthor__progressItem_filled")},t.setCurrentStoryIndex=function(e){this.data.index=e,this.drawFilledProgressItems()},t.renderEmpty=function(){var e=this.story.getPreview(),t=Stories.getWidth();return d.default.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},t.render=function(){var e,t,n,i=this,a=window.lang,r=Stories.getWidth(),o=C.isTouch?"ontouchstart":"onmousedown",s=C.isTouch?"ontouchend":"onmouseup";return d.default.html({class:"StoryAuthor StoryAuthor_inited",style:"width: "+r+"px;",inner:[{class:"StoryAuthor__header",inner:{class:"StoryAuthor__progress"+(this.story.isOneTime?" StoryAuthor__progress--isOneTime StoryAuthor__progress--hide":""),inner:this.data.items.map((function(){return{class:"StoryAuthor__progressItem",inner:[{class:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}},i.story.isOneTime?{class:"StoryAuthor__wick"}:null]}}))}},(e={class:"StoryAuthor__muted"},e[o]="Stories.unMute(this, event);",e.inner=[{class:"Story__icon_unmute",inner:Object(T.default)(Object(Gs.getVolumeUnmuted24Icon)())},{class:"StoryAuthor__muted_text",inner:a.mobile_stories_unmute}],e),(t={class:"StoryAuthor__next"},t[o]="Stories.onTouchStart(event);",t[s]="Stories.onTouchEnd(event);",t.ontouchcancel="Stories.onTouchEnd(event);",t),(n={class:"StoryAuthor__prev"},n[o]="Stories.onTouchStart(event);",n[s]="Stories.onTouchEnd(event, true);",n.ontouchcancel="Stories.onTouchEnd(event, true);",n),{class:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}(),tl=n("t2Vq"),nl=n("c9MT");var il=function(e){void 0===e&&(e={});var t=e.mode||"tint",n=e.size||"s",i=e.imageTheme||"dark",a="image"===t&&"dark"===i,r=c.default.class("Banner",{md:t,sz:n,aside:e.asideMode,inverted:a},"--");return{inner:[{inner:["image"===t&&e.background?{inner:[e.background],class:"Banner__bg",tag:"div"}:null,e.before?{inner:[e.before],class:"Banner__before",tag:"div"}:null,{inner:[e.header?{inner:[e.header],class:"Banner__header",tag:"div"}:null,e.subheader?{inner:[e.subheader],class:"Banner__subheader",tag:"div"}:null,e.text?{inner:[e.text],class:"Banner__text",tag:"div"}:null,e.actions?{inner:[e.actions],class:"Banner__actions",tag:"div"}:null],class:"Banner__content",tag:"div"},"expand"===e.asideMode?{inner:[Object(T.default)({icon:Object(tl.getChevron24Icon)()})],class:"Banner__expand Btn Btn_theme_none",onClick:e.onExpand,tag:"button"}:null,"dismiss"===e.asideMode?{inner:[Object(T.default)({icon:Object(nl.getDismiss24Icon)()})],class:"Banner__dismiss Btn Btn_theme_none",onClick:e.onDismiss,tag:"button"}:null],class:"Banner__in",tag:"div"}],onClick:e.onClick,class:r,tabindex:"0",role:"button",tag:"div"}},rl=n("lmbN"),ol=n("Q8TZ"),sl=n("xTMR"),ll=n("zJPW"),cl=function(){function e(e){var t=window.lang;this.store=Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[],this.poll=this.store.polls[e],this.extendedStats=this.store.extendedStats[e];var n=this.viewersState,i=n.count,a=n.repliesCountText,r=n.authorCountText,o=n.hiddenReason,s=n.privacyHint;this.raw_id=e,this.count=i,this.countText=langNumeric(this.count,t.mobile_stories_views_title),this.hiddenReason=o,this.repliesCountText=a,this.repliesAuthorCountText=r,this.privacyHint=s||{},this.questions.length||this.privacyHint.showEmptyStatsPrivacyHint||this.extendedStats?this.title=t.mobile_stories_views_title_interactions:this.count&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.count?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}var t=e.prototype;return t.render=function(){var e=this,t=window.winToUtf,n=this.store.questions[this.raw_id]||[],i=this.needShowOnlyHiddenViewersInfo(),a=this.viewersState.privacyHint||{};return d.default.html({class:Bem.class("Views",{short:!(this.viewers.length||!this.replies.length||this.hiddenReason)}),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView"+(i?" Views__body--centerAlign":""),onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.extendedStats?this.renderExtendedStatsBanner():null,a.showEmptyStatsPrivacyHint?{class:"ViewsEmptyStatsBlock",inner:[{class:"ViewsEmptyStatsBlock__icon",inner:Object(T.default)(Object(sl.getHideOutline56Icon)())},{class:"ViewsEmptyStatsBlock__text",inner:lang.mobile_stories_feedback_empty_stats_hint},{class:"ViewsEmptyStatsBlock__link",inner:{tag:"a",class:"link",inner:lang.mobile_stories_go_to_privacy_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]}}]}:null,a.showPrivacyHint?{class:"ViewsPrivacyHint",inner:il({subheader:lang.mobile_stories_feedback_privacy_hint,asideMode:"dismiss",before:Object(T.default)(Object(ll.getLockOutline28Icon)()),actions:{tag:"a",class:"link",inner:lang.mobile_stories_go_to_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]},onDismiss:["Stories.hidePrivacyHint",this.raw_id]})}:null,this.replies.length?{class:"Views__replies StoryViewsSeparator",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map((function(n){return{class:"Views__reply "+(n.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+n.owner_id+"/"+n.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:n.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:n.name?t(n.name):lang.mobile_stories_reply_you}]}}))}}]}:null,this.poll?{class:"Views__poll StoryViewsSeparator",inner:[{class:"Views__pollHeader",inner:lang.mobile_wall_poll_head_title},{class:"Views__pollBody",inner:{class:"StoryFeedbackPoll"+("default"===this.poll.background.type?" StoryFeedbackPoll--default":""),inner:[this.getBackgroundElementForPoll(this.poll),{class:"StoryFeedbackPoll__question",inner:this.poll.question},{class:"StoryFeedbackPoll__countVoters",inner:this.poll.votersCountText},{class:"StoryFeedbackPoll__showResult",onclick:"Stories.openPoll("+this.poll.ownerId+", "+this.poll.pollId+", "+this.raw_id+")",inner:lang.mobile_voting_show_result}]}}]}:null,n.length?{class:"Views__questions StoryViewsSeparator",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:lang.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:lang.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:n.slice(0,10).map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}}]}:null,{class:"Views__viewers",inner:[this.count&&(n.length||this.replies.length||this.extendedStats)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:[this.viewers.map((function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",inner:[{class:"Views__avatarPhoto",src:e.photo,tag:"img"},e.isLiked?d.default.wrap(Object(Ba.default)({mix:"Views__avatarBadgeIcon",icon:"notify_mini_like"})):null]}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}})),this.hiddenReason?{class:"Views__viewersHiddenReason",inner:[{class:"Views__viewersHiddenReasonIcon",inner:Object(T.default)(Object(sl.getHideOutline56Icon)())},{class:"Views__viewersHiddenReasonText",inner:this.hiddenReason}]}:null]}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},t.renderExtendedStatsBanner=function(){return{inner:[{inner:[Object(T.default)({icon:Object(rl.getStatistic28Icon)()})],class:"ViewsExtendedStatsBanner__before",tag:"div"},{inner:[{inner:[lang.mobile_stories_feedback_extended_stats],class:"ViewsExtendedStatsBanner__title",tag:"div"},{inner:[this.extendedStats.preview],class:"ViewsExtendedStatsBanner__subtitle",tag:"div"}],class:"ViewsExtendedStatsBanner__content",tag:"div"},{inner:[Object(T.default)({icon:Object(ol.getChevron16Icon)()})],class:"ViewsExtendedStatsBanner__after",tag:"div"}],class:"ViewsExtendedStatsBanner StoryViewsSeparator",onClick:["Stories.showExtendedStats",this.raw_id],tag:"button"}},t.needShowOnlyHiddenViewersInfo=function(){var e=this.store.questions[this.raw_id]||[];return this.count&&this.hiddenReason&&!this.viewers.length&&!this.replies.length&&!e.length},t.getBackgroundElementForPoll=function(e){var t=e.background,n=null,i="";if("photo"===t.type)n={class:"StoryFeedbackPoll__photo",style:"background-image: url("+t.photoUrl+")"},i="background: #"+t.backgroundColor;else if("gradient"===t.type){i="background: linear-gradient("+(t.angle-90)+"deg, "+t.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return{class:"StoryFeedbackPoll__background",style:i,inner:n}},e}(),ul=function(){function e(e){this.store=Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){return d.default.elem({class:Bem.class("Questions",{}),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:lang.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}]}]})},e}(),dl=n("9b/I"),_l=n("mP7y"),fl=function(){function e(e){this.store=Stories.getStore(),this.extendedStats=this.store.extendedStats[e]}var t=e.prototype;return t.render=function(){var e=this;return d.default.elem({inner:[{inner:[{inner:[{inner:[{inner:[lang.mobile_stories_extended_stats_title],class:"StoryExtendedStats__title",tag:"div"}],class:"StoryExtendedStats__cell",tag:"div"}],class:"StoryExtendedStats__table",tag:"div"},{inner:[Object(T.default)({icon:Object(dl.getBackOutline28Icon)()})],class:"StoryExtendedStats__back Btn Btn_theme_none",onClick:"Stories.hideExtendedStats();",tag:"button"}],class:"StoryExtendedStats__header",tag:"div"},{inner:[{inner:[this.extendedStats.achievement?{inner:[{inner:[Object(T.default)({icon:Object(_l.getStatisticGrow28Icon)()})],class:"StoryExtendedStatsAchievement__before",tag:"div"},{inner:[{inner:[this.extendedStats.achievement],class:"StoryExtendedStatsAchievement__label",tag:"div"},{inner:[this.extendedStats.achievementSubtitle],class:"StoryExtendedStatsAchievement__subtitle",tag:"div"}],class:"StoryExtendedStatsAchievement__content",tag:"div"}],class:"StoryExtendedStatsAchievement StoryViewsSeparator",tag:"div"}:null,this.extendedStats.categories.map((function(t){return e.renderCategory(t)}))],class:"StoryExtendedStats__inner",onTouchMove:"event.stopPropagation();",tag:"div"}],class:"StoryExtendedStats__body",tag:"div"}],class:"StoryExtendedStats",tag:"div"})},t.renderCategory=function(e){var t=this;return{inner:[{inner:[e.title],class:"StoryExtendedStatsCategory__title",tag:"div"},{inner:[e.lines.map((function(e){return t.renderCategoryLine(e)}))],class:"StoryExtendedStatsCategory__lines",tag:"div"}],class:"StoryExtendedStatsCategory StoryViewsSeparator",tag:"div"}},t.renderCategoryLine=function(e){return{inner:[{inner:[e.name],class:"StoryExtendedStatsCategoryLine__name",tag:"div"},{inner:[e.counter],class:"StoryExtendedStatsCategoryLine__counter",tag:"div"}],class:"StoryExtendedStatsCategoryLine",tag:"div"}},e}();function pl(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}var hl=[];var ml=[];var vl,gl=n("mMuO"),Al=0,bl=1,yl=3,wl={opened:!1,init:function(e,t){var n=this;void 0===t&&(t={}),this.params=extend({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0},t);var i=this._parseList(e).split("/"),a=i[0],r=i[1],o=i[2],s=a.split("_")[0];t&&t.id?s=t.id:t&&t.narrativeId&&(s=t.narrativeId),this.initRaw=e,this.storyOwner=s,this.storyRaw=a,this.storyExtra=o,this.storyList=r,this.extra=this.parseExtra(this.storyExtra),this.needAudioRestore=audio.playing(),this.Views={},this.popoutOpen=!1,this.slideTimer=null,this.createLayer(),this._initStore(),this.detectAutoplay().then((function(){n.isRestored?n._init():n._checkPreloadedList()?(n._initPreloadedList(),n._init()):n._requestList().then((function(e){var t=e.items,i=e.list;t&&(n.store.authors=t,n.store.listLoaded=!0,n.store.list=i,n.store.inited=!0,n._init())}),(function(){}))}))},parseExtra:function(e){var t={},n=String(e).split(";");for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].split(":"),r=a[0],o=a[1];r&&o&&(t[r]=o)}return t},_checkPreloadedList:function(){return!!(window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList])},_initPreloadedList:function(){var e=window.store.storiesLists[this.storyList];e&&(this.store.authors=e,this.store.listLoaded=!0,this.store.list=this.storyList,this.store.inited=!0)},pushPreloadedList:function(e){var t=Object(r.parseJSON)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),extend(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach((function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]}))},_init:function(){var e=this;this.createAuthors();var t=this.getFirstStoryIndex();this.setCurrentStory(t);var n=this.getCurrentStory();this.params.restore||this.setHistory(n.raw_id,{nav_init:!0,replace:this.params.replace}),this.sliderEl=ge("StoriesSlider"),this.slider=un(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(t){t=e.slider&&Object(r.intval)(e.slider.getCurrentPos());var n=e.getCurrentAuthorIndex(),i=e.getCurrentAuthor().data;clearTimeout(e.slideTimer),void 0!==t&&t!==n&&(e.markSeenAllOwners(),!1===e.isTap&&(t>n?e.sendAnalyticsEvent("go_to_next_author"):e.sendAnalyticsEvent("go_to_previous_author"),i.is_groups||i.is_apps||e.markSeenStory(!0)),e.setCurrentAuthor(t),e.slideTimer=setTimeout((function(){e.renderStory()}),300)),delete e.isTap},onSetup:function(){Object(r.addClass)(e.layer,"Stories_inited"),e.renderStory()}}),this.Authors&&1===this.Authors.length&&(Object(r.addClass)(this.layer,"Stories_inited"),this.renderStory()),this.store.showViews&&this.showViews(n.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},_initStore:function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},_requests:[],viewers:{},questions:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:this.params.reply,replyTo:this.params.replyTo,inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},_initViewerSource:function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=cur.module;break;default:this.viewerSource=e}},_sendOpeningEvents:function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=(this.getCurrentStory()||{}).narrative||{},i=n.owner_id,a=n.id;if(!i||!a)return;Object(r.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:Object(r.intval)(i),item_id:Object(r.intval)(a),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}},_abortRequests:function(){Object(W.isArray)(this.store._requests)&&Object(r.each)(this.store._requests,(function(e,t){t.abort()})),this.store._requests=[]},_saveRequest:function(e){this.store._requests.push(e)},getStore:function(){return this.store},setAllAuthorStoriesReaded:function(e){var t=this;this.store.authors[e].items.forEach((function(e){if(e.unread){var n=e.raw_id;e.track_code&&(n+="_"+e.track_code),t.store.readedStories[n]=!0}}))},markSeenAllOwners:function(){var e=this.getCurrentAuthor().data;if(e.is_groups||e.is_apps){var t=window.store.stories[e.is_groups?"groups":"apps"];if(t){t.authors.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))}));var n=t.authors.map((function(e){return e.author.id}));ajax.post("stories.php",{_ajax:1,act:"mark_owners_seen",hash:this.store.authors[0].read_hash,owners_ids:n.join(",")}),this._needFeedUpdate=!0}}},createAuthors:function(){var e=this,t="";this.Authors=[];var n=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(n=this.getFirstAuthorIndex());var i=this.store.authors[n],a=i.items[i.items.length-1].unread;if(this.extra)switch(this.extra.context){case"new":a=!0;break;case"all":a=!1}Object(r.each)(this.store.authors,(function(n,i){var r=i.items;if(!n||!a||r[r.length-1].unread){var o=new el(n,i);e.Authors.push(o),t+=o.renderEmpty()}})),Object(r.val)(Object(r.geByClass1)("Stories__authors",this.layer),t),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),Object(r.each)(this.Authors,(function(e,t){t.updateHeader()})),this.setCurrentAuthor(n)},getFirstStoryIndex:function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex((function(t){return t.raw_id===e.storyRaw}));return-1!==n?n:0}return this.getCurrentStoryIndex()},getFirstAuthorIndex:function(){var e=this,t=this.store.authors.findIndex((function(t){var n=t.author.id;return t.is_narrative&&(n=t.items[0].narrative.id),t.id&&(n=t.id),String(n)===String(e.storyOwner)}));return-1!==t?t:0},getCurrentAuthorIndex:function(){return this.store.authorIndex},getCurrentStoryIndex:function(){return this.store.authors[this.getCurrentAuthorIndex()].index},getCurrentStory:function(){return this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()]},setCurrentAuthor:function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},setCurrentStory:function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},drawSiblingPreview:function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},drawPreview:function(e){setStyle(e,"background-image","url("+attr(e,"data-src")+")")},updateCurrentAuthor:function(){var e=this.authors[this.store.authorIndex];Object(r.each)(this.authors,(function(e,t){Object(r.removeClass)(t,"StoryAuthor_current")})),Object(r.addClass)(e,"StoryAuthor_current")},getSizes:function(){var e,t,n=window.innerHeight,i=window.innerWidth;return i<540?(e=i,t=n,zlayer.open(),zlayer.onResize=this.onResize.bind(this)):(e=Math.floor(Math.min(540,Math.max(320,.563*n))),t=Math.floor(1.78*e),Object(r.addClass)(document.body,"vk__story_open")),[e,t]},createLayer:function(){window.innerWidth<540?(zlayer.open(),zlayer.onResize=this.onResize.bind(this)):Object(r.addClass)(document.body,"vk__story_open"),wl.opened=!0;var e=this.getSizes(),t=e[0],n=e[1];this.storyW=t;var i=d.default.html({id:"StoriesView",class:"Stories__layer _preventMenuOpen",style:"max-width: "+t+"px; max-height: "+n+"px",inner:[{class:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",class:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{class:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{class:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=Object(r.append)(Object(r.ce)("div",{className:"Stories",innerHTML:i}),document.body),attr(this.layer,"ontouchmove","event.preventDefault();"),this.loader=Object(r.geByClass1)("Stories__loading",this.layer),this.popout=Object(r.geByClass1)("Stories__popout",this.layer),this.swipeTextTop=Object(r.geByClass1)("Stories__swipeText_top",this.layer)},onResize:function(){var e=ge("StoriesView"),t=this.getSizes(),n=t[0],i=t[1];attr(e,"style","max-width: "+n+"px; max-height: "+i+"px"),this.storyW=n,this.authors.forEach((function(e){setStyle(e,"width",n+"px")})),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},getWidth:function(){return this.storyW},renderStory:function(){var e=this.store.authorPrevIndex,t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var a=this.Authors[e],r=this.authors[e];a.update();var o=a.renderEmpty(),s=ceFromString(o);replace(s,r)}var l=ceFromString(i.render());replace(l,n),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.extra.replies&&this.showViews(this.getCurrentStory().raw_id)},getCurrentAuthor:function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},getCurrentAuthorEl:function(){return this.getCurrentAuthor().authorElem},getAuthorElems:function(){return this.authors},prevStory:function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame((function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()}))},nextStory:function(e){var t=this;this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,this.markSeenStoryIfNeeded(),requestAnimationFrame((function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),a=t.getCurrentAuthorIndex(),r=n.items.length;if(t.Authors){var o=t.Authors.length;r-1<=i?o-1<=a?requestAnimationFrame((function(){t.sendAnalyticsEvent("close_auto_by_time"),t.close()})):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(a+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())}}))},stopStory:function(){this.store.isStopped=!0,this.pauseStory()},pauseStory:function(e){var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();e&&Object(r.addClass)(this.layer,"Stories_paused"),n&&n.pause()}},playStory:function(e){this.store.isStopped=!1;var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();Object(r.removeClass)(this.layer,"Stories_paused"),n&&n.start()}},pauseAudio:function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},restoreAudio:function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},showMenu:function(){this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),Object(r.addClass)(this.layer,"Stories_menuOpened")},hideMenu:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(r.removeClass)(this.layer,"Stories_menuOpened"),e&&this.playStory()},showLoading:function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout((function(){show(e.loader)}),100))},hideLoading:function(){this.loader&&(clearTimeout(this.loaderTimer),hide(this.loader))},onRepliesScroll:function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},goToSettingsFromPrivacyHint:function(e,t,n){var i=this.store.viewersState[e]||[];return this.sendAnalyticsEvent("go_to_settings",{nav_screen:i.count?"feedback":"feedback_without_viewers"}),nav.go(t,n)},showEmptyStats:function(e){this.sendAnalyticsEvent("open_empty_feedback"),this.showViews(e)},showViews:function(e,t){var n=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){var i=this.Views[e].render();this.popoutOpen=!0,Object(r.val)(this.popout,i);var a=Object(r.geByClass1)("Views__repliesBody",this.popout);a&&(a.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var o=this.store.viewersState[e],s=this.store.viewers[e];if(o&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then((function(){n.markQuestionsAsViewed(),n.createViews(e,t),n.hideLoading()}))}},showExtendedStats:function(e){var t=new fl(e).render();this.popout.appendChild(t),this.sendAnalyticsEvent("open_advanced_statistic")},hideExtendedStats:function(){re(Object(r.geByClass1)("StoryExtendedStats",this.popout))},markQuestionsAsViewed:function(){(this.getCurrentStory()||{}).isNewQuestions=!1,Object(r.removeClass)(Object(r.geByClass1)("Story__stats"),"Story__stats_new_questions")},createViews:function(e,t){void 0===t&&(t=!1);var n=this.store.viewersState[e],i=new cl(e),a=i.render();this.popoutOpen=!0,Object(r.val)(this.popout,a),this.Views[e]=i;var o=Object(r.geByClass1)("Views__repliesBody",this.popout);o&&(o.scrollLeft=n.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},hideViews:function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,Object(r.val)(this.popout,"")},loadViews:function(e){var t=this,n=this.store.viewersState[e],i=n.loading,a=n.nextFrom;!i&&a&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,a).then((function(){var i=new cl(e),a=i.render();t.popoutOpen=!0;var o=Object(r.geByClass1)("Views__body",t.layer).scrollTop;Object(r.val)(t.popout,a),Object(r.geByClass1)("Views__body",t.layer).scrollTop=o,t.Views[e]=i,t.hideLoading(),n.loading=!1})))},showComment:function(){var e=this,t=this.authors[this.store.authorIndex],n=Object(r.geByClass1)("Story__commentTextarea",t);this.store.showComment=!0,this.stopStory(),Object(r.addClass)(this.layer,"Stories_commentOpened"),this._hideTooltips(),requestAnimationFrame((function(){e.sendAnalyticsEvent("comment_tap"),n&&n.focus()}))},hideComment:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(r.removeClass)(this.layer,"Stories_commentOpened"),e&&this.playStory()},onInputComment:function(e){var t=this.authors[this.store.authorIndex],n=Object(r.geByClass1)("Story__commentSend",t),i=Object(r.val)(e);Object(r.toggleClass)("Story__commentSend_active",n,!!i)},sendComment:function(){var e=this.authors[this.store.authorIndex],t=Object(r.geByClass1)("Story__commentTextarea",e),n=Object(r.geByClass1)("Story__commentSend",e),i=Object(r.val)(t);if(hasClass("Story__commentSend_active",n)){Object(r.val)(t,""),Object(r.removeClass)(n,"Story__commentSend_active");var a,o=this.getCurrentAuthorIndex(),s=this.getCurrentStory(),l=s.raw_id,c=s.narrative,u=this.store.authors[o],d=u.send_hash,_=u.author.id;a=c?"narrative"+c.owner_id+"_"+c.id:"story"+l,this._sendMessage(d,a,i,_),this.hideComment()}},showFlashPopup:function(e,t){var n=this;void 0===t&&(t=!0);this.stopStory();var i=Object(r.geByClass1)("Stories__flash",this.layer);Object(r.val)(Object(r.geByClass1)("Stories__flashText",i),e),setTimeout((function(){Object(r.addClass)(i,"Stories__flash_show")})),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout((function(){Object(r.removeClass)(i,"Stories__flash_show"),n.flashHideTimer=setTimeout((function(){n.hideFlashPopup(t)}),1500)}),1500)},hideFlashPopup:function(e){e&&this.playStory(),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer);var t=Object(r.geByClass1)("Stories__flash",this.layer);Object(r.removeClass)(t,"Stories__flash_show")},removeCurrentStory:function(){var e=this,t=window.lang,n=this.getCurrentAuthor();if(n){var i=n.getCurrentStory(),a=i.narrative?t.mobile_stories_delete_narrative:t.mobile_stories_delete_story;if(confirm(a.replace(/(<([^>]+)>)/gi,"\n"))){var r=n.data.remove_hash,o=i.can_remove,s=i.raw_id;if(o){this.pauseStory();var l=function(){e._requestFeedBlock(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};if(i.narrative){var c=i.narrative,u=c.owner_id+"_"+c.id;this._requestRemoveNarrative(u,r).then((function(){l()}),(function(){}))}else this._requestRemoveStory(s,r).then((function(){e.sendAnalyticsEvent("delete"),l()}),(function(){}))}}}},onScrollViews:function(e,t){var n=this.store.viewersState[t],i=n.loading,a=n.nextFrom;if(!i&&a){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},unMute:function(e,t){var n=this.getCurrentAuthor().story.getVideo();Object(r.cancelEvent)(t),n&&n.muted&&(n.muted=!1,Object(r.removeClass)(gpeByClass(Ks,e),Ks))},onTouchStart:function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var i=n.getVideo();if(i&&i.paused)return void(this.preventedTap=!0)}this.isTap=!0,clearTimeout(this.isTapTimer),n.isOneTime||(this.pauseStory(!0),"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),this.isYmove=null,Object(r.removeClass)(this.layer,"Stories_touchMove"),this.isTapTimer=setTimeout((function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")}),200))},onTouchMove:function(e){var t=0,n=0;"touchmove"===e.type&&(t=this.tapStartX-e.changedTouches[0].clientX,n=this.tapStartY-e.changedTouches[0].clientY),null===this.isYmove&&(this.isYmove=Math.abs(t)<Math.abs(n),this.isYmove&&Object(r.addClass)(this.layer,"Stories_touchMove")),this.isYmove?this.onVerticalSwipe(-n/1.5):this.onVerticalSwipe(0)},onTouchEnd:function(e,t){clearTimeout(this.isTapTimer);var n=this.getCurrentAuthor();if(n){var i=n.story;this.isTap||this.sendAnalyticsEvent("resume_release");var a,o;"touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY),(Math.abs(this.tapStartX-a)>20||Math.abs(this.tapStartY-o)>20)&&(this.isTap=!1),Object(r.removeClass)(this.layer,"Stories_touchMove"),setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(r.geByClass1)("Story__moreLink"),1,[0,0]);var s=e.target&&e.target.classList.contains("Story__sticker"),l=Object(r.domData)(e.target,"id"),c=Number(Object(r.domData)(e.target,"type"));if(s&&this.sendAnalyticsEvent("click_on_clickable_sticker",{clickable_sticker:{id:l,type:Zs[c]}}),this.needGoToLink){var u=this.getCurrentAuthor().story;if(this.needGoToLink=!1,u&&u.hasLink())return void this.openCustomButton(e)}if(this.needClose)return this.sendAnalyticsEvent("close_swipe_down"),void this.close();if(this.featureTooltip)this._hideFeatureTooltip();else if(this.tooltip)this._hideTooltips();else{if(this.isTap){var d=this.getCurrentAuthor();if(!d)return;var _=d.getCurrentStory();if(s){var f=Object(r.domData)(e.target,"app-id"),p=Object(r.domData)(e.target,"pollId"),h=Object(r.domData)(e.target,"pollOwnerId");if(Object(r.removeClass)(this.layer,"Stories_paused"),Object(r.domData)(e.target,"question"))this.askQuestionBox(e);else if(f)wl.clickToApp();else if(p&&h)wl.openPoll(h,p,i.raw_id);else{var m=i._createStickerLink(e.target,{id:l,type:c});this.tooltip?this._hideTooltips():this._showTooltip(e,m)}return}if(t){if(_.isOneTime)return;this.sendAnalyticsEvent("go_to_previous_story"),this.prevStory()}else{if(this.sendAnalyticsEvent("go_to_next_story_tap"),_.isOneTime)return this.close(),void Object(r.cancelEvent)(e);this.nextStory()}}this._hideTooltips(!0),this.hideMenu()}}},openCustomButton:function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var a={ownerId:i[1],narrativeId:i[2]},r=a.ownerId,o=a.narrativeId;if(!r||!o)return!1;this.openNarrative(r+"/narrative"+r+"_"+o,{source:"narrative_story"})}else if(this.stopStory(),this.showLoading(),this.sendAnalyticsEvent("link_click"),t.stats&&t.stats.url_view){var s=t.stats.url_view,l=s.event_type,c=s.rhash,u=t.raw_id,d=t.track_code;this._requestClickStat(u,l,c,d,(function(){nav.go(n)}))}else nav.go(n);return!1},onVerticalSwipe:function(e){var t=window.lang;if(this.needClose=!1,this.needGoToLink=!1,e){var n=e>0,i=this.sliderEl.offsetHeight,a=i/3.5,o=Math.abs(e)>a;if(n){var s=o?t.mobile_zphoto_release_to_close:t.mobile_zphoto_move_to_close,l=o?"":n?"zpv_close_move_down":"zpv_close_move_up",c=Math.max(1-.75*e/i,.6);Object(r.val)(this.swipeTextTop,'<div class="zpv_close_msg '+l+'">'+s+"</div>"),setStyle(this.sliderEl,"opacity",c),setStyle.transform(this.sliderEl,1,[0,e/1.5]),setStyle(this.swipeTextTop,"opacity",Math.abs(c-1-.6)),setStyle.transform(this.swipeTextTop,1,[0,e/1.5*.85]),this.needClose=o}else{var u=Math.min(1-.5*e/i,1.1);setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(r.geByClass1)("Story__moreLink"),u,[0,Math.max(e/(1.5*1.6),-90)]),this.needGoToLink=o}}else setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(r.geByClass1)("Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},preventScroll:function(){return this.popoutOpen},_requestRemoveStory:function(e,t){return new Promise((function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestRemoveNarrative:function(e,t){return new Promise((function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestList:function(){var e=this;return new Promise((function(t,n){var i={storyOwner:e.storyOwner,list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra};if(!e.storyRaw)return n();var a=ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra},{onDone:function(e){i.items=e,t(i)},onFail:function(){n()}});e._saveRequest(a)}))},_removeList:function(){window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList]&&delete window.store.storiesLists[this.storyList],window.store&&window.store.stories[this.storyList]&&delete window.store.stories[this.storyList]},_forceSetStore:function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},_requests:[],questions:{},viewers:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:!1,inited:!0}},_requestFeedback:function(e,t){var n=this;void 0===t&&(t=0);var i=this.store;return new Promise((function(a,r){var o=ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,r,o,s,l,c,u,d,_,f){o&&o.length&&(i.replies[e]=o),i.viewers[e]=[].concat(i.viewers[e]||[],t).filter((function(e,t,n){return t===n.findIndex((function(t){return t.viewerId===e.viewerId}))})),i.viewersState[e]?extend(i.viewersState[e],{count:n,nextFrom:r}):i.viewersState[e]={count:n,nextFrom:r,repliesCountText:s,authorCountText:l,repliesScrollLeft:0,hiddenReason:u},c.length&&(i.questions[e]=c),s&&(i.viewersState[e].repliesCountText=s),l&&(i.viewersState[e].authorCountText=l),d&&(i.polls[e]=d),_&&(i.extendedStats[e]=_),i.viewersState[e].privacyHint=f,a({viewers:t,count:n,nextFrom:r,repliesCountText:s,authorCountText:l,questions:c})},onFail:function(){r()}});n._saveRequest(o)}))},markSeenStoryIfNeeded:function(e){var t=this.getCurrentAuthor();t&&(t.getCurrentStory().isOneTime&&this.markSeenStory(e))},markSeenStory:function(e){var t,n,i=this.getCurrentAuthor(),a=this._getSource(),o=i.getCountDown(),s=i.getCurrentStory(),l=0;!o||this.store.readedStories[s.raw_id]&&!e||(s.isOneTime&&(l=s.progress?s.progress:Math.max(Math.round(s.getProgressPercentByLeftTime(o.left)),1)),ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:this.store.authors[0].read_hash,story_id:s.raw_id,track_code:s.track_code?s.track_code:"",access_key:s.accessKey,all:Object(r.intval)(e),source:a,progress:l,navigation_stats:(n=hl.map((function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")})).join(";"),hl=[],n),loading_stats:(t=ml.map((function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")})).join(";"),ml=[],t),connection_type:pl()}),this.store.readedStories[s.raw_id]=!0,e?this.setAllAuthorStoriesReaded(this.getCurrentAuthorIndex()):this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()].unread=!1)},_requestUpdateFeedBlock:function(){var e=this.store,t=Object.keys(e.readedStories),n=this._getSource();(t.length||this._needFeedUpdate)&&"feed"===n&&(this._needFeedUpdate=!1,setTimeout((function(){wl._requestFeedBlock()})))},_getSource:function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},_sendNavigationStatEvents:function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;n&&function(e){var t=e.storyRawId,n=e.source,i=e.action,a=t.split("_");"reply"===n&&(n="replies_list");var r={ownerId:a[0],storyId:a[1],source:n,action:i};hl.push(r)}({storyRawId:n,source:this._getSource(),action:e})},_sendViewerStartTime:function(e,t){!function(e){var t=e.storyRawId,n=e.source,i=e.time,a=t.split("_"),r={ownerId:a[0],storyId:a[1],source:n,time:i};ml.push(r)}({storyRawId:e,source:this.viewerSource,time:t})},_requestFeedBlock:function(){var e=nav.getQuery();if(!window.store.storiesLayers.length)ajax.post("stories.php",{_ajax:1,act:"feed_block",q:e.q},{onDone:function(e,t){var n=ge("StoriesFeedBlock");n&&replace(ceFromString(e),n),wl.pushPreloadedList(t)}})},_requestClickStat:function(e,t,n,i,a){ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n,track_code:i},{onDone:function(){a&&a()}})},_requestStickerStat:function(e,t){var n=this.getCurrentStory(),i=n.raw_id,a=n.clickable_stickers;i&&a&&ajax.post("stories.php",extend({act:"stickers_stat",story_raw_id:i,action:e,hash:a.hash},t))},_sendMessage:function(e,t,n,i){var a=ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:e,media:t,message:n,to:i},{onDone:function(){var e=window.lang;wl.showFlashPopup(e.mobile_stories_comment_success),wl.sendAnalyticsEvent("comment_send")}});this._saveRequest(a)},_requestFave:function(e,t,n,i){ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:cur.module})},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=t[1],i=t[2],a=t[4],r=t[6],o=n+"_"+i;return e.match(/from_feed\=1/)?a="feed":e.match(/profile\=1/)?a="profile":a||(a=o),o+"/"+a+"/"+r}return e},setHistory:function(e,t){void 0===t&&(t={nav_init:!1,replace:!0});var n=window.nav,i=this.getHistoryURL(e),a=n.getQuery();if(i.match(/narrative(-?\d+_\d+(?:_\d+)?)$/)){var r=this.getCurrentStory(),o=r.narrative,s=r.raw_id.split("_")[1];i="narrative"+o.owner_id+"_"+o.id+"_"+s}a.z=i;var l=n.path+obj2qs(a)+n.hash,c={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};n.go(l,null,c)},getFrom:function(e){void 0===e&&(e=!0);var t=window.nav,n=this.store.list,i=t.getQuery(),a="z="+i.z,r="";return"/write"===t.path.substr(0,6)?r="write"+t.path.substr(0,6)+"?"+a:"/mail"===t.path?r="write"+i.peer+"?"+a:"/feed"===t.path?r=i.section&&"notifications"===i.section?"feed?section=notifications&"+a:"feed?"+a:n.startsWith("archive")?r=t.path+"?act=stories":i.from&&(r=i.from),e?encodeURIComponent(r):r},getHistoryURL:function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},getParams:function(){return this.params||{}},toggleBookmark:function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor();if(n){var i=n.getCurrentStory(),a=i.bookmark_add_hash,o=window.store,s=(i.narrative?i.narrative:i).is_bookmarked;Object.keys(o.stories).forEach((function(e){var t=o.stories[e];if(t.authors){var n=!1;t.authors.forEach((function(e){n||(n=e.items.find((function(e){return!!e.narrative&&(e.narrative.bookmark_hash===a&&e.raw_id===i.raw_id)})))})),n&&(n.narrative?n.narrative.is_bookmarked=!s:n.is_bookmarked=!s)}})),Object(r.val)(e,s?lang.mobile_stories_menu_bookmark_title:lang.mobile_stories_menu_bookmarked_title);var l=s?"bookmark_remove":"bookmark_add",c=i.narrative,u=c.owner_id,d=c.id;t||this._requestFave(l,u,d,a),i.narrative&&Share.setBookmarkState(u+"_"+d,!s)}},share:function(e,t){var n=this,i=this.getCurrentAuthor();if(i){var a=i.getCurrentStory(),r=a.bookmark_add_hash,o=a.narrative?a.narrative:a,s=o.is_bookmarked,l=o.is_owner_closed_group;this.stopStory();this.getFrom();var c=t?"narrative":"story";this.stopStory(),Share(e,{mail_hash:this.getCurrentStory().share_hash,object:c+e,is_bookmarked:s,bookmark_hash:r,bookmark_type:31,can_bookmark:t,can_to_own:t&&!l,can_to_club:t&&!l}),cur.share.onClose((function(){n.playStory()}))}},_requestMarkNotInterested:function(e,t){var n=this;ajax.post("stories.php",{act:"mark_not_interested",story_raw_id:e.raw_id,track_code:e.track_code,hash:e.canMarkNotInterestedHash},{onDone:function(){n.sendAnalyticsEvent("mark_not_interested"),"function"==typeof t&&t()}})},markCurrentStoryNotInterested:function(e){var t=this.getCurrentStory();t?e&&Object(ie.partConfigEnabled)("ads_new_reports_mvk_histories")?this._requestMarkNotInterested(t,(function(){return nav.go(e)})):(I.init({text:Object(W.getLang)("mobile_stories_thanks_feedback"),type:I.SNACKBAR_TYPE_SUCCESS}),this.hideMenu(),this._requestMarkNotInterested(t)):Object(y.logError)(new Error("Fail: markNotInterested"),{environment:"mobile_stories"})},openReplies:function(e,t){void 0===t&&(t=!1),this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,{reply:!0,replyTo:t});else this.close()},hidePrivacyHint:function(e){var t=this.store.viewersState[e];if(t&&t.privacyHint){var n=t.privacyHint.privacyHintHash;t.privacyHint=null,n&&window.ajax.post("stories.php",{act:"hide_privacy_hint",privacy_hint_hash:n})}var i=Object(M.$)(".ViewsPrivacyHint");i&&i.remove(),this.sendAnalyticsEvent("hide_privacy_block")},openNarrative:function(e,t){this.playStory(),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,t);else this.close()},clickClose:function(){var e=this;requestAnimationFrame((function(){e.sendAnalyticsEvent("close_tap"),e.close()}))},close:function(e){if(void 0===e&&(e={}),extend({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var t=window.nav,n=t.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var i=window.store.storiesLayers[window.store.storiesLayers.length-1-1],a=window.store.stories[i],r=a.authorIndex,o=a.authors[r].index,s=a.authors[r].items[o];n.z=this.getHistoryURL(s.raw_id)}else delete n.z;var l=t.path+obj2qs(n)+(t.hash||"");t.go(l,null,{push_only:!0})}if(this.destroy(),e.isPopState&&e.storyRaw){var c=this._parseList(e.storyRaw).split("/")[1];this.store?this.restore(this.store.storyList,c,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,!1,!1,e)},hideAllViews:function(){var e=window.store;e&&(e.storiesLayers=[],e.stories&&Object.keys(e.stories).forEach((function(t){e.stories[t].showViews=!1,e.stories[t].isStopped=!1})))},restore:function(e,t,n,i){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i={}),window.store.storiesLayers){var a=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(a,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var o=window.store.stories[e],s=window.store.stories[t];if(o&&s){var l=Object.keys(o.readedStories);Object(r.each)(l,(function(e,t){var n=t.split("_"),i=n[0],a=(n[1],n[2],s.replies[o.replyTo]);if(a){var r=a.filter((function(e){return e.owner_id==i}))[0];r&&(r.has_new=!1)}})),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();i.closeAll&&window.store.storiesLayers.length&&this.close(i)},clearStore:function(){this.store=this._initStore()},destroy:function(){var e=this;if(this.restoreAudio(),this.store){this.slider=null,this.hideMenu(!1),this.markSeenStoryIfNeeded(),this._abortRequests(),Object(r.removeClass)(this.layer,"Stories_inited");var t=this.getCurrentAuthorIndex(),n=this.getCurrentAuthor(),i=n&&n.getCurrentStory();if(i&&i.isOneTime&&this._removeList(),void 0!==t&&this.Authors)this.Authors[t].destroy();this.onRender.off(),Object(r.remove)(this.layer),this._requestUpdateFeedBlock(),Object.keys(this).forEach((function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])})),zlayer.close(),Object(r.addClass)(ge("StoriesFeedBlock"),"StoriesFeedBlock_been-open"),Object(r.removeClass)(document.body,"vk__story_open"),wl.opened=!1;var a=Object(r.geByClass1)("Question__popup"),o=Object(r.geByClass1)("Popup__overlay",a);o&&K.default.close(o)}},isAutoplaySupport:function(){return this.supportAutoplay},isGoodBrowser:function(){return C.default.ios&&C.default.safari_mobile&&parseInt(C.default.version,10)>=10},detectAutoplay:function(){var e=this;return new Promise((function(t){if(e.supportAutoplay)t();else{if(e.isGoodBrowser())return e.supportAutoplay=!0,void t();e.supportAutoplay=!1;var n=Object(r.ce)("video"),i=Object(r.ce)("source");i.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var a=Object(r.ce)("source");a.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",Object(r.append)(a,n),Object(r.append)(i,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),n.muted=!0,attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),Object(r.append)(n,document.body);var o=ge("base64testvideo");if(C.default.android&&C.default.chrome)return e.supportAutoplay=!0,Object(r.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(C.default.mobile&&C.default.ios&&C.default.ios<10)return e.supportAutoplay=!1,Object(r.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(!C.default.safari_mobile||C.default.safari_mobile&&parseInt(C.default.version,10)>=10){var s=n.play();void 0!==s&&s.then((function(){e.supportAutoplay=!0,Object(r.remove)(n),t(),clearTimeout(e.autoDetectTimeout)})).catch((function(e){}))}o.onplay=function(){e.supportAutoplay=!0,Object(r.remove)(n),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout((function(){o.paused||(e.supportAutoplay=!0),Object(r.remove)(n),t()}),250)}}))},narrativeReply:function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},narrativeGoToStories:function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},_showTooltip:function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n=this.getCurrentAuthorEl();this.tooltip=Object(r.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=Object(r.ce)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),n.appendChild(this.tooltip);var i=0,a=0;"touchend"===e.type?(i=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY):(i=e.clientX,a=e.clientY);var o=n.getBoundingClientRect(),s=o.top,l=o.left,c=o.width,u=getSize(this.tooltip),d=u[0],_=a-(s+u[1]+10),f=i-(l+d/2);setStyle(this.tooltip,{top:Math.max(_,2),left:Math.min(Math.max(f,2),c-d-2)}),setStyle(this.tooltipArrow,{left:Math.max(Math.min(i-l-Math.min(Math.max(f,0),c-d),d-15),15)}),this.pauseStory()}else this.playStory()},_showFeatureTooltipIfNeeded:function(){var e=this,t=window.store.storiesLists;if(t&&t.needShowFeatureTooltip){var n=wl.getCurrentAuthorEl(),i=Object(r.geByClass1)("StoriesFeatureTooltip",n);if(i){var a=setTimeout((function(){e.pauseStory(),Object(r.addClass)("StoriesFeatureTooltip--show",i),e.featureTooltip=i,e.featureTooltipHash=t.needShowFeatureTooltipHash}),2e3);t.needShowFeatureTooltip=!1,cur&&Object(W.isArray)(cur.destroy)&&cur.destroy.push((function(){clearTimeout(a)}))}}},_hideFeatureTooltip:function(e){if(this.featureTooltip){var t=wl.getCurrentAuthorEl(),n=Object(r.geByClass1)("StoriesFeatureTooltip",t);n&&(e||this.playStory(),Object(r.removeClass)("StoriesFeatureTooltip--show",n),this.featureTooltip=null,ajax.post("stories.php",{_ajax:1,act:"hide_feature_tooltip",type:"stories_pin",hash:this.featureTooltipHash}),this.featureTooltip=null,this.featureTooltipHash=null)}},_hideTooltips:function(e){this._hideFeatureTooltip(e),this.tooltip&&(e||this.playStory(),Object(r.remove)(this.tooltip),delete this.tooltip)},_hasContext:function(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)},sendAnalyticsEvent:function(e,t){void 0===t&&(t={});var n=wl.getCurrentStory(),i=wl.getCurrentAuthor(),a=wl.getCurrentStoryIndex(),o=wl._getSource(),s=n.is_groups_meta_story,l=n.raw_id.split("_"),c=l[0],u=l[1],d=0;s&&(c=0,u=0),"groups"===this.storyList&&(d=1);var _={event_type:e,story_owner_id:c,story_id:u,time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3),view_entry_point:o,nav_screen:cur.module,story_type:s?"group_feed":"",is_grouped:d,track_code:n.track_code};if(i){var f=i.data,p=i.getCountDown();p&&f&&extend(_,{stories_author_before:a,stories_author_after:f.items.length-a,view_event_timeline_position:p.initialTime-p.left})}Object.assign(_,t),Object(ie.partConfigEnabled)("web_stats_transport_story_view")?Object(gl.saveStoryViewStats)(_):Object(r.statlogsValueEvent)("story_product_analytics",_)},clickAuthor:function(){this.sendAnalyticsEvent("go_to_author")},askQuestionBox:function(e){Object(r.cancelEvent)(e);var t=this.getCurrentStory().can_ask;if(this.hideFlashPopup(!1),this._hideTooltips(),!t)return wl.showFlashPopup(lang.mobile_stories_ask_question_forbidden),!1;this.stopStory(),Object(r.addClass)(this.layer,"Stories_questionOpened");var n=this.authors[this.store.authorIndex],i=Object(r.geByClass1)("Story__questionTextarea",n);requestAnimationFrame((function(){i&&i.focus()}))},changeAskAnonymous:function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+Object(r.domData)(t,"selected"),i=this.getCurrentStory();if(i){var a=[Object(K.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",bl],class:n===bl?"selected":""}),Object(K.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",Al],class:n===Al?"selected":""})];i.can_ask_anonymous&&a.splice(1,0,Object(K.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",yl],class:n===yl?"selected":""}));var o=Object(K.default)({class:"Story__questionSelectModal",close:!0,closeText:lang.mobile_stories_ask_question_cancel,items:a});_n.default.open(d.default.elem(o),!0)}}},changeQuestionMode:function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case Al:Object(r.val)(n,lang.mobile_stories_ask_question_public),Object(r.domData)(n,"selected",Al);break;case bl:Object(r.val)(n,lang.mobile_stories_ask_question_author_only),Object(r.domData)(n,"selected",bl);break;case yl:Object(r.val)(n,lang.mobile_stories_ask_question_anonymous),Object(r.domData)(n,"selected",yl)}K.default.close(e)},hideAskQuestion:function(e){void 0===e&&(e=!0),wl.store.showMenu=!1,Object(r.removeClass)(wl.layer,"Stories_questionOpened"),e&&wl.playStory()},onInputQuestion:function(e){Object(M.$)(".Story__questionSend").disabled=!Object(r.trim)(Object(r.val)(e))},sendQuestion:function(){var e=wl.getCurrentAuthorEl();if(e){var t=Object(r.geByClass1)("Story__questionTextarea",e),n=Object(r.geByClass1)("Story__questionSend",e),i=wl.getCurrentStory(),a=i.raw_id,o=i.askQuestionHash,s=i.accessKey,l=a.split("_"),c=l[0],u=l[1],d=Object(r.trim)(Object(r.val)(t)),_=document.querySelector(".Story__questionSelect"),f=+Object(r.domData)(_,"selected"),p=!1,h=!1;f===Al?p=!0:f===yl&&(h=!0),Object(r.val)(t,""),n.disabled=!0;var m=ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:u,question_text:d,is_anonymous:+h,with_mention:+p,hash:o,access_key:s},{onDone:function(e){if(!e)return wl.showFlashPopup(lang.mobile_stories_question_error),!1;var t=wl.getCurrentAuthor().data.author;switch(wl.showFlashPopup(lang.mobile_stories_question_sent.replace("{name}",t.first_name_ins)),f){case Al:wl.sendAnalyticsEvent("question_reply_publish");break;case bl:wl.sendAnalyticsEvent("question_reply");break;case yl:wl.sendAnalyticsEvent("question_reply_anonymous")}}});wl._saveRequest(m),wl.hideAskQuestion()}},getQuestionById:function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find((function(t){return t.id===e}))},openQuestionActions:function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,r=[Object(K.ModalMenuBtn)({inner:lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(r.push(Object(K.ModalMenuBtn)({inner:i?lang.mobile_stories_question_unban:lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),r.push(Object(K.ModalMenuBtn)({inner:lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&r.unshift(Object(K.ModalMenuBtn)({inner:lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var o=Object(K.default)({class:"Question__popup",items:r});_n.default.open(d.default.elem(o),!0)}},removeQuestion:function(e,t){var n=this,i=this.getQuestionById(t),a=i.storyOwnerId,o=i.storyId,s=i.id,l=i.removeHash;ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:a,story_id:o,question_id:s,remove_hash:l},{onDone:function(i){var l=a+"_"+o;if(K.default.close(e),!i)return requestAnimationFrame((function(){return n.showFlashPopup(lang.mobile_stories_question_error)})),!1;$$('.Question[data-id="'+t+'"]').forEach((function(e){return re(e)})),n.store.questions[l]=n.store.questions[l].filter((function(e){return e.id!==t})),$$(".Question").length<1&&re(Object(r.geByClass1)("Views__questions")),wl.sendAnalyticsEvent("question_delete",{questionId:s})}})},replyQuestionBox:function(e,t){var n=this.getCurrentStory(),i=this.getQuestionById(t),a=i.author,r=i.text,o=lang.mobile_stories_question_reply_title.replace("{name}",a.nameGen),s=d.default.elem({class:"QuestionReplyPopup",inner:[{class:"QuestionReplyPopup__inner",inner:[{class:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+n.small_preview+")"},{class:"QuestionReplyPopup__top",inner:[{class:"QuestionReplyPopup__title",inner:o},{class:"QuestionReplyPopup__question",inner:r}]}]},{class:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{class:"QuestionReplyPopup__footer",inner:[Object(wt.default)({class:"QuestionReplyPopup__send",theme:"regular",inner:lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",t],disabled:!0}),Object(wt.default)({class:"QuestionReplyPopup__cancel",theme:"link",inner:lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});this.popout.appendChild(s),K.default.close(e)},hideReplyQuestion:function(){re(Object(r.geByClass1)("QuestionReplyPopup",wl.popout))},onInputReplyQuestion:function(e){Object(M.$)(".QuestionReplyPopup__send").disabled=!Object(r.trim)(Object(r.val)(e))},sendReplyQuestion:function(e){var t=Object(r.trim)(Object(r.val)(Object(r.geByClass1)("QuestionReplyPopup__textarea"))),n=wl.getQuestionById(e),i=n.id,a=n.ownerId,o=n.storyOwnerId,s=n.storyId,l=n.sendHash,c="story"+o+"_"+s,u=t+"\n\n🗣 "+n.text,d=ajax.post("mail.php",{_ajax:1,act:"send",hash:l,media:c,message:u,to:a},{onDone:function(e){var t=e&&e.error?e.message:lang.mobile_stories_comment_success;wl.showFlashPopup(t,!1),wl.sendAnalyticsEvent("question_send_message",{questionId:i})}});wl._saveRequest(d),wl.hideReplyQuestion()},showQuestions:function(e){var t=new ul(e).render();this.popout.appendChild(t),wl.sendAnalyticsEvent("question_show_all")},hideQuestions:function(){re(Object(r.geByClass1)("Questions",this.popout))},banQuestion:function(e,t){var n=this.getQuestionById(t),i=n.storyOwnerId,a=n.storyId,r=n.banHash,o=n.isOwnerBlocked;ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:i+"_"+a,question_id:t,ban_hash:r,is_blocked:+o},{onDone:function(i){if(!i)return K.default.close(e),void wl.showFlashPopup(lang.mobile_stories_question_error,!1);if(!o){var a="question_ban_author";n.isAnonymous&&(a="question_ban_anonymous_author"),wl.sendAnalyticsEvent(a,{questionId:t})}K.default.close(e),n.isOwnerBlocked=!o,wl.showFlashPopup(o?lang.mobile_stories_question_author_unblocked:lang.mobile_stories_question_author_blocked,!1)}})},reportQuestion:function(e,t){var n=this.getQuestionById(t),i=this.getFrom();K.default.close(e);var a="story_question"+n.storyOwnerId+"_"+n.id;nav.go("/reports?act=add&object="+a+"&refrom="+i)},toggleQuestionTooltip:function(e,t){var n=this.getCurrentAuthor().getCurrentStory(),i=Object(M.$)(".QuestionSupport"),a=Object(M.$)(".Story__questionSelect"),o=+Object(r.domData)(a,"selected");if(Object(r.cancelEvent)(e),i){var s=n.firstName;n.authorId<0&&(s=lang.mobile_stories_ask_question_group_owner);var l="";switch(o){case Al:l=lang.mobile_stories_ask_question_public_tooltip;break;case bl:l=lang.mobile_stories_ask_question_author_only_tooltip;break;case yl:l=lang.mobile_stories_ask_question_anonymous_tooltip}Object(M.$)(".QuestionSupport__tooltip").innerText=l.replace("{name}",s),t?Object(r.removeClass)(i,"QuestionSupport--active"):Object(r.toggleClass)(i,"QuestionSupport--active")}},openMusicStickerActions:function(e,t){var n=ge("audio"+e),i=hasClass("ai_added",n),a=Object(K.default)({close:!0,items:[Object(K.ModalMenuBtn)({class:"ai_add",inner:i?lang.global_delete_audio:lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),Object(K.ModalMenuBtn)({class:"ai_add",inner:lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),r=d.default.elem(a);r.setAttribute("id","ai_menu_"+e),_n.default.open(r,!0)},addMusic:function(e,t,n){audioplayer.add(t),K.default.close(e),wl._hideTooltips(!0),wl.showFlashPopup(n?lang.mobile_stories_music_deleted:lang.mobile_stories_music_added)},nextMusic:function(e,t){var n=window,i=n.audio,a=n.audioplayer,r=Pn(t);if(i.getCurrentId()){var o=i.playlist().map((function(e){return e.id})).indexOf(i.getCurrentId())+1;i.addToPlaylist([r],o)}else a.playPause(!1,r.fullId,!0),i.pause();K.default.close(e),wl._hideTooltips()},toggleLikeForCurrentStory:function(e){var t=this,n=wl.getCurrentStory(),i=wl.getCurrentAuthor().story,a=n.raw_id,o=n.isLiked,s=n.likeHash,l=n.accessKey,c={act:o?"delete_like":"like",hash:s,story_raw_id:a};i.isLiked=!o,n.isLiked=!o,o?e.innerHTML=d.default.html(Object(T.default)(Object(zs.getLikeOutlineShadow48Icon)())):(Object.assign(c,{access_key:l}),e.innerHTML=d.default.html(Object(T.default)(Object(qs.getLikeShadow48Icon)()))),Object(r.toggleClass)("Story__like--set",e,n.isLiked),ajax.post("stories.php",c,{onDone:function(a){a?(i.isLiked=o,n.isLiked=o,e.innerHTML=o?d.default.html(Object(T.default)(Object(qs.getLikeShadow48Icon)())):d.default.html(Object(T.default)(Object(zs.getLikeOutlineShadow48Icon)())),Object(r.toggleClass)("Story__like--set",e,n.isLiked)):t.sendAnalyticsEvent(o?"click_to_unlike":"click_to_like")}})},clickToApp:function(){var e=wl.getCurrentStory(),t=e.raw_id,n=void 0===t?"":t,i=e.accessKey,a=e.clickable_stickers,r=a&&a.stickers.find((function(e){return e.type===Js.app}));if(r&&r.appId){var o=n.split("_"),s=o[0],l=o[1];r.hasNewInteractions&&ajax.post("stories.php",{act:"mark_app_notifications_seen",owner_id:s,story_id:l,sticker_id:r.id,access_key:i,hash:r.hash},{onDone:function(){r.hasNewInteractions=!1;var e=document.querySelector(".Story__app");e&&e.classList.contains("has_new")&&e.classList.remove("has_new")}}),this.pauseStory(),this.showLoading(),nav.go("/app"+r.appId+"?ref="+r.appRef+"&hash="+r.appHash)}},openPoll:function(e,t,n){var i="/poll"+e+"_"+t+"?from=story"+n+"&story_raw="+n;nav.go(i),wl.showLoading()},onRender:Object(u.default)()};window.page&&page.onChange((function(){window.store.storiesLayers=[],window.store.stories={}})),window.Stories=wl,window.showNarrative=function(e,t,n,i,a){void 0===n&&(n=0),void 0===i&&(i=""),void 0===a&&(a={});var r=""+e+(n=n?"_"+n:"")+"/"+(i=i||"narrative"+e+"_"+t);Object.assign(a,{narrativeId:t}),wl.init(r,a)},function(e){e.IMAGE="image",e.VIDEO="video"}(vl||(vl={}));var Ol=n("WWJR"),Sl=function(e){var t="width: "+e.artboardWidth+"px; height: "+e.artboardHeight+"px",n=e.background_type===vl.IMAGE?{class:"StoryPublisher__canvasLayer",width:"1080",height:"1920",style:t,tag:"canvas"}:{inner:[{src:e.src,tag:"source"}],class:"StoryPublisher__video",preload:"metadata",controls:!0,controlsList:"nodownload",onContextMenu:"cancelEvent(); return false;",tag:"video"},i=d.default.wrap(Object(W.getLang)("mobile_apps_story_publisher_description").replace("{service_name}",e.miniAppName));return{inner:[{inner:[Object(wt.default)({inner:[Object(T.default)({icon:Object(Ol.getCancelOutline28Icon)()})],theme:"header",class:"StoryPublisher__headerButton",onClick:"StoryPublisher.closePopup()",use_native_onclick:!0,is_icon:!0})],class:"StoryPublisher__header",tag:"div"},{inner:[d.default.wrap(Object(La.default)({mix:"al_loading StoryPublisher__spinner",type:"pageLoader",isFixed:!0})),{inner:[n],class:"StoryPublisher__canvas",style:t,tag:"div"},{inner:[i],class:"StoryPublisher__description",tag:"div"},Object(wt.default)({inner:[d.default.wrap(Object(W.getLang)("mobile_apps_story_publisher_publish_btn_text"))],onClick:"StoryPublisher.save(this)",use_native_onclick:!0})],class:"StoryPublisher__content",tag:"div"}],class:"Popup StoryPublisher",tag:"div"}};Object.assign(Sl,{init:function(e,t,n){var i=this;void 0===t&&(t=L.noop),void 0===n&&(n=L.noop),this.successHandler=this.successHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),e.artboardHeight=e.artboardHeight||(window.innerHeight<357?window.innerHeight-100:357),e.artboardWidth=e.artboardWidth||e.artboardHeight/1.78,this.props=e,this.props.src=e.src||e.url||e.blob,this.onClickSave=t,this.cb=n,this.popup=_n.default.open(d.default.elem(Sl(this.props)),!0);var a=function(){return La.default.hide(document.querySelector(".StoryPublisher__spinner"))};switch(this.props.background_type){case vl.IMAGE:Object(L.loadImage)(this.props.src).then((function(e){a(),i.drawImage(e)})).catch((function(){return i.errorHandler(new Error("Can't upload image"))}));break;case vl.VIDEO:this.validateVideo(this.props).then(a).catch(this.errorHandler)}return this},drawImage:function(e){if(this.canvas=document.querySelector(".StoryPublisher__canvasLayer"),!this.canvas)return this.errorHandler();var t=this.canvas.getContext("2d");if(!t)return this.errorHandler();var n,i,a=+(e.height/e.width).toFixed(2);if(a>1.77?(i=this.canvas.height,n=this.canvas.height/a):(n=this.canvas.width,i=this.canvas.width*a),t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.filter="blur(135px)",t.drawImage(e,0,0,this.canvas.width,this.canvas.height),t.restore(),"none"!==t.filter){var r=Object(L.getAverageRGB)(t);t.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",t.fillRect(0,0,this.canvas.width,this.canvas.height)}t.drawImage(e,this.canvas.width/2-n/2,this.canvas.height/2-i/2,n,i)},closePopup:function(e){void 0===e&&(e=!0),e&&this.cb(),_n.default.close(this.popup),this.popup=null},successHandler:function(e){this.cb(!0,e),this.isLoading=!1,this.closePopup(!1)},errorHandler:function(e){void 0===e&&(e={}),this.props.closeAfterError&&this.closePopup(!1),this.cb(!1,{error:e}),this.isLoading=!1,wt.default.setLoading(this.shareButton,!1),I.init({type:I.SNACKBAR_TYPE_ERROR,text:e.message||Object(W.getLang)("mobile_apps_story_publisher_unexpected_error")})},save:function(e){var t=this;if(!this.isLoading){this.onClickSave(),wt.default.setLoading(e,!0),this.shareButton=e,this.isLoading=!0;var n=this.props,i=n.background_type,a=n.miniAppId,r=n.entrypoint,o=n.storyUploadUrlHash,s=n.storySaveHash;Promise.all([this.getBlob(),Object(q.getStoryUploadUrl)({mini_app_id:a,story_type:i===vl.IMAGE?q.StoryType.PHOTO:q.StoryType.VIDEO,hash:o,entry_point:r,ref:window.cur.module})]).then((function(e){var n=e[0],i=e[1];return t.uploadStoryBlobToServer(n,i)})).then((function(e){var t=e.response;return Object(q.saveStoryOnServer)(t&&t.upload_result,s)})).then(this.successHandler).catch(this.errorHandler)}},uploadStoryBlobToServer:function(e,t){return new Promise((function(n,i){var a=Object(L.getBlobType)(e),o=9e5*Math.random(),s=new FormData,l=encodeURIComponent("story_"+o+"."+a);s.append("file0",e,l);var c=Object(r.uploadFile)(t,s,{onComplete:function(){var e=Object(r.parseJSON)(c.response);e&&e.response&&e.response.upload_result||i(),n(e)},onError:i})}))},getBlob:function(){var e=this;return this.props.background_type===vl.IMAGE?new Promise((function(t,n){try{e.canvas.toBlob(t,"image/jpeg")}catch(e){n()}})):Object(L.getMediaBlob)(this.props.src)},validateVideo:function(e){return new Promise((function(t,n){Object(L.getVideoDuration)(e.src).then((function(i){if(e.maxVideoDuration&&i>e.maxVideoDuration)return n(new Error("The duration of the video file must not exceed 15 seconds"));t(i)})).catch((function(){return n(new Error("Can't upload video"))}))}))}}),window.StoryPublisher=Sl;var kl={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var i=ge(n+"__message-archived");if(t){var a=n+"__message-rollback",r=ce("div",{className:["post_message_item",i.className].join(" "),innerHTML:t,id:a});hide(i),ge(r)||after(r,i)}else{var o=ge(n+"__message-rollback");show(i),remove(o)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&addClass(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,i=e.restored,a=e.rollback_hash,r=this.link;cur.restored||(cur.restored=0),i&&"profile"===cur.module&&cur.restored++,removeClass(r,"wia_item--loading");var o=ge(n),s=ge(n+"_replies");if(t){if(cur.restored>3){var l=o.id+"?act=rollback_archive&hash="+a;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:l,onclick:"return ajax.click(this, Archive.rollback)",inner:getLang("mobile_archive_restore_bulk")}})}var c=o.id+"__message-archived",u=ce("div",{className:["post_message_item",o.className].join(" "),innerHTML:t,id:c});hide(o),hide(s),ge(c)||after(u,o)}else if(n){var d=ge(n+"__message-archived"),_=ge(n+"_replies");show(n),show(_),remove(d)}}}};window.Archive=kl;var Cl=function(e,t){cancelEvent(e);var n=t.getAttribute("href"),i=getLang("mobile_wall_prometheus_edit_warn");Confirm(i,'Popup.close(this); nav.go("'+n+'");',"",{title:getLang("mobile_prometheus_edit_warn_popup_title")})};window.PrometheusEditConfirm=Cl,window.CopyrightPopup={open:function(e,t,n,i){var a=Object(sn.default)({class:"CopyrightPopup",header:{title:getLang("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:getLang("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(i?1:0)+")"})]}]}});sn.default.open(Wd.elem(a),!0)},go:function(e,t,n){var i;if(sn.default.close(e),t.startsWith("/story"))Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(?:_(\d+))?(\/?([a-z0-9_-]+))?$/i.exec(t)){var a=i,r=a[0],o=a[1],s=a[2];window.showNarrative(r,o,s,{source:"view_source"})}else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}};var El=n("UvyM");function jl(){var e=window.lang,t=Object(M.$)(".pcont .service_msg_box");if(t){var n=Object(M.$)(".service_msg",t).innerHTML;Object(r.remove)(t);var i=Object(sn.default)({class:"CopyrightPopup",content:[{inner:d.default.wrap(n)},{class:"Popup__buttons",inner:[Object(El.default)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});sn.default.open(d.default.elem(i),!0)}}window.ZeroVKPopup={open:jl,init:function(){onDOMReady((function(){jl()}))}};n("B9v3"),n("2fMF"),n("PssS");window.initSharePage=function(e,t){var n=ge("SharePageInput__to"),i="";n&&(i=n.value);var a={};if("mail"===e&&""!==n.value&&(a=i.split(",").reduce((function(e,t){return e[t]=!0,e}),{})),"club"===e){var r=Object(M.$)(".SharePage .qsearch_wrap"),o=Object(M.$)(".hp_block",r);show(r),show(o)}var s=Object(M.$)(".SharePage .SharePanel.MessagePanel"),l=Object(M.$)(".SharePage .SharePanel.ActionsPanel");extend(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),isUndefined(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=ge("club"+e):"mail"===t&&(a=ge("peer"+e));var r=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!r:r),cur.like_search.toggleAttach(e,!r),i&&(cur.selectedMap[e]=!r),n.value=Object.keys(cur.selectedMap).filter((function(e){return cur.selectedMap[e]})).join(","));var o=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some((function(e){return!!cur.selectedMap[e]}));return s.classList.toggle("SharePanel--active",o),l.classList.toggle("SharePanel--active",!o),!1},selectedMap:a,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(a).forEach((function(t){cur.refreshSelected(t,e,!1)}))};var Tl=n("zouF"),Il=function(e,t,n,i,a,r,o,s){n?Object(Tl.Confirm)(t,"ReportConfirm.submit('"+a+"', false, "+i+", '"+r+"', "+JSON.stringify(o)+")","",{withoutPopupCloning:!0,title:e,id:"confirm-"+i}):Ml(a,!0,i,r,JSON.stringify(o),s)};function Ml(e,t,n,i,a,o){"string"==typeof a&&(a=JSON.parse(a));var s=Object(M.$)("#mcont");Object(r.setStyle)(s,{"pointer-events":"none"}),window.ajax.post(e,Object(j.default)({_ajax:1,reason:n,onDone:function(){alert(nav.cur),Object(r.isVkWebView)()&&history.back()}},a)),"story"===a.type&&window.Stories.sendAnalyticsEvent("claim"),Object(ie.partConfigEnabled)("mvk_new_info_snackbar")||window.Snackbar.init({text:o||Object(W.getLang)("mobile_msg_reported")}),Object(M.$$)(".Confirm").forEach((function(e){return sn.default.close(e)}))}Object(r.extend)(Il,{submit:Ml}),window.ReportConfirm=Il;var Dl=function(e){return{class:"ModalMenuUserList",inner:Object(ur.default)({inner:e.users})}},Pl=n("WE4r");var xl=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[{inner:[Object(T.default)({icon:Object(Pl.getCancel16Icon)()})],class:"CancelTimer__cross",tag:"div"},{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}},Ll=n("JlTo");window.Replies={init:function(e,t){void 0===t&&(t=0);!function(e){e&&function(){var e=Object(r.geByClass1)("wall_replies"),t=Object(r.domLC)(e);if(!t||!Object(r.hasClass)("RepliesThreadNext",t))return;var n=Object(r.geByClass1)("RepliesThreadNext__link",t);Object(r.autoScroll)((function(){if(Object(r.domPN)(t)&&!Object(r.hasClass)("RepliesThreadNext_loading",t))return n}),RepliesNext,{no_cache:!0})}();(function(){var e=Object(r.ge)("reply_field");if(!e||Object(r.hasClass)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t(Object(r.throttle)((function(t){var i=t+Object(r.getCh)(),a=Object(r.getH)(e),o=i<Object(r.getY)(e)+a;o&&!n?(Object(r.setStyle)(e,{height:a}),Object(r.addClass)("RepliesField_fixed",e)):!o&&n&&(Object(r.removeClass)("RepliesField_fixed",e),Object(r.setStyle)(e,{height:null})),n=o}),10)),Object(r.onBodyScrollForce)()})(),function(e){var t=Object(r.ge)("replies_to_last"),n=Object(r.geByClass1)("RepliesWrap"),i=Object(r.geByClass1)("RepliesField_wrap");if(!t||!n)return;var a=Object(r.ge)("reply_field"),o=Object(r.hasClass)("RepliesField_static",a),s=Object(r.getY)(n),l=window.onBodyScroll,c=!1;Nl(),l(Object(r.throttle)((function(e){var l=e+Object(r.getCh)(),u=a&&!o?Object(r.getY)(a)-50:s+Object(r.getH)(n)-Object(r.getH)(i),d=s<e&&l<u;d!==c&&(Object(r.toggleClass)("Replies_last_shown",t,d),t.setAttribute("tabindex",d?0:-1),c=d)}),10))}()}(e);var n=Object(r.ge)("reply_field"),i=Object(r.ge)("reply_field_text");mediaUpload&&n&&(mediaUpload.onStart(Fl),mediaUpload.onRemove((function(){Fl(),i.focus()})));if(at.default.checkStickers(),n){var a=window.cur;a.onStickersToggleCallbacks=a.onStickersToggleCallbacks||[],a.onStickersToggleCallbacks.push((function(e){if(Object(r.onBodyScrollForce)(),Rl(),e){var t=Object(r.geByTag1)("a","stickers_panel");t&&t.focus()}else i.focus()})),function(e){var t=Object(W.getState)("mention_items_"+e);t&&Mention.init({appendTo:$(".MentionContainer"),items:t})}(t),Bl()}post.stickersInit()},replyTo:function(e,t,n,i,a){void 0===a&&(a="wall_reply");if(Object(r.checkEvent)(e))return!0;if(window.cur.replyTo!==n&&ql)return Zl(),!0;n=n||0,Object(r.geByClass)("ReplyItem_active").forEach((function(e){Object(r.removeClass)("ReplyItem_active",e)}));var o,s=Object(r.ge)("reply_field"),l=Object(r.ge)("reply_field_text"),c=Object(r.hasClass)("RepliesField_static",s),u=!!window.post&&window.post.replyNamesRE(),d=Object(r.val)(l),_="";if(n){if(o=Object(r.ge)(a+t+"_"+n))if(c||Object(r.addClass)("ReplyItem_active",o),!Object(r.hasClass)("ReplyItem_deleted",o)&&i){var f=window.cur.replyNames[i]||{},p=f[0]||"";_=f[1]||"",d=d?u?d.replace(u,p):d:p,window.post&&window.post.onReplyClick(!0,p)}else d=u?d.replace(u,""):d}else d=u?d.replace(u,""):d;Object(r.val)(l,replaceEntities(d));var h=Object(r.ge)("reply_field_to"),m=Object(r.geByClass1)("RepliesField__infoName",h);Object(r.val)(m,Object(r.htsc)(_)),Object(r.toggleClass)("RepliesField__infoItem_shown",h,n&&_),Object(r.toggleClass)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!_);var v=Object(r.ge)("reply_field_info"),g=Object(r.ge)("reply_field_from");if(Object(r.toggleClass)("RepliesField__info_shown",v,n||g),Object(r.toggleClass)("RepliesField__info_single",v,n&&!g||!n&&g),Object(r.val)("field_reply_to",n),Object(r.val)("field_reply_to_name",n&&_?"1":""),window.cur.replyTo=n,Object(r.val)("field_timestamp",Gl()),c)if(o)Unfold.changePosition(Unfold.getByName("attaches"),!0,!1),domInsertAfter(s,o);else{Unfold.changePosition(Unfold.getByName("attaches"),!0,!0);var A=Object(r.geByClass1)("wall_replies");domInsertBefore(s,A)}return Rl(),Bl(),elfocus(l),Object(r.cancelEvent)(e)},showMoreActions:function(e,t){var n=Object(r.ge)("reply_more_"+e);if(!n)return;var i=Object(r.geByClass)("ReplyItem__action",n),a=[];i.forEach((function(e){a.push(Object(K.ModalMenuBtn)({inner:Object(r.val)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))}));var o=Object(K.default)({close:!0,items:a}),s=Object(r.ceFromString)(d.default.html(o));s=_n.default.open(s,!0,{oncloseCallback:function(){var t=Object(r.ge)("reply_more"+e);t&&t.focus()}});var l=Object(r.geByClass1)("ModalMenu__btn",s);l&&l.focus();return Object(r.cancelEvent)(t)},onClickMoreAction:function(e,t){t&&_n.default.close(t.target);var n=Object(r.ge)(e);if(!n)return;n.click()},onFieldInput:Bl,toggleStickers:function(e,t){if(ql)return Object(r.cancelEvent)(t);return window.post.stickersToggle(e),Object(r.cancelEvent)(t)},replyAsShow:function(e,t,n){void 0===n&&(n=!1);var i,a=!!window.cur.replyAs;Xl("editing"),a?i=Vl(window.cur.replyAs):(i=d.default.wrap(Object(oe.default)({large:!0})),function(e,t){void 0===t&&(t=!1);if(window.cur.replyAsLoading)return;var n=window.ajax;window.cur.replyAsLoading=!0,n.post("/wall.php",{act:"get_reply_clubs_list",only_this_group:t?1:0,post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=Object(r.ge)("reply_as_users_list");if(t){var n=Vl(e);Object(r.val)(t,d.default.html(n));var i=Object(r.geByClass1)("ModalMenuUserList__item",t);i&&i.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t,n));var o=Object(K.default)({title:Object(r.getLang)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:i}]}),s=Object(r.ceFromString)(d.default.html(o));if(_n.default.open(s,!0),a){var l=Object(r.geByClass1)("ModalMenuUserList__item",Object(r.ge)("reply_as_users_list"));l&&l.focus()}return Object(r.cancelEvent)(e)},replyAsChange:function(e,t,n,i){var a=Object(r.ge)("reply_field_from"),o=Object(r.geByClass1)("RepliesField__infoName",a);return Object(r.val)(o,Object(r.htsc)(i)),Object(r.val)("field_from_oid",n),K.default.close(t),Object(r["ge"])("reply_field_text").focus(),Object(r.cancelEvent)(e)},checkSendButton:function(e){if(!Ul())return Object(r.cancelEvent)(e);window.cur.needTrackMyTracker&&Object(Ll.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onClickLastReplies:function(e,t){var n=Object(r.geByClass1)("wall_replies"),i=Object(r.domLC)(n),a=i&&Object(r.hasClass)("RepliesThreadNext",i);if(a){var o=Object(r.geByClass1)("Loading",i);o||(o=Object(r.ceFromString)(Object(oe.default)({})),append(o,i)),Object(r.addClass)("RepliesThreadNext_loading",i)}if(Object(r.removeClass)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),a)return i.focus(),ajax.click(e,window.RepliesLast);i&&(Object(r.hasClass)("RepliesThread",i)&&(i=Object(r.domPS)(i)),Object(r.hasClass)("ReplyItem",i)&&Object(r.geByClass1)("ReplyItem__name",i).focus());return Object(r.cancelEvent)(t)},onSubmitForm:function(e,t){if(Gl())Zl();else{if(e.preventDefault(),zl)return;var n=$('textarea[name="message"]',t),i=n?n.value:"";if(!i)return Kl(-1),void Zl();zl=!0;var a=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),o=a[1],s=a[2];ajax.post("/wall.php",{act:"check_comment",oid:o,post_oid:s,text:i},{onDone:function(e){if(zl=!1,Kl(e.timestamp),e.delay){var t,n=1e3*e.delay,i=$("#reply_field");Object(r.hasClass)("RepliesField_fixed",i)?t=Object(r.getH)(i)+5:Object(r.hasClass)("RepliesField_static",i)||(t=Object(r.getH)($("body"))-Object(r.getY)(i)+5),Wl=Snackbar.init({type:I.SNACKBAR_TYPE_BULLYING,text:e.description,bottom:t,duration:n}),$l=setTimeout((function(){Jl(),Zl()}),n),function(e){var t=$("#nc_submit"),n=$(".RepliesField__field"),i=d.default.elem({class:"RepliesField__action RepliesField__action_cancel",inner:xl({duration:e/1e3}),onclick:["Replies.abortTimer","button"]});ql=!0;var a=$(".RepliesField__action_attach"),o=$(".RepliesField__action_smile");a&&a.classList.add("RepliesField__action_disabled"),o&&o.classList.add("RepliesField__action_disabled"),n.appendChild(i),Object(r.hide)(t)}(n)}else Zl()},onFail:function(){zl=!1,Zl()}})}},abortTimer:Xl,setCurrentTimestamp:Kl,getCurrentTimestamp:Gl};function Bl(){var e=Object(r.ge)("reply_field_text"),t=Object(r.ge)("reply_field_text_fake");if(e&&t){var n=e.value;t.innerText=n,"\n"===Object(r.last)(n)&&(t.innerHTML+="&nbsp;");var i=Object(r.getH)(t);Object(r.getH)(e)!==i&&(Object(r.setStyle)(e,{height:i}),Rl()),Hl(),Xl("editing")}}function Rl(){var e=Object(r.ge)("reply_field");Object(r.hasClass)("RepliesField_static",e)||Object(r.hasClass)("RepliesField_fixed",e)&&(Object(r.setStyle)(e,{height:Object(r.getH)(Object(r.geByClass1)("RepliesField_wrap",e))}),Nl(),Object(r.onBodyScrollForce)())}function Nl(){var e=Object(r.ge)("replies_to_last"),t=Object(r.ge)("reply_field");if(e&&t&&!Object(r.hasClass)("RepliesField_static",t)){var n=domData(e,"bottom");n||(n=parseInt(getStyle(e,"bottom"))||20,domData(e,"bottom",n)),Object(r.setStyle)(e,"bottom",Object(r.getH)(t)+parseInt(n))}}function Fl(){Hl(),Rl();var e=(mediaUpload?mediaUpload.getAttachesCount():0)<2;["photo_device","photo","video","audio","doc"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)}))}function Hl(){var e=Object(r.ge)("nc_submit");e&&Object(r.toggleClass)("RepliesField__action_send_active",e,Ul())}function Ul(){var e=(Object(r.ge)("reply_field_text")||{}).value;return trim(e)||mediaUpload&&mediaUpload.getAttachesCount()}function Vl(e){var t=[];return e.forEach((function(e){var n;t.push({class:"ModalMenuUserList__item",href:(n={href:e[2],image:e[1],name:e[3],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}).href,onclick:n.onclick?n.onclick:null,inner:[{tag:"img",class:"ModalMenuUserList__itemAvatar",src:n.image},{class:"ModalMenuUserList__itemName",inner:n.name}]})})),Dl({users:t})}var $l,Wl,ql=!1,zl=!1,Yl={};function Ql(){ql=!1,clearTimeout($l),Snackbar.close(Wl),Jl()}function Gl(){return Yl[""+window.cur.replyTo]}function Kl(e){Yl[""+window.cur.replyTo]=e,Object(r.val)("field_timestamp",e)}function Xl(e){if(ql){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],a=Gl();ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:a})}Ql()}function Jl(){var e=$("#nc_submit"),t=($(".RepliesField__field"),$(".RepliesField__action_cancel")),n=$(".RepliesField__action_attach"),i=$(".RepliesField__action_smile");n&&n.classList.remove("RepliesField__action_disabled"),i&&i.classList.remove("RepliesField__action_disabled"),Object(r.remove)(t),Object(r.show)(e)}function Zl(){var e=$("#nc_submit");Kl(Gl()),nav.go(e,event),Kl(0)}nav.onBeforeGo((function(e,t){var n=location.pathname.substr(1,4);isString(e)&&e.substr(1,4)!==n&&"wall"===n&&(Yl={})})),window.page&&page.onChange((function(e,t){Ql()}));n("8k8e");function ec(){Object(M.$$)(".WallSearchBtn__wrapper").forEach((function(e){var t=e.querySelector(".Slider__scroll"),n=null==t?void 0:t.getBoundingClientRect(),i=e.querySelector(".Slider__line"),a=null==i?void 0:i.getBoundingClientRect(),r=e.querySelector(".WallSearchBtn");(null==n?void 0:n.width)<(null==a?void 0:a.width)?null==r||r.classList.add("WallSearchBtn--divided"):(null==r?void 0:r.classList.contains("WallSearchBtn--divided"))&&(null==r||r.classList.remove("WallSearchBtn--divided"))}))}window.PostDraftReminder={openContextMenu:function(e,t,n){var i=window.lang;e.preventDefault(),e.stopPropagation();var a=Wd.html([Object(le.ContextMenuItem)({title:i.mobile_wall_draft_delete,href:n.remove_url,ref:"wall_draft_reminder"})]),r=Wd.elem(Object(le.ContextMenu)({list:a}));r.parentNode.id="post_draft_reminder_container",le.ContextMenu.open(r,"#post_draft_reminder_container",{appendToBody:!0})}},onDOMReady((function(){ec(),Object(r.onBodyResize)(ec)})),page.onChange(ec),window.WallSearch={onSearch:function(e,t){e.preventDefault(),statlogsValueEvent("mvk_wall_search_button"),nav.go(t)},checkOverflow:ec};var tc=n("6Mr/");window.TextliveFeedBanner={close:function(e){return function(){var e=window.lang;if(!Object(tc.canShow)("feed:textlive_hide"))return;var t=Object(M.$)(".BottomMenu__cell:nth-child(4) .BottomMenu__icon"),n=Wd.elem(Object(tc.default)({pos:"top_right",theme:"accent",inner:e.mobile_textlive_notifications_tooltip,onboarding:!0,"tooltip-id":"feed:textlive_hide"}));t.appendChild(n)}(),ajax.click(e,window.Comment)},restore:function(e){return ajax.click(e,window.Comment)},onTextliveOpen:function(){Object(r.statlogsValueEvent)("textlive_banner_action",null,"open")}};n("ionu");var nc=n("VzJG");window.MainMenu={showMenuItems:nc.showMenuItems},Router.getRouter().addRoute(/^\/menu([\?#].*)?$/,nc.rebuildNotifications);window.PostAttachVideoLink={},PostAttachVideoLink._onInit=cc,PostAttachVideoLink._onPlayClick=dc,PostAttachVideoLink._onReplayClick=dc,PostAttachVideoLink._onSoundClick=uc,PostAttachVideoLink._onVideoClick=_c,PostAttachVideoLink._onVideoPlay=function(e){return fc(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return fc(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return fc(e.target,"end")};var ic="PostAttachVideoLink_muted",ac=function(e){return"PostAttachVideoLink_state_"+e},rc=".PostAttachVideoLink",oc=".PostAttachVideoLink__video",sc=window.MutationObserver,lc=null;function cc(){sc&&!lc&&(lc=new sc(pc)).observe(document.body,{childList:!0,subtree:!0})}function uc(e){var t=e.closest(rc),n=Object(M.$)(oc,t);n.muted=!n.muted,t.classList.toggle(ic,n.muted)}function dc(e){var t=e.closest(rc);Object(M.$)(oc,t).play()}function _c(e){e.paused||e.pause()}function fc(e,t){var n=e.closest(rc);n.classList.remove(ac("play")),n.classList.remove(ac("pause")),n.classList.remove(ac("end")),n.classList.add(ac(t))}function pc(e){e.forEach((function(e){e.removedNodes.forEach((function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&Object(M.$$)(oc,e).forEach((function(e){e.src="",e.load()}))}))})),Object(M.$)(oc)||(lc.disconnect(),lc=null)}var hc,mc,vc,gc,Ac;n("bRFj"),n("eyw1");window.FeedAssistanceStats=((hc={register:nu,forceRegister:function(e,t){e[bc]=au(e),e[wc]=t,Fc.push(e)},onScroll:throttle(ou,50),onStartViewElement:Object(u.default)("element"),onEndViewElement:Object(u.default)("element"),onStopTrackElement:Object(u.default)("element"),onViewedElement:Object(u.default)("element"),onBeforePageChange:uu,onPageChanged:du,getElementType:au,registerElements:eu,registerTrackingCls:function(e){Xc.push(e)},unregisterTrackingCls:Zc}).unregisterTrackingCls=Zc,hc.setParenViewableX=function(e,t){e._feedAssistanceStatsParentViewableX=t},hc.forceProcessTrack=iu,hc.dispatchElementEvent=function(e,t){var n=function(e){return Lc[e]}(Lu(t[bc]||au(t),e));pu({type:e,data:n(t)})},hc.dispatchEvent=function(e){pu(e)},hc.serializeEventData=ru,hc.clearElemsCache=function(){Fc.forEach((function(e){e[Cc]=!1,e[Ec]=!1}))},hc._debug=function(){return{started:Hc,tracking:Fc,events:Kc,blindTop:Vc,blindBottom:$c}},hc.getFromRef=Wu,hc.getRoot=qu,hc.BLOCKS={},hc.EVENTS={},hc);var bc="_feedAssistanceStatsType",yc="_feedAssistanceStatsIdled",wc="_feedAssistanceStatsModule",Oc="_feedAssistanceStatsStarted",Sc="_feedAssistanceStatsProcessed",kc="_feedAssistanceStatsEventTs",Cc="_feedAssistanceStatsCachedY",Ec="_feedAssistanceStatsCachedX",jc="_feedAssistanceStatsLeft",Tc="_feedAssistanceStatsHeight",Ic="_feedAssistanceStatsWidth",Mc="_feedAssistanceStatsTop",Dc="_feedAssistanceStatsBottom",Pc=((mc={}).BLOCK_TYPE_RECOMMENDED_SLIDER="view_block",mc.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER="view_block",mc.BLOCK_TYPE_PROMO_BUTTON="view_block",mc.BLOCK_TYPE_EXPLORE_BAIT="explore_bait",mc.BLOCK_TYPE_PROFILE_PHOTO="feed_assistance",mc.BLOCK_TYPE_IMPORT_CONTACTS="feed_assistance",mc.BLOCK_TYPE_PUSH_SWITCH="feed_assistance",mc),xc=((vc={}).BLOCK_TYPE_RECOMMENDED_SLIDER=500,vc.BLOCK_TYPE_EXPLORE_BAIT=500,vc.BLOCK_TYPE_PROFILE_PHOTO=500,vc.BLOCK_TYPE_IMPORT_CONTACTS=500,vc.BLOCK_TYPE_PUSH_SWITCH=500,vc),Lc=((gc={})[Lu("BLOCK_TYPE_RECOMMENDED_SLIDER","view_block")]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code");return ru("view_block","",e,domData(t,"ref"),n)},gc[Lu("BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER","view_block")]=function(e){var t=e.querySelector(".Slider__scroll");return ru("view_block","",e,"",domData(t,"code"))},gc[Lu("BLOCK_TYPE_PROMO_BUTTON","view_block")]=function(e){return ru("view_block",geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button",e)},gc[Lu("BLOCK_TYPE_EXPLORE_BAIT","explore_bait")]=function(){return ru("SUB_EXPLORE_BAIT","view")},gc[Lu("BLOCK_TYPE_PROFILE_PHOTO","feed_assistance")]=function(e){return ru("feed_assistance",e,"m_ph","seen")},gc[Lu("BLOCK_TYPE_IMPORT_CONTACTS","feed_assistance")]=function(e){return ru("feed_assistance",e,"m_mp","seen")},gc[Lu("BLOCK_TYPE_PUSH_SWITCH","feed_assistance")]=function(e){return ru("feed_assistance",e,"m_push_switch","seen")},gc),Bc=((Ac={}).view_block=function(e,t,n,i){return n=n||Wu(t),[e,domChildIndex(t),zu(t),n,i].join("|")},Ac.SUB_EXPLORE_BAIT=function(e){return e},Ac.feed_assistance=function(e,t,n){return[t,n,Wu(e)].join("|")},Ac.hide=function(e,t){return[e,zu(t),domChildIndex(t),Wu(t)].join("|")},Ac.SUB_PROMO_BUTTON=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},Ac),Rc="feedAssistanceStat.events",Nc="feedAssistanceStat.idled",Fc=[],Hc=[],Uc=Date.now(),Vc=0,$c=0,Wc=!1,qc=null,zc=null,Yc=null,Qc=null,Gc=null,Kc=[],Xc=[],Jc=!1;function Zc(e){Fu(Xc,e)}function eu(){var e=[];each(Xc,(function(){e=e.concat(geByClass(this))})),each(e,(function(){nu(this,"feed")}))}function tu(){eu();var e=Mu();e.length&&(Eu(e),Du()),iu(),bu()}function nu(e,t){!e[bc]&&function(e){return!~Fc.indexOf(e)}(e)&&(e[bc]=au(e),e[wc]=t,Fc.push(e))}function iu(){_u(scrollGetY(),getCh())}function au(e){return e[bc]?e[bc]:hasClass("feedAssistance_recommendedFriends",e)?"BLOCK_TYPE_RECOMMENDED_SLIDER":e.classList.contains("feedAssistance_recommendedGroups")?"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER":hasClass("post_exploreBait",e)?"BLOCK_TYPE_EXPLORE_BAIT":hasClass("feedAssistance_profilePhoto",e)?"BLOCK_TYPE_PROFILE_PHOTO":hasClass("feedAssistance_promoButton",e)?"BLOCK_TYPE_PROMO_BUTTON":hasClass("feedAssistance_importContacts",e)?"BLOCK_TYPE_IMPORT_CONTACTS":hasClass("feedAssistance_pushNotificationsSwitch",e)?"BLOCK_TYPE_PUSH_SWITCH":"BLOCK_TYPE_DEFAULT"}function ru(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Bc[e].apply(Bc,n)}function ou(e,t){var n,i=ou;_u(e||scrollGetY(),t||getCh()),Wc||Jc?(clearTimeout(i.timer),i.timer=setTimeout(su,150),Jc=!1):(Wc=!0,Au(),n=ge("vk_head"),Vc=n&&n.offsetHeight,$c=0)}function su(){Au(),gu(),Wc=!1}function lu(){Au(),$u(Hc),Eu(Kc.concat(xu(Hc))),Uu(Hc),Kc=[],Hc=[],yu()}function cu(){Hc.forEach((function(e){e[Oc]=Date.now()})),ju(null),Tu(null),gu(),yu(),bu()}function uu(){Au(),$u(Hc),Kc=Kc.concat(xu(Hc)),Uu(Hc),Hc=[],Jc=!0,gu()}function du(){eu(),iu()}function _u(e,t){var n=[];Fc.forEach((function(i){Nu(i)?n.push(i):!function(e,t,n){return!e[Oc]&&mu(e,.5,t,n)&&vu(e,.5)}(i,e,t)?!function(e,t,n){return e[Oc]&&(!mu(e,.25,t,n)||!vu(e,.25))}(i,e,t)?hu(i)&&(fu(i),FeedAssistanceStats.onViewedElement(i)):(i[yc]?delete i[yc]:(fu(i),FeedAssistanceStats.onEndViewElement(i)),delete i[Oc]):(i[Oc]=Date.now(),Hc.push(i),FeedAssistanceStats.onStartViewElement(i))})),n.forEach((function(e){Fu(Fc,e),FeedAssistanceStats.onStopTrackElement(e)}))}function fu(e){Fu(Hc,e),Vu(e),pu(Ru(e)),Hu(e)}function pu(e){e&&Kc.push(e)}function hu(e){return!!e[Oc]&&Math.min(3e5,Date.now()-e[Oc])>function(e){var t=au(e);return xc[t]||500}(e)}function mu(e,t,n,i){if(!e)return!1;e[Cc]||(e[Cc]=!0,e[Tc]=e.offsetHeight,e[Mc]=n+e.getBoundingClientRect().top,e[Dc]=e[Mc]+e[Tc]);var a=i-Vc-$c,r=n+Vc,o=n+i-$c,s=e[Tc],l=e[Mc],c=e[Dc];return(c>r&&l<o?Math.min(o,c)-Math.max(r,l):0)>=Math.min(a*t,s*t)}function vu(e,t){var n=e._feedAssistanceStatsParentViewableX;n&&!n[Ec]&&~Fc.indexOf(n)&&(n[Ec]=!0,n[Ic]=n.clientWidth,n[jc]=n.getBoundingClientRect().left+n.clientLeft),e[Ec]||(e[Ec]=!0,e[Ic]=e.offsetWidth);var i=n?n[Ic]||n.clientWidth:getCw(),a=n?n[jc]||n.getBoundingClientRect().left+0:0,r=i+a,o=e[Ic],s=e.getBoundingClientRect().left,l=o+s,c=o*t,u=o*Math.max(0,1-t);return s+c>=a&&l-u<=r}function gu(){qc=setTimeout(wu,2500),zc=setTimeout(Ou,1e4),Yc=setTimeout(Su,6e3),Qc=setTimeout(ku,2e4)}function Au(){clearTimeout(qc),clearTimeout(zc),clearTimeout(Yc),clearTimeout(Qc)}function bu(){Gc=setInterval(Cu,3e4)}function yu(){clearInterval(Gc)}function wu(){Kc.length&&ju(Kc)}function Ou(){Eu(Kc),Kc=[],ju(null)}function Su(){Hc.length&&(Tu(xu(Hc)),Yc=setTimeout(Su,5e3))}function ku(){clearTimeout(Yc),$u(Hc),Eu(xu(Hc)),Uu(Hc),Hc.forEach((function(e){e[yc]=!0})),Hc=[],Tu(null)}function Cu(){Kc.length>=100&&Ou()}function Eu(e){if(e&&e.length){var t={act:"assistance_stats"};t=extend(t,(n={},each(e,(function(){n[this.type]?n[this.type].push(this.data):n[this.type]=[this.data]})),n)),ajax.post("/feed",t)}var n}function ju(e){Iu(Rc,e)}function Tu(e){Iu(Nc,e)}function Iu(e,t){var n=lsGet(e)||{};t?n[Uc]=t:delete n[Uc],lsSet(e,n)}function Mu(){var e=Mu,t=[],n=lsGet(Rc)||{},i=lsGet(Nc)||{};return e.iterator||(e.iterator=function(e){return function(n){Pu(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function Du(){var e=Du,t=lsGet(Rc)||{},n=lsGet(Nc)||{};e.iterator||(e.iterator=function(e){return function(t){Pu(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(Rc,t),lsSet(Nc,n)}function Pu(e){var t=Number(e);return t!==Uc&&Date.now()-t>=36e4}function xu(e){var t=[];return e.forEach((function(e){var n=Ru(e);n&&t.push(n)})),t}function Lu(e,t){return e+"_"+t}function Bu(e,t){return(0,Lc[Lu(e[bc],t)])(e)}function Ru(e){if(Nu(e))return null;if(!hu(e))return null;var t=function(e){return Pc[e[bc]]}(e);return{type:t,data:Bu(e,t)}}function Nu(e){return e[Sc]||!document.body.contains(e)}function Fu(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function Hu(e){Nu(e)||hu(e)&&(e[Sc]=!0)}function Uu(e){each(e,(function(){Hu(this)}))}function Vu(e){e[kc]=Date.now()}function $u(e){e.forEach(Vu)}function Wu(e){return(e=qu(e))&&domData(e,"from-ref")||"feed_other"}function qu(e){return hasClass(e,"feedAssistance")||(e=domCA(e,".feedAssistance")),e}function zu(e){var t=(new Date).getTime();return e&&(e[kc]||e[Oc])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:"BLOCK_TYPE_RECOMMENDED_SLIDER",BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER:"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER",BLOCK_TYPE_EXPLORE_BAIT:"BLOCK_TYPE_EXPLORE_BAIT",BLOCK_TYPE_PROFILE_PHOTO:"BLOCK_TYPE_PROFILE_PHOTO",BLOCK_TYPE_PROMO_BUTTON:"BLOCK_TYPE_PROMO_BUTTON",BLOCK_TYPE_IMPORT_CONTACTS:"BLOCK_TYPE_IMPORT_CONTACTS"},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:"explore_bait",EVENT_EXPLORE_BAIT_SUB:"SUB_EXPLORE_BAIT",EVENT_FEED_ASSISTANCE:"feed_assistance",SUB_EVENT_EXPLORE_BAIT_VIEW:"view",SUB_EVENT_EXPLORE_BAIT_LIKE:"like",SUB_EVENT_EXPLORE_BAIT_COMMENT:"comment",SUB_EVENT_EXPLORE_BAIT_OPENED:"opened",SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:"subscribe",SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:"unsubscribe",SUB_EVENT_EXPLORE_BAIT_OPEN_USER:"open_user",SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:"open_group",SUB_EVENT_EXPLORE_BAIT_HIDE:"hide",SUB_EVENT_EXPLORE_BAIT_REPORT:"report",SUB_EVENT_SEEN:"seen",SUB_EVENT_FILLED:"filled",EVENT_HIDE_BLOCK:"hide",SUB_EVENT_ENABLE_PUSH:"enable_push",SUB_EVENT_DECLINE_PUSH:"decline_push",EVENT_PROMO_BUTTON:"promo_button",EVENT_PROMO_BUTTON_SUB:"SUB_PROMO_BUTTON",SUB_EVENT_PROMO_BUTTON_CLICK:"clicked"},addEvent(window,"blur",lu),addEvent(window,"focus",cu),onDOMReady((function(){setTimeout(tu,500)})),addEvent(window,"scroll",(function(){ou(scrollGetY(),getCh())}),{passive:!0}),nav.onBeforeGo((function(){return uu()})),page.onChange((function(){return du()}));n("yuVR");function Yu(e){return Object.keys(e).map((function(t){return t+":"+e[t]+";"})).join("")}function Qu(e){return e+"-"+Date.now()+"-"+Math.round(999999*Math.random())}var Gu=[];function Ku(e){Gu.push(e),Xu()}var Xu=Object(r.debounce)((function(){var e=Gu.map((function(e){return Object(M.$)("#"+e)})).filter((function(e){return e})).map((function(e){var t=Math.round(e.getBoundingClientRect().left),n="skeleton-gradient-slide-"+t;return function(e,t){if(Zu[e])return;var n=function(e,t){return["@"+Ju()+"keyframes "+e+" {",t.map((function(e,n){return["\t"+n/(t.length-1)*100+"% {",Object.keys(e).map((function(t){return"\t\t"+t+": "+e[t]+";"})).join("\n"),"\t}"].join("\n")})).join("\n"),"}"].join("\n")}(e,t);Zu[e]=n,ed.appendChild(document.createTextNode(n))}(n,[{"background-position-x":-600-t+"px"},{"background-position-x":window.innerWidth-t+"px"}]),{el:e,prop:n+" 1.2s infinite cubic-bezier(0.4, 0.0, 0.2, 1)"}}));requestAnimationFrame((function(){e.forEach((function(e){var t=e.el,n=e.prop;t.style[Ju()+"animation"]=n})),Gu=[]}))}),100);function Ju(){var e="";document&&(e=null!=(document.documentElement||document.createElement("div")).style.animation?"":"-webkit-");return e}var Zu={},ed=document.createElement("style");function td(e){void 0===e&&(e={});var t=Qu("skeleton-circle"),n=Yu({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",c.default.class("SkeletonCircle",{header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return Ku(t),{id:t,class:i,style:n,tag:"div"}}document.head.appendChild(ed);function nd(e){void 0===e&&(e={});var t=Qu("skeleton-line"),n=Yu({})+(e.style||""),i=["SkeletonComponent__item",c.default.class("SkeletonLine",{small:e.small,header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return Ku(t),{id:t,class:i,style:n,tag:"div"}}function id(e){void 0===e&&(e={});var t=[c.default.class("SkeletonRow",{justifyContent:e.justify,alignItems:e.align},"--"),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function ad(e){void 0===e&&(e={});var t=[c.default.class("SkeletonCol",{auto:e.auto,grow:e.grow,flexColumn:e.flexColumn},"--"),e.class].filter((function(e){return e})).join(" ");return{inner:[e.inner],class:t,tag:"div"}}function rd(e){void 0===e&&(e={});var t=[c.default.class("SkeletonOffset",{small:e.small},"--"),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function od(e){void 0===e&&(e={});var t,n,i=Yu({opacity:e.opacity});return{inner:[id({inner:[ad({inner:[td({size:(t={s:32,modern:40,l:48},n=null,Object(r.getCw)()<=270&&null!=t.xs&&(n=t.xs),Object(r.getCw)()<=319&&null!=t.s&&(n=t.s),Object(r.getCw)()>=320&&null!=t.modern&&(n=t.modern),Object(r.getCw)()>=400&&null!=t.l&&(n=t.l),Object(r.getCw)()>=480&&null!=t.xl&&(n=t.xl),Object(r.getCw)()<=881&&null!=t.mobile&&(n=t.mobile),Object(r.getCw)()>=882&&null!=t.xxl&&(n=t.xxl),Object(r.getCw)()>=882&&null!=t.desktop&&(n=t.desktop),n),style:i})],auto:!0}),ad({inner:[id({inner:[ad({inner:[nd({style:i})],grow:3}),ad({grow:4})]}),id({inner:[ad({inner:[nd({small:!0,style:i})]}),ad({grow:3})]})],flexColumn:!0})]}),rd(),id({inner:[ad({inner:[nd({style:i})],grow:4}),ad({inner:[nd({style:i})],grow:3})]}),rd(),id({inner:[ad({inner:[nd({style:i})],grow:4}),ad({grow:1})]}),rd(),id({inner:[ad({inner:[nd({style:i})],grow:4}),ad({grow:3})]}),rd(),rd(),id({inner:[ad({inner:[td({size:24,style:i})],auto:!0}),rd(),ad({inner:[td({size:24,style:i})],auto:!0}),rd(),ad({inner:[td({size:24,style:i})],auto:!0}),ad({grow:1}),ad({inner:[td({size:24,style:i})],auto:!0})]})],class:"SkeletonWallBlock Post__rowPadding",tag:"div"}}function sd(e){void 0===e&&(e={});var t=Qu("skeleton-search"),n=Yu({})+(e.style||""),i=["SkeletonComponent__item",c.default.class("SkeletonSearch",{small:e.small,header:e.header},"--"),e.class].filter((function(e){return e})).join(" ");return Ku(t),{id:t,class:i,style:n,tag:"div"}}function ld(e){return{inner:[id({inner:[ad({inner:[id({inner:[ad({inner:[sd({header:!0})]}),rd({small:!0}),ad({inner:[td({class:"SkeletonSearchHeader__icon",header:!0,size:28})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonSearchHeader",tag:"div"}}function cd(e){for(var t=Math.ceil((window.innerHeight-56)/210),n=[],i=0;i<t;i++)n.push(od());return{inner:[ld(),Object(xs.Separator)(),n],class:"SkeletonComponent__page SkeletonRecommended Skeleton",tag:"div"}}function ud(e){void 0===e&&(e={});var t=Yu({opacity:e.opacity});return{inner:[id({inner:[ad({inner:[td({size:50,style:t})],auto:!0}),ad({inner:[id({inner:[ad({inner:[nd({style:t})],grow:3}),ad({grow:4}),ad({inner:[nd({style:t})]})],justify:"center"}),id({inner:[ad({inner:[nd({style:t})]}),ad({inner:[nd({style:t})],grow:5}),ad({grow:3,style:t})]})],flexColumn:!0})]})],class:"SkeletonChatBlock Post__rowPadding",tag:"div"}}function dd(e){void 0===e&&(e={});var t={};e.hideIcon&&(t.visibility="hidden");var n=Yu(t);return{inner:[id({inner:[ad({inner:[id({inner:[ad({inner:[nd({header:!0})],grow:5}),ad({grow:5}),ad({inner:[td({class:"SkeletonHeader__icon",header:!0,size:28,style:n})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonHeader Post__rowPadding",tag:"div"}}function _d(e){return{inner:[sd()],class:"SkeletonSearchBlock Post__rowPadding",tag:"div"}}function fd(e){for(var t=Math.ceil((window.innerHeight-56)/70),n=[],i=0;i<t;i++)n.push(ud());return{inner:[dd(),_d(),n],class:"SkeletonComponent__page SkeletonMessages Skeleton",tag:"div"}}function pd(e){void 0===e&&(e={});var t=Yu({opacity:e.opacity});return{inner:[td({class:"SkeletonStory__avatar",size:56,style:t}),id({inner:[rd({small:!0}),ad({inner:[nd({small:!0,style:t})]}),rd({small:!0})]})],class:"SkeletonStory",tag:"div"}}function hd(e){void 0===e&&(e={});for(var t=Math.ceil(window.innerWidth/76),n=[],i=0;i<t;i++)n.push(ad({inner:[pd()],auto:!0}));return{inner:[id({inner:[n]})],class:"SkeletonStoriesBlock Post__rowPadding",tag:"div"}}function md(e){return{inner:[id({inner:[ad({inner:[td({size:40})],auto:!0}),ad({inner:[sd()]})],justify:"center"})],class:"SkeletonNewPostBlock Post__rowPadding",tag:"div"}}function vd(e){for(var t=Math.ceil((window.innerHeight-56-180)/210),n=[],i=0;i<t;i++)n.push(od());return{inner:[dd({hideIcon:!0}),md(),hd(),n],class:"SkeletonComponent__page SkeletonFeed Skeleton",tag:"div"}}function gd(e){void 0===e&&(e={});var t=Qu("skeleton-line"),n=Yu({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",c.default.class("SkeletonSquare",{},"--"),e.class].filter((function(e){return e})).join(" ");return Ku(t),{id:t,class:i,style:n,tag:"div"}}function Ad(e){return{inner:[id({inner:[ad({inner:[td({size:48}),td({size:20,class:"SkeletonNotificationBlock__badge"})],auto:!0,class:"SkeletonNotificationBlock__avatar"}),ad({inner:[rd({small:!0}),id({inner:[ad({inner:[nd()]})]}),id({inner:[ad({inner:[nd()],grow:2}),ad()]}),id({inner:[ad({inner:[nd({small:!0})]}),ad({grow:5})]})],grow:6}),ad(),ad({inner:[gd({size:48})],auto:!0})],align:"flex-start"}),rd(),rd(),id({inner:[ad({inner:[td({size:48})],auto:!0}),ad({inner:[rd({small:!0}),id({inner:[ad({inner:[nd()]})]}),id({inner:[ad({inner:[nd({small:!0})]}),ad({grow:5})]}),rd()],grow:4}),ad({inner:[rd()]})],align:"flex-start"})],class:"SkeletonNotificationBlock Post__rowPadding",tag:"div"}}function bd(e){for(var t=Math.ceil((window.innerHeight-56)/170),n=[],i=0;i<t;i++)n.push(Ad());return{inner:[dd({hideIcon:!0}),Object(xs.Separator)(),{inner:[id({inner:[ad({inner:[nd()],grow:3}),ad({grow:2}),ad({inner:[nd()],grow:2})]})],class:"SkeletonNotifications__info Post__rowPadding",tag:"div"},n],class:"SkeletonComponent__page SkeletonNotifications Skeleton",tag:"div"}}var yd=n("UY6c"),wd=function(){var e,t=Math.max(window.innerHeight,window.innerWidth),n=["feed","recommend","messages","notification","menu"],i="",a={},o=((e={}).feed=0,e.recommend=0,e.messages=0,e.notification=0,e.menu=0,e);function s(e){var t=geBySel1('[data-tabbar="'+e+'"]');return attr(t,"data-default")}function l(e){each(geBySel("[data-tabbar]"),(function(t,n){var i=geByClass1("_BottomMenu__icon_js",n),a=geByClass1("BottomMenu__counter",i),r=attr(n,"data-counter"),o=attr(n,"data-tabbar");e({i:t,tabId:o,counter:r,$link:n,$icon:i,$counter:a})}))}function c(){l((function(e){var t=e.$counter,n=e.$icon,i=(e.$link,e.tabId),a=o[i],r=n.outerHTML.includes("Tooltip");if(a&&0!==a||r)if(t&&!r)val(t,a);else{var s,l=ceFromString(n.outerHTML),c=ce("div",{className:"BottomMenu__counter",innerHTML:a});if(r)val(n,null==(s=$(".Tooltip",l))?void 0:s.outerHTML);a&&append(c,n)}else val(n,"")}))}function u(e){setTimeout((function(){d()}),0);var t=Wd.html({class:"pcont bl_cont",inner:{id:"al_loading",class:"BottomMenu__preloader"}});val(geByClass1("mcont",e),t)}function d(){var e=$(".BottomMenu__updateButton");remove(e)}return{setCurrentId:function(e){i=e},setHistory:function(e){a=extend({},e)},setCounter:function(e,t){o[e]=t?parseInt(t,10):0,c()},getCurrentId:function(){return i},getDefaultURL:s,getTabCounter:function(e){return o[e]?o[e]:0},drawUI:function(){l((function(e){var t=e.$icon,n=e.$link,r=e.tabId,o=a[r];if(o){var l=o.filter((function(e){return!0===e.current}))||[];l.length&&"messages"!==r&&attr(n,"href",l[0].a);var c=attr(n,"href");r!==i||!l.length||l[0].a!==c&&l[0].d!==c||attr(n,"href",s(r))}toggleClass("BottomMenu__icon_active",t,r===i)})),c()},drawUICounters:c,drawLoader:u,drawSkeletonLoader:function(e,t){if(hasClass(document.querySelector(".vk"),"vk_flex_yes"))switch(setTimeout((function(){d()}),0),t){case"feed":$(".mcont",e).innerHTML=Wd.html(vd());break;case"messages":$(".mcont",e).innerHTML=Wd.html(fd());break;case"notification":$(".mcont",e).innerHTML=Wd.html(bd());break;case"recommend":$(".mcont",e).innerHTML=Wd.html(cd());break;case"menu":default:u(e)}else u(e)},showUpdateButton:function(e){var t=window.lang,n=Wd.html({class:"BottomMenu__updateButton",inner:{class:"BottomMenu__updateButton_container",inner:{class:"BottomMenu__updateButton_wrap",onclick:["nav.updateCurrentPage"],inner:[{class:"BottomMenu__updateButton_icon",inner:Object(T.default)(Object(yd.getUpUpdate16Icon)())},{class:"BottomMenu__updateButton_text",inner:t.mobile_menu_refresh_button}]}}}),i=hasClass("vk_custom_scroll",geByTag1("body")),a=e.$(i?".basis":".upanel");a.$(".BottomMenu__updateButton")||a.insertBefore(ceFromString(n),a.firstChild)},removeUpdateButton:d,onFocusIn:function(e){var t=geBySel1(".BottomMenu"),n=e&&e.target;if(n&&t&&browser.android){var i=!1;"textarea"===n.tagName.toLowerCase()&&(i=!0),"input"!==n.tagName.toLowerCase()||["checkbox","radio"].includes(n.type)||(i=!0),"select"===n.tagName.toLowerCase()&&(i=!0),i&&t.classList.add("vk_tabbar_hidden")}},onFocusOut:function(){var e=geBySel1(".BottomMenu");e&&e.classList.remove("vk_tabbar_hidden")},onResize:function(){var e=window.bodyNode;$(".Skeleton")&&($(".mcont").innerHTML='<div class="pcont bl_cont"><div id="al_loading"></div></div>',Object(r.alLoadingFix)()),e&&e.classList.contains("vk_tabbar_bottom")&&0===Math.abs(window.orientation)&&t-180>window.innerHeight?e.classList.add("vk_tabbar_hidden"):e&&e.classList.remove("vk_tabbar_hidden")},setDefaultCounters:function(){l((function(e){var t=e.tabId,n=e.counter;o[t]=n?parseInt(n,10):0})),c()},TAB_ID_FEED:"feed",TAB_ID_RECOMMEND:"recommend",TAB_ID_MESSAGES:"messages",TAB_ID_NOTIFICATION:"notification",TAB_ID_MENU:"menu",TAB_IDS:n}}();window.Tabbar=wd;var Od=wd;window.page&&page.onRestore(wd.drawUI),window.page&&page.onChange(wd.drawUI),onDOMReady((function(){var e;wd.setDefaultCounters(),addEvent(window,"resize",(function(){wd.onResize(),clearTimeout(e),e=setTimeout((function(){wd.onResize()}),300)}))}));var Sd=!1;page.onChange(jd),photoview.onHide(jd),photoview.onShow(Td),o.colorScheme.onInit((function(){Sd||Ed()})),o.colorScheme.subscribe((function(){Sd||Ed()}));var kd,Cd=Object(M.$)('meta[name="theme-color"]');function Ed(){o.colorScheme.isDarkScheme()?Id("#050505"):Id("#ffffff")}function jd(){Sd=!1,Ed()}function Td(){Sd=!0,Id("#050505")}function Id(e){kd||(kd=Object(M.$)("#theme_color_shim")),Cd&&Cd.setAttribute("content",e),kd&&(kd.style.backgroundColor=e)}n("U34x");var Md,Dd,Pd,xd,Ld,Bd=[".basis__header_unauthorized"],Rd=!1;function Nd(){Rd||(Md={vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),headerFirstIcon:geByClass1("GroupCoverIcons__icon--back_outline_28",geByClass1("basis__header")),headerSecondIcon:geByClass1("GroupCoverIcons__icon--back_outline_white_28",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}).cover&&(Rd=!0,addClass(Md.vk,"groupCover-vk_animationYes"),Dd=!C.default.chrome||Number(C.default.version.split(".")[0])>50,Pd="fixed"===getStyle(Md.header,"position"),xd=getH(Md.header),Ld=getH(Md.cover),onBodyScroll(Hd),onBodyResize(Ud),Hd(),window.cur.destroy=window.cur.destroy.filter((function(e){return e!==Fd})),window.cur.destroy.push(Fd))}function Fd(){(!0||menu.opened())&&(removeClass(Md.vk,"groupCover-vk_animationStep"),removeClass(Md.vk,"groupCover-vk_animationYes")),onBodyScroll("__clear",Hd),onBodyResize("__clear",Ud),Rd=!1}function Hd(){var e=scrollTop();if(Pd)if(e<0)setStyle(Md.header,"top",-e),$d(),setStyle(Md.coverDimmer,"opacity",0),setStyle(Md.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(Ld-xd)),i=t&&t.classList.contains("vk_tabbar_top")&&!Md.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle(Md.header,"top",i),setStyle(Md.headerTitle,"display","block"),setStyle(Md.headerFirstIcon,"display","block"),setStyle(Md.headerSecondIcon,"display","block"),n<=.9?($d(),Dd&&setStyle(Md.coverImage,"top",.5*e),setStyle(Md.coverDimmer,"opacity",n/.9),setStyle(Md.headerTitle,"opacity",0),setStyle(Md.headerFirstIcon,"opacity",0),setStyle(Md.headerSecondIcon,"opacity",1)):(setStyle(Md.headerTitle,"opacity",1),setStyle(Md.headerFirstIcon,"opacity",1),setStyle(Md.headerSecondIcon,"opacity",0),Vd())}else Math.min(1,e/Ld)<1?($d(),setStyle(Md.coverDimmer,"opacity",0),Dd&&setStyle(Md.coverImage,"top",.5*e),setStyle(Md.headerTitle,"display","none"),setStyle(Md.headerFirstIcon,"display","none"),setStyle(Md.headerSecondIcon,"display","block")):Vd()}function Ud(){Fd(),Nd()}function Vd(){Bd.map((function(e){return $(e)})).some((function(e){return e}))||removeClass(Md.vk,"groupCover-vk_animationStep")}function $d(){Bd.map((function(e){return $(e)})).some((function(e){return e}))||addClass(Md.vk,"groupCover-vk_animationStep")}onDOMReady((function(){(C.default.chrome||C.default.safari&&C.default.ios>=9)&&(Nd(),page.onChange(Nd),zlayer.onClose((function(){setTimeout(Nd,0)})))}));n("l51W"),n("BLcx"),n("nXjO");var qd,zd,Yd=function(){return Object(r.geByClass1)("tabs_block")},Qd=function(){return Object(r.geByClass1)("tab_item_top")},Gd=!0,Kd=0;function Xd(){zd&&zd(),qd&&qd()}function Jd(e){Object(r.stopEvent)(e),Object(r.preventEvent)(e),Kd=300,Gd&&(Object(r.toggleClass)("TopMenu__switcher_on",Object(r.geByClass1)("TopMenu__switcher")),"touchstart"===e.type&&setTimeout((function(){nav.go(Qd(),null)}),130))}function Zd(e){Object(r.gpeByClass)("tabs_block",e.target)||Object(r.gpeByClass)("mhb_back",e.target)||(Object(r.stopEvent)(e),Object(r.preventEvent)(e),Object(r.removeClass)("TopMenu_open",Yd()),e_(),Xd())}function e_(){Xd(),Object(r.removeEvent)(window,"touchstart mousedown click",Zd)}window.TopMenu={onHeaderClick:function(e){if(!Gd)return;var t=Yd();Object(r.stopEvent)(e),Object(r.preventEvent)(e);var n=Object(r.geByClass1)("mhb_back");if(Object(r.hasClass)("TopMenu_open",t))Object(r.removeClass)("TopMenu_open",t),Xd();else{var i=Qd();Object(r.addClass)("TopMenu_open",t),Object(r.geByClass1)("_hfixed")&&Object(r.setStyle)(t,"max-height",window.innerHeight-70),Object(r.append)(t,n),Object(r.addEvent)(window,"touchstart mousedown click",Zd),Object(r.addEvent)(i,"touchstart mousedown",Jd),Object(r.addEvent)(i,"click",(function(e){Object(r.stopEvent)(e),Object(r.preventEvent)(e)})),zd=Object(s.expandPopup)(Object(r.geByClass1)("al_back")),(qd=Object(s.setMenuNavigation)(t))&&(qd.exitIntent=function(){Object(r.removeClass)("TopMenu_open",t),Xd()}),cur.destroy.push(e_),cur.destroy.push((function(){return Object(r.removeEvent)(i,"touchstart mousedown",Jd)}))}}},nav.onBeforeGo((function(){Gd=!1,setTimeout((function(){Kd=0,Gd=!0,Xd()}),Kd)}));var t_=function(){var e,t,n,i=!1;function a(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function r(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function o(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))a(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),r(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function l(e){e&&"A"===e.target.tagName&&requestAnimationFrame((function(){o()}))}function c(c){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(c),addClass("ai_menu_opened",e),append(t,document.body),(n=Object(s.setFocusTrap)(t))&&(n.exitIntent=function(){u()}),i=u,tooltip.addHandler(i),tooltip.show(e,t),addEvent(window,"resize",o),addEvent(t,"click",l);var d=geByClass1("i_pointer",e),_=a(d);_.isOverflowYContainer&&addEvent(_.cursor,"scroll",o);var f=r(d);f.isOverflowXContainer&&addEvent(f.cursor,"scroll",o),o()}function u(){removeClass("ai_menu_opened",e),append(t,e),tooltip.removeHandler(i),tooltip.hide(),n&&(n(),n=null),removeEvent(window,"resize",o),removeEvent(t,"click",o);var s=geByClass1("i_pointer",e),l=a(s);l.isOverflowYContainer&&removeEvent(l.cursor,"scroll",o);var c=r(s);c.isOverflowXContainer&&removeEvent(c.cursor,"scroll",o)}return{closeMenu:u,toggleMenu:function(t,n){cancelEvent(t),hasClass("ai_menu_opened",e)?u():c(n)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,(function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout((function(){removeClass("unhover",n)}),100)}))}}(),o()}}}();window.ActionMenu=t_;n("zHNa"),n("wCFN");var n_=function(){var e=38,t=40,n=13,i=27,a={},r={},o=!1;function s(){a={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},r={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}s();var l=!0;function c(){l=!1}function d(){var e=val(a.input),t=Math.max(e.lastIndexOf("@"),e.lastIndexOf("*")),n=!1;if(t>-1){var i=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),a=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),a.appendChild(i.cloneContents()),val(a).replace(/\n$/,"").length}return 0}(a.input),o=e.substr(0,i);t=Math.max(o.lastIndexOf("@"),o.lastIndexOf("*"));var s=o.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);s&&"."!==s[2].substr(-1)&&(n=s[2])}!1===n&&delete a.ignoredTerm,void 0!==a.ignoredTerm&&n==a.ignoredTerm&&(n=!1),a.curValue=e,a.curTerm=n,a.curPos=t,r.text=n,!1===a.curTerm?p():(y(!1,a.curTerm),f(),function(){var e=ge("mhead").offsetHeight,t=r.container.getBoundingClientRect(),n=a.input.offsetHeight,i=parseInt(getStyle(r.scroll,"maxHeight"),10),o=!1;o=hasClass("Mention_openToBottom",r.container)?t.top-n-i<e:t.bottom-i<e,getXY(a.input)[1]>=e+i&&(o=!1),toggleClass("Mention_openToBottom",r.container,o),toggleClass("Mention_openToBottom",r.opts.appendTo,o)}())}function _(e){a.input=e}function f(){E(),document.addEventListener("click",h,!0),addClass("MentionContainer_opened",r.opts.appendTo),show(r.container),function(){if(!o){var e=browser.ipad?"touchend":"click";o=!0,addEvent(window,e,p),addEvent(window,"touchmove",c),nav.onBeforeGo(p)}}()}function p(e){!browser.ipad||l?e&&e.target&&gpeByClass("Mention_inited",e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass("MentionContainer_opened",r.opts.appendTo)&&(removeClass("MentionContainer_opened",r.opts.appendTo),hide(r.container),function(){if(o){var e=browser.ipad?"touchend":"click";removeEvent(window,e,p),removeEvent(window,"touchmove",c),nav.onBeforeGo.off(p),o=!1}}()):l=!0}function h(e){var t=e.target;t&&!gpeByClass("Mention_inited",t)&&(e.preventDefault(),e.stopImmediatePropagation(),p()),document.removeEventListener("click",h,!0)}function m(e){void 0===e&&(e={}),r.opts=extend(r.opts,e),v(),y(!0)}function v(){var e,t,n=r.opts.defaultItems,i=r.opts.items,a=[];for(e=0,t=n.length;e<t;++e)a.push(e);for(r.cache[""]=a,e=0,t=i.length;e<t;++e)g(e,i[e])}function g(e,t){var n,i,a,o="",s=r.opts.searchKeys,l={};for(n=0,a=s.length;n<a;++n)o+=" "+(t[s[n]]||"").replace(r.opts.delimeter," ").replace(/<[^>]*>/g,"");for(o+=(parseLat(o)||"")+(parseCyr(o)||""),o=trim(o.toLowerCase()).split(/\s+/),n=0;n<o.length;n++)for(i=1;i<=r.opts.wholeIndex;i++){var c=o[n].substr(0,i);l[c]||(r.index[c]||(r.index[c]=[]),r.index[c].push(e),l[c]=1)}}function A(){var e=trim(r.text);e&&ajax.post(r.opts.url,extend({str:e,mobile:1},r.opts.params||{}),{onDone:function(t){r.cache[e]=b(e).concat(t),w(r.cache[e],!0)}})}function b(e){if(!(e=trim(e.toLowerCase().replace(r.opts.delimeter," "))))return r.cache[""];var t=r.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return r.index[e]||[];var n,i,a=0,o="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var s=e[n].substr(0,t),l=r.index[s];if((!o||!l||l.length<a)&&(a=l?l.length:0,o=s),!a)return[]}var c=[],u=r.opts.searchKeys,d=u.length,_=e.length;for(n=0,i=r.index[o].length;n<i;++n){for(var f=r.index[o][n],p=r.opts.items[f],h=!1,m="",v=0;v<d;++v)m+=" "+(p[u[v]]||"").replace(r.opts.delimeter," ").replace(/<[^>]*>/g,"");m=(m+=(parseLat(m)||"")+(parseCyr(m)||"")).toLowerCase();for(var g=0;g<_;++g)if(-1===m.indexOf(" "+e[g])){h=!0;break}h||c.push(f)}return c}function y(e,t){if(r.cache[""])if(t=void 0!==t?t:trim(r.text),r.lastQ!==t||e){r.lastQ=t,clearTimeout(r.requestTimer);var n=r.cache[t];n?w(n,!0):(w(n=b(t),!r.opts.url),r.opts.url&&(r.requestTimer=setTimeout(A,r.opts.requestWait)))}else f()}function w(e,t){var n=[];r.shown=[];for(var i=e.slice(0,r.opts.maxItems),a=0,o=i.length;a<o;++a){var s=i[a];isArray(s)||(s=r.opts.items[s]),r.shown[s[0]]||(r.shown[s[0]]=s,n.push(O(s)))}r.container&&r.opts.appendTo.contains(r.container)||(r.container=ce("div"),addClass("Mention",r.container),r.scroll=ce("div"),addClass("ScrollView Mention__scroll",r.scroll),Object(Je.setScrollView)(r.scroll,{topBanner:!1}),r.opts.appendTo.appendChild(r.container),r.container.appendChild(r.scroll),addEvent(r.scroll,"touchmove",(function(e){hasClass("Mention_noScroll",r.scroll)&&preventEvent(e)}))),toggleClass("Mention_empty",r.container,!n.length),val(r.scroll,n.join("")),r.scroll.scrollTop=0,k(),setTimeout((function(){toggleClass("Mention_noScroll",r.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(r.scroll.scrollHeight>r.scroll.offsetHeight)return!0;return!1}())}),0)}function O(e){var t=e[0],n=e[1],i=e[2];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                <img src="'+e[3]+'" class="MentionItem__img"/>\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function S(){var e=geByClass1("MentionItem_active",r.container),t=e.offsetTop;r.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(r.scroll,"paddingTop"),10)}function k(e){void 0===e&&(e=null);var t=geByClass("MentionItem",r.container);if(t.length){var n=t.find((function(e){return hasClass("MentionItem_active",e)}));e?(removeClass("MentionItem_active",n),addClass("MentionItem_active",e)):n||addClass("MentionItem_active",t[0])}}function C(e,t){setTimeout((function(){_(t),d()}),0)}var E=Object(u.default)();return{onKeyUp:function(n,i){n.keyCode!==e&&n.keyCode!==t&&(y(!0),_(i),d())},onKeyDown:function(a,o){var s;hasClass("MentionContainer_opened",r.opts.appendTo)&&(a.keyCode===e?(!function(){var e=geByClass1("MentionItem_active",r.container);if(e){var t=domPS(e);t&&(k(t),S())}else k(),S()}(),a.preventDefault()):a.keyCode===t?(!function(){var e=geByClass1("MentionItem_active",r.container);if(e){var t=domNS(e);t&&(k(t),S())}else k(),S()}(),a.preventDefault()):a.keyCode===n?(s=geByClass1("MentionItem_active",r.container))&&(s.click(),1)&&a.preventDefault():a.keyCode===i&&(p(),a.preventDefault()))},onFocus:C,onClick:C,onSelect:function(e){var t=r.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=a.curValue.substr(0,a.curPos),o=a.curValue.substr(a.curPos),s=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);r.opts.preferDomain&&e[9]&&(s=!0);s||(t=replaceEntities(e[8]||e[1]));var l=new RegExp("^(@|\\*)"+escapeRE(a.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");o=o.replace(l,(function(e,i,a){var r=i+n+" ";return s||(r+="("+t.replace(/[\(\)\]\[]/g,"")+") "),r})),s||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(o=" "+o);p(),val(a.input,i+o),elfocus(a.input),r.opts.afterInsert&&r.opts.afterInsert(a.input)}(t),p()},onItemHover:function(e){k(e)},onOpen:E,init:function(e){void 0===e&&(e={}),s(),r.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",r.opts.appendTo),r.scroll&&removeClass("Mention_noScroll",r.scroll),v()},update:m,addItems:function(e){if(r.opts.defaultItems){e=r.opts.defaultItems.concat(e);var t={};e.filter((function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)})),m({defaultItems:e,items:e})}}}}();window.Mention=n_;n("OGWK"),n("ciqL");var i_={cachedProgress:{}},a_={init:function(e,t){return void 0===e&&(e=Object(r.srand)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,i_.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);i_.cachedProgress[e]=t;var r=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",r)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}},r_=(n("tqja"),n("aiw/")),o_=function(){function e(){window.isCustomScroll&&(document.body.classList.contains("vk__page_mail")||Je.restoreDocumentScroll())}return{init:function(){if(window.isCustomScroll&&!document.body.classList.contains("vk__page_mail")){var t=ge("mcont");t&&t.classList.contains("ScrollView")?Je.init():e(),r_.onClose()}},restore:e}}();onDOMReady((function(){o_.init(),page.onChange((function(){o_.init()}))})),window.ContentScrollView=o_;var s_,l_,c_,u_,d_,__,f_,p_=!1,h_=Object(r.scrollTop)(),m_=56,v_=!1,g_=!1,A_=[];function b_(e){void 0===e&&(e=S_());var t=document.body;t&&"fixed"===Object(r.getStyle)(t,"position")||e.classList.remove("basis__header_hidden")}function y_(){var e=Object(r.scrollTop)();if(s_){O_(s_,e);var t,n=Object(r.ge)("mcont");if(n){var i=$(".BottomMenu__updateButton"),a=Math.max(n.scrollHeight,parseInt(Object(r.getStyle)(n,"height"),10));if(g_&&e)return;if(Math.abs(h_-e)<=m_)return;s_.classList.contains("basis__header_nohide")||(e>h_+20&&e>m_?(void 0===(t=s_)&&(t=S_()),t.classList.add("basis__header_hidden"),i&&i.classList.add("BottomMenu__updateButton_offset"),g_=!0,setTimeout((function(){g_=!1}),200)):e+window.innerHeight<a&&(b_(s_),i&&i.classList.remove("BottomMenu__updateButton_offset")))}var o=document.body;o&&"fixed"!==Object(r.getStyle)(o,"position")&&(h_=e)}}function w_(){if(p_&&(clearInterval(d_),Object(r.onBodyScroll)("__clear",l_),removeEvent(window,"touchend",c_),A_.forEach((function(e){removeEvent(e,"blur",c_)})),p_=!1),!p_){s_=S_(),m_=parseInt(Object(r.getStyle)(s_,"height"),10),h_=Object(r.scrollTop)();var e=$(".BottomMenu__updateButton");s_&&(s_.classList.add("basis__header_noTransition"),b_(s_),e&&e.classList.remove("BottomMenu__updateButton_offset")),O_(s_,Object(r.scrollTop)()),l_=function(){v_=!0},c_=function(){clearInterval(u_),u_=setTimeout((function(){var t=Object(r.ge)("mcont");if(t){var n=Math.max(t.scrollHeight,parseInt(Object(r.getStyle)(t,"height"),10));window.innerHeight>n&&n&&(b_(s_),e&&e.classList.remove("BottomMenu__updateButton_offset"))}}),100)},setTimeout((function(){v_=!1}),0),setTimeout((function(){s_&&s_.classList.remove("basis__header_noTransition")}),200),p_||(d_=setInterval((function(){v_&&(y_(),v_=!1)}),250),Object(r.onBodyScroll)(l_),addEvent(window,"touchend",c_,{passive:!0}),(A_=Array.from($$("input, textarea")||[])).forEach((function(e){addEvent(e,"blur",c_)})),p_=!0)}}function O_(e,t){e&&e.classList.contains("basis__header_nohide")||(t<=5&&e&&e.classList.contains("basis__header_noshadow")?e.classList.add("basis__header_noshadowAnim"):e&&e.classList.remove("basis__header_noshadowAnim"))}function S_(){return $(".basis__header")}function k_(){(s_=S_())&&(b_(s_),O_(s_,Object(r.scrollTop)()))}onDOMReady((function(){w_(),window.page.onChange(w_),onBodyResize(k_),addEvent(window,"orientationchange",k_),addEvent(window,"blur",k_)})),__="",f_=function(){var e=__,t=nav.cur;__=t,function(){if(Object(ie.partConfigEnabled)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],a="http"+("https:"==location.protocol?"s":""),r="vkgalv";if(window.vk&&window.vk.countryISO)switch(window.vk.countryISO){case"BY":r="vkgaby";break;case"MD":r="vkgamd";break;case"EE":r="vkgaee"}n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=a+"://"+r+".hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}();var n=e===t?"":e;window.vk.__dev||(function(e,t){for(var n=[new RegExp("(\\/login)(\\?).*$")],i=0;i<n.length;i++)if(e.match(n[i]))return;var a=[[new RegExp("(\\/(?:write|mail|im|al_im.php))(\\?[a-z0-9&=\\-_]*)?$"),"$1"],[new RegExp("(\\/write)(\\d*)(\\?[a-zA-Z0-9&=\\-_]*)?$"),"$1"]],r={referrer:t,url:e};Object(di.each)(r,(function(e){Object(di.each)(a,(function(){r[e]=r[e].replace(this[0],this[1])}))})),t=r.referrer,e=r.url;var o=location.protocol,s=window._tns&&(window._tns.tnsPixelSocdem||"83"),l=t.replace(/\*/g,"%2a").split("#")[0],c=window._tns&&window._tns.tnsPixelType;Object(di.vkImage)().src=o+"//www.tns-counter.ru/V13a**clid:"+s+"*"+l+"*vk_com/ru/UTF-8/tmsec=vksite_total/"+Math.round(1e9*Math.random()),Object(Y.statlogsValueEvent)("counters_check",1),"unauth"===c?Object(di.vkImage)().src=o+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184674/"+Math.round(1e9*Math.random()):"has_rough"===c?Object(di.vkImage)().src=o+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184675/"+Math.round(1e9*Math.random()):"not_has_rough"===c&&(Object(di.vkImage)().src=o+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184677/"+Math.round(1e9*Math.random()))}(location.protocol+"//"+location.host+t,n?location.protocol+"//"+location.host+n:""),Object(Ll.tmrTrackPage)(t,n))},onDOMReady((function(){f_(),window.page.onChange((function(){__!==nav.cur&&f_()}))}));var C_={URL:"special-event",ACT:"getPopup",start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(this.sendStats("click"),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.animationUrl||(this.animationUrl=String(atob(window.domData(e,"animation-url")))||0),this.duration&&this.animationUrl&&(this.hasPopup=Boolean(window.domData(e,"popup")),!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then((function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()}))):this._play())}},_getAnimation:function(){var e=this;return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET",e.animationUrl,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}}))},_showPopup:function(){window.ImageStatus&&window.ImageStatus.open&&window.ImageStatus.open({user_id:vk.id,special_id:this.id})},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!1,autoplay:!0,animationData:this.animationData});0,this.timeoutHandle=setTimeout((function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,e.sendStats("showed"),e._showPopup()}),this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n},sendStats:function(e){e&&Object(Bn.saveStatlogEvents)({name:"special_event",value:e,keys:[this.platform,this.id]})}};C_.init({platform:"mvk",animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.SpecialEvent=C_;var E_={onIframeReady:Object(u.default)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:Object(u.default)(),onAcceptCookieClick:Object(u.default)()};function j_(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&E_.onPostMessage(t.action,t.action_params)}}E_.onIframeReady((function(){addEvent(window,"message",j_),window.cur.destroy.push((function(){removeEvent(window,"message",j_)}))})),window.BasisMoneyTransfer=E_;var T_=E_;T_.onPostMessage((function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()}));T_.onPostMessage((function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)}));var I_=["touchstart","touchend","touchmove","touchcancel"];T_.onIframeReady((function(e){e.is_api&&registeredEvents.forEach((function(e){var t=e[0],n=e[1],i=e[2];I_.indexOf(n)>=0&&removeEvent(t,n,i)}))})),T_.onPostMessage((function(e){"resizeFrame"!==e&&"pageLoad"!==e||window.scrollTop(0)}));var M_,D_,P_,x_="pageMoneyTransfer",L_="pageMoneyTransfer_error";T_.onIframeReady((function(e){R_(),D_={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},F_(),window.cur.destroy.push(H_)})),T_.onPostMessage((function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1(x_));else if("payError"===e)H_(),addClass(L_,geByClass1(x_)),val(geByClass1("pageMoneyTransfer__errorText"),t.descr);else if("session_fail"===e){if(B_)return void N_();H_(),addClass(L_,geByClass1(x_)),addClass("pageMoneyTransfer_errorCookie",geByClass1(x_))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;Object(r.isVkWebView)()&&(Object(r.isIosWebView)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),Object(r.statlogsValueEvent)("money_transfers",0,"iframe_loaded",n)}}));var B_=0;function R_(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(R_,2e3)}function N_(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1(x_).appendChild(t),ge("payment_form").submit()}else setTimeout(N_,2e3)}function F_(){var e=D_,t=e.checkUrl,n=e.onSuccessUrl;M_=setInterval((function(){P_=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(H_(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(H_(),addClass(L_,geByClass1(x_)),val(geByClass1("pageMoneyTransfer__errorText"),t))}})}),2e3)}function H_(){M_&&(clearInterval(M_),M_=null),P_&&(P_.abort(),P_=null)}T_.onAcceptCookieClick((function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout((function(){e.close();var t=geByClass1("pageMoneyTransfer__iframe"),n=clone(t);removeClass(L_,geByClass1(x_)),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),F_()}),500),B_++}));var U_={_onMouseDown:Object(u.default)(),_onCancelClick:Object(u.default)()};window.MoneyTransferButton=U_;var V_=U_;V_._onMouseDown((function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,"-webkit-tap-highlight-color","transparent"),setTimeout((function(){return function(e){setStyle(e,"-webkit-tap-highlight-color","initial")}(t)}),400))}));var $_,W_,q_=!1,z_=null;function Y_(){z_&&Btn.setLoading(z_,!1),$_&&(clearInterval($_),$_=null),W_&&(W_.abort(),W_=null)}V_._onCancelClick((function(e,t){var n,i;t?(q_=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(q_=!0,t=e.$btn,e=null,z_=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},i=n.cancelUrl,$_=setInterval((function(){W_=ajax.post(i,{_ajax:1},{onDone:function(e){if(1===e){if(q_){var t=arguments[1];return z_.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void Y_()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push((function(){window.scrollTop(n)})),Y_()}}})}),1500),window.cur.destroy.push(Y_)}));need("attr"),need("geByClass1");var Q_=need("preventEvent"),G_=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=pf,SendMoneyForm._onSubmit=Af,SendMoneyForm._onRecommAmountChange=hf,SendMoneyForm._onAutoAcceptToggle=bf,SendMoneyForm._onNoAmountToggle=yf,SendMoneyForm._onChooseCardClick=ff,SendMoneyForm._onChooseCardCancelClick=_f,SendMoneyForm._onChooseCardContinueClick=uf,SendMoneyForm._onCardSelect=df;var K_="sendMoneyForm_error_min",X_="sendMoneyForm_error_max",J_="sendMoneyForm_addCardVisible",Z_="sendMoneyForm_requestedVisible",ef="sendMoneyForm_recommErrorMin",tf="sendMoneyForm_recommErrorMax",nf="sendMoneyForm_noAmount",af="sendMoneyForm_autoAccept",rf=".sendMoneyForm",of=".sendMoneyForm__cardsPopup",sf=".sendMoneyForm__input_amount",lf=".sendMoneyForm__recommAmountInput input",cf=".sendMoneyForm__amountNote_requestAmount";function uf(){var e=Object(M.$)('.Control__native[name="card"]:checked').value,t=Object(M.$)('.Control__native[name="card"]:checked ~ .Control__label').innerText;Object(M.$)('input[name="accept_card"]').value=e,Object(M.$)('input[name="accept_card"]').setAttribute("data-value",e),Object(M.$)(".sendMoneyForm__chooseCard").innerText=t,G_.close()}function df(e){var t="-1"===e.value;Object(M.$)(rf).classList.toggle(J_,t)}function _f(){G_.close()}function ff(){var e=Object(M.$)(of);G_.open(e)}function pf(e){e||(e=Object(M.$)('input[name="amount"]')),vf(e),gf(e,6);var t=e.closest(rf),n="1"===t.getAttribute("data-is-chat-request"),i=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(K_),t.classList.remove(X_),n||i>a&&t.classList.add(X_),n){var r=mf(),o=Number(t.getAttribute("data-min-amount"))*(r?2:1),s=function(e,t){var n=Object(M.$)('input[name="amount"]').closest(rf),i=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),r=Number(n.getAttribute("data-chat-members-count")),o=Math.ceil(e/(r-(t?0:1)));return Math.min(a,Math.max(i,o))}(i,r);if(Object(M.$)(lf).value=s,t.classList.remove(tf),t.classList.remove(ef),!o||i>=o){var l=r?i-s:i;Object(M.$)(cf).innerText=l,t.classList.add(Z_)}else t.classList.remove(Z_)}}function hf(e){vf(e),gf(e,6);var t=e.closest(rf),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(tf),t.classList.remove(ef),n>i&&t.classList.add(tf)}function mf(){var e=Object(M.$)('input[name="participiate"]');return e&&e.checked}function vf(e){e.value=parseInt(e.value,10)||""}function gf(e,t){e.value=e.value.slice(0,t)}function Af(e,t){var n=t.$(sf).value,i=Number(n),a=Number(t.getAttribute("data-min-amount")),r=Number(t.getAttribute("data-max-amount")),o="1"===t.getAttribute("data-is-chat-request"),s=!1;(t.classList.remove(K_),t.classList.remove(X_),o&&(t.classList.remove(tf),t.classList.remove(ef)),Object(M.$)(rf).classList.contains(nf))||(i<a*(!!o&&mf()?2:1)||!n||n!==i.toString()?(t.classList.add(K_),s=!0):i>r&&!o&&(t.classList.add(X_),s=!0));if(o){var l=t.$(lf).value,c=Number(l);c<a||!l||l!==c.toString()?(t.classList.add(ef),s=!0):c>r&&(t.classList.add(tf),s=!0)}if(s)Q_(e),stopEvent(e);else{Q_(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var u=Object(M.$)("#submit");ajax.click(u)}}function bf(e){Object(M.$)(rf).classList.toggle(af,e.checked),e.checked?Object(M.$)('input[name="accept_card"]').value=Object(M.$)('input[name="accept_card"]').getAttribute("data-value"):Object(M.$)('input[name="accept_card"]').value=""}function yf(e){Object(M.$)(rf).classList.toggle(nf,e.checked)}window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){var n=arguments,i=this;if(!MoneyLink.qrcode){var a,r,s=o.colorScheme.isDarkScheme();t?(a=geByClass1("snippet__icon",geByClass1(t)),r=s?128:80):(a=ge("money_link_qr"),r=200);var l={isShowLogo:!0};s&&(l.isShowBackground=!0,l.backgroundColor="#fff"),val(a,Vi.a.createQR(e,r,"qr-code",l));var c=o.colorScheme.subscribe((function(){c(),i.genQRCode.apply(i,n)}))}}};var wf=need("Voting"),Of=function(){var e,t,n=[],i=!1,a=!1,r={};function o(e){return function(){if(!i)return e.apply(this,arguments)}}function s(e){return"A"===e.tagName}function l(){a=n.length>0,toggleClass("vk_messages_actions_visible",document.body,a)}function c(){a&&(r={},each(n,(function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))})),i=!1,n=[],l())}function u(){return!!window.getSelection&&window.getSelection().toString().length>0}function d(e,t,a,r){void 0===r&&(r=!1),i=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:r?"spam":"delete",peer:t,hash:a,ids:n.join(","),community:Sf()}})}function _(){return Boolean(e)}function f(){ge("dialogs")&&_()?addClass("vk_dialogs_forwarding",document.body):e="",c()}return page.onChange(f),mail.onShowDialogsPageFromCache(f),mail.onShowDialogFromCache(f),mail.onShowDialogsPageFromCache(b_),mail.onShowDialogFromCache(b_),mail.onMessagesRepainted((function(){each(n,(function(e,t){addClass("mi_selected",geByClass1("_msg"+t))}))})),{onMessageClick:o((function(e){var t=e.target,i=e.currentTarget,a=s(t)||s(t.parentNode);t.closest("."+wf.cls)?e.stopPropagation():(a&&c(),browser.uc_mini||u()||a||setTimeout((function(){var e,t,a;u()||(e=i,t=attr(e,"data-id"),(a=n.indexOf(t))>=0?(n.splice(a,1),removeClass("mi_selected",e),delete r[t]):(n.push(t),addClass("mi_selected",e),r[t]=hasClass("msg_item_important",e)),l(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())}),40))})),remove:o(d),reply:o((function(e,t,a){i=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:a,object:"mail"+n.join(";"),community:Sf()}})})),forward:o((function(a,r){i=!0,lockButton(a),e="mail"+n.join(";"),t=r;var o=Sf(),s=o?"?community="+o:"";nav.go(location.pathname+s,null,{ignore_cur_process:!0})})),spam:o((function(e,t,n){d(e,t,n,!0)})),close:o(c),toggleImportant:o((function(e){var t,i=n.length,a=0;for(t=0;t<i;t++)if(!r[n[t]]){a=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===a);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:a,hash:e}),c()})),hasFwdMessages:_,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:Sf()}}),e=""}}}();function Sf(){return nav.getQuery("community")}window.MessagesActions=Of;var kf=n("TxR4"),Cf=n("S6+Z"),Ef=Object.entries(Cf.EMOJI_HINTS).map((function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+Object(di.escapeRE)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]})),jf={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?jf["\\"]="ё":jf["`"]="ё";var Tf=new RegExp("["+Object(di.escapeRE)(Object.keys(jf).join(""))+"]","gi"),If=function(e){return e.replace(Tf,(function(e){return jf[e]}))},Mf=Object.entries(jf).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e})),Df=new RegExp("["+Object(di.escapeRE)(Object.keys(Mf).join(""))+"]","gi"),Pf=function(e){return e.replace(Df,(function(e){return Mf[e]}))},xf=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=Ef.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(n,(function(e,t,n,a){return(t||"")+Object(kf.emojiByteHexToSymbol)(i)+(a||"")}))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(kf.emojiRemoveSkinToneModifiers)(e)],a=0,r=[].concat(i);a<r.length;a++){var o=r[a];i.push(If(o)),i.push(Pf(o))}for(var s=0,l=[].concat(i);s<l.length;s++){var c=l[s];i.push(c.replace(/ё/g,"е")),i.push(c.replace(/е/g,"ё"))}for(var u=0,d=[].concat(i);u<d.length;u++){var _=d[u];i.push(_.replace(/[.!?]+$/,""))}return Object.keys(i.reduce((function(e,t){return e[t]=1,e}),{}))},t.isBotLinkEnabled=function(){return Object(ie.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"},t.getBotLinkImageUrl=function(e,t){return void 0===t&&(t="light"),"/images/stickers_suggestions_bot_"+t+"_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return Object(ie.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();window.StickersHints=function(){var e,t,n,i,a,s,l=!0,c=0,u=new xf({mvk:!0});Cf.EMOJI_HINTS;function d(e){var r=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),u.setConfig(e),n&&!n.initialized){var o=function(e){var t=n.value.length;t-c>1,c=t,_(),l&&(!function(){g()&&vkNow()-A()>864e5*(2+Math.random())&&f();e=function(e){e*=1e3,g()&&e>A()&&f()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),l=!1)};n.initialized=!0,a=geByClass1("stickersHints"),i=geByClass1("stickersHints__content"),addEvent(n,"focus",_),addEvent(n,"input",o),addEvent(document,"click",p),onBodyResize(h),onBodyResize(y),r.destroy.push((function(){a=null,i=null,n=null,removeEvent(n,"focus",_),removeEvent(n,"input",o),removeEvent(document,"click",p),onBodyResize("__clear",h),onBodyResize("__clear",y),t&&t.destroy(),c=0})),document.activeElement===n&&_()}}function _(){var r;n&&(e&&clearTimeout(e),r=function(r){var s=u.getQueries(n.value).find((function(e){return r.hasOwnProperty(e)})),l=s&&r[s];l?e=setTimeout((function(){var e,n,r=l.userStickers||[],c=l.promotedStickers||[];if(r.length>0||c.length>0){var d=[];each(r,(function(e,t){d.push(m({stickerId:t,query:s,isPromoted:!1}))})),each(c,(function(e,t){d.push(m({stickerId:t,query:s,isPromoted:!0}))})),u.isBotLinkEnabled()&&d.push((e=Object(S.getStickerSize)(),n="light",o.colorScheme.isDarkScheme()&&(n="dark"),Wd.html({inner:[{inner:[{class:"th_img",src:u.getBotLinkImageUrl(e,n),tag:"img"}],class:"sticker_thumb",href:u.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),i.innerHTML=d.join(""),show(a),h(),y(),(t=new Scroller(a)).init()}}),300):(t&&t.destroy(),hide(a))},s?r(s):g()?(s=lsGet("stickers_keywords").keywords,r(s)):v((function(e){s=e,b(e),r(e)})))}function f(){v((function(e){s=e,b(e),_()}))}function p(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(a),e&&clearTimeout(e))}function h(){attr(i,"style","")}function m(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(a,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",r=Stickers.getStickerUrl(e.stickerId,Object(S.getStickerSize)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,r).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function v(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,(function(e,n){var i=n.user_stickers,a=n.promoted_stickers;each(n.words,(function(e,n){t[n]={userStickers:i,promotedStickers:a}}))})),t}(t))}})}function g(){return Boolean(lsGet("stickers_keywords"))}function A(){return lsGet("stickers_keywords").time}function b(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function y(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-4,n=t/64,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var a=Math.round(t/n-8);each(geByClass("sticker_item",e),(function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",a),setStyle(t,"height",a),setStyle(n,"width",a),setStyle(n,"height",a),setStyle(i,"height",a)}))}}return onDOMReady((function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit((function(){d()})),geByClass1("stickersHints")&&d())})),ajax.onRedirect((function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&f()})),post.onReplyClick((function(e){var t=window.cur;e,setTimeout(_,10),t.destroy.push((function(){;""}))})),{actualizeVisibility:_,init:d,onStickerThumbClick:function(t,i,r,o){window.isNewMail&&preventEvent(t);var s=gpeByClass("sticker_item",i),l=geByClass1("th_img",s);return attr(s,"style",""),attr(i,"style",""),attr(l,"style",""),hide(a),n.value="",e&&clearTimeout(e),post.sendSticker(i,r,!0,o)},onCheckboxLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,f)}),0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,f)}),0)},onSuggestionsBotLinkClick:function(){r.statlogsValueEvent.apply(void 0,[u.getBotLinkClickStatName(),0].concat(u.getBotLinkClickStatKeys()))}}}();var Lf=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return Object(M.$)(Bf(e))}};var Bf=function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'};function Rf(e,t){window.isNewMail?(e.preventDefault(),uMessenger.goToMsg(+t.parentNode.getAttribute("data-msg-id"))):Lf.go(t,e)}PinnedMsg._onClick=Rf,PinnedMsg._onHideClick=PinnedMsg.onHideClick;n("98L6");window.SettingsRow_select={},SettingsRow_select._onChange=Hf;var Nf=".settingsRow",Ff=".settingsRow__description";function Hf(e,t){!function(e){var t=e.$select,n=e.label;t.closest(Nf).$(Ff).textContent=n}(t),d.default.handle(e,t)}n("MzAf"),n("Dh0N"),n("fYoA");var Uf=n("PovR");function Vf(e){pushNotifier.canBeEnabled().then((function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then((function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)})).catch((function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1})):n.checked=!1)}))}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=Vf;var $f=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,a=!1,r=!1,o=vkNow(),s=0,l=this.getTouchX(e),c=getW(this.wrap);function u(e){if(!r)if(!a&&Math.abs(i.getTouchY(e)-n)>20)r=!0;else{i.lock&&(a=!0,t=i.getTouchX(e),o=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||a)&&(cancelEvent(e),a||(t=i.getTouchX(e),d=0,a=!0),s=d,l=u,d=-(100+d/c*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",a=Math.abs(l-t)/(o/vkNow());a+=.2*a;var r=100*i.opts.shownSlidesNum;r="next"==n?100+r:r-100,setStyle(i.helper,{transition:"transform "+a+"ms",transform:"translateX(-"+r+"%)"});var c=i.items.length-1,_="prev"==n?i.pos-1:i.pos+1;_<0?_=c:_>c&&(_=0),i.opts.onStartChange&&i.opts.onStartChange(_,n),i.newPos=_,i.changeTimeout=setTimeout((function(){i.lock=0,i.changeSlide(_)}),a)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout((function(){i.lock=0}),200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",a=e,r=0;r<t;r++)--a<0&&(a=n),i=this.makeItem(this.items[a])+i;i+=this.makeItem(this.items[e]),a=e;for(var o=0;o<t;o++)++a>n&&(a=0),i+=this.makeItem(this.items[a]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var a="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+a+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var r=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout((function(){a="next"==t?-100:0,setStyle(r.helper,{transition:"transform 200ms",transform:"translateX("+a+"%)"}),r.toSlideTimer=setTimeout((function(){r.lock=0,r.changeSlide(e)}),200)}),10)},e}();window.landingsSlider=$f;n("03kU"),n("4qiT"),n("Tjn9");window.FriendsRecommendedSlider={init:function(){window.cur&&(Gf($("."+qf)),cur.destroy.push((function(){zf=null,Yf=null,Qf=null})))},hideRecommended:function(e,t,n,i){var a=gpeByClass("prettyCard",e);if(!a)return i&&Object(r.cancelEvent)(i);var o=Jf(a),s=domData(a,"code")||domData(o,"code"),l=domData(o,"ref");!function(e){var t=Jf(e);remove(e),Qf=null,Yf=null,Kf().length||Xf(t)}(a);var c="/friends"+obj2qs({act:"hide_possible",hash:n,id:t,track_code:s,ref:l});return ajax.post(c,{_ajax:1}),i&&Object(r.cancelEvent)(i)},hideBlock:Xf,acceptFriend:function(e,t,n,i){if(hasClass("prettyCard__button_accepted",e)||hasClass(e))return i&&Object(r.cancelEvent)(i);var a=gpeByClass("prettyCard",e),o=e.querySelector(".prettyCard__buttonText"),s=Jf(e),l=domData(a,"code")||domData(s,"code"),c=domData(s,"ref");return addClass(Wf,e),Friends.accept(t,n,"user_rec",0,c,l,(function(t,n){var i=t||getLang("mobile_friends_feed_recom_got_notification");removeClass(Wf,e),addClass("prettyCard__button_accepted",e),o.innerHTML=i,function(e){var t=function(e){var t=domCA(e,".prettyCard");if(!t)return;return geByClass1("prettyCard__closeButton",t)}(e);addClass("prettyCard__closeButton_hidden",t)}(e);var a=Object(r.isObject)(null==n?void 0:n.friend_request_add_sent_message_nudge)?n.friend_request_add_sent_message_nudge:void 0;if(a){var s=a.url,l=a.text;Object(I.init)({text:i,type:I.SNACKBAR_TYPE_SUCCESS,vertical:!0,action:{text:l,url:s,callback:function(e,t){var n=t.id;Object(I.close)(n),Object(r.cancelEvent)(e),window.nav.go(s)}}})}}),(function(t,n){2===t&&nav.hard_go(n),removeClass(Wf,e)})),i&&Object(r.cancelEvent)(i)},onOpenUser:function(e){var t=gpeByClass("prettyCard",e);if(!t)return;var n=Jf(t),i=domData(t,"uid")||"",a=domData(t,"code")||domData(n,"code"),r=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:r,trackCode:a})},onScroll:throttle(Gf,50)};var Wf="prettyCard__button_loading",qf="friendsRecommendedSliderWrap",zf=null,Yf=null,Qf=null;function Gf(e){if(!zf&&e&&(zf=Jf(e)),zf&&(zf._lastScroll=zf.scrollLeft,!e.ajaxIsRunning)){var t=zf.scrollLeft,n=function(){if(Yf)return Yf;if(!zf)return{};var e=getSize(zf)[0],t=getX(zf),n=Kf(),i=getX(n[0])-t,a=getSize(n[0])[0],r=getX(n[1])-t-i-a,o=Math.floor(a/3);return Yf={width:e,itemWidth:a+r,leftMargin:i,part:o,scrollWidth:zf.scrollWidth}}(),i=Math.max(0,Math.floor((t-n.leftMargin)/n.itemWidth)),a=Math.max(0,Math.floor((t+n.width-n.leftMargin)/n.itemWidth));i*n.itemWidth+n.itemWidth-n.part<t&&i++,a*n.itemWidth+n.part>t+n.width&&a--;var r=Kf();i=Math.max(0,i),a=Math.min(r.length,a);for(var o=domData(zf,"ref"),s=domData(zf,"code"),l=i;l<=a;l++){var c=r[l];if(c&&!c.viewed){c.viewed=!0;var u=domData(c,"uid")||"",d=domData(c,"code")||s;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:u,pos:l,ref:o,trackCode:d})}}!e.allLoaded&&t+n.width>=n.scrollWidth/2&&function(e){(e=Jf(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=3)return void(e.allLoaded=!0);var n=domData(e,"code")||"",i=domData(e,"ref")||"",a=intval(domData(e,"friend-id")),r="/friends"+obj2qs({act:"recommended_carousel",next:t,ref:i,friendId:a,track_code:n});e.ajaxIsRunning=!0,ajax.post(r,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1("Slider__line",e),a=cdf(t);append(a,i),Yf=null,Qf=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout((function(){return e.ajaxIsRunning=!1}),500)}})}(e)}}function Kf(){return Qf||(zf&&(Qf=geByClass("prettyCard",zf)),Qf||[])}function Xf(e,t){var n=gpeByClass(qf,e);if(!n)return t&&Object(r.cancelEvent)(t);var i=zf;if(!i&&e&&(i=Jf(n)),i){var a=domData(i,"code"),o=domData(i,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:o,trackCode:a})}if(remove(n)){var s=nav.getQuery();delete s.recs,nav.go(location.pathname+obj2qs(s),!1,{replace:!0,push_only:!0})}return t&&Object(r.cancelEvent)(t)}function Jf(e){var t;return hasClass(e,"Slider__scroll")?t=e:(t=geByClass1("Slider__scroll",e))||(t=gpeByClass("Slider__scroll",e)),t}n("w1QQ"),n("DVnk"),n("cLcH"),n("uo4j"),n("Fhlr");var Zf=n("myok");window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,r,o){var s=o.$btn,l=s.getAttribute("href"),c=s.nextElementSibling||s.previousElementSibling,u=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(Zf.default.setLoading(s,!0),ajax.post(l,{_ajax:1},{onDone:function(){Zf.default.setLoading(s,!1),c&&c.remove(),s.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+u+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n){e.preventDefault();var i=e.target,a=i.getAttribute("href"),r=a+"&action=hide",o=a+"&action=restore";(!n||confirm(n))&&ajax.post(r,{_ajax:1},{onDone:function(){var e=i.closest(".notificationList__items")||i.closest(".notificationList"),n=i.closest(".notification"),a=n.getAttribute("id"),r=e.closest(".notificationList");if(hide(n),NotifyItem._onBodyScroll(),r.classList.contains("notificationList_type_unread")){var s=r.$(".Pad__title"),l=parseInt(s.innerText,10)-1;s.innerText=langNumeric(l,lang.mobile_notifications_new)}var c=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(c=!1)})),c&&r.classList.add("Pad_empty");var u=window.Snackbar;u&&u.init&&u.init({text:t,action:{url:o,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",a]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,a=n.url;e.preventDefault();var r=ge(t);ajax.post(a,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=r.closest(".notificationList__items")||r.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var a=n.$(".Pad__title"),o=parseInt(a.innerText,10)+1;a.innerText=langNumeric(o,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(s=!1)})),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach((function(e){e.classList.remove("notification_actionsOpen")})),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach((function(e){e!==t&&e.classList.remove("notification_actionsOpen")})),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,i){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,r={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach((function(e){r["setting_"+e.name]=e.checked?1:0})),ajax.post("feed.php",Object(j.default)({gid:t,hash:n,unmuted:a,from:i},r,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}};var ep=n("H5mD");function tp(e,t,n){if(ep.isWKWebView){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var i=new Event("click");return t.dispatchEvent(i),void setTimeout((function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n}))}C.default.android?location.href="https://vk.com/write"+(2e9+e):ep.isIOS?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{_ajax:1},{onDone:function(e){tp(e,t,n)}}),!1},open:function(e,t,n){return setTimeout((function(){tp(e,t,n)})),!1}};n("wkhI"),n("DOEQ");var np=10,ip={setMaxAttach:function(e){np=e},checkAttaches:function(){ip.toggleEnableAttaches(mediaUpload.getAttachesCount()<np)},toggleEnableAttaches:function(e){if(void 0===e&&(e=!0),Object(M.$)("#feed_add_form")){Object(M.$$)(".cp_attach_btn",Object(M.$)("#feed_add_form")).forEach((function(t){t.classList.toggle("cp_disabled_btn",!e)})),["photo","video","audio","doc","poll"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})),["photo","audio"].forEach((function(t){var n=Object(M.$)(".CreatePostButtons__item--"+t);n&&n.classList.toggle("CreatePostButtons__item--disabled",!e)}));var t=Object(M.$)(".CreatePostButtons__item--photo .inline_upload");Object(r.attr)(t,"disabled",!e)}}};window.CreatePost=ip;var ap=n("Ogzf");!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var rp="doc",op="photo",sp="video",lp="album",cp="market_album",up=window.isMVK?200:120,dp=window.isMVK?604:537,_p=window.isMVK?360:343;function fp(e,t,n,i){var a=function(e){var t=0;return each(e,(function(e,n){t+=n})),t},r=function(e,t,n){return(t-(e.length-1)*n)/a(e)},o=(i=yp(i)?i:{}).wide,s=[],l=0,c=[],u=[];each(n,(function(e,t){Ap(t.type)&&(c[c.length]=t[t.type]),t.type===sp&&s.push(l),l++}));var d="",_=[],f=c.length;each(c,(function(n,i){var a=vp(i,e,t);d+=a>1.2?"w":a<.8?"v":"q",_[_.length]=a}));var p,h,m=_.length>0?a(_)/_.length:1,v=5;window.isMVK&&(v=window.innerWidth>=480?6:3);var g=v;i.force?(p=e,h=t):(o?(p=dp,h=_p):e>=381?(p=381,h=1==f?361:237):(p=337,h=1==f?320:214),e<p&&(p=e,h=t),window.isMVK&&(p=Math.min(dp,window.innerWidth),h=Math.min(_p,p)));var A=p/h,b=0,y=0;if(1==f){var w={lastColumn:1,lastRow:1,single:1};c[0].thumb?(b=279,y=185):_[0]>=1*A?(b=p,y=Math.min(b/_[0],h)):(y=h,b=Math.min(y*_[0],p));var O=pp(c[0],b,y,w);!O.unsized&&(O.image.width<b&&O.image.height<=h||O.image.height<y&&O.image.width<=p)&&(b=O.image.width,y=O.image.height,O=pp(c[0],b,y,w)),u[0]=O}else if(2==f){var S,k;switch(d){case"ww":if(m>1.4*A&&_[1]-_[0]<.2){k=p,S=Math.min(k/_[0],k/_[1],(h-g)/2),u[0]=pp(c[0],k,S,{lastColumn:1}),u[1]=pp(c[1],k,S,{lastColumn:1,lastRow:1}),b=p,y=2*S+g;break}case"vv":case"qv":case"vq":case"qq":k=(p-v)/2,S=Math.min(k/_[0],k/_[1],h),u[0]=pp(c[0],k,S,{lastRow:1}),u[1]=pp(c[1],k,S,{lastRow:1,lastColumn:1}),b=p,y=S;break;default:var C=intval((p-v)/_[1]/(1/_[0]+1/_[1])),E=p-C-v;S=Math.min(h,C/_[0],E/_[1]),u[0]=pp(c[0],C,S,{lastRow:1}),u[1]=pp(c[1],E,S,{lastColumn:1,lastRow:1}),b=p,y=S}}else if(3==f)if((_[0]>1.2*A||m>1.5*A)&&"www"==d){var j,T=p,I=Math.min(T/_[0],.66*(h-g));if(u[0]=pp(c[0],T,I,{lastColumn:1}),"www"==d){var M=intval(p-v)/2;j=Math.min(h-I-g,M/_[1],M/_[2]),u[1]=pp(c[1],M,j,{lastRow:1}),u[2]=pp(c[2],p-M-v,j,{lastColumn:1,lastRow:1})}else{var D=intval((p-v)/_[2]/(1/_[1]+1/_[2])),P=p-D-v;j=Math.min(h-I-g,D/_[2],P/_[1]),u[1]=pp(c[1],D,j,{lastRow:1}),u[2]=pp(c[2],D,j,{lastRow:1,lastColumn:1})}b=p,y=I+j+g}else{var x=h,L=intval(Math.min(x*_[0],.75*(p-v)));u[0]=pp(c[0],L,x,{lastRow:1});var B=_[1]*(h-g)/(_[2]+_[1]),R=h-B-g,N=Math.min(p-L-v,intval(B*_[2]),intval(R*_[1]));u[1]=pp(c[1],N,R,{lastColumn:1}),u[2]=pp(c[2],N,B,{lastColumn:1,lastRow:1}),b=L+N+v,y=h}else if(4==f)if((_[0]>1.2*A||m>1.5*A)&&"wwww"==d){var F=p,H=Math.min(F/_[0],.66*(h-g));u[0]=pp(c[0],F,H,{lastColumn:1});var U=(p-2*v)/(_[1]+_[2]+_[3]),V=intval(U*_[1]),$=intval(U*_[2]),W=F-V-$-2*v;U=Math.min(h-H-g,U),u[1]=pp(c[1],V,U,{lastRow:1}),u[2]=pp(c[2],$,U,{lastRow:1}),u[3]=pp(c[3],W,U,{lastColumn:1,lastRow:1}),b=p,y=H+U+g}else{var q=h,z=Math.min(q*_[0],.66*(p-v)),Y=(h-2*g)/(1/_[1]+1/_[2]+1/_[3]),Q=intval(Y/_[1]),G=intval(Y/_[2]),K=q-Q-G-2*g;z+(Y=Math.min(p-z-v,Y))+v<p&&q*_[0]>z&&(z=Math.min(q*_[0],p-v-Y)),u[0]=pp(c[0],z,q,{lastRow:1}),u[1]=pp(c[1],Y,Q,{lastColumn:1}),u[2]=pp(c[2],Y,G,{lastColumn:1}),u[3]=pp(c[3],Y,K,{lastColumn:1,lastRow:1}),b=z+Y+v,y=h}else{var X=[],J=0;m>(s.length?1.3:1.1)?each(_,(function(e,t){X[X.length]=Math.max(1,t)})):each(_,(function(e,t){~s.indexOf(J)?X[X.length]=t:X[X.length]=Math.min(1,t),J++}));var Z,ee,te={};for(te[f+""]=[r(X,p,v)],Z=1;Z<=f-1;Z++)te[Z+","+(ee=f-Z)]=[r(X.slice(0,Z),p,v),r(X.slice(Z),p,v)];for(Z=1;Z<=f-2;Z++)for(ee=1;ee<=f-Z-1;ee++)te[Z+","+ee+","+(f-Z-ee)]=[r(X.slice(0,Z),p,v),r(X.slice(Z,Z+ee),p,v),r(X.slice(Z+ee),p,v)];var ne,ie=null,ae=0;for(var re in te)if(te.hasOwnProperty(re)){var oe=te[re],se=a(oe)+g*(oe.length-1),le=Math.abs(se-h);if(~re.indexOf(",")){for(var ce=re.split(","),ue=0;ue<ce.length;ue++)ce[ue]=intval(ce[ue]);(ce[0]>ce[1]||ce[2]&&ce[1]>ce[2])&&(le+=50,le*=1.5)}(null===ie||le<ae)&&(ie=re,ae=le,ne=se)}for(var de=bp(c),_e=bp(X),fe=ie.split(","),pe=te[ie],he=fe.length-1,me=0;me<fe.length;me++){var ve=parseInt(fe[me]),ge=de.splice(0,ve),Ae=pe.shift(),be=ge.length-1,ye={};he==me&&(ye.lastRow=!0);for(var we=p,Oe=0;Oe<ge.length;Oe++){var Se=ge[Oe],ke=_e.shift(),Ce=ye,Ee=void 0;be==Oe?(Ee=Math.ceil(we),Ce.lastColumn=!0):we-=(Ee=intval(ke*Ae))+v,u[u.length]=pp(Se,Ee,Ae,Ce)}}b=p,y=ne}return{width:intval(b),height:intval(y),thumbs:u}}function pp(e,t,n,i){var a={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:hp(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(a,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(a,{title:e.title,msize:e.msize}):e.type===sp&&e.name&&void 0!==e.name&&extend(a,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),a.unsized?a.ratio=1:a.ratio=a.image.width/a.image.height,a}function hp(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,r=window.devicePixelRatio||1;if(e.type===sp||e.type===rp){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((function(i){e.sizes[i]&&(!a||t*r<=e.sizes[i][1]&&n*r<=e.sizes[i][2])&&(a=e.sizes[i])}))}else{var o=e.thumb?e.thumb.sizes:e.sizes,s=o.x||o[o.length-1],l=s?(s[1]||1)/(s[2]||1):1,c=0;l>t/n?(c=n,l>1&&(c*=l)):(c=t,l<1&&(c/=l)),n*=r,t*=r;var u=!i&&o.o,d="";d=o.temp?"temp":c<75?"s":c<130?"m":u&&o.o&&o.o[1]>=t&&o.o[2]>=n?"o":u&&o.p&&o.p[1]>=t&&o.p[2]>=n?"p":u&&o.q&&o.q[1]>=t&&o.q[2]>=n?"q":u&&o.r&&o.r[1]>=t&&o.r[2]>=n?"r":"x",a=o[d]||[]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function mp(e,t,n){var i=t,a=n,r=0,o=0;if(!e.vid&&e.image.width&&e.image.height){var s=e.image.width/e.image.height;s<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(a=(i=t)/s)>n&&(o=-intval((a-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(a=n)*s)>t&&(r=-intval((i-t)/2)))}return{width:i,height:a,marginLeft:r,marginTop:e.orig&&(e.type===cp||e.type===lp)&&e.single?0:o}}function vp(e,t,n){var i;switch(e.type){case rp:i=e.ratio;break;case sp:i=e.ratio||1.777;break;case lp:case cp:i=1.5;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,r=a[1],o=a[2];r&&o&&(i=r/o)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,l=s[1],c=s[2];l&&c&&(i=l/c)}}return i||1}function gp(e,t,n,i){var a=t.split("_"),r=a[0],o=a[1],s=Object(j.default)({owner_id:r,ownerId:r,itemId:o,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},i);switch(e){case rp:s.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},s.doc=s.data;break;case op:s.data={pid:o,sizes:n.sizes,restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.photo=s.data;break;case sp:s.data={vid:o,duration:n.duration,platform:n.platform,play_icon:n.play_icon,preview:n.preview,active_live:n.active_live,restriction:n.restriction,ratio:n.ratio,sizes:n.sizes,name:n.name},s.video=s.data;break;case lp:s.data={aid:o,title:n.title,size:n.size,thumb:{sizes:n.sizes},restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.album=s.data;break;case cp:s.data={type:cp,aid:o,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},s.market_album=s.data}return s.data.type=e,s.data.id=s.temp?e+"temp_"+r:""+e+s.ownerId+"_"+s.itemId,s}function Ap(e){return!!~[rp,op,sp,lp,cp].indexOf(e.toString())}function bp(e,t){var n=yp(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=bp(e[i]):n[i]=e[i]);return n}var yp=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var wp=n("0DYw"),Op=n("eLSo"),Sp=n("4/mX"),kp=n("HbQ2"),Cp=n("Z6iq"),Ep=n("a3n7"),jp=n("l1SD"),Tp=n("AQO8"),Ip=n("QDiA"),Mp=n("R3X3"),Dp=n("L3c9"),Pp=function(e){var t;switch(e.iconFilename+(e.canPreview?"":"_grey")+"_44"){case"delete_outline_44":t=Object(wp.getDeleteOutline44Icon)();break;case"delete_outline_grey_44":t=Object(Op.getDeleteOutlineGrey44Icon)();break;case"do_not_disturb_outline_44":t=Object(Sp.getDoNotDisturbOutline44Icon)();break;case"do_not_disturb_outline_grey_44":t=Object(kp.getDoNotDisturbOutlineGrey44Icon)();break;case"hide_outline_44":t=Object(Cp.getHideOutline44Icon)();break;case"info_outline_44":t=Object(Ep.getInfoOutline44Icon)();break;case"info_outline_grey_44":t=Object(jp.getInfoOutlineGrey44Icon)();break;case"lock_outline_44":t=Object(Tp.getLockOutline44Icon)();break;case"lock_outline_grey_44":t=Object(Ip.getLockOutlineGrey44Icon)();break;case"recent_outline_44":t=Object(Mp.getRecentOutline44Icon)();break;case"recent_outline_grey_44":t=Object(Dp.getRecentOutlineGrey44Icon)()}var n=[{class:"VideoRestriction__boxWrap",inner:[{class:"VideoRestriction__box",inner:[Object(T.default)(t),{class:"VideoRestriction__title",inner:e.title}]}]}];e.thumb&&n.push({class:"VideoRestriction__thumb",style:"background-image: url("+e.thumb+"); height: 100%; width: 100%;"});e.button&&n[0].inner[0].inner.push({class:"VideoRestriction__button",inner:e.button.text,onclick:["VideoRestriction.hideDisclaimerAndPlay"]});return n};var xp={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady((function(){window.ThumbsEdit.init(!1),page.onChange((function(){window.ThumbsEdit.init(!1,"/wall")}))}))},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall")&&0!==t.indexOf("/board"))return this.initialized=!1,removeClass(document.body,"te_i"),void(xp.destroyLongpress&&xp.destroyLongpress());if(addClass(document.body,"te_i"),!geByClass1("ThumbsEdit",e)){var i=Object(r.ceFromString)(d.default.html({class:"ThumbsEdit",style:"width: 100%; height: 100%",id:"ThumbsEdit"})),a=Object(r.ceFromString)(d.default.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:i}));a.appendChild(i),e.insertBefore(a,e.firstChild),xp=Object(j.default)({},xp,{previews:[],loaders:{},attachEl:i});var o=this.parsePreviews(Object(r.getPreloadData)());this.initialized=!0,o.length&&(xp.previews=o,this.draw(),Object(r.onBodyResize)((function(){return n.draw()})))}},parsePreviews:function(e){return e.map((function(e){return gp.apply(void 0,e)})).filter((function(e){return Ap(e.type)}))},draw:function(){var e=this,t=xp,n=t.previews,i=t.attachEl,a=n[0]?vp(n[0]):1.5,r={width:i.parentNode.offsetWidth,height:Math.min(Math.round(i.parentNode.offsetWidth/a),360),wide:!0},o=fp(r.width,r.height,n,r),s=o.thumbs,l=o.height,c=o.width;xp=Object(j.default)({},xp,{thumbs:s,height:l,options:r});var u=document.createDocumentFragment();s.forEach((function(t,n){u.appendChild(e.createThumbEl(t,n))})),this.updateIds();var d=ce("div");d.id="ThumbsEdit-splitter",val(i,""),i.style.width=c+"px",i.parentNode.style.height=l+"px",i.appendChild(u),ge("ThumbsEdit-splitter")||i.parentNode.appendChild(d),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var i=e.id,a=ge(i),o=xp.thumbs,s=xp.height,l=xp,c=l.options,u=l.drag,_=t[0]?vp(t[0]):1.5,f=c.width,p=c.height;f&&p||(f=e.parentNode.offsetWidth,p=Math.min(Math.round(f/_),360)),c.width=f,c.height=p,c.wide=!0;var h=fp(f,p,t,c),m=h.thumbs,v=h.height,g=h.width,A=Object(r.ceFromString)(d.default.html({class:"ThumbsEdit",style:"width: "+g+"px; height: "+v+"px; position: fixed; left: "+u.wpos[0]+"px; top: "+u.wpos[1]+"px; visibility: hidden"}));m.forEach((function(e,t){A.appendChild(n.createThumbEl(e,t,!0))})),document.body.appendChild(A);var b=this.getCoords(A,u.wpos);re(A),b.forEach((function(e,t){var n=xp.drag.coords.find((function(t){return t.id===e.id}));if(n){var i=geByClass1("Thumb",n.node),a=$("img",i),s=o[n.index],l=m.find((function(e){return e.id===s.id}));xp.drag.toIndex!==t&&r.setStyle.transform(i,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==xp.drag.i||setTimeout((function(){r.setStyle.animate(i,"margin-left, margin-top, height, width, opacity, transform",{duration:up+"ms"}),Object(r.setStyle)(i,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),r.setStyle.transform(i,1,[e.x-n.x,e.y-n.y]),r.setStyle.animate(i.parentNode,"background",{duration:up+"ms"}),Object(r.setStyle)(i.parentNode,{func:"ease-in",background:"transparent"});var t=mp(l,e.width,e.height);a&&(r.setStyle.animate(a,Object.keys(t).join(),up+"ms"),Object(r.setStyle)(a,t))}))}})),s!==v&&setTimeout((function(){[a,a.parentNode].forEach((function(e){r.setStyle.animate(e,"height",{duration:up+"ms"}),Object(r.setStyle)(e,{height:v})}))})),g>=f&&(r.setStyle.animate(a,"width",{duration:up+"ms"}),Object(r.setStyle)(a,{width:g})),setTimeout((function(){Object(r.setStyle)(a,{width:g}),xp.thumbs=m,xp.previews=t,xp.height=v;var e=document.createDocumentFragment();m.forEach((function(t,i){e.appendChild(n.createThumbEl(t,i))})),a.innerHTML="",a.appendChild(e),xp.drag.updating=!1,n.updatePhotos()}),up)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,i=e.width,a=e.height,o=e.type,s=mp(e,i,a),l=["Thumb-wrap","Thumb-wrap--"+o],c=0===e.id.indexOf("phototemp_"),u=c||i<=30||a<=60,_=e.orig.restriction;c&&l.push("Thumb-wrap--temp"),e.lastColumn&&l.push("last_column"),e.lastRow&&l.push("last_row");var f=xp.previews[t],p=null;f.label&&(p=d.default.wrap(f.label));var h=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var m=[{class:_?"VideoRestriction__thumb":"",inner:[{tag:"img",src:(h?h.src:n.src)||"/images/blank.gif",width:""+Math.round(s.width),height:""+Math.round(s.height),style:"margin-left: "+s.marginLeft+"px; margin-top: "+s.marginTop+"px;"}]},{class:"Thumb__overlay",inner:[!u&&{class:"Thumb__overlay-closeBtn",onclick:"ThumbsEdit.remove(null, "+t+")"},p]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:o},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(o.length,e.id.length)}];if(c){var v,g=Math.min(Math.min((s.width-24)/2,30),Math.min((s.height-24)/2,30));xp.loaders[e.id]&&(v=xp.loaders[e.id]);var A=a_.init(v,g),b=A.component,y=A.id;xp.loaders[e.id]=y,m.push(b)}var w=["Thumb"];_&&(w.push("VideoRestriction"),w.push("VideoRestriction--onlyIcon"),e.orig.restriction.canPreview&&w.push("VideoRestriction--canPreview"),e.orig.restriction.needBlur&&w.push("VideoRestriction--blur"));var O=Object(r.ceFromString)(d.default.html({class:w.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(a)+"px",inner:m})),S=Object(r.ceFromString)(d.default.html({class:l.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(a)+"px","data-media":e.id,"data-index":t,"data-upload":f.upload}));if(xp.destroyLongpress=Object(ap.onLongpress)(O,350,this.startDrag.bind(this,O)),addEvent(S,"click",this.showPopup.bind(this)),_){var k=d.default.html(Pp({canPreview:e.orig.restriction.canPreview,iconFilename:e.orig.restriction.icon,title:e.orig.restriction.title}));O.appendChild(Object(r.ceFromString)(k))}return S.appendChild(O),S},addTempPreview:function(e){var t;if(xp.attachEl){var n=this.parsePreviews([e]);(t=xp.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=xp.previews.findIndex((function(t){return t.ownerId===e})),r=xp.previews[a],o=t.split("_").ownerId,s=t.split("_").itemId;r.ownerId=o,r.owner_id=o,r.itemId=s,r.temp=!1,r.upload=e,r.list=n,r.photo.sizes=i,r.photo.id="photo"+t,r.photo.pid=s,r.data=r.photo,a_.ready(xp.loaders["phototemp_"+e]),this.draw()},onUploadProgress:function(e,t){a_.update(xp.loaders["phototemp_"+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains("Thumb")&&!e.classList.contains("Thumb--moving")){window.navigator.vibrate&&navigator.vibrate(50),Object(r.setStyle)(document.body,"overflow","hidden"),Object(r.setStyle)(document.body,"max-height","100%"),Object(r.setStyle)(document.body,"user-select","none");var n=this.onDrag.bind(this),i=this.onDrop.bind(this);addEvent(window,"mousemove touchmove",n),addEvent(window,"mouseup touchend touchcancel",i),statlogsValueEvent("mvk_thumb_edit_interaction",""),xp.drag=Object(j.default)({},xp.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:i});var a=e.offsetWidth>=40&&e.offsetHeight>=80,o=e.parentNode.parentNode,s=$("img",e),l=intval(e.parentNode.getAttribute("data-index")),c=xp.thumbs[l],u=getXY(o),d=getXY(e.parentNode),_=this.getCoords(o,u);xp.drag.id=o.id,xp.drag.i=l,xp.drag.toIndex=l,xp.drag.x=(t.pageX||t.detail.pageX)-d[0],xp.drag.y=(t.pageY||t.detail.pageY)-d[1],xp.drag.t=c,xp.drag.w=c.width,xp.drag.h=c.height,xp.drag.pos=d,xp.drag.wpos=u,xp.drag.crop=mp(c,c.width,c.height),xp.drag.coords=_,xp.drag.needScale=a;var f=a?function(e,t,n,i){n=intval(n),i=intval(i)||n;var a=e,r=t;return e>=t&&e>n?(a=intval(n),r=intval(t/(e/n))):e<t&&t>i&&(r=intval(i),a=intval(e/(t/i))),[a,r]}(c.width,c.height,.9*e.offsetWidth,.9*e.offsetHeight):[c.width,c.height],p=f[0],h=f[1],m=intval((c.width-p)*(browser.android?.5:xp.drag.x/c.width)),v=intval((c.height-h)*(browser.android?.5:xp.drag.y/c.height));addClass(e,"Thumb--moving"),Object(r.setStyle)(e,{zIndex:100}),Object(r.setStyle)(e.parentNode,{zIndex:100});var g=mp(c,p,h);Object(r.setStyle)(e,{opacity:.75,width:p,height:h,marginLeft:m,marginTop:v}),s&&Object(r.setStyle)(s,g),xp.drag.state=!0}},onDrag:function(e){var t=xp.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),i=n.x,a=n.y,o=xp.drag,s=i-(o.pos[0]+o.x),l=a-(o.pos[1]+o.y);r.setStyle.transform(t,1,[s,l]);var c=o.wpos;s=o.pos[0]+intval(t.style.marginLeft)+s-c[0],l=o.pos[1]+intval(t.style.marginTop)+l-c[1];var u=s,d=l,_=(t.offsetWidth,t.offsetHeight,o.i),f=!1,p=o.i,h=-1,m=window.innerWidth>=480?6:3,v={};if(o.coords.forEach((function(e,t){if(t!==o.i&&t!==h){e.offsetX=e.node.offsetWidth+m,e.offsetY=e.node.offsetHeight+m;var n=o.coords[t-1],i=o.coords[t+1],a=u+o.x,s=d+o.y,l=e.x+e.offsetX/2,c=e.y+e.offsetY/2,g=e.x+e.offsetX,A=e.y+e.offsetY,b=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||i&&i.x===e.x&&i.y!=e.y)&&0!=e.x,y=a>=l&&(i&&(a<=i.x+i.offsetX/2&&(i.offsetY===e.offsetY||a<g)||i.y!=e.y)||!i&&u<=g)&&s>e.y&&s<A,w=a<l&&a>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!i))&&s>e.y&&s<A,O=b&&s>=c&&s<A&&a>e.x&&a<g,S=b&&s<c&&s>=e.y&&a>e.x&&a<g;y=y&&!b,w=w&&!b&&!y,(y||w||O||S)&&(f=!0,p=e.index<o.i&&(y||O)?e.index+1:_<e.index&&(S||w)?e.index-1:e.index),p!==o.i?(r.setStyle.transform(e.node,1,[y?-5:w?5:0,O?-5:S?5:0]),y?(v.side="right",v.toIndex=e.index):w&&(v.side="left"),O?(v.side="down",v.toIndex=e.index):S&&(v.side="up")):r.setStyle.transform(e.node,1,[0,0]),y&&i&&i.y===e.y&&i.x>e.x&&_>e.index&&(r.setStyle.transform(e.node,1,[0,0]),r.setStyle.transform(e.node,1,[0,0]),r.setStyle.transform(i.node,1,[5,0]),h=t+1,v.side="left",v.toIndex=p),O&&i&&i.x===e.x&&i.y>e.y&&s<=c&&(r.setStyle.transform(i.node,1,[0,0]),h=t+1),S&&n&&n.x===e.x&&n.y<e.y&&s<=c&&(r.setStyle.transform(n.node,1,[0,-5]),r.setStyle.transform(e.node,1,[0,0]),v.side="down",v.toIndex=n.index),p===t&&"number"!=typeof v.toIndex&&(v.toIndex=e.index)}})),v&&(!o.split||o.split.toIndex!==v.toIndex||o.split.side!==v.side)){var g=ge("ThumbsEdit-splitter");if(Object(r.setStyle)(g,{opacity:0}),o.split=v,"number"==typeof v.toIndex){var A=o.coords[v.toIndex].node,b=3===m;"left"===o.split.side&&Object(r.setStyle)(g,{left:Math.max(0,A.offsetLeft-(b?0:1)),top:A.offsetTop+8,height:A.offsetHeight-16,width:"2px",opacity:1}),"right"===o.split.side&&Object(r.setStyle)(g,{left:Math.min(A.offsetLeft+A.offsetWidth-(b?2:1),xp.options.width-2),top:A.offsetTop+8,height:A.offsetHeight-16,width:"2px",opacity:1}),"up"===o.split.side&&Object(r.setStyle)(g,{left:A.offsetLeft+8,top:A.offsetTop,height:"2px",width:A.offsetWidth-16,opacity:1}),"down"===o.split.side&&Object(r.setStyle)(g,{left:A.offsetLeft+8,top:A.offsetTop+A.offsetHeight-1,height:"2px",width:A.offsetWidth-16,opacity:1})}}return o.toIndex=f?p:o.i,cancelEvent(e)},onDrop:function(e){var t=xp.drag;t.state=!1,t.updating=!0;var n=t.curEl,i=$("img",n),a="touchcancel".split(" ").includes(e.type);if(removeEvent(window,"mousemove touchmove",t.dragListener),removeEvent(window,"mouseup touchend touchcancel",t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if(Object(r.setStyle)(document.body,"overflow",null),Object(r.setStyle)(document.body,"max-height",null),Object(r.setStyle)(document.body,"user-select",null),r.setStyle.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge("ThumbsEdit-splitter").removeAttribute("style");if(!hasClass(n,"Thumb--moving"))return t.updating=!1,cancelEvent(e);if(a){var o=t.coords[t.toIndex].node;r.setStyle.transform(o,1,[0,0])}if(t.toIndex===t.i||a){var s=t.crop;r.setStyle.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"},(function(){removeClass(n,"Thumb--moving")})),r.setStyle.animate(i,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"});var l=xp.thumbs[t.i];r.setStyle.transform(n,1,[0,0]),Object(r.setStyle)(n,{"margin-top":0,"margin-left":0,width:l.width,height:l.height,opacity:1,zIndex:null}),Object(r.setStyle)(n.parentNode,{zIndex:null}),i&&Object(r.setStyle)(i,s)}else{var c=xp.previews;c=function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}(c,t.i,t.toIndex),this.update(t.id,c)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach((function(e,i){var a=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(a[0]-t[0]),y:intval(a[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}})),n},remove:function(e,t){var n=xp.previews[t];e&&_n.default.close(e.target),mediaUpload.reset(null,null,n.remove,(function(){xp.previews=xp.previews.filter((function(e,n){return n!==t})),ThumbsEdit.draw()}))},showPopup:function(e){var t=e.target;if(!xp.drag.state&&!t.classList.contains("Thumb--moving")&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),i=Object(r.ceFromString)(d.default.html(this.getPopup(n)));K.default.open(i,!0)}},getPopup:function(e){var t=xp.previews[e],n=null;switch(t.type){case"doc":t.is_gif&&(n='\n            Gif.openPopup(null, null, {\n              raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n              hasVideo: '+Gif.isMp4Supports()+"\n            });\n            Popup.close(this);\n          ");break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=Object(K.ModalMenuBtn)({inner:getLang("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),a=null;return n&&!t.temp&&(a=Object(K.ModalMenuBtn)({inner:getLang("mobile_open"),onclick:""+n})),Object(K.default)({class:"ThumbsEdit__modal",close:!0,items:[a,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,xp.cachedPhoto[e]){var a=xp.cachedPhoto[e].find((function(e){return e.src===t}));a?n&&n(a.src):i.onload=function(){xp.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),xp.cachedPhoto[e].sort((function(e,t){return e.width>t.width?-1:e.width<t.width?1:0})),n&&n(t)}}else xp.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;xp.thumbs.forEach((function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,(function(e){n.src=e}))}))},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:xp.cachedPhoto[e]&&0!==xp.cachedPhoto[e].length?xp.cachedPhoto[e].find((function(e){var t=e.src,n=ce("img");return n.src=t,n.complete})):null},getThumbsCount:function(){return(xp.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach((function(e,n){var i=$$("input",e),a=t+n;i[0].name="attach"+a+"_type",i[1].name="attach"+a}))}};n("WCKs"),n("XLP4");onDOMReady(Lp),window.page&&page.onChange(Lp);function Lp(){window.pushNotifier&&pushNotifier.canBeEnabled().then((function(e){return e&&PushNotifier.getPermission()===Uf.PUSH_NOTIFIER_PERMISSION_DEFAULT})).then((function(e){if(e){FeedNotifications.addWebActionAcceptHandler("enable_browser_notifications",Bp),FeedNotifications.addWebActionDeclineHandler("enable_browser_notifications",Rp);var t=geByClass1("feedAssistance_pushNotificationsSwitch");if(!t)return;FeedAssistanceStats.registerTrackingCls("feedAssistance_pushNotificationsSwitch"),FeedAssistanceStats.register(t,"feed")}}))}function Bp(e){return pushNotifier.requestPermission().then((function(t){var n,i=!0;return unlockButton(e),t===Uf.PUSH_NOTIFIER_PERMISSION_DEFAULT?i=!1:(n=t===Uf.PUSH_NOTIFIER_PERMISSION_GRANTED?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,Fp(e,n),Np(),i)}),(function(){return Rp(e)}))}function Rp(e){return unlockButton(e),Fp(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),Np(),!0}function Np(){var e=geByClass1("feedAssistance_pushNotificationsSwitch");remove(e)}function Fp(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,"m_push_switch",t)})}window.closePostSuggest=function(e,t){return suggestionEvent(e,t,!1),stopEvent(t)},window.suggestionEvent=function(e,t,n){void 0===n&&(n=!1);var i=Object(r.geByClass1)("post_suggest");return ajax.post("wall.php",{_ajax:1,act:"suggestion_event",event_type:e,suggest_id:i.getAttribute("data-suggest-id"),not_hide_by_click:intval(n)}),n||Object(r.re)(i),stopEvent(t)};n("zRDV");var Hp=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},Up=function(){function e(e,t){this.sendLogsTimeout=null,this.sendLogsProcess=!1,this.localStorageKey="recommended_groups",this.logsDataDelimiter="|",this.location=e,this.act=t}return e.prototype.sendLogs=function(){this.sendLogsTimeout&&clearTimeout(this.sendLogsTimeout),this.sendLogsTimeout=setTimeout(this.sendLogsAccept.bind(this),1e4)},e.prototype.sendLogsAccept=function(){var e=this;if(!this.sendLogsProcess){var t=this.getLogs(!0);t.length&&(this.sendLogsProcess=!0,this.clearLogs(),window.ajax.post(this.location,{act:this.act,logs:t},{onDone:function(){e.sendLogsProcess=!1},onFail:function(){return e.restoreLogs(t),e.sendLogsProcess=!1,!0}}))}},e.prototype.restoreLogs=function(e){var t=this,n=this.getLogs(),i=e.map((function(e){return e.split(t.logsDataDelimiter)})),a=Hp(i,n);qn.default.set(this.localStorageKey,a)},e.prototype.getLogs=function(e){var t=this,n=qn.default.get(this.localStorageKey)||[];return e&&(n=n.map((function(e){return e.join(t.logsDataDelimiter)}))),n},e.prototype.addLog=function(e){var t=this.getLogs(),n=e.eventType,i=e.trackCode,a=e.groupId,r=a?[n,i,a]:[n,i];t.push(r),qn.default.set(this.localStorageKey,t),this.sendLogs()},e.prototype.clearLogs=function(){qn.default.remove(this.localStorageKey)},e}(),Vp=function(){function e(){this.onScroll=Object(r.throttle)(this.onScroll,50)}return e.prototype.init=function(){this.gallery=document.querySelector(".groupsRecommendedSlider"),this.sliderSizes=null,this.allLoaded=!1,this.ajaxIsRunning=!1,this.gallery&&(this.block=document.querySelector(".GroupsRecommendedSlider"),this.sliderScrollNode=this.gallery.querySelector(".Slider__scroll"),this.sliderLineNode=this.gallery.querySelector(".Slider__line"),this.eventLog=new Up("/groups","stats"))},e.prototype.subscribe=function(e,t,n){var i=e.closest(".prettyCard").dataset,a=i.groupId,o=i.trackCode;if(a&&o&&!e.classList.contains("prettyCard__button_accepted"))return this.eventLog.addLog({eventType:"group_subscribed",groupId:a,trackCode:o}),window.ajax.post("/groups",{act:"subscribe_from_recomm_groups",hash:t,oid:-a,track_code:o},{onDone:function(t){e.classList.add("prettyCard__button_accepted"),e.innerHTML=t,e.onclick=null},onFail:function(){return!1},showProgress:function(){Object(r.lockButton)(e),e.classList.add("prettyCard__button_loading")},hideProgress:function(){Object(r.unlockButton)(e),e.classList.remove("prettyCard__button_loading")}}),n&&Object(r.cancelEvent)(n);Object(r.cancelEvent)(n)},e.prototype.closeGroup=function(e,t,n){var i=e.closest(".prettyCard"),a=i.dataset,o=a.groupId,s=a.trackCode;if(o&&s)return this.eventLog.addLog({eventType:"group_hidden",groupId:o,trackCode:s}),Object(r.remove)(i),this.slides=null,window.ajax.post("/groups",{act:"hide_recomm_groups_block_group",hash:t,track_code:s,group_id:o}),n&&Object(r.cancelEvent)(n)},e.prototype.hideBlock=function(){var e=Object(r.domData)(this.sliderScrollNode,"code")||"";this.eventLog.addLog({eventType:"block_hidden",trackCode:e}),Object(r.remove)(this.block)},e.prototype.clickOnGroup=function(e){var t=e.dataset,n=t.groupId,i=t.trackCode;n&&i&&this.eventLog.addLog({trackCode:i,groupId:n,eventType:"group_opened"})},e.prototype.clickOnViewAll=function(){var e=Object(r.domData)(this.sliderScrollNode,"code")||"";e&&this.eventLog.addLog({trackCode:e,eventType:"block_expanded"})},e.prototype.viewBlock=function(e){this.eventLog.addLog({trackCode:e,eventType:"block_seen"})},e.prototype.onScroll=function(){if(this.gallery&&this.sliderScrollNode){var e=this.getScrollSizeValues();if(!this.ajaxIsRunning&&e){var t=this.sliderScrollNode.scrollLeft,n=Math.max(0,Math.floor((t-e.leftMargin)/e.itemWidth)),i=Math.max(0,Math.floor((t+e.width-e.leftMargin)/e.itemWidth));n*e.itemWidth+e.itemWidth-e.part<t&&n++,i*e.itemWidth+e.part>t+e.width&&i--;var a=this.getSlides();if(a){n=Math.max(0,n),i=Math.min(a.length,i);for(var o=n;o<=i;o++){var s=a[o];if(s&&!s.viewed){s.viewed=!0;var l=s.dataset,c=l.groupId;(d=l.trackCode)&&c&&this.eventLog.addLog({trackCode:d,groupId:c,eventType:"group_seen"})}}if(!this.allLoaded&&t+e.width>=e.scrollWidth/2){var u=Object(r.domData)(this.sliderScrollNode,"next")||"",d=Object(r.domData)(this.sliderScrollNode,"code")||"";if(!u)return void(this.allLoaded=!0);this.ajaxIsRunning=!0;var _=this;window.ajax.post("/groups",{act:"recommended_carousel",next:u,track_code:d},{onDone:function(e,t){if(e){var n=window.cdf(e);Object(r.append)(n,_.sliderLineNode),_.sliderSizes=null,_.slides=null}Object(r.domData)(_.sliderScrollNode,"next",t||null),_.allLoaded=!t,_.ajaxIsRunning=!1},onFail:function(){return setTimeout((function(){return _.ajaxIsRunning=!1}),500),!1}})}}}}},e.prototype.getScrollSizeValues=function(){var e;if(this.sliderSizes)return this.sliderSizes;var t=this.getSlides(),n=Object(r.getSize)(this.sliderScrollNode)[0],i=Object(r.getX)(this.sliderScrollNode),a=Object(r.getX)(t[0])-i,o=Object(r.getSize)(t[0])[0],s={width:n,itemWidth:o+(Object(r.getX)(t[1])-i-a-o),leftMargin:a,part:Math.floor(o/3),scrollWidth:null===(e=this.sliderScrollNode)||void 0===e?void 0:e.scrollWidth};return this.sliderSizes=s,this.sliderSizes},e.prototype.getSlides=function(){var e;return this.slides||(this.slides=null===(e=this.gallery)||void 0===e?void 0:e.querySelectorAll(".prettyCard")),this.slides},e}();window.RecommendedGroupsSlider=new Vp;n("mPGc"),n("STl5");function $p(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find((function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t}))}var Wp,qp=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function zp(){Wp&&Wp.classList.remove(Na.class.open)}function Yp(){Wp&&Wp.classList.add(Na.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),Object(r.isIosWebView)()||Object(r.isAndroidWebView)()||Object(r.isVkWebView)()||(n||(Wp=Object(r.geByClass1)(Na.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&zp(),$p(t,qp)||nav.getQuery("z")?(zp(),setTimeout(zp)):Yp())}(null,!1)}));var Qp={_onCloseClick:function(e){Na._onCloseClick(e),Object(hn.setCookie)("remixregbtn",0,0)},show:Yp,hide:zp};window.uRegisterFloatBtn=Qp;var Gp,Kp=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function Xp(){Gp&&Gp.classList.remove(Na.class.open)}function Jp(){Gp&&Gp.classList.add(Na.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),n||(Gp=Object(r.geByClass1)(Na.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:ae.default.path,!/^\/photo/.test(t)&&Xp(),$p(t,Kp)||ae.default.getQuery("z")?Xp():Jp()}(null,!1)}));var Zp={_onCloseClick:function(e){Na._onCloseClick(e)},show:Jp,hide:Xp,processOpenInNativeApp:function(e,t,n,i,a){void 0===a&&(a={}),a=a||{},ae.default.onMenuItemClick(n),ae.default.openInNativeApp(i,t,e),Object(r.statlogsValueEvent)("utm_open_in_native_app_button","clicked",a.utm_source,a.utm_param,a.utm_medium,a.utm_time)}};window.uOpenInNativeAppFloatBtn=Zp;var eh=n("7E7W"),th=n("6Ysw");var nh=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(T.default)({icon:Object(eh.getCancelOutline24Icon)()})],class:"Covid19Banner__close",role:"button","aria-label":e.aria_label_close,onClick:["Covid19Banner.close","event","this"],tag:"div"},{inner:[{inner:[Object(T.default)({icon:Object(th.getCovid1964Icon)()})],class:"Covid19Banner__icon",tag:"div"},{inner:[{inner:[e.title],class:"Covid19Banner__title",tag:"h4"},{inner:[e.text,{inner:[e.more],class:"Covid19Banner__link",href:e.url,onClick:"event.preventDefault()",tag:"a"}],class:"Covid19Banner__text",tag:"p"}],class:"Covid19Banner__content",tag:"div"}],class:"Covid19Banner__wrapper",tag:"div"}],class:"Covid19Banner",role:"complementary",onClick:["Covid19Banner.open","event",e.url,e.statlogsEventOpen],tag:"div"}};function ih(){Object(r.throttle)(ah,66)()}function ah(){var e=Object(M.$)(".Covid19Banner__offset");if(e){var t=Object(M.$)(".Covid19Banner").clientHeight;e.style.height=t+"px"}}onDOMReady((function(){!function(){var e=Object(M.$)(".Covid19Banner");if(e){var t=Object(M.$)(".layout"),n=e.clientHeight,i=(a=n,(r=document.createElement("div")).classList.add("Covid19Banner__offset"),r.style.height=a+"px",r);t.appendChild(i)}var a,r}(),window.addEventListener("resize",ih)}));window.Covid19Banner=nh,Object(r.extend)(nh,{open:function(e,t,n){e.preventDefault(),e.stopPropagation(),Object(r.statlogsValueEvent)(n),nav.hard_go(t)},close:function(e,t){var n;e.preventDefault(),e.stopPropagation(),E.default.post("/stats?act=covid_19_banner_close"),t.parentElement.remove(),n=Object(M.$)(".Covid19Banner__offset"),window.removeEventListener("resize",ih),n.remove()}});window.ProfileImageModal={open:function(e,t,n,i,a){var o=Object(G.default)({id:"profile-photo-modal",close:!0,on_overlay_click:"ProfileImageModal.closeModal(this);",items:[Object(K.ModalMenuBtn)({"aria-label":Object(W.getLang)("mobile_profile_photo_modal_album"),inner:Object(W.getLang)("mobile_profile_photo_modal_album"),onclick:"ProfileImageModal.openAlbum('"+decodeURIComponent(e)+"');"}),Object(K.ModalMenuBtn)({"aria-label":Object(W.getLang)("mobile_profile_photo_modal_change"),class:"ModalMenu__btn_overflow",inner:[{tag:"input",type:"file",class:"inline_upload","data-upload-url":decodeURIComponent(t),"data-static-url":decodeURIComponent(i),"data-base-url":decodeURIComponent(n),onclick:"ownerPhotoUpload.prepareInput(this);",onchange:"return ownerPhotoUpload.start(this, event);",accept:decodeURIComponent(a)},Object(W.getLang)("mobile_profile_photo_modal_change")],onclick:"ProfileImageModal.selectImage();"})]});G.default.open(d.default.elem(o),!0),Object(r.statlogsValueEvent)("mvk_profile_image_modal","open");var l=Object(M.$)(".profile_photo_modal_expand");Object(s.expandPopup)(l).exitIntent=function(){Object(r.statlogsValueEvent)("mvk_profile_image_modal","close"),G.default.close()}},openAlbum:function(e){Object(r.statlogsValueEvent)("mvk_profile_image_modal","album"),G.default.close(),nav.go(e)},selectImage:function(){Object(r.statlogsValueEvent)("mvk_profile_image_modal","upload"),G.default.close(),Object(M.$)(".inline_upload").click()},closeModal:function(e){Object(r.statlogsValueEvent)("mvk_profile_image_modal","close"),G.default.close(e)}};var rh=Object(r.need)("page"),oh=Object(r.need)("audio"),sh=Object(r.need)("onDOMReady"),lh=Object(r.need)("audioplayer"),ch=Object(r.need)("AudioSpecialForYou");function uh(){_h(),oh.subscribe([oh.events.INIT,oh.events.SELECT,oh.events.PAUSE],_h),rh.onChange(_h)}function dh(e){var t=e.$btn;ph()?lh.playPause():lh.playFirst(null,t),lh.onPlay(_h),lh.onPause(_h)}function _h(){ch.setPlaying(oh.playing()&&ph())}window.uAudioBlock={},sh(uh),window.uAudioBlock._onSpecialPlayAllClick=dh;var fh=null;function ph(){var e=oh.getCurrentPlaylistId();if(!fh){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(fh=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!fh&&e===fh}var hh=n("9jiJ"),mh={_onMorePopupClose:function(e){return this.expand&&this.expand(),G.default.close(e)},morePopup:function(e,t){var n=parseInt(Object(r.attr)(t,"data-owner_id"),10),i=parseInt(Object(r.attr)(t,"data-playlist_id"),10),a=Object(r.attr)(t,"data-publish_href"),o="true"===Object(r.attr)(t,"data-is_followed"),l=Object(r.attr)(t,"data-follow_hash"),c=l?"/audio?act=follow_playlist&playlist_owner_id="+n+"&playlist_id="+i+"&hash="+l:"";G.default.open(d.default.elem(Object(G.default)({id:"more-"+n+"-"+i,on_overlay_click:["return AudioPlaylist._onMorePopupClose","this"],close:!0,onClose:["return AudioPlaylist._onMorePopupClose","this"],items:[l&&Object(G.ModalMenuBtn)({url:c,class:o?" audioPlaylist__add_added":"",inner:[{inner:o?Object(W.getLang)("mobile_playlist_unfollow"):Object(W.getLang)("mobile_playlist_follow"),tag:"span",class:"audioPlaylistSnippet__buttonText"}],attrs:{"data-playlist_owner_id":n,"data-playlist_id":i,"data-hash":l,"data-follow_text":Object(W.getLang)("mobile_playlist_follow"),"data-unfollow_text":Object(W.getLang)("mobile_playlist_unfollow")},onclick:"return AudioPlaylist.followPlaylist(event, this);"}),Object(G.ModalMenuBtn)({url:a,inner:Object(W.getLang)("mobile_like_publish_title"),onclick:'return AudioPlaylist._onMorePopupClose(this) || nav.go("'+a+'");'})]})),!0),this.expand=Object(s.expandPopup)(e.target)},playPause:function(e,t){Object(r.preventEvent)(e);var n=Object(r.gpeByClass)("_audioSnippet",t),i=Object(r.geByClass1)("audio_item",n);window.audioplayer.playPause(e,Object(r.attr)(i,"data-id")),Object(r.toggleClass)("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){Object(r.preventEvent)(e);var n=Object(r.attr)(t,"data-playlist_owner_id"),i=Object(r.attr)(t,"data-playlist_id"),a=Object(r.attr)(t,"data-hash"),o=Object(r.geByClass1)("_audioPlaylistsPage__item"+n+"_"+i),s=t.querySelector(".audioPlaylistSnippet__buttonText"),l=Object(r.hasClass)("audioPlaylist__add_added",t);s&&(s.innerText=l?Object(r.attr)(t,"data-follow_text"):Object(r.attr)(t,"data-unfollow_text")),Object(r.toggleClass)("audioPlaylistsPage__item_removed",o,l),Object(r.toggleClass)("audioPlaylist__add_added",t),function(e){E.default.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:Object(r.attr)(e,"data-playlist_owner_id"),playlist_id:Object(r.attr)(e,"data-playlist_id"),hash:Object(r.attr)(e,"data-hash")},{redirectToLoginPage:!0})}(t);for(var c=document.querySelectorAll('button[data-owner_id="'+n+'"][data-playlist_id="'+i+'"][data-follow_hash="'+a+'"]'),u=0;u<c.length;u++)Object(r.attr)(c[u],"data-is_followed",l?"false":"true")},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <button class="ai_menu_toggle_button" onclick="AudioPlaylist.morePopup(event, this);" data-owner_id="'+e.owner_id+'" data-playlist_id="'+e.id+'" data-publish_href="'+e.publish_href+'" data-is_followed="'+e.is_followed+'" data-follow_hash="'+e.follow_hash+'" aria-label="'+Object(W.getLang)("mobile_more")+'" aria-haspopup="true" aria-expanded="false" aria-controls="more-'+e.owner_id+"-"+e.id+'"></button>\n                </div>\n             </div>\n             '+e.actions;t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <button class="ai_menu_toggle_button"></button>\n                   </div>\n                 </div>');var i=e.grid_covers;return i||e.thumb_style||(i=d.default.html({class:"audioPlaylistsPage__coverPlaceholder",inner:Object(T.default)(Object(hh.getPlaylistOutline36Icon)())})),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+i+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),Object(r.escapeAttr)(e),Object(W.getLang)("mobile_audio_search_btn");var n=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+Object(W.getLang)("mobile_audio_search_placeholder_simple")+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"};return t?n():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(n)},copyValue:function(e,t){var n=Object(r.val)(e),i=Object(r.ge)(t+"_field");Object(r.val)(i,n),cur&&cur[t]&&cur[t].go();var a=Object(r.geBySel1)(".audioPage__tabs .tab_item_cur");a&&Object(r.toggleClass)("tab_item_cur_noactive",a,n)}};window.AudioPlaylist=mh;n("eJy5");var vh=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:d.default.wrap(t.name)},d.default.wrap(Object(Ba.default)({icon:n}))]}};var gh=vh;window.BookmarksFilterListItem=vh;var Ah=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map((function(e){return{class:"Owner__tag",inner:d.default.wrap(e.name)}}))]:null}};var bh=Ah;window.BookmarksPageItem=Ah;var yh=window.Popup,wh=window.ActionMenu,Oh=window.attr,Sh=window.val,kh=window.ajax,Ch=window.replace,Eh=window.scrollTop,jh=window.ceFromString,Th=window.Btn;window.Bookmarks={hideTagsList:Gh,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=zh(Ih),i=tm();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var a=t.closest(Fh),o=nm(Oh(a,"id"));i=i.filter((function(e){return o.includes(e.id)})),n.classList.add("BookmarksPopup__hideCorner")}var s=Object(r.qs2obj)(nav.params),l=Object.keys(i).reduce((function(e,t){var n=i[t];return e.push(gh({tag:n,current_id:parseInt(s.tag)})),e}),[]),c=d.default.html(l);Sh(n.$(".Popup__scrollContent"),c);var u=Object(M.$$)(Bh,n);u&&u.forEach((function(e){addEvent(e,"click",Gh)}));return!1},hideDeletePopup:Kh,showDeletePopup:function(e){var t=zh(Mh),n=Oh(e,"data-id"),i=Oh(e,"data-hash"),a=Oh(e,"data-name");return rm(t,{id:n,hash:i}),Sh(t.$("["+Hh+"]"),Object(r.htsc)(a)),!1},submitDeleteTag:function(){var e=om(Array.from(Object(M.$$)(Mh)).pop()),t=e.id,n=e.hash;kh.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){qh(e),Kh()}})},hideCreatePopup:Xh,showCreatePopup:function(e){var t=zh(Dh),n=Oh(e,"data-hash");rm(t,{hash:n});var i=Object(M.$)("[name="+Uh+"]",t),a=Object(M.$)(Nh,t),r=Sh(i).trim();return Th.setDisabled(a,!r),!1},submitCreateTag:function(){var e=Array.from(Object(M.$$)(Dh)).pop(),t=Array.from(Object(M.$$)(Lh)).pop(),n=om(e).hash,i=Sh(e.$("[name="+Uh+"]")),a=+!!Object(M.$)(Lh);kh.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:a},{onDone:function(e,n){if(a){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){i.push(e.value)})),Sh(t,e),i.forEach((function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)}))}else qh(e);!function(e){var t=em(),n=e[0],i=e[1];t&&t.tags&&t.tags.push({id:n,name:i,order:0})}(n),Xh()}})},hideEditPopup:Jh,showEditPopup:function(e){var t=zh(Ph),n=Oh(e,"data-id"),i=Oh(e,"data-hash"),a=Oh(e,"data-name")||"",r=t.$("[name="+Vh+"]");Sh(r,a),rm(t,{id:n,hash:i,name:a});var o=Array.from(Object(M.$$)(Nh,t)).pop(),s=Sh(r).trim();return Th.setDisabled(o,!s),!1},submitEditTag:function(){var e=Array.from(Object(M.$$)(Ph)).pop(),t=om(e),n=t.id,i=t.hash,a=Sh(e.$("[name="+Vh+"]"));kh.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:a,hash:i,id:n},{onDone:function(e){qh(e),Jh()}})},hideSettingsPopup:Zh,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,a,r=Oh(e,"data-item_id"),o=Oh(e,"data-item_oid"),s=Oh(e,"data-item_type"),l=Oh(e,"data-hash"),c=Oh(e,"data-raw");t.wrap||(n=zh(xh),i=n.$(Lh),a=nm(c),Sh(i,d.default.html({class:"Bookmarks__tagsSettingsLoading"})),rm(n,{id:r,oid:o,type:s,hash:l,itemRaw:c}));return kh.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:l,item_id:r,item_oid:o,item_type:s,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var u=jh(e);rm(u=zh(u),{id:r,oid:o,type:s,hash:l,itemRaw:c,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else Sh(i,e),a.forEach((function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)}))}}),!1},submitSettingsTags:function(){var e=Array.from(Object(M.$$)(xh)).pop(),t=om(e),n=t.id,i=t.oid,a=t.type,r=t.hash,o=t.itemRaw,s=t.is_from_snackbar,l=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){l.push(e.value)}));var c=l.join(",");kh.post("/bookmarks",{_ajax:1,act:"tag_set",hash:r,item_id:n,item_oid:i,item_type:a,tag_ids:c,is_from_snackbar:s},{onDone:function(e){Zh();var t=Object(M.$)("#"+o);if(t){var n=Object(M.$)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)Sh(n,e);else if(n=Object(M.$)(".Owner__tags",t)){var i=tm(),a=l.map((function(e){return parseInt(e,10)})),r=i.filter((function(e){return a.includes(e.id)})),s=d.default.html(bh({tags:r}));Sh(n.parentNode,s)}cm(o,l,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){Gh(),Kh(),Xh(),Jh(),Zh()},initStore:am,pushItemsToStore:function(e){var t=em();t&&(t.items=Object(j.default)({},t.items,{},e))},pushItemToStore:cm,removeFromBookmarkLink:function(e){var t=Oh(e,"data-item_id"),n=Oh(e,"data-item_oid"),i=Oh(e,"data-item_type"),a=Oh(e,"data-hash"),r=Oh(e,"data-raw"),o=Oh(e,"data-link_url"),s=Oh(e,"data-link_title"),l=Oh(e,"data-link_img"),c=Object(M.$)("#"+r);return wh.closeMenu(),addClass(c,$h),kh.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:a,item_id:t,item_oid:n,item_type:i,link_url:o,link_title:s,link_img:l},{onDone:function(e){lm(r,[$h]),Share.setBookmarkState(r,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=Oh(e,"data-item_id"),n=Oh(e,"data-item_oid"),i=Oh(e,"data-item_type"),a=Oh(e,"data-hash"),r=Oh(e,"data-raw"),o=Oh(e,"data-link_url"),s=Oh(e,"data-link_title"),l=Oh(e,"data-link_img"),c=Object(M.$)("#"+r);return wh.closeMenu(),removeClass(c,$h),kh.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:a,item_id:t,item_oid:n,item_type:i,link_url:o,link_title:s,link_img:l},{onDone:function(){var e=sm(r),t=e.indexOf($h);-1!==t&&e.splice(t,1),lm(r,e),Share.setBookmarkState(r,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,i=Object(r.geByClass1)("RepliesField_fixed");i&&(t=Object(r.getH)(i)+5);Snackbar.init({type:I.SNACKBAR_TYPE_BOOKMARK,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce((function(t,n){return t["data-"+n]=e[n],t}),{})}})},keyupCreateInput:function(e,t){var n=gpeByClass("BookmarksPopup",t),i=Object(M.$)(Nh,n),a=Sh(t).trim();Th.setDisabled(i,!a)},openSavedTab:function(e,t){var n=Object(M.$)(".mm_counter",t),i=Object(hn.getCookie)(Wh);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=Object(M.$)(".mm_new",e);Object(r.remove)(t)},getStoreItemDataById:um,getTagsByItemId:dm,renderSearchItem:function(e,t,n,i,a){var r="";if(!i||isEmpty(i))r=n;else{var o=dm(e),s=sm(e);i=JSON.parse(i),o&&(t=o.reduce((function(e,t){return[].concat(e,[t.id])}),[]),i.subtitle=bh({tags:o})),s&&(i.mix=[].concat(s)),i.title=d.default.wrap(a.highlight(i.title)),r=d.default.html(zr(i))}return cm(e,t,n),r}};var Ih=".BookmarksPopup__filter",Mh=".BookmarksPopup__delete",Dh=".BookmarksPopup__create",Ph=".BookmarksPopup__edit",xh=".BookmarksPopup__settings",Lh=".Bookmarks__tagsSettings",Bh=".Bookmarks__tagsSelectItem",Rh=".basisDefault",Nh=".BookmarksPopup__buttonSubmit",Fh=".BookmarksItem",Hh="data-deletetagname",Uh="createtagname",Vh="edittagname",$h="BookmarksItem_removed",Wh="remixblt";function qh(e){var t=Eh(),n=Object(M.$)(Rh),i=jh(e);Ch(i,n),Eh(t)}function zh(e){var t;wh.closeMenu(),t="string"==typeof e?Object(M.$)(e):e,t=yh.open(t,!0);var n="popup"+Date.now();return Oh(t,"data-popupid",n),t}function Yh(e){return Oh(e,"data-popupid")}function Qh(e){var t;if(t=!("string"==typeof e)?e:Array.from(Object(M.$$)(e)).pop()){yh.close(t);var n=om(t),i=n&&n.needRemove;!function(e){var t=Yh(e);delete em().popup[t]}(t),i&&Object(r.remove)(t)}return!1}function Gh(){var e=Array.from(Object(M.$$)(Ih)).pop(),t=Object(M.$$)(Bh,e);return t&&t.forEach((function(e){removeEvent(e,"click",Gh)})),Qh(e)}function Kh(){return Qh(Mh)}function Xh(){var e=Array.from(Object(M.$$)(Dh)).pop();if(e){var t=e.$("[name="+Uh+"]");Sh(t,"")}return Qh(Dh)}function Jh(){var e=Array.from(Object(M.$$)(Ph)).pop();if(e){var t=e.$("[name="+Vh+"]");Sh(t,"")}return Qh(Ph)}function Zh(){return Qh(xh)}function em(){return window.store.bookmarks||am(),window.store.bookmarks}function tm(){var e=em();return e.tags?e.tags:{}}function nm(e){var t=em();return t.items[e]?t.items[e][3]:[]}function am(e){void 0===e&&(e={}),window.store.bookmarks=Object(j.default)({},e,{popup:{}})}function rm(e,t){var n=Yh(e);em().popup[n]=t}function om(e){var t=Yh(e);return em().popup[t]}function sm(e){var t=em();return t&&t.items&&t.items[e]&&t.items[e][5]}function lm(e,t){var n=em();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function cm(e,t,n,i){var a=em();a&&a.items&&(t=t.map((function(e){return parseInt(e,10)})),a.items[e]?(a.items[e][3]=t,a.items[e][4]=i):a.items[e]=["",n,e,t,i])}function um(e){var t=em();return t&&t.items&&t.items[e]}function dm(e){var t=um(e),n=tm();if(t&&n){var i=t[3]||[];return n.filter((function(e){return i.includes(e.id)}))}return!1}window.uCloseProfileSwitcher={},uCloseProfileSwitcher._onConfirmClick=fm;var _m=null;function fm(e,t){var n=t.checked;ae.default.clear();var i={is_closed:n?"1":"0",_ajax:1};E.default.post(e,i,{onDone:function(){ae.default.reload();var e=window.cur;_m=Object(r.scrollTop)(),e.destroy.push(pm)}})}function pm(){Object(r.scrollTop)(_m),requestAnimationFrame((function(){Object(r.scrollTop)(_m),requestAnimationFrame((function(){Object(r.scrollTop)(_m)}))}))}var hm,mm=function(e,t){void 0===t&&(t={});return{inner:[d.default.wrap(e)],class:"CoronaStatus__tooltip CoronaStatus__tooltip--type"+t.id,onclick:["CoronaStatus.open",t],tag:"span"}};window.page.onChange((function(){hm&&K.default.close(hm)}));window.CoronaStatus=mm,Object(W.extend)(mm,{open:function(e){void 0===e&&(e={}),Object(r.cancelEvent)(),Object(r.statlogsValueEvent)("corona_status_stat","show_tooltip");var t=d.default.elem(Object(K.default)({class:"CoronaStatus",items:[Object(K.ModalMenuHeaderCloseButton)(),Object(K.ModalMenuIcon)({inner:{class:"CoronaStatus__icon CoronaStatus__icon--type"+e.id}}),Object(K.ModalMenuTitle)({inner:d.default.wrap(e.title)}),Object(K.ModalMenuBody)({inner:d.default.wrap(e.text)}),Object(K.ModalMenuBtn)({url:"/covid19#utm_source=vk&utm_medium=cpc&utm_campaign=status_tooltip_mvk",theme:"regular",size:"large",isBtn:!0,inner:Object(W.getLang)("mobile_special_covid_status_modal_go_button"),onclick:"window.CoronaStatus.sendStat()"})]}));hm=K.default.open(t,!0)},sendStat:function(){Object(r.statlogsValueEvent)("corona_status_stat","open_app")}});function vm(e){void 0===e&&(e={});var t=e,n=t.url,i=t.type,a=t.url_x2;if(!n)return"";var r="";return a&&(r=a+" 2x"),{inner:[{inner:[{src:n,srcSet:r,class:"ImageStatus__image ImageStatus__image--"+i,tag:"img"}],class:"ImageStatus__imageFrame",tag:"div"}],class:"ImageStatus__imageWrapper",tag:"div"}}function gm(e){var t=e.backgrounds,n=void 0===t?{}:t,i=e.themeKey,a="";return n[i]&&n[i]&&(a=n[i]),a?{class:"ImageStatus__background",style:'background-image: url("'+a+'")',tag:"div"}:""}var Am;window.page.onChange((function(){Am&&K.default.close(Am)})),window.ImageStatus={open:function(e){void 0===e&&(e={}),Object(r.cancelEvent)();var t=e,n=t.user_id,i=t.special_id,a=d.default.elem(Object(K.default)({class:"ImageStatus",items:[{class:"ImageStatus__preload",inner:d.default.wrap(Object(La.default)())}]}));Am=K.default.open(a,!0,"image_status");var s=Object(M.$)(".Popup__content",Am);ajax.post("/special_event",{act:i?"special_event":"image_status",user_id:n},{onDone:function(e){var t,n=e.status_id,a=e.color,r=void 0===a?{}:a,l=e.backgrounds,c=void 0===l?{}:l;t=o.colorScheme.isDarkScheme()?"dark":"light";var u=[Object(K.ModalMenuHeaderCloseButton)(),gm({backgrounds:c,themeKey:t}),vm(e.image),Object(K.ModalMenuTitle)({inner:d.default.wrap(e.title)})];e.description&&u.push(Object(K.ModalMenuBody)({inner:d.default.wrap(e.description)})),e.participants&&u.push(function(e){void 0===e&&(e={});var t=e,n=t.images,i=t.text,a=t.addition;return{inner:[{inner:[n.map((function(e){return{inner:[{src:e,class:"ImageStatus__participantImage",tag:"img"}],class:"ImageStatus__participantWrapper",tag:"div"}})),a?{inner:[{inner:["+"+a],class:"ImageStatus__participantAddition",tag:"div"}],class:"ImageStatus__participantWrapper",tag:"div"}:""],class:"ImageStatus__participantsWrapper",tag:"div"},{inner:[i],class:"ImageStatus__participantsText",tag:"div"}],class:"ImageStatus__participants",tag:"div"}}(e.participants)),(e.buttons||[]).forEach((function(e){u.push(Object(K.ModalMenuBtn)({url:e.url,theme:e.type,size:"large",isBtn:!0,inner:e.title,onclick:i?"window.SpecialEvent && window.SpecialEvent.sendStats('popup_action');":"ImageStatus.sendStat("+n+");",attrs:{target:"_blank"}}))})),u.push(function(e){void 0===e&&(e={});var t=e.terms;return t?{inner:[d.default.wrap(t)],class:"ImageStatus__terms",tag:"div"}:""}(e)),Array.from(s.childNodes).forEach((function(e){s.removeChild(e)})),r[t]&&(s.style.backgroundColor="#"+r[t]),s.append(d.default.elem({class:"ImageStatus__inner",inner:u})),i&&window.SpecialEvent?window.SpecialEvent.sendStats("popup_showed"):Object(Bn.saveStatlogEvents)({name:"image_status",value:n,keys:["show_popup"]})},onFail:function(){K.default.close(Am)}})},sendStat:function(e){e&&Object(Bn.saveStatlogEvents)({name:"image_status",value:e,keys:["popup_action"]})}};var bm=n("Ubt6"),ym=n("mIGa"),wm=n("U+Ks"),Om=n("+QBn"),Sm=n("3PCX"),km=n("4RAq"),Cm=function(e){var t=Object(W.getLang)("mobile_promo_vkconnect_agreement");return t=(t=t.replace("{link1}",'<a href="'+e.terms_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link1}","</a>")).replace("{link2}",'<a href="'+e.privacy_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link2}","</a>"),t=d.default.wrap(t),{inner:[{inner:[Object(T.default)({icon:Object(ym.getVkconnectLogoIcon)()}),{inner:[Object(T.default)({icon:Object(wm.getHelpOutline28Icon)()})],href:e.learn_more_url,target:"_blank",class:"PromoVKConnect__help",tag:"a"}],class:"PromoVKConnect__header",tag:"div"},{inner:[Object(W.getLang)("mobile_promo_vkconnect_title")],class:"PromoVKConnect__title",tag:"h1"},{inner:[{inner:[{inner:[Object(T.default)({icon:Object(Om.getMagicWandOutline28Icon)()})],class:"PromoVKConnect__listIcon",tag:"div"},Object(W.getLang)("mobile_promo_vkconnect_list1")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(T.default)({icon:Object(Sm.getUserCircleOutline28Icon)()})],class:"PromoVKConnect__listIcon",tag:"div"},Object(W.getLang)("mobile_promo_vkconnect_list2")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(T.default)({icon:Object(km.getCheckShieldOutline28Icon)()})],class:"PromoVKConnect__listIcon",tag:"div"},Object(W.getLang)("mobile_promo_vkconnect_list3")],class:"PromoVKConnect__listItem",tag:"li"}],class:"PromoVKConnect__list",tag:"ul"},{inner:[Object(wt.default)({inner:[Object(W.getLang)("mobile_promo_vkconnect_button")],size:"large",class:"PromoVKConnect__button",onClick:["PromoVKConnect.accept","event","this",e.hash],use_native_onclick:!0}),{inner:[t],class:"PromoVKConnect__agreement",tag:"div"}],class:"PromoVKConnect__footer",tag:"div"}],class:"PromoVKConnect ScrollView",tag:"div"}};var Em={init:function(e){var t=this;onDOMReady((function(){return t.open(e)}))},open:function(e){var t=Object(G.default)({on_overlay_click:[],class:"PromoVKConnectModal",attached:!0,body:Cm(e)});G.default.open(Wd.elem(t),!0,"",{swipeDown:!1})},accept:function(e,t,n){var i=this;e.preventDefault(),wt.default.setLoading(t,!0,"white"),E.default.post("/",{act:"vkconnect_accept",hash:n},{onDone:function(){i.showTooltip(),G.default.close()},onFail:function(){i.showTooltip(),G.default.close()}})},showTooltip:function(){var e=Object(M.$)(".BottomMenu__cell:nth-child(5) .BottomMenu__icon"),t=Wd.elem(Object(bm.default)({pos:"top_right",theme:"accent",inner:getLang("mobile_promo_vkconnect_tooltip")}));e.appendChild(t)}};window.PromoVKConnect=Em;var jm=function(e){void 0===e&&(e={});var t=e.storiesCount?"window.showNarrative("+e.ownerId+", "+e.id+", 0, 'narratives"+e.ownerId+"'); return false;":null;return{inner:[{inner:[{class:"NarrativesBlockItem__coverImage",style:"background-image: url('"+e.coverUrl,tag:"div"}],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[e.title],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem",onClick:t,tag:"div"}},Tm=n("3ai+"),Im=n("NElm"),Mm=n("j+hY");var Dm=function(e){void 0===e&&(e={});var t=c.default.class("NarrativesBlock",{empty:e.isEmpty,collapsed:e.isCollapsed},"--"),n=Object(W.getNumShort)(e.hiddenNarrativesCount),i=Object(W.makeUrl)("narratives",{act:"create",owner_id:e.ownerId});return e.isEmpty?{inner:[Object(Gr.default)(),{inner:[{inner:[{inner:[Object(W.getLang)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:"0",class:"slim_header_cnt",tag:"span"},{inner:[Object(T.default)({icon:Object(Tm.getChevronRight24Icon)()})],class:"slim_header_rl",tag:"span"}],class:"slim_header",tag:"div"}],class:"NarrativesBlock__header",onClick:["NarrativesBlock.onToggle","event"],tag:"div"},{inner:[Object(wt.default)({inner:[Object(W.getLang)("mobile_narratives_block_create_narrative_label")],theme:"none",url:"/narratives?act=create&owner_id="+e.ownerId,class:"NarrativesBlock__createBtn",icon:Object(T.default)(Object(Im.getNarrativeOutline24Icon)())}),{inner:[Object(W.getLang)("mobile_narratives_block_empty_description")],class:"NarrativesBlock__emptyPlaceholder",tag:"p"}],class:"NarrativesBlock__content",tag:"div"},Object(Gr.default)()],class:t,tag:"div"}:{inner:[Object(Gr.default)(),{inner:[{inner:[{inner:[Object(W.getLang)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:[e.narrativesTotalCount],class:"slim_header_cnt",tag:"span"},{inner:[Object(T.default)({icon:Object(Tm.getChevronRight24Icon)()})],class:"slim_header_rl",tag:"span"}],class:"slim_header",tag:"div"}],class:"NarrativesBlock__header link_header",href:"/narratives?owner_id="+e.ownerId,rel:"noopener",tag:"a"},Object(ur.default)({inner:[e.isCreateBlockVisible?{inner:[{inner:[Object(T.default)({icon:Object(Mm.getAdd24Icon)()})],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[Object(W.getLang)("mobile_narratives_block_create_narrative_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--create",href:i,tag:"a"}:null,e.narratives.map((function(e){return jm(e)})),e.isMoreBlockVisible?{inner:[{inner:["+",n],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[Object(W.getLang)("mobile_narratives_block_more_narratives_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--more",href:"/narratives?owner_id="+e.ownerId,tag:"a"}:null],mix:"NarrativesBlock__content"}),Object(Gr.default)()],class:t,tag:"div"}};Object.assign(Dm,{onToggle:function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.closest(".NarrativesBlock");if(!n)return n;n.classList.toggle("NarrativesBlock--collapsed");n.classList.contains("NarrativesBlock--collapsed")}}),window.NarrativesBlock=Dm;window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,i,a){return Object(r.statlogsValueEvent)("groups_menu_item_click",e,t,n,i,a),!0};var Pm=function(e){void 0===e&&(e={});var t=window.lang;return Object(G.default)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:Object(T.default)(Object(sl.getHideOutline56Icon)())},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[Object(G.ModalMenuBtn)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:t.mobile_back,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),Object(G.ModalMenuBtn)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:t.mobile_groups_warning_notification_proceed,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}})]})};window.WarningModal=Pm,extend(Pm,{close:function(e,t){t&&t.preventDefault(),K.default.close(e),E.default.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:Object(r.domData)(e,"id"),group_id:Object(r.domData)(e,"gid"),hash:Object(r.domData)(e,"hash")})},leave:function(e,t){t&&t.preventDefault(),K.default.close(e),Object(M.$)("#m .header__back").click()}}),window.Donut={help:function(e,t){var n=geByClass1("Tooltip",e);if(n)return;return n=d.default.elem(Object(bm.default)({pos:"left",inner:lang.mobile_donut_info_text})),e.appendChild(n),Object(r.cancelEvent)(t)}};n("KiYr");var xm=n("z1UI"),Lm=(n("5sv7"),n("svF/"));function Bm(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return Object(xm.default)({icon_raw:t,title:e.title,text:e.description,action_text:e.action_text,action_url:e.action_url,before:Rm(e),class:"DonutPaymentInfo"})}function Rm(e){return void 0===e&&(e={}),{inner:["form"===e.layout?[{inner:[{inner:[Object(T.default)(Object(Lm.getDonut12Icon)())],class:"DonutPayment__avatarIcon",tag:"div"}],class:"DonutPayment__avatar",style:"background-image: url("+e.avatar+")",tag:"div"},{inner:[e.title],class:"DonutPayment__title",tag:"h2"},e.description?{inner:[e.description],class:"DonutPayment__description",tag:"span"}:null]:null],class:"DonutPayment__header",tag:"div"}}var Nm=n("b6Sp"),Fm=n("LmmP"),Hm=n("WWoJ"),Um=n("qDz2"),Vm=n("P6H+"),$m=n("qBU/"),Wm={},qm=0;var zm=function(){qm+=1};function Ym(){Gm({icon:{inner:[Object(T.default)(Object(ft.getLoading40Icon)())],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"},type:"loading",title:Object(r.getLang)("mobile_donut_payment_info_waiting"),description:Object(r.getLang)("mobile_donut_payment_info_waiting_text")})}function Qm(e){var t=e.message,n=Object(Hm.default)({inner:[Object(Fm.default)({inner:[t],theme:"error"})],style:{small_paddings:!0}}),i=Object(M.$)('[data-section-ref="donut_payment_form_error"]');i&&(i.innerHTML=d.default.html(n))}function Gm(e){void 0===e&&(e={});var t=Object(M.$)('[data-section-ref="donut_payment_content"]');if(t){var n=e.type;try{t.innerHTML=d.default.html(Bm({icon:e.icon,layout:"info",type:n,title:e.title||Object(r.getLang)("mobile_donut_payment_info_error"),description:e.description||"",action_text:("success"===n||"error"===n)&&Object(r.getLang)("mobile_donut_payment_button"),action_url:e.continueButtonURL||window.nav.path}))}catch(e){console.error(e)}}}function Km(e){var t=e.checkSuccess,n=e.onCancel,i=e.onFailure,o=e.onTimeout,s=e.paymentURL,l=e.paymentWindow,c=qm;window.clog("Open VK Pay window. Starting payment check"),l.location=s,Gm({icon:{inner:[Object(T.default)(Object(ft.getLoading40Icon)())],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"},type:"loading",title:Object(r.getLang)("mobile_donut_payment_info_waiting"),description:Object(r.getLang)("mobile_donut_payment_info_waiting_text")});var d=setInterval((function(){if(c!==qm)return clearInterval(d),void f();l&&l.window&&!l.window.closed||(window.clog("VK Pay window was manually closed. Unsubscribing from events"),clearInterval(d),f(),n())}),500),_=function(e){if(c===qm)if("externalAppDone"===e.data.method&&e.data.params.status){window.clog("Received VK Pay done event. Waiting for payment success check"),f(),clearInterval(d);var n=Date.now(),r=!0,s=setInterval((function(){if(c===qm){if(r)return Date.now()-n>=1e3*(Wm.waitingTimeSec||5)?(window.clog("Payment check timeout. Showing done info."),clearInterval(s),r=!1,void o()):void t().then((function(){if(!r)return!1;window.clog("Payment check succeeded. Showing done info"),clearInterval(s),r=!1})).catch((function(){}))}else clearInterval(s)}),1e3);ev(a.RESULT_PAYMENT_SUCCESS_WAITING)}else"closeApp"!==e.data.method&&"externalAppFail"!==e.data.method||(window.clog("Received VK Pay close or fail event. Unsubscribing from events"),f(),i());else f()};window.addEventListener("message",_,!1);var f=function(){window.removeEventListener("message",_,!1)};Object(u.onEmitOnce)(window.nav.onBeforeGo,(function(){f()}))}function Xm(e){var t=e.description;Gm({icon:{inner:[Object(T.default)(Object(Um.getCheckCircleOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(r.getLang)("mobile_donut_payment_change_amount_changed_title"),description:t,continueButtonURL:Wm.backURL}),ev(a.RESULT_CHANGE_SUCCESS_OK)}function Jm(e){void 0===e&&(e=!1),Object(r.toggleClass)("DonutPayment__customAmount--visible",Object(M.$)('[data-section-ref="custom_price_input_container"]'),e)}function Zm(e,t,n){b.logEventAction(Object(j.default)({event_type:e,owner_id:Wm.ownerId,screen:t||a.UNKNOWN,source:Wm.source},n))}function ev(e,t){Zm(i.PAYMENT_FORM,e,t)}function tv(){Zm(i.PAYMENT_FORM_CLICK_OFFER,a.PAYMENT_START)}function nv(){var e=window.open("");return null==e||e.focus(),null==e||e.document.write(Object(r.getLang)("mobile_donut_payment_info_waiting")),Object(u.onEmitOnce)(window.nav.onBeforeGo,(function(){return null==e?void 0:e.close()})),e}var iv={init:function(e){var t=e.backURL,n=e.isCustomPriceVisible,i=e.ownerId,a=e.source,o=e.type,s=e.waitingTimeSec;qm+=1,Wm={backURL:t,ownerId:i,source:a,type:o,waitingTimeSec:s};var l,c=Object(M.$)("#custom_price_input"),d=c&&c.checked;Jm(n||d),"subscribe"===o&&(l=Object(M.$)('[data-section-ref="donut_payment_external_links"]'))&&Object(r.addEvent)(l,"click",(function(e){Object(r.matchesSelector)(e.target,"a")&&tv()})),Object(u.onEmitOnce)(window.nav.onBeforeGo,zm)},onCustomAmountChange:function(e,t){return Object(M.$)("#custom_price_input").checked=!0,ea.default.filter("number",e,t)},onLegalExternalLinkClick:tv,onFormSubmit:function(e,t){e.preventDefault();var n=Object(Nm.getFormValues)(t),i=Object(_t.parseURL)(t.action);"subscribe"===Wm.type&&function(e,t,n){var i=qm,o=Object(r.submitBtn)(n);wt.default.setLoading(o,!0);var s=nv();E.default.post(e.requestUri,t,{onDone:function(e){i===qm&&(wt.default.setLoading(o,!1),Ym(),function(e,t,n){Km({paymentURL:e,paymentWindow:n,checkSuccess:function(){return new Promise((function(e,n){E.default.post(t,{},{onDone:function(t){if(t.status)return e(t),void function(e){Gm({icon:{inner:[Object(T.default)(Object(Um.getCheckCircleOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(r.getLang)("mobile_donut_payment_info_success"),description:e.text}),ev(a.RESULT_PAYMENT_SUCCESS_OK)}(t);n()},onFail:function(){n()}})}))},onCancel:function(){Gm({icon:{inner:[Object(T.default)(Object(Vm.getErrorOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(r.getLang)("mobile_donut_payment_info_error"),description:Object(r.getLang)("mobile_donut_payment_info_canceled_text")}),ev(a.RESULT_PAYMENT_CANCEL)},onFailure:function(){Gm({icon:{inner:[Object(T.default)(Object(Vm.getErrorOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(r.getLang)("mobile_donut_payment_info_error"),description:Object(r.getLang)("mobile_donut_payment_info_canceled_text")}),ev(a.RESULT_ERROR)},onTimeout:function(){Gm({icon:{inner:[Object(T.default)(Object($m.getRecentOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(r.getLang)("mobile_donut_payment_info_success"),description:Object(r.getLang)("mobile_donut_payment_info_success_later_text")}),ev(a.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT)}})}(e,Object(_t.makeUrl)(window.nav.path,{act:"donut_payment_check",hash:t.hash}),s))},onFail:function(){wt.default.setLoading(o,!1),Qm({message:Object(r.getLang)("mobile_unknown_error")}),s.close()}})}(i,n,t),"change"===Wm.type&&function(e,t,n){var i=qm,o=Object(r.submitBtn)(n);wt.default.setLoading(o,!0),s=Object(M.$)('[data-section-ref="donut_payment_form_error"]'),s&&(s.innerHTML="");var s;var l=(u=t,-1===Number(u.price)?Number(u.custom_price):Number(u.price)),c=nv();var u;E.default.post(e.requestUri,t,{onDone:function(e){if(i===qm&&(wt.default.setLoading(o,!1),e))return e.error?(Qm({message:e.error}),void c.close()):void(e.paymentRequiredToComplete?function(e,t,n){var i=qm,o=Object(_t.makeUrl)(window.nav.path,{act:"donut_payment_change_check",hash:e.check_hash}),s=function(){Gm({icon:{inner:[Object(T.default)(Object(Vm.getErrorOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"error",title:Object(r.getLang)("mobile_donut_payment_info_error"),description:Object(r.getLang)("mobile_donut_payment_info_canceled_text"),continueButtonURL:Wm.backURL}),ev(a.RESULT_CHANGE_ERROR)};Km({paymentURL:e.paymentURL,paymentWindow:n,checkSuccess:function(){return new Promise((function(n,r){E.default.post(o,{},{onDone:function(o){if(i===qm)return o.amount===t?(n(),Xm({description:e.successDescription}),void ev(a.RESULT_CHANGE_SUCCESS_OK)):void r()},onFail:function(){r()}})}))},onCancel:s,onFailure:s,onTimeout:function(){Gm({icon:{inner:[Object(T.default)(Object($m.getRecentOutline56Icon)())],class:"SplashScreen__icon",tag:"div"},type:"success",title:Object(r.getLang)("mobile_donut_payment_change_timeout_error_title"),description:Object(r.getLang)("mobile_donut_payment_change_timeout_error_description"),continueButtonURL:Wm.backURL}),ev(a.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT)}}),Ym()}(e,l,c):(Xm({description:e.successDescription}),c.close()))},onFail:function(){wt.default.setLoading(o,!1),Qm({message:Object(r.getLang)("mobile_unknown_error")}),c.close()}})}(i,n,t)},onPriceRadioChange:function(e){Jm(-1===Number(e.value))}};window.DonutPayment=iv;var av=!1,rv={start:function(e,t,n){if("%page_id%"!==e&&!av){var i;switch(av=!0,n&&"%page_path%"!==n?n:ae.default.cur){case"/feed":i=Od.TAB_ID_FEED;break;case"/feed?section=recommended":i=Od.TAB_ID_RECOMMEND;break;case"/mail":i=Od.TAB_ID_MESSAGES;break;case"/feed?section=notifications":i=Od.TAB_ID_NOTIFICATION}i&&innerWidth<882?Od.drawSkeletonLoader(Object(M.$)(".layout__basis"),i):(Od.drawLoader(Object(M.$)(".layout__basis")),Object(r.alLoadingFix)()),setTimeout((function(){var i={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){}};ajax.onNavDone(rv.onStarted),n&&"%page_path%"!==n?ae.default.go(n,{push_only:!0,replace:!0},i):ae.default.go(ae.default.cur,null,i)}))}},onStarted:function(){ajax.onNavDone.off(rv.onStarted),Object(ie.calculateTimeOffsets)()}},ov=rv;window.AppShell=ov;var sv={reload:function(e){wt.default.setDisabled(e,!0),!1===navigator.onLine?setTimeout((function(){wt.default.setDisabled(e,!1)}),500):ae.default.reload()}};window.OfflinePage=sv;var lv=n("2mXy");var cv=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)}))],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&Object(wt.default)({inner:[Object(W.getLang)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}},uv=function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map((function(e){return e+": "+t[e]})).join("\n");E.default.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=Object(j.default)({},t),n}Object(ci.default)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return d.default.preact(cv,Object(j.default)({},this.state,{onSendClick:this.onSendClick}))},t}(lv.Component);function dv(){var e=$("#DeviceInfo");d.default.hydrate(uv,Object(W.getState)("DeviceInfo"),e)}_.default.getRouter().addRoute("/?device",dv),window.initDeviceInfo=dv;var _v=n("iChR"),fv=n("UDoE");function pv(e){if(!e)return!1;var t={},n=Object(M.$$)(".StoryThumb[data-time]",e);n&&n.forEach((function(e,i){var a=n[i-1],o=a&&1e3*a.getAttribute("data-time"),s=o&&new Date(o),l=s&&s.toDateString(),c=1e3*e.getAttribute("data-time"),u=new Date(c).toDateString(),d=l===u,_=Object(r.geByClass1)("StoryThumbDate",e);t[u]&&t[u]!==c&&d?Object(r.setStyle)(_,"display","none"):(t[u]=c,Object(r.setStyle)(_,"display","block"))}))}var hv=function(e){void 0===e&&(e={});var t=c.default.class("StoryThumb",{draggable:e.isDraggable},"--"),n=c.default.class("StoryThumb__checkbox",{checked:e.isSelected},"--"),i=e.story||{},a=e.onClick?e.onClick:i.isUnavailable?null:["Stories.init",i.rawId+"/"+i.listId];return{inner:[{inner:[{inner:[i.day],class:"StoryThumbDate__day",tag:"div"},{inner:[i.month],class:"StoryThumbDate__month",tag:"div"}],class:"StoryThumbDate",tag:"div"},e.isSelectable?{inner:[Object(T.default)({icon:Object(fv.getCheckboxCheck24Icon)()})],class:n,onClick:[e.onStoryThumbCheckboxClick,"event",e.story],tag:"div"}:null,i.isUnavailable?{inner:[{inner:[Object(T.default)({icon:Object(_v.getError24Icon)()})],class:"StoryThumbUnavailable__icon",tag:"div"},{inner:[Object(W.getLang)("mobile_stories_archive_unavailable_label")],class:"StoryThumbUnavailable__label",tag:"div"}],class:"StoryThumbUnavailable",tag:"div"}:null],class:t,onClick:a,style:i.isUnavailable?null:"background-image: url("+i.preview+")","data-time":i.time,"data-story-id":i.id,tag:"div"}},mv=n("Wccy"),vv=n("La8/"),gv=n("UTGD");var Av=function(e){void 0===e&&(e={});var t=e.stories&&0===e.stories.length,n=e.selectedStories&&e.selectedStories.length,i=0===n,a=c.default.class("StoriesArchive",{editable:e.isEdit},"--"),r=["StoriesArchive__stories",e.isLoading?"_si_container_loading":null];return t?Object(Os.default)({inner:[{inner:[Object(T.default)({icon:Object(mv.getArchiveOutline56Icon)()})],class:"StoriesArchiveEmpty__icon",tag:"div"},{inner:[Object(W.getLang)("mobile_stories_archive_empty_label")],class:"StoriesArchiveEmpty__label",tag:"div"}],mix:"StoriesArchive StoriesArchiveEmpty"}):Object(Os.default)({inner:[{inner:[e.stories.map((function(t){var n=Object(W.arraySomeEqual)(e.selectedStories,"id",t.id);return hv({isSelectable:e.isEdit,isSelected:n,story:t,onStoryThumbCheckboxClick:e.onStoryThumbCheckboxClick})}))],class:r,ref:e.storiesArchiveStoriesWrapperRef,tag:"div"},e.isLoading?d.default.wrap(Object(La.default)({mix:"StoriesArchive__spinner"})):null,e.isEdit?{inner:[{inner:[i?Object(W.getLang)("mobile_stories_archive_select_at_least_one"):Object(W.getLangNumeric)(n,Object(W.getLang)("mobile_stories_archive_selected_stories_title","raw")),i?null:{inner:[Object(T.default)({icon:Object(vv.getCancel12Icon)()})],class:"StoriesArchiveActions__resetSelectedIcon",onClick:e.onResetSelectedStoriesClick,tag:"div"}],class:"StoriesArchiveActions__selected",tag:"div"},{inner:[Object(wt.default)({inner:[Object(W.getLang)("mobile_stories_archive_remove")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--delete",theme:"secondary",onClick:e.onDeleteStoriesActionClick,disabled:!e.selectedStories.length||e.isCreateNarrativeActionLoading,isLoading:e.isDeleteActionLoading,icon:Object(T.default)(Object(gv.getDeleteOutline24Icon)())}),Object(wt.default)({inner:[Object(W.getLang)("mobile_stories_archive_to_narrative")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--narrative",theme:"secondary",onClick:e.onCreateNarrativeActionClick,disabled:!e.selectedStories.length||e.isDeleteActionLoading,isLoading:e.isCreateNarrativeActionLoading,icon:Object(T.default)(Object(Im.getNarrativeOutline24Icon)())})],class:"StoriesArchiveActions__buttons",tag:"div"}],class:"StoriesArchiveActions",ref:e.storiesArchiveActionsRef,tag:"div"}:null],mix:a,ref:e.storiesArchiveRef})},bv=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),yv=function(){return(yv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},wv=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},Ov=function(e){function t(t){var n,i,a=e.call(this,t)||this;return a.storiesArchiveRef=Object(lv.createRef)(),a.storiesArchiveStoriesWrapperRef=Object(lv.createRef)(),a.storiesArchiveActionsRef=Object(lv.createRef)(),a.state=yv(yv({},t),{storiesLoadedCount:null===(n=t.stories)||void 0===n?void 0:n.length,isLoading:!1,isAllLoaded:(null===(i=t.stories)||void 0===i?void 0:i.length)>=t.storiesTotalCount,selectedStories:[]}),a.deleteSelectedStories=a.deleteSelectedStories.bind(a),a.createNarrativeFromSelectedStories=a.createNarrativeFromSelectedStories.bind(a),a.resetSelectedStories=a.resetSelectedStories.bind(a),a.onStoryThumbCheckboxClick=a.onStoryThumbCheckboxClick.bind(a),a}return bv(t,e),t.prototype.componentDidMount=function(){var e=this;pv(this.storiesArchiveStoriesWrapperRef.current),Object(r.initStickySimulator)((function(){return e.storiesArchiveRef.current}),(function(){return e.storiesArchiveActionsRef.current}),{shouldCalculateAudioPlayer:!0}),Object(r.initAutoScroll)((function(){var t=Object(M.$$)(".StoryThumb",e.storiesArchiveStoriesWrapperRef.current);return t[t.length-1]}),this.loadStories.bind(this))},t.prototype.componentDidUpdate=function(){pv(this.storiesArchiveStoriesWrapperRef.current)},t.prototype.loadStories=function(){var e=this;if(this.state.isLoading||this.state.isAllLoaded)return!1;this.setState({isLoading:!0}),ajax.post("stories",{act:"archive_list",offset:this.state.storiesLoadedCount,owner_id:this.state.ownerId,_ajax:!0},{onDone:function(t){var n=wv(e.state.stories,t.stories||[]),i=n.length>=t.storiesTotalCount;e.setState({stories:n,storiesLoadedCount:n.length,storiesTotalCount:t.storiesTotalCount,isAllLoaded:i,isLoading:!1})}})},t.prototype.deleteSelectedStories=function(){var e,t=this,n=this;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;var i=Object(W.getLangNumeric)(this.state.selectedStories.length,Object(W.getLang)("mobile_stories_archive_confirm_stories_delete_message","raw")),a=Object(Tl.Confirm)(i,(function(){var e;t.setState({isDeleteActionLoading:!0}),_n.default.close(a),ajax.post("stories.php",{_ajax:!0,act:"remove_stories",remove_stories_hash:t.state.removeStoriesHash,owner_id:t.state.ownerId,story_ids:null===(e=t.state.selectedStories)||void 0===e?void 0:e.map((function(e){return e.id})).join(",")},{onDone:function(e){var t,i,a=e.deletedStoryIds||[];n.setState({stories:null===(t=n.state.stories)||void 0===t?void 0:t.filter((function(e){return!a.includes(e.id)})),selectedStories:null===(i=n.state.selectedStories)||void 0===i?void 0:i.filter((function(e){return!a.includes(e.id)})),isDeleteActionLoading:!1,storiesTotalCount:n.state.storiesTotalCount-a.length,storiesLoadedCount:n.state.storiesLoadedCount-a.length}),I.init({type:I.SNACKBAR_TYPE_SUCCESS,text:Object(W.getLang)("mobile_stories_archive_stories_deleted_successful")})},onFail:function(){n.setState({isDeleteActionLoading:!1})}})}),null,{yes_label:Object(W.getLang)("mobile_stories_archive_remove"),withoutPopupCloning:!0})},t.prototype.createNarrativeFromSelectedStories=function(){var e,t,n;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;if((null===(t=this.state.selectedStories)||void 0===t?void 0:t.length)>100)I.init({type:I.SNACKBAR_TYPE_ERROR,text:Object(W.getLangNumeric)(100,Object(W.getLang)("mobile_stories_archive_max_narrative_stories_count_alert","raw"))});else{var i=null===(n=this.state.selectedStories)||void 0===n?void 0:n.map((function(e){return e.id})),a=Object(W.makeUrl)("narratives",{act:"create",owner_id:this.props.ownerId,selected:(null==i?void 0:i.length)?i.join(","):null});nav.go(a),this.setState({isCreateNarrativeActionLoading:!0})}},t.prototype.resetSelectedStories=function(){this.setState({selectedStories:[]})},t.prototype.onStoryThumbCheckboxClick=function(e,t){if(e.preventDefault(),e.stopPropagation(),t){var n=wv(this.state.selectedStories);n.some((function(e){return e.id===t.id}))?n=n.filter((function(e){return e.id!==t.id})):n.push(t),this.setState({selectedStories:n})}},t.prototype.render=function(){return d.default.preact(Av,yv(yv({},this.state),{onStoryThumbCheckboxClick:this.onStoryThumbCheckboxClick,onResetSelectedStoriesClick:this.resetSelectedStories,onDeleteStoriesActionClick:this.deleteSelectedStories,onCreateNarrativeActionClick:this.createNarrativeFromSelectedStories,storiesArchiveRef:this.storiesArchiveRef,storiesArchiveStoriesWrapperRef:this.storiesArchiveStoriesWrapperRef,storiesArchiveActionsRef:this.storiesArchiveActionsRef}))},t}(lv.Component);function Sv(){var e=Object(W.getState)("StoriesArchive"),t=Object(M.$)("#StoriesArchive");d.default.mountPreactComponent(Ov,e,t)}_.default.getRouter().addRoute(/^\/?stories_archive/,Sv),window.initStoriesArchive=Sv;var kv=n("UknS");var Cv,Ev=function(e){void 0===e&&(e={});var t=e.tabs||[],n=c.default.class("NarrativeForm__preview",{covered:e&&e.coverStory},"--");return Object(xm.default)({inner:[{inner:[{inner:[{inner:[{inner:[Object(T.default)({icon:Object(kv.getPictureOutline28Icon)()})],class:n,onClick:e.onCoverClick,style:e.coverStory?"background-image: url("+e.coverStory.preview+");":null,tag:"div"},{inner:[Object(Xr.RowLabeledInput)({maxlength:e.narrativeTitleMaxLength,on_change:e.onNarrativeTitleChange,label:Object(W.getLang)("mobile_narratives_create_page_name_input_label"),value:Object(W.winToUtf)(e.narrativeTitle),placeholder:Object(W.getLang)("mobile_narratives_create_page_name_input_placeholder")})],class:"NarrativeForm__details",tag:"div"}],class:"NarrativeForm__headerContent NarrativesSeparator NarrativesSeparator--before",tag:"div"}],class:"NarrativeForm__header",tag:"div"},{inner:[{inner:[t.map((function(t){var n=c.default.class("NarrativeFormTabs__tab",{active:t.active,disabled:t.disabled},"--");return{inner:[t.text],disabled:t.disabled,type:"button",class:n,onClick:[e.onTabChange,t.label],tag:"button"}}))],class:"NarrativeFormTabs",tag:"div"},{inner:[{inner:[{inner:[("selected"===e.activeTab?e.selectedStories:e.stories).map((function(t){var n=Object(W.arraySomeEqual)(e.selectedStories,"id",t.id)&&!Object(W.arraySomeEqual)(e.uncheckedStories,"id",t.id),i="selected"===e.activeTab&&e.selectedStories&&e.selectedStories.length>1;return hv({story:t,isDraggable:i,isSelectable:!0,isSelected:n,onStoryThumbCheckboxClick:e.onStoryThumbCheckboxClick})}))],class:"StoriesArchive__stories",ref:e.storiesArchiveStoriesWrapperRef,tag:"div"}],class:"StoriesArchive",ref:e.storiesArchiveRef,tag:"div"}],class:"NarrativeFormStories__content",tag:"div"}],class:"NarrativeFormStories",tag:"div"},{type:"submit",id:"NarrativeForm__submit",disabled:!e.isSubmitAvailable,class:"NarrativeForm__submit",tag:"button"}],class:"NarrativeForm__content",onSubmit:e.onFormSubmit,tag:"form"}],class:"NarrativeForm"})};!function(e){e.SELECTED="selected",e.ALL="all"}(Cv||(Cv={}));var jv=n("YS7c"),Tv=n.n(jv);var Iv=function(e){return void 0===e&&(e={}),{inner:[{inner:[e.stories.map((function(t){var n=t.id===e.coverStory.id;return hv({story:t,isSelectable:n,isSelected:n,onClick:[e.onSelect,t]})}))],class:"StoriesArchive__stories",tag:"div"}],class:"StoriesArchive",tag:"div"}};var Mv=function(e){return void 0===e&&(e={}),{inner:[{inner:[{inner:[Object(wt.default)({inner:[Object(T.default)({icon:e.isLeftActionBack?Object(dl.getBackOutline28Icon)():Object(Ol.getCancelOutline28Icon)()})],theme:"header",class:"ModalPage__headerButton",onClick:e.onLeftActionClick,use_native_onclick:!0,is_icon:!0}),{inner:[e.title],class:"ModalPage__headerTitle",tag:"div"}],class:"ModalPage__header",tag:"div"},{inner:[e.content],class:"ModalPage__content",id:e.contentId,tag:"div"}],class:"ModalPage__wrapper",tag:"div"}],class:"Popup ModalPage",tag:"div"}},Dv=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Pv=function(){return(Pv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},xv=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},Lv=function(e){function t(t){var n,i,a,r=e.call(this,t)||this;r.storiesArchiveRef=Object(lv.createRef)(),r.storiesArchiveStoriesWrapperRef=Object(lv.createRef)();var o=(null===(n=t.stories)||void 0===n?void 0:n.length)>=t.storiesTotalCount,s=t.selectedStories||[],l=t.coverStory,c=l||s[0],u=s.length?Cv.SELECTED:Cv.ALL,d=t.narrativeTitleMaxLength||23,_=null===(i=t.narrativeTitle)||void 0===i?void 0:i.trim();return r.state=Pv(Pv({},t),{narrativeTitle:_,selectedStories:s,activeTab:u,coverStory:c,pinnedCoverStory:l,uncheckedStories:[],storiesLoadedCount:null===(a=t.stories)||void 0===a?void 0:a.length,isLoading:!1,isAllLoaded:o,narrativeTitleMaxLength:d}),r.onStoryThumbCheckboxClick=r.onStoryThumbCheckboxClick.bind(r),r.onTabChange=r.onTabChange.bind(r),r.onNarrativeTitleChange=r.onNarrativeTitleChange.bind(r),r.onFormSubmit=r.onFormSubmit.bind(r),r.onCoverClick=r.openCoverSelector.bind(r),r}return Dv(t,e),t.prototype.onNarrativeTitleChange=function(e){this.setState({narrativeTitle:e.target.value})},t.prototype.componentDidMount=function(){var e=this;this.headerSubmitBtn=Object(M.$)(".NarrativeForm__headerSubmitBtn"),this.updateHeaderSubmitBtn(),pv(this.storiesArchiveStoriesWrapperRef.current),this.initDraggable(),Object(r.initAutoScroll)((function(){var t=Object(M.$$)(".StoryThumb",e.storiesArchiveStoriesWrapperRef.current);return t[t.length-1]}),this.loadStories.bind(this))},t.prototype.componentDidUpdate=function(){pv(this.storiesArchiveStoriesWrapperRef.current),this.updateHeaderSubmitBtn()},t.prototype.componentWillUpdate=function(e,t){this.updateCoverStory(t)},t.prototype.updateCoverStory=function(e){var t=this.getSelectedStoriesExcludeUnchecked(e.selectedStories,e.uncheckedStories);if(e.pinnedCoverStory&&(null==t?void 0:t.some((function(t){var n;return t.id===(null===(n=e.pinnedCoverStory)||void 0===n?void 0:n.id)}))))return void this.setState({coverStory:e.pinnedCoverStory});this.setState({coverStory:t[0]})},Object.defineProperty(t.prototype,"isSubmitAvailable",{get:function(){var e,t,n,i,a,r,o,s=Number(null===(t=null===(e=this.state)||void 0===e?void 0:e.selectedStories)||void 0===t?void 0:t.length)-Number(null===(i=null===(n=this.state)||void 0===n?void 0:n.uncheckedStories)||void 0===i?void 0:i.length)>0,l=Boolean(null===(a=this.state.narrativeTitle)||void 0===a?void 0:a.trim().length);return this.props.isEdit?this.isNarrativeChanged(this.getSelectedStoriesExcludeUnchecked(null===(r=this.state)||void 0===r?void 0:r.selectedStories,null===(o=this.state)||void 0===o?void 0:o.uncheckedStories),this.state.narrativeTitle):s&&l},enumerable:!0,configurable:!0}),t.prototype.isNarrativeChanged=function(e,t){var n,i,a,r,o,s=function(e){return null==e?void 0:e.map((function(e){return e.id})).join("")},l=s(e)===s(this.props.selectedStories),c=(null===(i=null===(n=this.props)||void 0===n?void 0:n.coverStory)||void 0===i?void 0:i.id)!==(null===(r=null===(a=this.state)||void 0===a?void 0:a.coverStory)||void 0===r?void 0:r.id);return(null==t?void 0:t.trim())!==(null===(o=this.props.narrativeTitle)||void 0===o?void 0:o.trim())||!l||c},t.prototype.updateHeaderSubmitBtn=function(){this.isSubmitAvailable?this.headerSubmitBtn.classList.remove("NarrativeForm__headerSubmitBtn--disabled"):this.headerSubmitBtn.classList.add("NarrativeForm__headerSubmitBtn--disabled")},t.prototype.loadStories=function(){var e=this;if(this.state.isLoading||this.state.isAllLoaded||this.state.activeTab===Cv.SELECTED)return!1;this.setState({isLoading:!0},(function(){ajax.post("/stories?act=archive_list",{offset:e.state.storiesLoadedCount,owner_id:e.state.ownerId,_ajax:!0},{onDone:function(t){var n=xv(e.state.stories,t.stories||[]),i=n.length>=t.storiesTotalCount;e.setState({stories:n,storiesLoadedCount:n.length,storiesTotalCount:t.storiesTotalCount,isAllLoaded:i,isLoading:!1})}})}))},t.prototype.onStoryThumbCheckboxClick=function(e,t){var n;if(e.preventDefault(),e.stopPropagation(),t){var i=this.state.activeTab===Cv.ALL?xv(this.state.selectedStories):xv(this.state.uncheckedStories),a=this.state.activeTab===Cv.ALL?"selectedStories":"uncheckedStories",r=i.some((function(e){return e.id===t.id}));if(this.state.activeTab===Cv.ALL){if(i.length>=100&&!r)return}else{(e.target&&e.target.classList.contains("StoryThumb__checkbox")?e.target:e.target.closest(".StoryThumb__checkbox")).classList.toggle("StoryThumb__checkbox--checked")}r?i=i.filter((function(e){return e.id!==t.id})):i.push(t),this.setState(((n={})[a]=i,n))}},t.prototype.onTabChange=function(e){this.state.activeTab!==e&&(this.setState({activeTab:e}),this.synchronizeUncheckedAndSelectedStories())},t.prototype.synchronizeUncheckedAndSelectedStories=function(e){var t=this.getSelectedStoriesExcludeUnchecked(this.state.selectedStories,this.state.uncheckedStories);return this.setState({selectedStories:t,uncheckedStories:[]},e),t},t.prototype.getSelectedStoriesExcludeUnchecked=function(e,t){return null==e?void 0:e.filter((function(e){return!(null==t?void 0:t.some((function(t){return t.id===e.id})))}))},t.prototype.onFormSubmit=function(e){},t.prototype.initDraggable=function(){var e=this;Tv()({isContainer:function(t){var n;return t===(null===(n=e.storiesArchiveStoriesWrapperRef)||void 0===n?void 0:n.current)},moves:function(e){return Boolean(null==e?void 0:e.classList.contains("StoryThumb--draggable"))}}).on("dragend",(function(t){var n,i=xv(e.state.selectedStories),a=Number(t.getAttribute("data-story-id")),r=i.findIndex((function(e){return e.id===a})),o=Array.from(null===(n=e.storiesArchiveStoriesWrapperRef)||void 0===n?void 0:n.current.children).indexOf(t);if(r!==o){var s=i.splice(r,1)[0];i.splice(o,0,s),e.setState({selectedStories:i},(function(){return pv(e.storiesArchiveStoriesWrapperRef.current)}))}}))},t.prototype.openCoverSelector=function(){var e=this,t=this.getSelectedStoriesExcludeUnchecked(this.state.selectedStories,this.state.uncheckedStories);if(!(null==t?void 0:t.length)||t.length<=1)return!1;var n=d.default.preactElem(Mv,{contentId:"NarrativeFormCoverSelector",title:Object(W.getLang)("mobile_narratives_cover_selector_page_title"),onLeftActionClick:function(){_n.default.close(e.coverSelectorPopup)}});d.default.mountPreactTemplate(Iv,{stories:t,coverStory:this.state.coverStory,onSelect:function(t){_n.default.close(e.coverSelectorPopup),e.setState({pinnedCoverStory:t})}},Object(M.$)("#NarrativeFormCoverSelector",n)),this.coverSelectorPopup=_n.default.open(n,!0,{withoutCloning:!0}),pv(n)},t.prototype.render=function(){var e,t,n=[{label:Cv.SELECTED,text:Object(W.getLang)("mobile_narratives_create_page_selected_tab_title"),active:this.state.activeTab===Cv.SELECTED,disabled:!Boolean(null===(t=null===(e=this.state)||void 0===e?void 0:e.selectedStories)||void 0===t?void 0:t.length)},{label:Cv.ALL,text:Object(W.getLang)("mobile_narratives_create_page_all_tab_title"),active:this.state.activeTab===Cv.ALL}];return d.default.preact(Ev,Pv(Pv({},this.state),{tabs:n,onStoryThumbCheckboxClick:this.onStoryThumbCheckboxClick,onNarrativeTitleChange:this.onNarrativeTitleChange,isSubmitAvailable:this.isSubmitAvailable,onCoverClick:this.onCoverClick,onFormSubmit:this.onFormSubmit,onTabChange:this.onTabChange,storiesArchiveRef:this.storiesArchiveRef,storiesArchiveStoriesWrapperRef:this.storiesArchiveStoriesWrapperRef}))},t}(lv.Component),Bv=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Rv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bv(t,e),t.prototype.onFormSubmit=function(e){var t=this,n=this;e.preventDefault(),this.synchronizeUncheckedAndSelectedStories((function(){var e,i;ajax.post("narratives",{act:"publish",owner_id:t.props.ownerId,hash:t.props.publishNarrativeHash,cover_story_id:null===(e=t.state.coverStory)||void 0===e?void 0:e.id,story_ids:null===(i=t.state.selectedStories)||void 0===i?void 0:i.map((function(e){return e.id})).join(","),title:t.state.narrativeTitle},{onDone:function(e){I.init({type:I.SNACKBAR_TYPE_SUCCESS,avatar:e.preview,text:Object(W.getLangReplace)(Object(W.getLang)("mobile_narratives_success_created"),{narrative_title:Object(W.winToUtf)(e.title)})}),n.setState({selectedStories:[],uncheckedStories:[],narrativeTitle:"",activeTab:Cv.ALL}),nav.go(window.location.pathname+"?owner_id="+n.props.ownerId)}})}))},t}(Lv);function Nv(){var e=Object(W.getState)("NarrativesCreate"),t=Object(M.$)("#NarrativesCreate");d.default.mountPreactComponent(Rv,e,t)}_.default.getRouter().addRoute(/^\/?narratives\?act=create/,Nv),window.initNarrativesCreate=Nv;var Fv=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Hv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fv(t,e),t.prototype.onFormSubmit=function(e){var t=this,n=this;e.preventDefault(),this.synchronizeUncheckedAndSelectedStories((function(){var e,i;ajax.post("narratives",{act:"update",owner_id:t.props.ownerId,hash:t.props.editNarrativeHash,cover_story_id:null===(e=t.state.coverStory)||void 0===e?void 0:e.id,story_ids:null===(i=t.state.selectedStories)||void 0===i?void 0:i.map((function(e){return e.id})).join(","),title:t.state.narrativeTitle,narrative_raw_id:t.props.narrativeRawId},{onDone:function(e){var t;I.init({type:I.SNACKBAR_TYPE_SUCCESS,avatar:e.preview,text:Object(W.getLangReplace)(Object(W.getLang)("mobile_narratives_success_updated"),{narrative_title:Object(W.winToUtf)(e.title)})}),n.setState({narrativeTitle:e.title,activeTab:(null===(t=n.state.selectedStories)||void 0===t?void 0:t.length)?Cv.SELECTED:Cv.ALL}),nav.go(window.location.pathname+"?owner_id="+n.props.ownerId)}})}))},t}(Lv);function Uv(){var e=Object(W.getState)("NarrativesEdit"),t=Object(M.$)("#NarrativesEdit");e.isEdit=!0,d.default.mountPreactComponent(Hv,e,t)}_.default.getRouter().addRoute(/^\/?narratives\?act=edit/,Uv),window.initNarrativesEdit=Uv;var Vv=n("GzIP");var $v=function(e){void 0===e&&(e={});var t=e.storiesCount?"window.showNarrative("+e.ownerId+", "+e.id+", 0, 'narratives"+e.ownerId+"'); return false;":null,n=0===e.storiesCount,i=c.default.class("NarrativesListItem",{draft:n},"--");return{inner:[{inner:[n?Object(T.default)({icon:Object(Vv.getNarrativeActiveOutline24Icon)()}):{class:"NarrativesListItem__coverImage",style:"background-image: url("+e.coverUrl+");",tag:"div"}],class:"NarrativesListItem__cover",onClick:t,tag:"div"},{inner:[{inner:[Object(W.winToUtf)(e.title)],class:"NarrativesListItem__name",tag:"div"},{inner:[Object(W.getLangNumeric)(e.storiesCount,Object(W.getLang)("mobile_narratives_stories_count","raw")),n?{inner:["\n               · \n              ",Object(W.getLang)("mobile_narratives_draft")],tag:"span"}:null],class:"NarrativesListItem__storiesCount",tag:"div"}],class:"NarrativesListItem__description",tag:"div"}],class:i,tag:"div"}},Wv=n("Ex+q"),qv=n("7ADY");var zv=function(e){void 0===e&&(e={});var t=c.default.class("NarrativesList",{withFooter:e.isSaveActionAvailable},"--"),n=Object(W.makeUrl)("narratives",{act:"create",owner_id:e.ownerId,selected:e.selectedStoryIds?e.selectedStoryIds.join(","):null}),i=!e.selectedNarrative,a=e.isSaveActionAvailable&&!i,r=!e.isEdit&&e.isActionsMenuAvailable;return Object(Os.default)({inner:[e.isCreateBtnVisible?Object(wt.default)({inner:[Object(W.getLang)("mobile_narratives_create_narrative_label")],theme:"none",url:n,class:"NarrativesList__createBtn",icon:Object(T.default)({icon:Object(Mm.getAdd24Icon)()})}):null,{inner:[e.narratives.map((function(t){var n=c.default.class("NarrativesListNarrative",{sortable:e.isEdit},"--");return{inner:[e.isSelectActionAvailable?{inner:[Object(T.default)({sprite:"stories",name:"checkbox_check"})],class:"NarrativesListNarrative__actionIcon NarrativesListNarrative__checkbox",onClick:[e.onCheckboxClick,"this",t],tag:"div"}:null,e.isEdit?{inner:[Object(T.default)({icon:Object(Wv.getReorder24Icon)()})],class:"NarrativesListNarrative__actionIcon",tag:"div"}:null,$v(t),r?{inner:[Object(T.default)({icon:Object(ws.getMoreHorizontal16Icon)()})],class:"NarrativesListNarrative__actionIcon NarrativesListNarrative__actionIcon--edit",onClick:[e.onEditMenuClick,t],tag:"div"}:null,e.isEdit?{inner:[Object(T.default)({icon:Object(qv.getCancel24Icon)()})],class:"NarrativesListNarrative__actionIcon",onClick:[e.onDeleteNarrativeClick,t],tag:"div"}:null],class:n,"data-narrative-id":t.id,tag:"div"}}))],class:"NarrativesList__narratives",ref:e.narrativesListNarrativesRef,tag:"div"},e.isTotalCountVisible?{inner:[Object(W.getLangNumeric)(e.narrativesTotalCount,Object(W.getLang)("mobile_narratives_count","raw"))],class:"NarrativesList__narrativesCount",tag:"div"}:null,a?{inner:[Object(wt.default)({inner:[Object(W.getLang)("mobile_narratives_list_save_button_label")],onClick:e.onSaveClick,disabled:i,stretch:!0})],class:"NarrativesListActions",ref:e.narrativesListActionsRef,tag:"div"}:null],mix:t,ref:e.narrativesListRef})},Yv=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Qv=function(){return(Qv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Gv=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},Kv=function(e){function t(t){var n,i=e.call(this,t)||this;i.narrativesListRef=Object(lv.createRef)(),i.narrativesListNarrativesRef=Object(lv.createRef)(),i.narrativesListActionsRef=Object(lv.createRef)(),i.actionsContextMenu=null,i.reorderNarrative=function(e){var t,n=Gv(i.state.narratives),a=Number(e.getAttribute("data-narrative-id")),r=n.findIndex((function(e){return e.id===a})),o=Array.from(null===(t=i.narrativesListNarrativesRef)||void 0===t?void 0:t.current.children).indexOf(e);if(r!==o){var s=Gv(n),l=s.splice(r,1)[0];s.splice(o,0,l),i.setState({narratives:s});var c=s[o-1],u=s[o+1];ajax.post("narratives",{act:"reorder",hash:i.props.reorderNarrativeHash,owner_id:i.props.ownerId,narrative_id:l.id,before_narrative_id:null==u?void 0:u.id,after_narrative_id:null==c?void 0:c.id},{onFail:function(){i.setState({narratives:n})}})}};var a=t.narratives||[],r=(null===(n=t.narratives)||void 0===n?void 0:n.length)||0;return i.state=Qv(Qv({},t),{narratives:a,isLoading:!1,isAllLoaded:r===t.narrativesTotalCount,narrativesLoadedCount:r}),i.onEditMenuClick=i.onEditMenuClick.bind(i),i.deleteNarrative=i.deleteNarrative.bind(i),i.onCheckboxClick=i.onCheckboxClick.bind(i),i.onSaveClick=i.onSaveClick.bind(i),i}return Yv(t,e),t.prototype.componentDidMount=function(){var e=this;Object(r.initStickySimulator)((function(){return e.narrativesListRef.current}),(function(){return e.narrativesListActionsRef.current}),{shouldCalculateAudioPlayer:!0}),Object(r.initAutoScroll)((function(){var t=Object(M.$$)(".NarrativesListNarrative",e.narrativesListNarrativesRef.current);return t[t.length-1]}),this.loadNarratives.bind(this)),this.props.forceFirstLoading&&this.loadNarratives(),this.state.isEdit&&this.initSortable()},t.prototype.initSortable=function(){var e=this;Tv()({isContainer:function(t){var n;return t===(null===(n=e.narrativesListNarrativesRef)||void 0===n?void 0:n.current)},moves:function(e){return Boolean(null==e?void 0:e.classList.contains("NarrativesListNarrative--sortable"))}}).on("dragend",this.reorderNarrative)},t.prototype.deleteNarrative=function(e){var t=this,n=this,i=Object(W.winToUtf)(Object(W.getLangReplace)(Object(W.getLang)("mobile_narratives_confirm_narrative_delete_message"),{narrative_title:e.title})),a=Object(Tl.Confirm)(i,(function(){Popup.close(a),le.ContextMenu.close(t.actionsContextMenu),ajax.post("narratives",{act:"remove",hash:t.props.removeNarrativeHash,owner_id:t.props.ownerId,narrative_id:e.id},{onDone:function(){I.init({type:I.SNACKBAR_TYPE_SUCCESS,text:Object(W.winToUtf)(Object(W.getLangReplace)(Object(W.getLang)("mobile_stories_narratives_remove_success"),{narrative_title:e.title}))});var t=Gv(n.state.narratives).filter((function(t){return t.id!==e.id}));n.setState({narratives:t,narrativesTotalCount:n.state.narrativesTotalCount-1,narrativesLoadedCount:n.state.narrativesLoadedCount-1})}})}),null,{yes_label:Object(W.getLang)("mobile_stories_narratives_remove_button_label"),withoutPopupCloning:!0})},t.prototype.shareNarrative=function(e){le.ContextMenu.close(this.actionsContextMenu),window.Share(e.rawId,{mail_hash:this.props.shareNarrativeMailHash,object:"narrative"+e.rawId,is_bookmarked:e.bookmarked,bookmark_hash:e.bookmarkHash,bookmark_type:31,can_bookmark:!0,can_to_own:!this.props.isClosedGroup,can_to_club:!this.props.isClosedGroup,shouldInteractWithGlobalStories:!1})},t.prototype.updateNarrativeBookmarkStatus=function(e,t){var n=Gv(this.state.narratives),i=null==n?void 0:n.findIndex((function(t){return t.id===e.id}));n[i].bookmarked=t,this.setState({narratives:n})},t.prototype.toggleNarrativeBookmark=function(e){var t=this;le.ContextMenu.close(this.actionsContextMenu);var n=e.bookmarked;this.updateNarrativeBookmarkStatus(e,!n),ajax.post("bookmarks.php",{_ajax:1,act:n?"bookmark_remove":"bookmark_add",item_type:31,item_oid:e.ownerId,item_id:e.id,hash:e.bookmarkHash,ref:cur.module},{onDone:function(){I.init({type:I.SNACKBAR_TYPE_SUCCESS,text:Object(W.winToUtf)(Object(W.getLangReplace)(Object(W.getLang)(n?"mobile_stories_narratives_removed_from_bookmarks":"mobile_stories_narratives_added_to_bookmarks"),{narrative_title:e.title}))})},onFail:function(){t.updateNarrativeBookmarkStatus(e,n)}})},t.prototype.prepareActionsMenu=function(e){var t=this,n=this.props.ownerId,i=this.props.isCanEdit,a=Object(W.makeUrl)("narratives",{act:"edit",owner_id:n,narrative_id:e.id}),r=Object(le.ContextMenu)({withoutWrap:!0,list:[Object(le.ContextMenuItem)({title:e.bookmarked?Object(W.getLang)("mobile_narratives_list_action_save_remove"):Object(W.getLang)("mobile_narratives_list_action_save_fave"),onclick:function(){return t.toggleNarrativeBookmark(e)}}),i&&Object(le.ContextMenuItem)({title:Object(W.getLang)("mobile_narratives_list_action_edit"),href:a}),Object(le.ContextMenuItem)({title:Object(W.getLang)("mobile_narratives_list_action_share"),onclick:function(){return t.shareNarrative(e)}}),i&&Object(le.ContextMenuItem)({title:Object(W.getLang)("mobile_narratives_list_action_delete"),onclick:function(){return t.deleteNarrative(e)}})].filter(Boolean)});return d.default.preactElemFromTemplate(r)},t.prototype.loadNarratives=function(){var e=this;if(this.state.isLoading||this.state.isAllLoaded)return!1;this.setState({isLoading:!0}),ajax.post("narratives",{act:"narratives_list",start_from:this.state.nextStartFrom,owner_id:this.state.ownerId,_ajax:!0},{onDone:function(t){var n=Gv(e.state.narratives,t.narratives||[]),i=n.length>=t.narrativesTotalCount;e.setState({narratives:n,narrativesLoadedCount:n.length,narrativesTotalCount:t.narrativesTotalCount,isAllLoaded:i,isLoading:!1,nextStartFrom:t.nextStartFrom})}})},t.prototype.onEditMenuClick=function(e){var t=this.prepareActionsMenu(e);t.parentNode.id="NarrativesListActionsMenu",this.actionsContextMenu=le.ContextMenu.open(t,"#NarrativesListActionsMenu",{appendToBody:!0,withoutPopupCloning:!0})},t.prototype.onCheckboxClick=function(e,t){var n=e.classList.contains("NarrativesListNarrative__checkbox")?e:e.closest(".NarrativesListNarrative__checkbox");if(n){var i=n.classList.contains("NarrativesListNarrative__checkbox--checked"),a=Object(M.$$)(".NarrativesListNarrative__checkbox",this.narrativesListNarrativesRef.current);a&&a.forEach((function(e){return e.classList.remove("NarrativesListNarrative__checkbox--checked")})),i||e.classList.add("NarrativesListNarrative__checkbox--checked"),this.setState({selectedNarrative:i?void 0:t})}},t.prototype.onSaveClick=function(){this.props.onSaveClick&&this.props.onSaveClick(this.state.selectedNarrative)},t.prototype.render=function(){return d.default.preact(zv,Qv(Qv({},this.state),{onEditMenuClick:this.onEditMenuClick,onDeleteNarrativeClick:this.deleteNarrative,onCheckboxClick:this.onCheckboxClick,onSaveClick:this.onSaveClick,narrativesListRef:this.narrativesListRef,narrativesListNarrativesRef:this.narrativesListNarrativesRef,narrativesListActionsRef:this.narrativesListActionsRef}))},t}(lv.Component);function Xv(){var e=Object(W.getState)("NarrativesList"),t=Object(M.$)("#NarrativesList");d.default.mountPreactComponent(Kv,e,t)}_.default.getRouter().addRoute((function(e){return/^\/?narratives/.test(e)&&!/(\?|&)act=/.test(e)||/(\?|&)act=config/.test(e)}),Xv),window.initNarrativesList=Xv;var Jv={screens:[],hash:"",replacedScreen:"",isEnabled:!1},Zv={setHash:function(e){Jv.hash=e},getHash:function(){return Jv.hash},getScreens:function(){var e=[];return Jv.screens.forEach((function(t){e.push(t)})),e},replaceScreen:function(e){Jv.replacedScreen=e},setScreen:function(e){Jv.screens.push(e),Jv.screens.length>5&&Jv.screens.shift()},getScreen:function(){return""!==Jv.replacedScreen?Jv.replacedScreen:Jv.screens.length>0?Jv.screens[Jv.screens.length-1]:""},getPrevScreen:function(){return Jv.screens.length>1?Jv.screens[Jv.screens.length-2]:""},popScreen:function(){return Jv.screens.length>0?String(Jv.screens.pop()):""},setEnabled:function(e){Jv.isEnabled=e},isEnabled:function(){return Jv.isEnabled}};window.MarketAnalyticsManager=Zv;var eg=n("vOeY");Object(f.initStaticManager)(),Object(r.addEvent)(window,"scroll touchmove",(function(){Object(r.onBodyScroll)(!0)}),{passive:!0});var tg=window,ng=tg.thover,ig=tg.ajax;function ag(){if(Object(r.lsGet)("custom_opts"))return Object(r.addClass)("_copts","vk_wrap");var e=Object(r.ce)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});Object(r.append)(e,"vk_utils");var t=Object(r.ge)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&(Object(r.addClass)("_copts","vk_wrap"),Object(r.lsSet)("custom_opts",1)),Object(r.remove)(e)}Object(r.addEvent)(document,"touchmove touchcancel",ng.cancel,{passive:!0}),Object(r.addEvent)(document,"touchend",ng.end,{passive:!0}),ig.enabled=!0,ig.enabled&&(onDOMReady((function(){Object(r.remove)("app_go_frame"),ig.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),Object(r.addClass)("_js","vk_wrap")})),page.clear()),onDOMReady((function(){_.default.getRouter().checkRoutes(),window.page&&page.onChange((function(){return _.default.getRouter().checkRoutes()}));var e=document.getElementById("utils");e||((e=document.createElement("div")).id="utils",document.body.insertAdjacentElement("afterbegin",e)),window.utilsNode=e})),onDOMReady(k.resizePosters),Object(r.addEvent)(window,"resize",k.resizePosters),Object(r.addEvent)(document,"touchstart",(function(e){var t=Object(r.checkTouchHover)(e.target);ng.clear(),t&&ng.start.call(t,e)}),{passive:!0}),Object(r.addEvent)(document,"click",(function(e){if(e.target.dataset.logEvent&&w(e.target.dataset.logEvent),Object(r.ajaxLayoutEnabled)()){var t=Object(r.gpeByClass)("al_after",e.target);if(t){var n=Object(r.attr)(t,"data-target"),i=!!n&&Object(r.geByClass1)(n,t);if(i&&!nav.go_after(i,e)||!nav.go_after(t,e))return}var a=Object(r.matchesSelector)(e.target,".mi_text a");if(O.SAKIntegration.isIntegrated&&a)e.target.target="_blank";else{var o=Object(r.checkNav)(e.target,{allow_post_away:!0});if(o&&(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),nav.go(o,e)||Object(r.cancelEvent)(e)),"bookmarks"===cur.module){var s=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!s)return;var l=s.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],c=l[0],u=l[1],d=l[2],_=l[3];if(!(c&&u&&d&&_))return;var f=!1;switch(u){case"link":f=e.target.closest('a[target="_blank"]');break;case"page":f=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!f)return;Object(Y.statlogsValueEvent)("bookmarks_product_analytics",{item_type:u,item_owner_id:intval(d),item_id:intval(_),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}})),Object(r.addEvent)(document,"submit",(function(e){var t=e.target;Object(r.hasClass)("vk_js_yes",geByTag1("html"))&&!Object(r.hasClass)("opera_mini_yes",geByTag1("body"))&&Object(r.hasClass)("qsearch",t)&&Object(r.gpeByClass)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),Object(r.cancelEvent)(e))})),Object(r.addEvent)(document,C.isTouch?"touchstart":"mousedown",(function(e){tooltip.closeByTap(e)}),{passive:!0}),onDOMReady(ag),onDOMReady((function(){Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isFlexboxSupported)()),"flexbox"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isMatchMediaSupported)()),"match_media"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isCSSVariablesSupported)()),"css_variables"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isAutoSchemesSupported)()),"auto_change_scheme"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isSupportsSupported)()),"css_supports"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isGridsSupported)()),"grids"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isSVGSupported)()),"svg"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isIntersectionObserverSupported)()),"intersection_observer"),Object(Y.statlogsValueEvent)("mvk_feature_is_supported",Number(Object(Q.isWebRTCCallsSupported)()),"webrtc_calls"),Object(Y.statlogsValueEvent)("mvk_dark_theme",Number(Object(Q.isDarkTheme)()),"current"),function(){var e={is_schemes_supported:Object(Q.isCSSVariablesSupported)(),is_auto_schemes_supported:Object(Q.isAutoSchemesSupported)(),current_scheme:Object(Q.isDarkTheme)()?2:Object(Q.isLightTheme)()},t=Object.keys(e).sort().map((function(t){return t+":"+Number(e[t])})).join("/");if(localStorage&&localStorage.getItem){var n=localStorage.getItem("supportedFeatures");null!==n&&t===n||(localStorage.setItem("supportedFeatures",t),Object(Y.statlogsValueEvent)("browser_features",t))}}()})),[!Object(Q.isSVGSupported)()].some((function(e){return e}))&&onDOMReady((function(){UnsupportedBrowser.show()})),onDOMReady(ie.calculateTimeOffsets),Object(r.sgFix)(),onDOMReady((function(){var e=window.vk;e&&!e.id&&Object(r.lsCheck)()&&localStorage.clear(),Object(ie.partConfigEnabled)("mvk_experiment_perf")&&(clog("performance experiment enabled"),Object(r.addEvent)(document,"touchstart touchmove touchend",(function(e){window.__experiment||(window.__experiment={}),window.__experiment.ts=(e&&e.timeStamp||0)+ +Date.now()})))})),window.optionsTest=ag,zlayer.isReady=!0,window.PasswordInput={toggleVisibility:function(e,t,n){void 0===n&&(n=!1),(n?Object(M.$$)(".PasswordInput .PasswordInput__button"):t).forEach((function(e){setTimeout((function(){var t="true"===e.getAttribute("aria-expanded"),n=Object(ea.getNative)(e.closest(".TextInput"));e.setAttribute("aria-expanded",t?"false":"true"),n.setAttribute("type",t?"password":"text"),e.innerHTML=Wd.html(Object(T.default)({icon:t?Object(Zr.getViewOutline24Icon)():Object(eo.getHideOutline24Icon)()}))}),0)}));var i=t.closest(".TextInput"),a=Object(M.$)(".TextInput__native",i),r=document.activeElement===a||i.classList.contains("TextInput--focused");function o(){!r||Object(s.isTabbing)()?(e.preventDefault(),e.stopPropagation(),t.focus()):a.focus()}o(),setTimeout((function(){return o()}))}},window.isNewMail&&(n("4bPz"),n("s0aB"),n("/Id8"),n("DkIl"),n("CkGd"),n("iS9e"),n("fWqt"),n("QBkA"),n("rKp0"),n("u33z"),n("A6le"),n("SNk7"),n("JCKH"),n("1KAK"),n("eWFs"),n("drfJ"),n("V2dH"),n("PUg3"),n("3pHe")),window.Form=eg.Form,onDOMReady((function(){g.addStatEvent(g.getModule(),h.NavigationProductionStatEventTypes.TAB_OPEN)})),C.default.android&&Object(Y.statlogsValueEvent)("mvk_pixel_ratio",window.devicePixelRatio||1)},"8/JR":function(e,t,n){"use strict";var i=n("8T9/"),a=n("Ibf7");e.exports=function(e,t){var n=t||{},r={};return void 0===e&&(e={}),e.on=function(t,n){return r[t]?r[t].push(n):r[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var i=arguments.length;if(1===i)delete r[t];else if(0===i)r={};else{var a=r[t];if(!a)return e;a.splice(a.indexOf(n),1)}return e},e.emit=function(){var t=i(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var o=(r[t]||[]).slice(0);return function(){var r=i(arguments),s=this||e;if("error"===t&&!1!==n.throws&&!o.length)throw 1===r.length?r[0]:r;return o.forEach((function(i){n.async?a(i,r,s):i.apply(s,r),i._once&&e.off(t,i)})),e}},e}},"8T9/":function(e,t){e.exports=function(e,t){return Array.prototype.slice.call(e,t)}},"8ZMO":function(e,t,n){"use strict";n.r(t);var i=function(e){return{class:["Anchor",e.mix],id:e.id,tag:"div"}};t.default=i},9:function(e,t,n){e.exports=n("75Qd")},"98L6":function(e,t){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,a=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){e.progress=!1,t?val(a,t):hide(a),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,a=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(a),val(a,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},"9M99":function(e,t,n){"use strict";n.r(t),n.d(t,"emojiToHTML",(function(){return l}));var i=n("S6+Z"),a=n("TxR4"),r=n("vkmG");function o(e,t,n,i){return!n&&t?t:i?'<i class="emoji @'+e+'" emoji="'+e+'"'+(t?' title="'+t+'"':"")+"></i>":'<img class="emoji" src="/emoji/e/'+e+(window.devicePixelRatio>=2?"_2x":"")+'.png"'+(t?' alt="'+t+'"':"")+(browser.msie&&Number(browser.version)>8?' contenteditable="false"':"")+">"}function s(e){return o(Object(a.emojiSymbolToByteHex)(e),Object(r.encodeHTMLEntities)(e),!0)}var l=function(e){return function(e,t){if(browser.ipad||browser.iphone)return e;e=(e+"").replace(/&nbsp;/g," ").replace(/<br>/g,"\n");for(var n=0;n<2;n++)Object.keys(i.EMOJI_PREFIXED_REPLACES).forEach((function(t){e.replace(i.EMOJI_PREFIXED_REPLACES[t],(function(e,n,i,a){return(n||"")+o(t)+(a||"")}))}));return Object.keys(i.EMOJI_REPLACES).forEach((function(t){e=e.replace(i.EMOJI_REPLACES[t],(function(e,n,i){return o(t)+(i||"")}))})),e=e.replace(/\n/g,"<br>"),t&&(e=e.replace(/\uFE0F/g,"").replace(Object(i.emojiRegex)(),s)),e}(e,!0)}},"9y81":function(e,t,n){"use strict";n.r(t),n.d(t,"IconWd",(function(){return o}));var i=n("bZ/P"),a=n("Mc5h"),r=function(e){var t,n=e.icon,r=e.class||e.mix;return Object(a.default)({mix:i.default.class(r,"Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t)),url:e.url,attrs:e.attrs})};function o(e){var t,n=e.icon;return{class:[e.class,Bem.class("Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t))],href:e.url,attrs:e.attrs}}Object.assign(r,{toggleActive:function(e){e.classList.toggle(s)}});var s="Icon_active";t.default=r;window.Icon=r},A6le:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("z9sQ"),r=n("fdw3"),o=n("WQTZ"),s=n("J51G"),l=function(e){var t=e.durationInSeconds,n=e.isDefaultCasperTimerShown,l=t<=60;return{inner:[{inner:[Object(i.default)({icon:Object(o.getBomb16Icon)()})],class:a.default.class("CasperTimer__icon",{normal:!0},"--"),"aria-hidden":"true",tag:"span"},{inner:[Object(i.default)({icon:Object(s.getBombActive16Icon)()})],class:a.default.class("CasperTimer__icon",{warning:!0},"--"),"aria-hidden":"true",tag:"span"},{inner:[Object(r.formatDuration)(t)],class:"CasperTimer__timer",role:"timer","aria-live":"polite",tag:"span"}],class:a.default.class("CasperTimer",{active:t>0,hidden:!n,warning:l},"--"),onClick:["CasperTimer.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false",title:Object(r.getLang)("mobile_casper_timer_title"),"data-left":t,tag:"button"}};var c=n("UxAg"),u=new(n("Cz26").Timers)({}),d={init:function(e){var t=this,n=Object(c.$)(".msg_id_"+e);if(!n)return!1;var i=Object(c.$)(".CasperTimer",n);if(!i)return!1;var a=this.getTimerElement(i);u.add((function(n){if(i.parentNode){var o=t.getLeftSeconds(i);(o-=n)<=0&&(i.classList.add("CasperTimer--hidden"),a.classList.remove("CasperTimer__timer--opened"),i.classList.remove("CasperTimer--itsGonnaBlow"),setTimeout((function(){i.hasOwnProperty("remove")?i.remove():i&&i.parentNode&&i.parentNode.removeChild(i)}),1e3),u.remove(e),o=0),t.setLeftSeconds(i,o),o>0&&o<=10&&i.classList.add("CasperTimer--itsGonnaBlow"),o>0&&o<=60&&(i.classList.remove("CasperTimer--hidden"),i.classList.add("CasperTimer--warning")),t.isOpened(i)&&(a.innerHTML=Object(r.formatDuration)(o))}else u.remove(e)}),{id:e})},getLeftSeconds:function(e){return parseInt(e.getAttribute("data-left"))},setLeftSeconds:function(e,t){e.setAttribute("data-left",t)},getTimerElement:function(e){if(!e)throw new Error("CasperTimer: element is not provided");return Object(c.$)(".CasperTimer__timer",e)},isOpened:function(e){return this.getTimerElement(e).classList.contains("CasperTimer__timer--opened")},clickHandler:function(e,t){var n=this.getTimerElement(e);n.classList.toggle("CasperTimer__timer--opened");var i=this.isOpened(e);e.setAttribute("aria-expanded",i),n.innerHTML=Object(r.formatDuration)(this.getLeftSeconds(e)),t.stopPropagation(),clearTimeout(e._autoCloseTimer),i&&(e._autoCloseTimer=setTimeout((function(){n&&n.classList.remove("CasperTimer__timer--opened")}),4e3))}};window.CasperTimer=d;t.default=l},AXyT:function(e,t,n){"use strict";n.r(t);var i=function(e){return Wd.html({class:[Bem.class("Oval",{type:e.gray?"minor":e.type,hidden:a(e.value)}),e.mix],inner:"empty"===e.value?" ":e.value})};function a(e){return"empty"!==e&&(!e||e<=0)}Object.assign(i,{setValue:function(e,t){if(!e)return;var n=a(t);e.innerText="empty"===t?" ":t,e.classList.toggle(r,n)}});var r="Oval_hidden";t.default=i;Object.assign(window,{Oval:i,Oval_isHidden:a})},AgBx:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),r=function(e){return Object(a.default)({mix:i.default.class(e.mix,"ScrollView"),attrs:e.attrs,inner:e.inner})};n("QMH7"),t.default=r;window.ScrollView=r},"B+U2":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("29dZ"),a=n("Y6JH"),r=n("TYsd"),o=n("z9sQ"),s=n("fdw3"),l=n("6C7c"),c=n("gFCQ"),u=n("sPQa"),d=n("lhfX"),_=function(e){var t=e.keyboard,n=e.msgId,_=e.pressed||{},f=t.buttons,p=0;return{class:"BotsKeyboard__main",inner:f.map((function(e){return function(e,t,n,_,f){var p=0;return{class:"BotsKeyboard__row",inner:e.map((function(e){return function(e,t,n,_,f,p){var h,m=window.lang,v=e.action.type,g=o.default.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===v,positive:"positive"===e.color,negative:"negative"===e.color},"--"),A=["uMailWrite._onKeyboardButtonClick","this","event",{action:(b=Object(s.stringifyJSON)(e.action),b.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;")),authorId:t.author_id,inline:t.inline,msgId:n}];var b;h="vkpay"===v?[{class:"BotsKeyboard__buttonInner",inner:[r.default.wrap(m.mobile_mail_keyboard_label_vkpay),r.default.wrap("&nbsp;"),r.default.wrap("&nbsp;"),Object(a.default)(Object(l.getVkpayIcon)())]}]:"location"===v?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)(Object(c.getPlace24Icon)())},r.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[r.default.wrap(m.mobile_mail_keyboard_label_location)]}]}]:"open_app"===v?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)(Object(u.getService24Icon)())},r.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[r.default.wrap(e.action.label)]}]}]:"open_link"===v?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[r.default.wrap(e.action.label)]},r.default.wrap("&nbsp;"),Object(a.default)(Object(d.getOpenLink16Icon)())]}]:[r.default.wrap(e.action.label)];var y=!1,w=f+","+p;_[w]&&(y=!0);return Object(i.default)({class:g,isLoading:y,spinner:!0,on_click:A,use_native_onclick:!0,inner:h,theme:"none",size:"normal",type:"button",attrs:{"data-position":w}})}(e,t,n,_,f,p++)}))}}(e,t,n,_,p++)}))}};t.default=_},B9v3:function(e,t,n){"use strict";n.r(t),n.d(t,"setBookmarkState",(function(){return se})),n.d(t,"ActionsPanel",(function(){return w})),n.d(t,"init",(function(){return le}));var i=n("Y6JH"),a=n("VRji"),r=n("p5n7"),o=n("29dZ"),s=n("fdw3"),l=n("haUC"),c=n("Uz3H"),u=n("7ADY"),d=n("1S0R"),_=n("ETBP"),f=n("dvEy"),p=n("Epxf"),h=n("sYro"),m=n("7E7W"),v=n("3ZCC"),g=n("Fbxv"),A=n("2fMF"),b=n("PssS");function y(e){return void 0===e&&(e={}),{class:"SharePanel SharePanel-header SharePanel--active ShareHeaderConversationsPanel","aria-hidden":"false","data-name":"ShareHeaderConversationsPanel",inner:[{"aria-label":Object(s.getLang)("mobile_close"),onclick:"cur.share.destroy()",role:"button",class:"SharePanel-header__close",inner:Object(i.default)(Object(u.getCancel24Icon)())},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(s.getLang)("mobile_like_publish_head_title")},{class:"SharePanel-headerText__receivers"}]},{class:"SharePanel-headerRight",inner:[{"aria-label":Object(s.getLang)("mobile_search"),class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)(Object(d.getSearch24Icon)()),onclick:"cur.share.toggleConversationsSearch(true)"},e.supportsExternalShare?{"aria-label":Object(s.getLang)("mobile_share_external"),class:"SharePanel-headerRight__externalShare",role:"button",inner:"iOS"===e.platform?Object(i.default)(Object(_.getShareExternalIos24Icon)()):Object(i.default)(Object(f.getShareExternalAndroid24Icon)()),onclick:"cur.share.externalShare()"}:null]}]}}function w(e){var t=e.buttons,n=e.options,i="boolean"!=typeof e.active||e.active;return{class:"ActionsPanel SharePanel "+(i?"SharePanel--active":""),"data-name":"ActionsPanel","aria-hidden":!i,style:!(n.can_to_own||n.can_to_club||n.can_bookmark)?"display: none;":"",inner:t.map((function(e){if(e)return function(e){var t=e.href?"a":"div",n=e.onclick,i={tag:t,role:"button",tabindex:-1,href:e.href,onclick:n,class:"ActionsPanel-button ActionsPanel-button--"+e.target,inner:[{class:"ActionsPanel-button__icon",inner:e.icon},{class:"ActionsPanel-button__label",inner:e.label}]};"boolean"==typeof e["aria-pressed"]&&(i["aria-pressed"]=e["aria-pressed"]+"");return i}(e)}))}}var O=function(e){var t=e.can_bookmark,n=e.is_bookmarked,u=e.object,_=e.list,f=e.from,O=e.post_from,S=e.supportsExternalShare,k=e.isVKApp,C=e.targetOwnOnClick,E=Object(s.makeUrl)("/wall",{act:"add",share_box:1,is_vk_app:k,object:u,list:_,from:f,post_from:O});return{inner:[{inner:[y({platform:e.platform,supportsExternalShare:S}),{class:"SharePanel ShareHeaderSearch ShareHeaderConversationsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderConversationsSearchPanel",role:"search",inner:Object(r.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "peers", true)',prefix:{text:{role:"button",inner:Object(i.default)(Object(h.getSearchOutline16Icon)())}},postfix:{text:{class:"ShareHeaderSearch__clear",role:"button",onclick:'cur.share.clearSearch(event, "peers")',inner:Object(i.default)(Object(m.getCancelOutline24Icon)())}},class:"ShareHeaderConversationsSearchPanel__input",id:"ShareHeaderConversationsSearchPanel__input",placeholder:Object(s.getLang)("mobile_search"),spellcheck:!1})},{class:"SharePanel SharePanel-header ShareHeaderGroupsPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsPanel",inner:[{"aria-label":Object(s.getLang)("mobile_back"),onclick:"cur.share.toggleGroupsPanel(false)",role:"button",class:"SharePanel-header__close",inner:Object(i.default)(Object(p.getBack24Icon)())},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(s.getLang)("mobile_like_publish_head_title")}]},{class:"SharePanel-headerRight",inner:[{class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)(Object(d.getSearch24Icon)()),onclick:'cur.share.setActivePanel(this, "ShareHeaderGroupsSearchPanel", true)'}]}]},{class:"SharePanel ShareHeaderSearch ShareHeaderGroupsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsSearchPanel",role:"search",inner:Object(r.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "group", true)',prefix:{text:{"aria-label":Object(s.getLang)("mobile_search"),role:"button",inner:Object(i.default)(Object(h.getSearchOutline16Icon)())}},postfix:{text:{class:"ShareHeaderSearch__clear",onclick:'cur.share.clearSearch(event, "group")',inner:Object(i.default)(Object(m.getCancelOutline24Icon)())}},class:"ShareHeaderGroupsSearchPanel__input",id:"ShareHeaderGroupsSearchPanel__input",placeholder:Object(s.getLang)("mobile_search"),spellcheck:!1})}],class:"SharePanelRoot ShareHeader",tag:"header"},{id:"Share__input",style:"display: none;",tag:"input"},{inner:[{class:"ShareConversations SharePanel SharePanel--active filter_peer_wrap","data-name":"ShareConversations","aria-hidden":"false",role:"group",id:"ShareConversations"},{class:"ShareGroups SharePanel","data-name":"ShareGroups","aria-hidden":"true",role:"group",id:"ShareGroups"}],class:"SharePanelRoot ShareLists",tag:"section"},{inner:[w({active:!0,options:e,buttons:[e.can_to_own?{target:"own",label:Object(s.getLang)("mobile_share_target_own"),onclick:C||"cur.share.go('"+E+"')",icon:Object(i.default)(Object(l.getRepostOutline28Icon)())}:null,e.can_to_club?{target:"group",label:Object(s.getLang)("mobile_share_target_group"),icon:Object(i.default)(Object(c.getUsersOutline28Icon)())}:null,t?{target:"bookmark","aria-pressed":n,label:n?Object(s.getLang)("mobile_share_target_bookmark_active"):Object(s.getLang)("mobile_share_target_bookmark"),icon:Object(i.default)(e.is_bookmarked?Object(A.getFavorite28Icon)():Object(b.getFavoriteOutline28Icon)())}:null]}),{class:"SharePanel MessagePanel","aria-hidden":"true","data-name":"MessagePanel",inner:[Object(r.default)({tabindex:-1,autocomplete:!1,class:"MessagePanel__input",on_click:["cur.share.expandMessage"],placeholder:Object(s.getLang)("mobile_share_message_placeholder"),spellcheck:!1,readonly:!0,disabled:!0}),Object(o.default)({stretch:!0,size:"large",inner:Object(s.getLang)("mobile_share_message_single"),on_click:"cur.share.sendMessage(event)",use_native_onclick:!0})]},{class:"SharePanel ExpandedMessagePanel","aria-hidden":"true","data-name":"ExpandedMessagePanel",inner:[{class:"ExpandedMessagePanel__textareaWrap",inner:[Object(a.default)({placeholder:Object(s.getLang)("mobile_share_message_placeholder"),rows:1}),{class:"ExpandedMessagePanelSend",inner:Object(i.default)(Object(v.getSendActive24Icon)())}]}]},{class:"SharePanel ProcessingPanel","aria-hidden":"true","data-name":"ProcessingPanel",inner:[{class:"ProcessingPanel__icon ProcessingPanel__icon--loading",inner:Object(i.default)(Object(g.getLoading40Icon)())},{class:"ProcessingPanel__label",inner:Object(s.getLang)("mobile_share_state_progress")}]}],class:"SharePanelRoot ShareBottom",tag:"footer"}],class:"Share","aria-role":"dialog","aria-label":Object(s.getLang)("mobile_like_publish_head_title"),hidden:"false",tabindex:"-1",tag:"div"}},S=n("wTbK"),k=n("YU/R"),C=n("Qz23"),E=n("OcsD");function j(e){return/^((?:([a-z]+)_)?([a-z_]+))(-?\d+)?(?:_(\d+))?$/.test(e)}var T=n("UxAg"),I=n("j80l"),M=n("aiw/"),D=n("H5mD"),P=n("zq7H"),x=n("yOyn"),L=n("L3oE"),B=n("1u0X"),R="/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1",N="ShareConversations",F=0,H=!1,U={bookmarks:{}};function V(e){W(e)}function $(e){nav.go(e),cur.share.destroy({isNavigation:!0})}function W(e){if(cur.share){var t=cur.share._els.header,n=e.scrollTop;t.classList.toggle("ShareHeader--scrolled",n>=10)}}function q(e,t,n){if(!cur.share||cur.share.blocked)return!1;if(Y(!0),cancelEvent(n),hasClass("inline_item_selected",t))return cur.shareSearch.toggleAttach(e,!1),function(e,t){for(var n=0;n<cur.share.selected.length;n++)if(cur.share.selected[n]===e){cur.share.selected.splice(n,1);break}return X(!1),Z(),!1}(e);cur.shareSearch.toggleAttach(e,!0);for(var i=!1,a=0;a<cur.share.selected.length;a++)if(cur.share.selected[a]===e){i=!0;break}return i||cur.share.selected.push(e),Y(!1),X(!1),Z(),!1}function z(e,t,n){if(cur.share&&!cur.share.blocked){e=e.closest(".SharePanelRoot");var i,a=Object(T.$$)(".SharePanel",e);t&&(i=Object(T.$)("."+t,e)),a.forEach((function(e){var t=e===i;e.setAttribute("aria-hidden",!t),e.classList.toggle("SharePanel--active",t),t?e.removeAttribute("tabindex"):e.setAttribute("tabindex",-1),Object(T.$$)("input, ul",e).forEach((function(e){e.setAttribute("aria-hidden",!t);var n=e.closest(".TextInput");t?(null==n||n.classList.remove("TextInput_disabled"),e.removeAttribute("disabled"),e.setAttribute("tabindex",0)):(null==n||n.classList.add("TextInput_disabled"),e.setAttribute("disabled",!0),e.setAttribute("tabindex",-1))}))}));var r=Object(T.$)("input",i);r&&n&&r.focus(),setStyle(e,{height:i?i.clientHeight:0})}}function Y(e){var t=Object(T.$)(".ShareModal");t&&t.classList.toggle("ShareModal--disableAnimations",!e)}function Q(e){if(cur.share){var t=cur.share._els,n=t.header,i=t.content,a=t.bottom;i.classList.add("ShareLists--transition"),Y(!0),z(n,e?"ShareHeaderGroupsPanel":"ShareHeaderConversationsPanel"),z(i,e?"ShareGroups":"ShareConversations"),z(a,e?"":"ActionsPanel"),setTimeout((function(){i.classList.remove("ShareLists--transition")}),300),Object(T.$)(".SharePanel--active ul",i).focus(),Z(),W(e?Object(T.$)("#ShareGroups .ShareList__container"):Object(T.$)("#ShareConversations .ShareList__container"))}}function G(e){if(cur.share){var t=cur.share._els,n=t.header,i=(t.content,t.bottom),a=J();H=e,Y(!1),z(i,e?"":a),e&&z(n,"ShareHeaderConversationsSearchPanel",!0),!D.isIOS&&innerWidth<P.DESKTOP_WIDTH&&Z(e),setTimeout((function(){browser.ios&&Object(E.scrollTop)(document.activeElement)}),500)}}function K(){if(cur.share){var e=cur.share._els,t=e.content,n=e.bottom,i=e.messageTextarea;z(n,"ExpandedMessagePanel"),t.classList.add("ShareLists--transition"),D.isIOS||Z(!1),i.focus({preventScroll:!0})}}function X(e){if(void 0===e&&(e=!0),cur.share){var t=cur.share,n=t.selected,i=t._els;ge(N)&&(!function(){if(!cur.share)return;var e=cur.share.cache._cache,t=Object(T.$)(".ShareHeaderConversationsPanel"),n=Object(T.$)(".ShareHeaderConversationsPanel .SharePanel-headerText__receivers",t),i=cur.share.selected,a=i.length;t.classList.toggle("ShareHeaderConversationsPanel--hasReceivers",a>0);var r="";if(1===a){r=getLang("mobile_share_box_to_single");var o=e[i[0]][0];r=r.replace("{name}",o)}else if(2===a){r=getLang("mobile_share_box_to_couple");var s=e[i[0]][6]||e[i[0]][0],l=e[i[1]][6]||e[i[1]][0];r=r.replace("{name1}",s).replace("{name2}",l)}else if(a>2){r=getLang("mobile_share_box_to_many");var c=e[i[0]][6]||e[i[0]][0];r=r.replace("{name}",c).replace("{count}",a-1)}n.innerHTML=r}(),ee());var a,r,o=J();z(i.bottom,o,e),a=n.length>1,r=cur.share._els.messagePanel,Object(T.$)(".Btn",r).innerHTML=a?getLang("mobile_share_message_many"):getLang("mobile_share_message_single")}}function J(){if(cur.share){var e=cur.share,t=e.selected,n=e.content,i=Object(T.$)(".SharePanel--active",n).getAttribute("data-name");return"ShareHeaderGroupsSearchPanel"===i||"ShareHeaderGroupsPanel"===i?"":document.activeElement&&document.activeElement.closest(".ExpandedMessagePanel")?"ExpandedMessagePanel":t.length>0?"MessagePanel":"ActionsPanel"}}function Z(e){if(cur.share&&cur.share._els){var t=cur.share._els,n=t.header,i=t.bottom,a=t.content,r=t.groupsList;if(n&&i&&a){Object(T.$)(".ShareModal");var o=400;(e=H||e)&&(o+=cur.share.lastBottomHeight-Object(E.getH)(i)),i.clientHeight&&(cur.share.lastBottomHeight=i.clientHeight);var s=[n,i].reduce((function(e,t){var n=Object(T.$)(".SharePanel--active",t);return n&&(e+=n.clientHeight,setStyle(t,{height:n.clientHeight})),e}),0),l=Math.min(o,Object(E.getCh)()-s),c=s+l!==F;c||(Y(!1),a.classList.remove("ShareLists--transition")),setStyle(r,{bottom:-i.clientHeight}),setStyle(a,{height:l}),c||Y(!0),F=s+l}}}function ee(){cur.share&&each(geByClass("inline_item",Object(T.$)("ShareConversations__container")),(function(e,t){if(cur.share){var n=intval((t.id||"").substr(4)),i=-1!==cur.share.selected.indexOf(n);toggleClass("inline_item_selected",t,i),t.setAttribute("aria-selected",i);var a=Object(T.$)('input[type="checkbox"]',t);a&&(a.checked=i)}}))}function te(e){var t=cur.share._els.bookmarkButton;if(t){var n=Object(T.$)(".ActionsPanel-button__icon",t),a=Object(T.$)(".ActionsPanel-button__label",t);t.setAttribute("aria-pressed",e),e?(n.innerHTML=Wd.html(Object(i.default)(Object(A.getFavorite28Icon)())),a.innerHTML=getLang("mobile_share_target_bookmark_active")):(n.innerHTML=Wd.html(Object(i.default)(Object(b.getFavoriteOutline28Icon)())),a.innerHTML=getLang("mobile_share_target_bookmark")),window.thover.clear()}}function ne(e){var t=cur.share._els,n=t.bottom,a=t.processingPanel,r=this.mail_hash,o=this.object,s=this.list,l=this.appId,c=this.shouldInteractWithGlobalStories,u={_ajax:1,from:"share_box",hash:r,list:s,message:Object(T.$)(".ExpandedMessagePanel__textareaWrap textarea").value,to:cur.share.selected.join(","),app_id:l};j(cur.share.options.object)?u.media=o:u.link=o,Y(!0),e&&cancelEvent(e),z(n,"ProcessingPanel"),cur.share.blocked=!0,(o.startsWith("story")||o.startsWith("narrative"))&&c&&Stories.sendAnalyticsEvent("share_to_message"),setTimeout((function(){Z()})),setTimeout((function(){Z()}),350),ajax.post("/mail?act=send",u,{onDone:function(e){Y(!0);var t=Object(T.$)(".ProcessingPanel__icon",a),n=Object(T.$)(".ProcessingPanel__label",a);t.classList.remove("ProcessingPanel__icon--loading");var r=e.error;t.innerHTML=Wd.html(r?Object(i.default)(Object(B.getErrorCircle40Icon)()):Object(i.default)(Object(L.getDoneCircle40Icon)())),n.innerText=r?getLang("mobile_share_state_error"):getLang("mobile_share_state_success"),setTimeout((function(){cur.app&&(r&&cur.app.hasOwnProperty("vkMiniAppShareFail")?cur.app.vkMiniAppShareFail():!r&&window.isFunction(cur.app.vkMiniAppShareSuccess)&&cur.app.vkMiniAppShareSuccess(0)),cur.share&&cur.share.destroy({isFail:r})}),1e3)}})}function ie(e,t,n){void 0===n&&(n=!1),Object(E.preventEvent)(e);var i,a,r,o=cur.share._els.header;if("group"===t?(i=ge("ShareHeaderGroupsSearchPanel__input"),a="ShareHeaderGroupsPanel",r=cur.shareGroupSearch):"peers"===t&&(i=ge("ShareHeaderConversationsSearchPanel__input"),a="ShareHeaderConversationsPanel",r=cur.shareSearch),Y(!1),i.value){if(n)return void Y(!0);r.clear()}else"peers"===t?(z(o,a),G(!1)):(z(o,a),Y(!0))}function ae(){var e,t=cur.share.options.object,n="unknown";if(j(cur.share.options.object)){e=/^([a-z_]+)(-?\d+)_(\d+)$/.exec(cur.share.options.object),n=e[1];var i=e[2],a=e[3];"app"===n&&"0"===a&&(t="app"+i),cur.share.options.list&&(t+="?list="+cur.share.options.list),t=t.replace("wall_reply","wall")}else cur.share.options.isVKApp&&(n="link");t=cur.share.options.external_url||t;var r=navigator.share({url:t});if(!r)return Object(E.statlogsValueEvent)("mvk_share_external",n);r.then((function(){cur.share&&Object(E.statlogsValueEvent)("mvk_share_external",n)}))}function re(e,t,n){var i=e.split("_"),a=31,r=5,o=6,s=[a,r,3,o].includes(Object(E.toInt)(t.bookmark_type)),l=[2,o].includes(t.bookmark_type);if(ajax.post("/bookmarks.php",{_ajax:1,from:"share_box",wide:l?1:0,star:s?1:0,act:t.is_bookmarked?"bookmark_remove":"bookmark_add",item_type:t.bookmark_type,item_oid:i[0],item_id:i[1],hash:t.bookmark_hash,link_url:t.link_url,link_title:t.link_title,link_img:t.link_img},{onDone:function(e,t){var n=Object(T.$)("."+e),i=Object(E.ceFromString)(t);n&&Object(E.replace)(i,n.parentNode)}}),t.bookmark_type===r&&Article.toggleButton(e,!t.is_bookmarked),t.bookmark_type===a&&t.shouldInteractWithGlobalStories){var c=Object(T.$)(".StoryMenu__button");Stories.toggleBookmark(c,!0)}t.is_bookmarked=!t.is_bookmarked,U.bookmarks[e]=t.is_bookmarked,n()}function oe(){Z(!1)}function se(e,t){U.bookmarks[e]=t}var le=function(e,t,n){var r=t.can_to_own,o=void 0===r||r,s=t.can_to_club,l=void 0===s||s,c=t.can_bookmark,u=t.is_bookmarked,d=t.from,_=t.post_from,f=t.list,p=(t.message,t.targetOwnOnClick),h=t.appId,m=t.isVKApp;cur.share&&cur.share.destroy();var v=!j(t.object);if(!v||m){v&&!/^(https|http)?:\/\//i.test(t.object)&&(t.object="https://"+e,e=t.object),k.default&&k.default.close(),t.withoutScrollView||Object(C.preventDocumentScroll)(),v||(u=void 0!==U.bookmarks[e]?U.bookmarks[e]:u,t.is_bookmarked=u),cancelEvent(n);var g=!!navigator.share,A=browser.ios?"iOS":"Android",b=Object(S.default)({on_overlay_click:"cur.share.destroy()",class:"ShareModal",attached:!0,body:O({targetOwnOnClick:!!p&&"cur.share.toOwnWall()",can_to_own:o,can_to_club:l,supportsExternalShare:g,platform:A,can_bookmark:c,is_bookmarked:u,list:f,from:d,post_from:_,object:t.object,isVKApp:t.isVKApp})}),y=t.withoutHash?null:"share";S.default.open(Wd.elem(b),!0,y,{swipeDown:!0,onClose:function(){cur.share&&cur.share.destroy({closeModal:!1})}});var w=Object(T.$)(".ShareModal"),E=Object(T.$)(".ShareHeader"),P=Object(T.$)(".ShareLists"),L=Object(T.$)(".ShareBottom"),B=Object(T.$)(".ActionsPanel-button--bookmark"),F=Object(T.$)(".ActionsPanel-button--group");setTimeout((function(){!function(e){void 0===e&&(e={});cur.shareSearch=new QuickSearch;var t=e.appId?R+"&app_id="+e.appId:R,n=e.appId?R+"&app_id="+e.appId+N:"/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1ShareConversations";cur.shareSearch.init({action:t,field:"ShareHeaderConversationsSearchPanel__input",container:N,top_len:20,onFocusChanged:function(e){e?M.onOpen("top"):M.onClose(),Z(e),setTimeout((function(){Z(e)}),200)},tpl:function(e,t){return'<ul aria-multiselectable="true" aria-hidden="false" class="ScrollView ShareConversations__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(e,t){if(cur.share){var n=cur.share.cache._cache,a=n[this.id][0],r=!(!n[this.id][8]||!n[this.id][8].is_casper)?'<span class="ShareConversationsCasperTitle">\n             <span class="ShareConversationsCasperTitle__text">'+this.highlight(a)+'</span>\n             <span class="ShareConversationsCasperTitle__icon">'+Wd.html(Object(i.default)(Object(x.getCasper16Icon)()))+"</span>\n           </span>":this.highlight(a),o=-1!==cur.share.selected.indexOf(+this.id)?"inline_item_selected":"";return'\n        <label aria-label="'+a+'" tabindex="0" role="checkbox" id="peer'+this.id+'" onclick="cur.share.select('+this.id+', this)" class="inline_item active '+o+'">\n          <input type="checkbox" style="display: none;">\n            <img aria-hidden="true" class="ii_img" src="'+t+'" />\n            <div class="ii_body">\n              <div class="ii_owner">\n                 '+r+"\n              </div>\n            </div>\n          </input>\n        </label>\n      "}},null_tpl:function(e){var t=getLang("mobile_friends_search_not_found").replace("%s",htsc(e));return e||(t=getLang("mobile_share_list_no_friends")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}}),cur.share.cache=QuickSearchCache[n],ee()}({appId:h})}),250),addEvent(B,"click",re.bind(this,e,t,(function(){te(t.is_bookmarked)})),{passive:!0}),addEvent(F,"click",(function(){Q(!0)}),{passive:!0});var H=Object(T.$)(".ExpandedMessagePanel textarea"),W=Object(T.$)(".MessagePanel__input input");H.value=t.message||"",W.value=t.message||"",Object(a.initAutogrow)(H),addEvent(H,"input blur focus",(function(e){var t=cur.share._els.content;W.value=H.value.replace(/\n/gi," "),Y(!1),"input"===e.type&&Z(!1),"focus"===e.type&&(t.classList.remove("ShareLists--transition"),w.classList.add("ModalMenu--blocked"),w.classList.add("ModalMenu--focused"),M.onOpen("bottom"),setTimeout((function(){X(!0),Y(!1),Z()}),100)),"blur"===e.type&&(w.classList.remove("ModalMenu--blocked"),e.preventDefault(),e.stopPropagation(),M.onClose(),Y(!1),w.classList.remove("ModalMenu--focused"),D.isIOS||Z(!1),setTimeout((function(){X(!1),Y(!1),Z()}),100))})),addEvent(Object(T.$)(".ExpandedMessagePanelSend"),"click touchend",(function(e){e.stopPropagation(),e.preventDefault(),document.activeElement&&document.activeElement.blur(),cur.share.sendMessage()}),{capture:!0}),addEvent(H,"touchmove",(function(e){stopEvent(e)}),{capture:!0}),M.onCloseCallback(oe),addEvent(H,"keydown",(function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey&&browser.mac)&&cur.share.sendMessage(e)}));var J={act:"publish_box",object:"null"};h&&(J.app_id=h),t.object?(J.object=t.object,t.list&&(J.list=t.list)):v&&(J.link=e,delete J.object);var se=Object(I.makeUrl)("/like",J);cur.share={open:!0,onClose:befall(),go:$,options:t,externalShare:ae,actionBox:se,blocked:!1,updateHeights:Z,_els:{actionsPanel:Object(T.$)(".ActionsPanel"),messagePanel:Object(T.$)(".MessagePanel"),processingPanel:Object(T.$)(".ProcessingPanel"),groupsList:ge("ShareGroups"),conversationsList:ge("ShareConversations"),bookmarkButton:B,messageTextarea:H,header:E,content:P,bottom:L},selected:[],expandMessage:K,toggleGroupsPanel:Q,toggleConversationsSearch:G,select:q,clearSearch:ie,setActivePanel:z,onScroll:V,sendMessage:ne.bind(t),lastBottomHeight:L.clientHeight,destroy:function(e){void 0===e&&(e={}),e=extend({closeModal:!0,isFail:!0,isNavigation:!1},e),M.offCloseCallback(oe);var t=Object(T.$)(".ShareModal");e.isFail&&cur.app&&cur.app.vkMiniAppShareFail&&cur.app.vkMiniAppShareFail(),t&&e.closeModal&&S.default.close(t),cur.share&&(cur.share.onClose(e.isNavigation),cur.share.open=!1),cur.share.options.withoutScrollView||Object(C.restoreDocumentScroll)(),delete cur.share,delete cur.shareSearch,delete cur.shareGroupSearch}},p&&(cur.share.toOwnWall=p),setTimeout((function(){!function(){cur.shareGroupSearch=new QuickSearch;var e=Icon({icon:"chevron_right"});if(!cur.share.options.can_to_club)return;cur.shareGroupSearch.init({load_once:!0,field:"ShareHeaderGroupsSearchPanel__input",container:"ShareGroups",action:cur.share.actionBox,onFocusChanged:function(e){e?M.onOpen("top"):M.onClose(),setTimeout((function(){Z(!1)}),100)},tpl:function(e,t){return'<ul aria-hidden="true"  class="ScrollView ShareGroups__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(t,n){if(!cur.share)return"";var i=function(){if(!cur.share)return{};var e=cur.share.actionBox+"ShareGroups";return QuickSearchCache[e]}()._cache[this.id][0],a=cur.share.options,r=a.object,o=a.list,s=a.from,l=a.post_from,c={act:"add",share_box:"1"};r&&(c=extend(c,{object:r,list:o,from:s,post_from:l})),cur.share.options.isVKApp&&(c.is_vk_app=+cur.share.options.isVKApp);var u=Object(I.makeUrl)("/wall"+this.id,c);return'\n        <li aria-label="'+i+'" tabindex="0" role="link" id="group'+this.id+'" onclick="cur.share.go(\''+u+"', "+cur.share.options.isVKApp+')" class="inline_item " xmlns="http://www.w3.org/1999/html">\n          <img aria-hidden="true" class="ii_img" src="'+n+'" />\n          <div class="ii_body">\n            <div class="ii_owner">\n               '+this.highlight(i)+'\n            </div>\n            <div class="ii_go">\n               '+e+"\n            </div>\n          </div>\n        </li>\n      "},null_tpl:function(e){var t=getLang("mobile_groups_no_groups_found");return e||(t=getLang("mobile_share_list_no_groups")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}})}()}),300),te(u),Z(),E.closest(".Share").focus(),onBodyResize((function(){document.activeElement&&"INPUT"===document.activeElement.tagName?Z(!0):Z(!1),setTimeout((function(){Y(!0)}),150)})),onBodyResize(!0)}else console.warn("Can't share link outside miniapp")};window.Share=le,extend(window.Share,{setBookmarkState:se});t.default=O},"BJj/":function(e,t,n){"use strict";function i(e,t,n){var i;return function(){var a=this,r=arguments,o=function(){i=null,n||e.apply(a,r)},s=n&&!i;clearTimeout(i),i=setTimeout(o,t),s&&e.apply(this,r)}}n.r(t),n.d(t,"debounce",(function(){return i}))},BLcx:function(e,t){var n,i=(n=document.getElementsByClassName("gift_create_post_counter"),{counter:function(e){var t=n[0];if(t){var i=e.value.length,a=e.maxLength;if(i>a)e.value=e.value.substr(0,a);else if(i>a/2){var r=Math.max(a-i,0);t.innerText=langNumeric(r,lang.text_N_symbols_remain),show(t)}else hide(t)}}});window.GiftsSendFormCounter=i},BZzM:function(e,t,n){"use strict";n.r(t),n.d(t,"resizePosters",(function(){return i}));function i(e,t,n){var i=ge(t)||document,a="[data-poster-resized='false']";(e||n)&&(a="");var r=domQuery(".poster__text"+a,i),o=[],s=cur.posterConfig&&cur.posterConfig.constants;if(!s){if(!r.length)return;s=JSON.parse(domData(r[0].parentElement,"poster-constants"))}for(var l=0;l<r.length;l++){var c=r[l],u=domPN(c);o.push(domPN(u).clientWidth)}for(var d=0;d<r.length;d++){var _=r[d],f=domPN(_),p=o[d],h=s.font_size_ratio_range_1*p+"px",m=Math.round(s.line_height_ratio_range_1*p)+"px",v="0 "+Math.round(p*(1/18))+"px";_.textContent.length>s.range_threshold&&(h=Math.round(s.font_size_ratio_range_2*p)+"px",m=Math.round(s.line_height_ratio_range_2*p)+"px"),setStyle(f,{height:p*(3/4)+"px",width:p}),setStyle(_,{fontSize:h,lineHeight:m,padding:v}),domData(_,"poster-resized",!0)}}},BoyB:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),r=n("Y6JH"),o=n("/0lW"),s=function(e){void 0===e&&(e={});var t=[e.class||e.mix,a.default.class("Loading",{white:e.white,large:e.large,spinner:e.spinner})];if(e.spinner)return i.default.html({inner:[Object(r.default)({icon:Object(o.getSpinner16Icon)()})],class:t,tag:"div"});return i.default.html({class:t,inner:{class:"Loading__items",inner:[{class:"Loading__item Loading__item_0"},{class:"Loading__item Loading__item_1"},{class:"Loading__item Loading__item_2"}]}})};t.default=s;window.Loading=s},CQvH:function(e,t,n){"use strict";n.r(t),n.d(t,"isTabbing",(function(){return y})),n.d(t,"setFocusTrap",(function(){return w})),n.d(t,"setMenuNavigation",(function(){return O})),n.d(t,"expandPopup",(function(){return S})),n.d(t,"onTransitionEnd",(function(){return k})),n.d(t,"sayIt",(function(){return o}));var i=n("OcsD"),a=n("H5mD"),r=n("UxAg");function o(e,t){var n=(void 0===t?{}:t).important,i=void 0!==n&&n;if(e){Object(r.$$)('[id^="say-it-"]').forEach((function(e){document.body.removeChild(e)}));var a=document.createElement("span"),o=i?"alert":"status";a.setAttribute("aria-live",i?"assertive":"polite"),a.setAttribute("role",o),a.classList.add("visually-hidden"),a.id="say-it-"+Date.now(),document.body.appendChild(a),setTimeout((function(){a.innerHTML=e}),10)}}var s=function(){function e(e){var t=e.capacity,n=void 0===t?1:t;this._capacity=n,this.clear()}var t=e.prototype;return t.add=function(e){this._cursor>=this._capacity&&(this._cursor=0),this._buffer[this._cursor]=e,this._cursor++,this._size<this._capacity&&this._size++},t.clear=function(){this._buffer=Array(this._capacity),this._cursor=0,this._size=0},t.size=function(){return this._size},t.toArray=function(){return this._buffer},e}(),l=n("DM2o"),c=n("Cz26"),u=n("W9Tc");!function(){var e=new s({capacity:15}),t=new s({capacity:15}),n=new s({capacity:15}),i=new s({capacity:15}),a=null;if(window.addEventListener("mousemove",(function(){if(a){var t=Date.now()-a;t>500&&(t-500<500&&e.add(!1),a=null)}else a=Date.now()}),{capture:!0,passive:!0}),new c.Timers({timer:1e4}).add((function(){e.add(!0)})),window.addEventListener("touchstart",(function(e){if(e&&e.touches)if(e.touches.length>1)t.add(!1);else{if(1===e.touches.length){var n=e.touches[0];if(0!==n.radiusX&&0!==n.radiusY)return void t.add(!1)}t.add(!0)}}),{capture:!0,passive:!0}),window.addEventListener("click",(function(a){if(a&&a.target){var r=0===a.pageX&&0===a.pageY&&0===a.screenX&&0===a.screenY,o=a.target.getBoundingClientRect(),s=Math.abs(o.width/2+o.left-a.clientX)<2&&Math.abs(o.height/2+o.top-a.clientY)<2;if(r||s){n.add(!0);try{i.add(function e(t){if(t.id)return"#"+t.id;var n=t.tagName.toLowerCase(),i="";t.name&&(i+='[name="'+t.name+'"]');var a="";!i&&t.className&&(a=t.className.split(/ +/g).map((function(e){return"."+e})).join(""));var r="";if(!i)for(var o=0,s=0;s<t.parentNode.children.length;s++){var l=t.parentNode.children[s];if(l.tagName===t.tagName&&o++,t===l){r=":nth-of-type("+o+")";break}}var c=n+i+a+r;return t.parentNode===document.body?"body > "+c:e(t.parentNode)+" > "+c}(a.target)+"—"+s+"—"+r)}catch(e){}}else n.add(!1),i.add(!1);if(n.size()>3){var c=e.toArray().filter((function(e){return e})).length>=Math.round(e.size()/2),u=t.toArray().filter((function(e){return e})).length>=Math.round(t.size()/2),d=n.toArray().filter((function(e){return e})).length>=Math.round(n.size()/2);if(localStorage&&localStorage.getItem){var _=localStorage.getItem("isKeyboardUser1"),f=d&&u&&c,p=document.querySelector(".keyboardUser");p&&(f?(p.style.display="block",p.innerHTML=e.toArray().filter((function(e){return e})).length+"."+t.toArray().filter((function(e){return e})).length+"."+n.toArray().filter((function(e){return e})).length):p.style.display="none"),(f&&null===_||null!==_&&_!==String(f))&&(localStorage.setItem("isKeyboardUser1",f),Object(l.statlogsValueEvent)("accessibility","is_keyboard_user",f))}}}}),{capture:!0,passive:!0}),Object(u.partConfigEnabled)("mvk_show_a11y_box")){var r=window.onDOMReady||function(e){setTimeout(e,5e3)};r&&r((function(){if(document.body&&!document.querySelector(".keyboardUser")){var e=document.createElement("div");e.style.background="rgba(230,0,255,.7)",e.style.position="fixed",e.style.top="3px",e.style.right="3px",e.style.color="#fff",e.style.fontSize="10px",e.style.minWidth="8px",e.style.height="14px",e.style.lineHeight="14px",e.style.textAlign="center",e.style.border="1px solid rgba(255,255,255, 0.2)",e.style.display="none",e.style.zIndex=9999999999,e.innerHTML="K",e.style.padding="0 3px",e.className="keyboardUser";var t=document.createElement("textarea");if(t.style.position="fixed",t.style.opacity=.9,t.style.top=0,t.style.right=0,t.style.bottom=0,t.style.left=0,t.style.width="100%",t.style.padding="10px",t.style.zIndex=9999999,t.style.display="none",document.body.appendChild(t),e.addEventListener("click",(function(){t.innerHTML=i.toArray().join("\n\n"),"none"===t.style.display?t.style.display="block":t.style.display="none"})),document.body.appendChild(e),localStorage&&localStorage.getItem)"true"===localStorage.getItem("isKeyboardUser1")&&(e.style.display="block")}}))}}();var d=38,_=40,f=36,p=35,h=32,m=13,v=27,g=9,A=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","audio","video","[contenteditable]","[tabindex]"];function b(){document.body.classList.add("tabbing")}function y(){return document.body.classList.contains("tabbing")}function w(e){if(a.isIOS&&a.iosMajor>8)return!1;if(!e)throw new Error("A11y: No element passed to setFocusTrap");var t=Array.from(e.querySelectorAll(A.join()));if(!(t=t.filter((function(e){return null!==e.offsetParent}))).length)return!1;var n=t[0],i=t[t.length-1],r=E(e,(function(e){var t=e.event,a=e.exit;t.keyCode===g&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),i.focus()):document.activeElement===i&&(t.preventDefault(),n.focus())),t.keyCode===v&&a()}));return cur.destroy.push((function(){r()})),setTimeout((function(){n.focus()})),r}function O(e,t){void 0===t&&(t={});var n=void 0===t.enableInitialFocus||t.enableInitialFocus;if(a.isIOS&&a.iosMajor>8)return!1;if(!e)throw new Error("A11y: No element passed to setMenuNavigation");if(!["menu","menubar"].includes(e.getAttribute("role")))throw new Error('A11y: Element must be `role="menu"` or `role="menubar"`');var i=['[role="menu"]','[role="menubar"]'].join(),r=['[role="menuitem"]','[role="menuitemradio"]','[role="menuitemcheckbox"]'].join(),o=Array.from(e.querySelectorAll(i)),s=Array.from(e.querySelectorAll(r));if(o.forEach((function(e){Array.from(e.querySelectorAll(r)).forEach((function(e){s[s.indexOf(e)]=null}))})),!(s=(s=s.filter((function(e){return e}))).filter((function(e){return null!==e.offsetParent}))).length)return!1;if("menu"===e.getAttribute("role")&&!s.every((function(e){return"-1"===e.getAttribute("tabindex")})))throw new Error('A11y: Every `menuitem` must have `tabindex="-1" attribute`');var l=E(e,(function(e){var t=e.event,n=e.exit,i=document.activeElement,a=s[0],r=s[s.length-1||0],o=s.indexOf(i),l=s[o+1],c=s[o-1];t.keyCode===d&&(c?C(c,t):r&&C(r,t)),t.keyCode===_&&(l?C(l,t):a&&C(a,t)),t.keyCode===f&&a&&C(a,t),t.keyCode===p&&r&&C(r,t),t.keyCode!==h&&t.keyCode!==m||(n(),i.click(),t.preventDefault()),t.keyCode!==v&&t.keyCode!==g||n()}),{onExit:function(){}});return n&&setTimeout((function(){C(s[0])})),l}function S(e){if(!e)throw new Error("A11y: No element passed to expandPopup");if(!e.getAttribute("aria-haspopup"))throw new Error("A11y: No `aria-haspopup` attribute on expanded element");if(null==e.getAttribute("aria-expanded"))throw new Error("A11y: No `aria-expanded` attribute on expanded element");if(null==e.getAttribute("aria-controls"))throw new Error("A11y: No `aria-controls` attribute on expanded element");if(!document.getElementById(e.getAttribute("aria-controls")))throw new Error("A11y: No element that the `aria-controls` refers to. Try to call `expandPopup` _after_ appending a popup");return e.setAttribute("aria-expanded",!0),E(e,(function(e){var t=e.event,n=e.exit;t.keyCode===v&&n()}),{onExit:function(){e.setAttribute("aria-expanded",!1)}})}function k(e,t){return void 0===t&&(t=10),new Promise((function(n){var i=setTimeout((function(){e.removeEventListener("transitionrun",a),n()}),t),a=function t(){clearTimeout(i),e.removeEventListener("transitionrun",t);e.addEventListener("transitionend",(function t(){e.removeEventListener("transitionend",t),n()}),!1)};e.addEventListener("transitionrun",a,!1)}))}function C(e,t){t&&(b(),t.preventDefault());var n=!1;null!=e.getAttribute("tabindex")&&(n=!0),n||e.setAttribute("tabindex",0),e.focus(),setTimeout((function(){n||e.removeAttribute("tabindex")}))}function E(e,t,n){void 0===n&&(n={}),e._enteredA11yElementKeyDownHandler&&document.removeEventListener("keydown",e._enteredA11yElementKeyDownHandler);var a=document.activeElement,r=!1;function o(t){if(t&&o.exitIntent&&!1===o.exitIntent(t))t.preventDefault();else if(!r){r=!0;var l=Object(i.scrollTop)(),c=Array.from(e.querySelectorAll(A.join()));document.activeElement&&!c.includes(document.activeElement)||(a&&C(a),Object(i.scrollTop)(l)),document.removeEventListener("keydown",s),n.onExit&&n.onExit()}}function s(e){e.ctrlKey||e.altKey||e.metaKey||t({event:e,exit:o.bind(null,e)})}return document.addEventListener("keydown",s),e._enteredA11yElementKeyDownHandler=s,o}addEvent(window,"keydown",(function(e){e.keyCode===g&&b()}),{passive:!0}),addEvent(window,"mousedown touchstart",(function(){document.body.classList.remove("tabbing")}),{capture:!0,passive:!0}),document._buttonA11yFix||(document._buttonA11yFix=!0,document.addEventListener("keydown",(function(e){e.ctrlKey||e.altKey||e.metaKey||(e.keyCode!==m&&e.keyCode!==h||"button"!==e.target.getAttribute("role")||(e.target.click(),e.preventDefault()),e.keyCode!==h||"checkbox"!==e.target.getAttribute("role")&&"radio"!==e.target.getAttribute("role")||(e.target.click(),e.preventDefault()))})))},Cbap:function(e,t,n){"use strict";n.r(t);var i=function(){function e(){this.routes=[]}e.getRouter=function(){return window.router||(window.router=new e),window.router};var t=e.prototype;return t.addRoute=function(e,t,n){this.routes.push({isActive:!1,test:e,activateCallback:t,deactivateCallback:n})},t.test=function(e){var t=e.test;if(nav.cur)return"function"==typeof t?t(window.nav.cur):t instanceof RegExp?t.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof t)&&window.nav.cur.startsWith(t)},t.deactivateAllRoutes=function(){this.routes=this.routes.map((function(e){return e.isActive=!1,e.deactivateCallback&&e.deactivateCallback(),e}))},t.checkRoutes=function(){var e=this;this.routes=this.routes.map((function(t){var n=e.test(t);return n&&t.activateCallback&&t.activateCallback(),!n&&t.isActive&&t.deactivateCallback&&t.deactivateCallback(),t.isActive=n,t}))},e}();t.default=i,window.Router=i},CkGd:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=n("9y81");function o(){var e=Object(i.default)(['\n    <div class="','" ',">","</div>\n  "]);return o=function(){return e},e}function s(){var e=Object(i.default)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <button class="Btn Btn_theme_small ','" ',">\n      ","\n    </button>\n  "]);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){e||(e={});window.lang;var t=a.default.onClick("MailActs._onMoreClick"),n=Object(r.default)({mix:"mailActs__close",icon:"close12",attrs:a.default.onClick("MailActs._onCloseClick")}),i=d("reply"),o=d("forward"),s=_("edit",e),l=_("pin",e),u=_("important",e),p=_("remove",e),h=_("spam",e),m=f("edit",e),v=f("pin",e),g=f("important",e),A=f("remove",e),b=f("spam",e),y=a.default.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel});return a.default.html(c(),y,n,i,o,s,l,u,p,h,t,m,v,g,A,b)};function d(e){var t=window.lang,n=a.default.class("mailActs__button",{type:e}),i=a.default.onClick("MailActs._onButtonClick",e),r="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return a.default.html(l(),n,i,r)}function _(e,t){var n,i=window.lang,r=a.default.class("mailActs__icon",{type:e}),o=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(s(),r,n,o)}function f(e,t){var n,i=window.lang,r=a.default.class("mailActs__chevronListItem",{type:e}),s=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(o(),r,s,n)}var p,h=n("UxAg"),m=n("+cqQ");function v(){store.mail.cur&&O()}function g(e){store.mail.cur&&function(e){var t=e.target,n=$(".mailActs");n&&n.classList.contains("mailActs_menuOpened")&&!t.closest(".mailActs__chevronList")&&!t.closest(".mailActs__chevronMoreIcon")&&n.classList.remove("mailActs_menuOpened")}(e)}function A(e){y({canEdit:e})}function b(e){$(".mailActs__button_type_forward").disabled=!e}function y(e){Object(h.$$)(".mailActs").forEach((function(t){var n=a.default.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailActs",Object.assign({},n,e)))}))}function w(e){switch(e){case"edit":u.onEditClick();break;case"remove":u.onRemoveClick();break;case"important":u.onImportantClick();break;case"reply":u.onReplyClick();break;case"forward":u.onForwardClick();break;case"spam":u.onSpamClick();break;case"pin":u.onPinClick()}}function O(){var e=document.querySelector(".mailActs__chevron"),t=e.offsetWidth-1,n=e.querySelectorAll(".mailActs__chevronListItem"),i=e.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(i,(function(e,a){t<36*i.length?t-34>=36*(a+1)?(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden")):(e.classList.add("mailActs__icon_hidden"),n[a].classList.remove("mailActs__chevronListItem_hidden")):(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden"))})),y({cutted:t<36*i.length})}function S(){Object(h.$$)(".mailActs").forEach((function(e){return e.classList.toggle("mailActs_menuOpened")}))}Object.assign(u,((p={onCloseClick:Object(m.default)(),onRemoveClick:Object(m.default)(),onImportantClick:Object(m.default)(),onReplyClick:Object(m.default)(),onForwardClick:Object(m.default)(),onSpamClick:Object(m.default)(),onPinClick:Object(m.default)(),onMoreClick:Object(m.default)(),onEditClick:Object(m.default)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);Object(h.$$)(".mailActs__counter").forEach((function(e){return e.innerText=t})),1!=e&&A(!1);O()},setEditAvailable:A,setImportantAvailable:function(e){y({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setForwardAvailable:b,setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e}}).setForwardAvailable=b,p.togglePin=function(e){Object(h.$$)(".mailActs").forEach((function(t){return t.classList.toggle("mailActs_canPin",e)}))},p.setModifiers=y,p.setLabels=function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},p.update=O,p)),u._onButtonClick=w,u._onCloseClick=u.onCloseClick,u._onMoreClick=S,onBodyResize(v),document.addEventListener("click",g,{passive:!0});t.default=u;window.MailActs=u},Cz26:function(e,t,n){"use strict";n.r(t),n.d(t,"Timers",(function(){return i}));var i=function(){function e(e){var t=e.timer,n=void 0===t?1e3:t,i=e.autostart,a=void 0===i||i;this._list=[],this._timer=n,this._autostart=a}var t=e.prototype;return t._animate=function(e){var t=!1;return function n(){t||requestAnimationFrame((function(){t||(e(),n())}))}(),function(){t=!0}},t.add=function(e,t){var n=(void 0===t?{}:t).id;this.remove(e),n?(this.remove(n),this._list.push({id:n,callback:e})):this._list.push({callback:e}),!this._cancellation&&this._autostart&&this.start()},t.remove=function(e){this._list="function"==typeof e?this._list.filter((function(t){return t.callback!==e})):this._list.filter((function(t){return t.id!==e}))},t.start=function(){var e=this,t=Date.now();return this._cancellation=this._animate((function(){var n=Date.now();t+e._timer<n&&(e._list.forEach((function(n){var i=t;Promise.resolve().then((function(){var t=Date.now()-(i+e._timer);n.callback(Math.floor(t/e._timer)+1)}))})),t=n)})),this._cancellation},t.stop=function(){return!!this._cancellation&&(this._cancellation(),this._list=[],!0)},e}()},DOEQ:function(e,t,n){"use strict";n.r(t),n.d(t,"POST_PARAM_DONUT_DURATION",(function(){return i}));var i="donut_duration"},DVnk:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}}))},Dh0N:function(e,t){function n(e,t){var n=t.$select,r=t.value;n.closest(i.email).classList.toggle(a.groupsVisible,e.includes(r)||e.includes(Number(r)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=n;var i={email:".settingsEmail"},a={groupsVisible:"settingsEmail_groupsVisible"}},DkIl:function(e,t,n){"use strict";n.r(t),n.d(t,"MailHat",(function(){return I})),n.d(t,"MailHat__Title",(function(){return M})),n.d(t,"MailHat__icon",(function(){return P})),n.d(t,"MailHat_main",(function(){return E})),n.d(t,"MailHat_convo",(function(){return j})),n.d(t,"MailHat_page",(function(){return T}));var i=n("MUpH"),a=n("bZ/P"),r=n("9y81"),o=n("gy8s"),s=n("KMpi"),l=n("Y6JH"),c=n("fdw3"),u=n("vwub"),d=n("oZo5"),_=n("9b/I"),f=n("WWJR"),p=n("yOyn"),h=n("gZry"),m=n("zs4F"),v=n("ScVK");function g(){var e=Object(i.default)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return g=function(){return e},e}function A(){var e=Object(i.default)(["\n    ","\n      ",'\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitleWrapper">\n          <div class="','">',"</div>\n          ","\n        </div>\n        ","\n      </div>\n    ","\n  "]);return A=function(){return e},e}function b(){var e=Object(i.default)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="mailHat__desktopTitle">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function O(){var e=Object(i.default)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return O=function(){return e},e}function S(){var e=Object(i.default)(['\n    <div class="mailHat__unreadCount mailHat__unreadCount_length_','">\n      ',"\n    </div>\n  "]);return S=function(){return e},e}function k(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return k=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="mailHat '," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return C=function(){return e},e}function E(e){Object(r.default)({mix:"mailHat__burger",icon:"burger",attrs:a.default.onClick("MailHat_main.onBurgerClick")});var t,n,i,s,c,d,f,p=function(e,t,n,i,a){var r=window.lang;return Object(o.default)({mix:"mailHat__folder",triggerWrapperTag:"h1",items:[{name:"all",text:r.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:r.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:r.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:r.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important},a?{name:"ad_tag",text:r.mobile_mail_tab_ad_tag,active:"ad_tag"===e,url:t.adTag}:""]})}(e.folder,e.urls,e.withUnrespond,e.importantCount,e.withAdTag);i=e.unreadCount,s=a.default.class("mailHat__unread",{hasUnread:i>0}),c=Object(r.default)({mix:"mailHat__unreadIcon",icon:"msg"}),(t=i)>999?(t="999+",n=4):n=t>99?3:t>9?2:1,d=a.default.html(S(),n,t),f=a.default.onClick("MailHat_main.onUnreadClick"),a.default.html(k(),s,f,c,d);return I({type:"main",left:""+Wd.html({class:"mailHat__cancelForward",inner:Object(l.default)(Object(_.getBackOutline28Icon)()),onmousedown:["MailHat_main.onCancelForwardTap"]}),center:""+p+function(){var e=window.lang;return a.default.html(O(),e.mobile_mail_choose_recipient)}()+function(){var e=window.lang;return a.default.html(w(),e.mobile_mail_tab_messages)}(),right:""+Wd.html({href:e.urls.createChatUrl,class:"mailFilter__create",inner:Object(l.default)(Object(u.getWriteOutline28Icon)())}),forwarding:e.forwarding})}function j(e){var t=D(),n=Wd.html({class:"mailHat__cancelEditing",inner:Object(l.default)(Object(f.getCancelOutline28Icon)()),onmousedown:["MailHat_convo.onCancelEditingTap"]}),i=function(e){var t=e.isContact,n=(e.peerProfile.tagsData,a.default.class("mailHat__convo",{mobile:e.mobile})),i=a.default.class("mailHat__convoTitle",{casper:e.isCasper}),r=Object(s.default)({mix:"mailHat__convoAvatar",photos:e.photos,size:36,isContact:t,name:e.title}),o=function(e){var t=window.lang,n=e.membersCount,i="",r="";if(n>0)r=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var o=e.onlinePlatform;r=x(e.isOnline,e.offlineText),"mobile"===o&&(i=Wd.html({class:a.default.class("mailHat__onlineIcon",{platform:"mobile",isOnline:e.isOnline}),inner:e.isOnline?Object(l.default)(Object(h.getOnlineMobileComposite16Icon)()):Object(l.default)(Object(m.getOnlineMobile12Gray200Icon)())}))}return a.default.html(g(),r,i)}(e),u=e.isCasper?'<span title="'+Object(c.getLang)("mobile_casper_chat_title")+'" class="mailHat__convoCasperIcon">'+Wd.html(Object(l.default)(Object(p.getCasper16Icon)()))+"</span>":"",d=t?'<div class="'+n+'">':'<a class="'+n+'" href="'+e.url+'">',_=t?"</div>":"</a>";return a.default.html(A(),d,r,i,e.title,u,o,_)}(e),r=function(){var e=window.lang;return a.default.html(y(),e.mobile_mail_message_editing)}(),u="",_=function(e){return Object(o.default)({mix:"mailHat__actions",trigger_attrs:{"aria-label":Object(c.getLang)("mobile_mail_actions_label")},icon_html:Wd.html(Object(l.default)(Object(v.getMoreHorizontal28Icon)())),position:"topRight",items:e})}(e.actions);if(Object(c.isSAKIntegration)()){var b=Wd.html({class:"mailHat__icon",inner:Object(l.default)(Object(d.getVideocamOutline28Icon)()),onclick:["uMessenger.onCall"]});u=e.isCommunity||e.viewerIsCommunity||e.unableToWrite||e.closed?_:""+b+_}else u=_;return I({type:"convo",left:""+t+n,center:""+i+r,right:u,hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function T(e){return I({type:"page",left:""+D(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function I(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,r=e.editing?"mailHat_editing":"";return a.default.html(C(),i,t,n,r,e.left,e.center,e.right)}function M(e){return a.default.html(b(),e.title)}function D(){return Wd.html({tag:"button",type:"button","aria-label":Object(c.getLang)("mobile_back"),class:"mailHat__back",inner:Object(l.default)(Object(_.getBackOutline28Icon)()),onclick:["MailHat_convo.onBackTap"]})}function P(e){return Object(r.default)({mix:a.default.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url})}function x(e,t){var n=window.lang;return e?n.mobile_mail_online:t}var L=n("UxAg"),B=n("+cqQ");function R(e){Object(L.$$)(".mailHat").forEach((function(t){var n=a.default.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailHat",Object.assign({},n,e)))}))}Object.assign(E,{onUnreadClick:Object(B.default)(),onBurgerClick:Object(B.default)(),onCancelForwardTap:Object(B.default)(),setFolder:function(e){Object(L.$$)(".mailHat__folder").forEach((function(t){o.default.setActive(t,e)}))},setImportantCount:function(e){Object(L.$$)(".mailHat__folder").forEach((function(t){o.default.setCount(t,"important",e)}))},setForwarding:function(e){Object(L.$$)(".mailHat_type_main").forEach((function(t){return t.classList.toggle("mailHat_forwarding",e)}))},setModifiers:R}),Object.assign(j,{onBackTap:Object(B.default)(),onCancelEditingTap:Object(B.default)(),setOnline:function(e,t){var n=x(e,t);Object(L.$$)(".mailHat__convoDetailsText").forEach((function(e){return e.innerText=n}))},setMobile:function(e){Object(L.$$)(".mailHat__convo").forEach((function(t){return t.classList.toggle("mailHat__convo_mobile",e)}))},setHasPinnedMsg:function(e){Object(L.$$)(".mailHat_type_convo").forEach((function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)}))},setModifiers:R}),window.MailHat_main=E,window.MailHat_convo=j},EXR0:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("fdw3"),r=n("7ADY");t.default=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(i.default)({icon:Object(r.getCancel24Icon)()})],class:"ModalMenuHeader__close","aria-label":Object(a.getLang)("mobile_close"),onClick:e.onClose,tag:"button"},{inner:[e.inner],class:"ModalMenuHeader__title",tag:"div"}],class:"ModalMenuHeader",tag:"div"}}},FbVm:function(e,t,n){"use strict";n.r(t),n.d(t,"NavigationStatCollector",(function(){return c})),n.d(t,"ProductionStatCollector",(function(){return _})),n.d(t,"ActionStatCollector",(function(){return p})),n.d(t,"ClickStatCollector",(function(){return m})),n.d(t,"ViewStatCollector",(function(){return g})),n.d(t,"RegistrationItemStatCollector",(function(){return A})),n.d(t,"MarketingTransitionItemStatCollector",(function(){return r})),n.d(t,"NavigationProductionStatEventTypes",(function(){return i.NavigationProductionStatEventTypes})),n.d(t,"RegistrationFieldItemNames",(function(){return i.RegistrationFieldItemNames})),n.d(t,"RegistrationItemEventTypes",(function(){return i.RegistrationItemEventTypes})),n.d(t,"EventScreens",(function(){return i.EventScreens})),n.d(t,"marketingTransitionItemStat",(function(){return b}));var i=n("r0fY"),a=n("J8bf"),r=function(){function e(){this.productStatCollector=new _,this.actionStatCollector=new p(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n,r){var o;void 0===r&&(r="");var s={campaign:e,source:n,event:t,unauth_id:Object(a.getCookie)("remixstid")};r&&(s.url=r);var l=((o={type:i.ActionProductionStatEventTypes.TYPE_MARKETING_TRANSITION_ITEM})[i.ActionProductionStatEventTypes.TYPE_MARKETING_TRANSITION_ITEM]=s,o);this.actionStatCollector.logEvent(l)},e}(),o=n("HLtZ"),s=n("W9Tc"),l=function(){return(l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=function(){function e(e){this.ProductionStatCollector=e,this.tabId=this.ProductionStatCollector.getIntId()%128}return e.prototype.getEventTabOpen=function(e){return{subtype:i.NavigationProductionStatEventTypes.TAB_OPEN,tab_id:this.tabId,screen:e}},e.prototype.getEventMove=function(e,t){var n,a,r=this.lastStatEvents,s=this.lastNavEvents;return r&&s?(s.subtype===i.NavigationProductionStatEventTypes.TAB_OPEN?n=s.screen:(n=s.screen_to,a=s.screen),{prev_navgo_id:r.id,subtype:t,screen:n,screen_to:e,screen_prev:a,prev_navgo_timestamp:r.timestamp,tab_id:this.tabId}):(Object(o.logError)(new Error("NavigationStatCollector: previous event not found.")),null)},e.prototype.addStatEvent=function(e,t){var n;if(void 0===t&&(t=i.NavigationProductionStatEventTypes.GO),Object(s.partConfigEnabled)("navigation_timespent")){var a;if(t===i.NavigationProductionStatEventTypes.TAB_OPEN)a=this.getEventTabOpen(e);else{var r=this.getEventMove(e,t);if(!r)return;a=r}var o=l(l({},this.ProductionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_NAVGO})[i.ProductionStatEventTypes.TYPE_NAVGO]=a,n));this.ProductionStatCollector.logEvent(o),this.lastStatEvents=o,this.lastNavEvents=a}},e.prototype.getModule=function(){var e,t;return null!==(t=null===(e=window.cur)||void 0===e?void 0:e.module)&&void 0!==t?t:"unknown"},e}(),u=n("W0P9"),d=n("Bj12"),_=function(){function e(){this.DEBUG=!1}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.logEvent=function(e){this.DEBUG&&Object(u.log)(e),e.type&&e[e.type]?(Object(d.saveProductionStats)(e),this.lastEvent=e):Object(o.logError)(new Error("ProductionStatCollector: invalid event."))},e.prototype.getLastEvent=function(){return this.lastEvent},e.prototype.getBaseEvent=function(){var e;return{id:this.getIntId(),prev_id:null===(e=this.lastEvent)||void 0===e?void 0:e.id,timestamp:this.getCurrentTime(),url:window.location.href}},e.MAX_INT32=2147483647,e}(),f=function(){return(f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e){var t,n=f(f({},this.productionStatCollector.getBaseEvent()),((t={type:i.ProductionStatEventTypes.TYPE_ACTION})[i.ProductionStatEventTypes.TYPE_ACTION]=e,t));this.productionStatCollector.logEvent(n)},e}(),h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},m=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=h(h({},this.productionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_CLICK})[i.ProductionStatEventTypes.TYPE_CLICK]=h({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),v=function(){return(v=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},g=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=v(v({},this.productionStatCollector.getBaseEvent()),((n={type:i.ProductionStatEventTypes.TYPE_VIEW})[i.ProductionStatEventTypes.TYPE_VIEW]=v({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),A=function(){function e(e){this.actionStatCollector=e,this.fields={}}return e.prototype.logFieldInteraction=function(e,t,n){void 0===n&&(n=!1),[i.RegistrationFieldItemNames.PASSWORD,i.RegistrationFieldItemNames.SMS_CODE,i.RegistrationFieldItemNames.RULES_ACCEPT].includes(e)&&(t=t?"1":"0");var a=n?"0":this.actionStatCollector.productionStatCollector.getCurrentTime(!1);this.fields[e]?(this.fields[e].value=t,this.fields[e].end_interaction_time=a):this.fields[e]={name:e,value:t,start_interaction_time:a,end_interaction_time:a}},e.prototype.getFieldInteractions=function(){return Object.values(this.fields)},e.prototype.resetFieldInteractions=function(){for(var e=0,t=Object.getOwnPropertyNames(this.fields);e<t.length;e++){var n=t[e];delete this.fields[n]}},e.prototype.logEvent=function(e,t,n){var r;if(Object(s.partConfigEnabled)("registration_item_stat")){var o={event_type:e,screen:t,unauth_id:Object(a.getCookie)("remixstid"),sid:Object(a.getCookie)("remixnreg_sid")};[i.RegistrationItemEventTypes.SCREEN_PROCEED,i.RegistrationItemEventTypes.SCREEN_SKIP,i.RegistrationItemEventTypes.SCREEN_RETURN].includes(e)&&(o.screen_to=n,o.fields=this.getFieldInteractions(),this.resetFieldInteractions());var l=((r={type:i.ActionProductionStatEventTypes.TYPE_REGISTRATION_ITEM})[i.ActionProductionStatEventTypes.TYPE_REGISTRATION_ITEM]=o,r);this.actionStatCollector.logEvent(l)}},e}(),b=new r},Fhlr:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",(function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)})),e._promoButtonClickHandlerAdded=!0}}))},Fkq0:function(e,t,n){"use strict";n.r(t),n.d(t,"marketDebug",(function(){return o})),n.d(t,"marketItemIdToObject",(function(){return s})),n.d(t,"albumLinkToObject",(function(){return l})),n.d(t,"parseBookmarkedProductClass",(function(){return c})),n.d(t,"extractURLQueryParameter",(function(){return u})),n.d(t,"isElementVisible",(function(){return d})),n.d(t,"isElementInViewport",(function(){return _}));var i=n("ZD4m"),a=n("W9Tc"),r=n("tGJf");function o(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];(Object(a.partConfigEnabled)("extended_client_logging")||r.vkLocalStorage.getItem("market_extended_client_logging"))&&("error"===e?console.error("[market "+t+"]: ",n):"warn"===e?console.warn("[market "+t+"]: ",n):"info"===e?console.info("[market "+t+"]: ",n):console.debug("[market "+t+"]: ",n))}function s(e,t){void 0===t&&(t="market");var n=new RegExp(t+"(-?[0-9]+)_([0-9]+)"),i=e.match(n);if(!i||i.length<3)return null;var a=i[1],r=i[2];return{id:a+"_"+r,ownerId:parseInt(a),itemId:parseInt(r)}}function l(e){var t=e.match(/market(\-?[0-9]+).+section=album_([0-9]+)/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:n+"_"+i,ownerId:parseInt(n),itemId:parseInt(i)}}function c(e){var t=e.match(/_([0-9]+)_(\-?[0-9]+)_4/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:i+"_"+n,ownerId:parseInt(i),itemId:parseInt(n)}}function u(e,t){var n=new RegExp("[?&]+"+t+"=([a-zA-Z0-9_]+)"),i=e.match(n);return!i||i.length<2?null:i[1]?String(i[1]):null}function d(e){var t;return"none"!==(null===(t=e.style)||void 0===t?void 0:t.display)}function _(e,t,n,a){void 0===t&&(t=50),void 0===n&&(n=null);var r=n?n.left:0,o=n?n.top:0,s=Object(i.getViewportSize)(),l=Object(i.getElementOffset)(e),c=Object(i.getElementSize)(e),u=c.width*t/100,d=c.height*t/100;if(a){if(a.width>s.width)return!1;if(a.height>s.height)return!1;s=a}return!(l.left+c.width<r+u)&&(!(l.left+u>s.width)&&(!(l.top+c.height<o+d)&&!(l.top+d>s.height)))}},"GR/G":function(e,t,n){var i=n("/8IX"),a=n("HN+/");function r(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||o(e)!==o(t)?e:(a(e,t),s(e,t),t):null:e}function o(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function s(e,t){for(var n,i,a,o,s=0,c=0;n=t.childNodes[c],i=e.childNodes[c-s],n||i;c++)if(i)if(n)if(l(i,n))(a=r(i,n))!==n&&(t.replaceChild(a,n),s++);else{o=null;for(var u=c;u<t.childNodes.length;u++)if(l(t.childNodes[u],i)){o=t.childNodes[u];break}o?((a=r(i,o))!==o&&s++,t.insertBefore(a,n)):i.id||n.id?(t.insertBefore(i,n),s++):(a=r(i,n))!==n&&(t.replaceChild(a,n),s++)}else t.appendChild(i),s++;else t.removeChild(n),c--}function l(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(3===e.type&&e.nodeValue===t.nodeValue)}e.exports=function(e,t,n){if(i.equal(typeof e,"object","nanomorph: oldTree should be an object"),i.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly)return s(t,e),e;return i.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),r(t,e)}},GVTI:function(e,t,n){"use strict";n.r(t),n.d(t,"_PhotoviewPage_tags",(function(){return f}));var i=n("vOib"),a=n("rc7J"),r=n("fdw3"),o=n("29dZ"),s=n("vk58"),l=n("Q8gl"),c=n("O5lf"),u=n("vhZE");function d(e){var t="wi_like_wrap";e.liked_people||(t+=" is_empty");var n="PhotoviewPage__description";return e.photo.description||(n+=" PhotoviewPage__description--empty"),{inner:[e.photo.caption?{inner:[Wd.wrap(e.photo.caption)],class:"PhotoviewPage__caption",tag:"div"}:null,{inner:[Wd.wrap(e.photo.description)],class:n,tag:"div"},{inner:[e.liked_people?e.liked_people:null],class:t,tag:"div"},e.buttons?{inner:[{inner:[e.buttons],class:"wi_buttons",tag:"div"}],class:"wi_buttons_wrap",tag:"div"}:null,e.author,e.replies],class:"PhotoviewPage__footer",tag:"div"}}function _(e){var t=window.lang;return{inner:[{inner:[e.edit_data.rotate.can_rotate?Object(s.default)({inner:[Object(o.default)({inner:[t.mobile_photos_edit_rotate_left],url:e.edit_data.rotate.left,stretch:!0}),Object(o.default)({inner:[t.mobile_photos_edit_rotate_right],url:e.edit_data.rotate.right,stretch:!0})],nowrap:!0}):null,{inner:[{inner:[t.mobile_photos_edit_desc_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.photo.description],name:"text",class:"textfield",rows:"4",tag:"textarea"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[{inner:[t.mobile_photos_edit_album_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.edit_data.albums.map((function(e){return{inner:[e.name],selected:e.selected?"selected":null,value:e.id,tag:"option"}}))],name:"aid",tag:"select"},{inner:[Object(l.default)({withoutWrap:!0,name:"cover",label:t.mobile_photos_edit_cover_label,type:"checkbox"})],class:"fi_subrow",tag:"div"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[Object(s.default)({inner:[Object(o.default)({inner:[t.mobile_photos_edit_save_btn],type:"submit"}),Object(o.default)({inner:[t.mobile_cancel],theme:"link",url:e.edit_data.back_url})]})],class:"fi_row",tag:"div"}],action:e.edit_data.action,method:"post",tag:"form"}],class:"form_item",tag:"div"}}function f(e){return void 0===e&&(e=[]),{inner:[Object.keys(e).map((function(t){return{inner:[{class:"fill",tag:"div"}],class:"pv_tag",id:"pv_tag"+t,style:function(e){if(!Object(r.isArray)(e))return"";var t=e[0];return Object(r.isArray)(t)?"left: "+t[0]+"%; top: "+t[1]+"%; width: "+t[2]+"%; height: "+t[3]+"%":""}(e[t]),tag:"div"}}))],class:"PhotoviewPage__tags",tag:"div"}}var p=function(e){void 0===e&&(e={});var t=e.info||{},n=e.photo||{},o=e.is_loading||!1,s=e.navigation_buttons||{},l=Object(r.concatValues)("PhotoviewPage ",e.class);e.info&&(e.author=Object(a.default)({url:t.url,author_url:t.author_url,avatar:t.avatar,title:t.title,subtitle:t.subtitle,withoutBottomBorder:!e.has_replies})),e.photo||(e.photo={}),e.photo.description||(e.photo.description="");var p,h="",m=null;o&&(l=Object(r.concatValues)(l," PhotoviewPage--skeleton"),n.width?h+=" width"+e.width+"px;":m=Wd.wrap(Object(c.default)({mix:"al_loading",type:"pageLoader"})));var v=["PhotoviewPage__photo"];e.photo.restriction&&("block"===e.photo.restriction.type?v.push("PhotoviewPage__photo--block"):"blur"===e.photo.restriction.type&&v.push("PhotoviewPage__photo--blur")),p=[{src:n.src,style:h,tag:"img"},f(e.tags)];var g,A=!!e.photo.restriction;return A&&((g=e.photo.restriction).width=e.width,g.height=e.height||e.width),Object(i.default)({inner:[{inner:[{inner:[m||{inner:[p],class:v,href:n.href,tag:"a"},{inner:[Object(u.default)(g)],class:"PhotoviewPage__restrictedInfo",style:A?"":"display: none;",tag:"div"},s],class:"PhotoviewPage__thumb",tag:"div"},e.edit_mode?_(e):d(e)],id:e.photo.id,tag:"div"}],class:l})};t.default=p},GYWy:function(e,t,n){(function(e,i){var a;!function(r){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i&&i;o.global!==o&&o.window!==o&&o.self;var s,l=2147483647,c=/^xn--/,u=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function h(e){throw new RangeError(_[e])}function m(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function v(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+m((e=e.replace(d,".")).split("."),t).join(".")}function g(e){for(var t,n,i=[],a=0,r=e.length;a<r;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<r?56320==(64512&(n=e.charCodeAt(a++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),a--):i.push(t);return i}function A(e){return m(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function y(e,t,n){var i=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;i+=36)e=f(e/35);return f(i+36*e/(e+38))}function w(e){var t,n,i,a,r,o,s,c,u,d,_,p=[],m=e.length,v=0,g=128,b=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&h("not-basic"),p.push(e.charCodeAt(i));for(a=n>0?n+1:0;a<m;){for(r=v,o=1,s=36;a>=m&&h("invalid-input"),((c=(_=e.charCodeAt(a++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:36)>=36||c>f((l-v)/o))&&h("overflow"),v+=c*o,!(c<(u=s<=b?1:s>=b+26?26:s-b));s+=36)o>f(l/(d=36-u))&&h("overflow"),o*=d;b=y(v-r,t=p.length+1,0==r),f(v/t)>l-g&&h("overflow"),g+=f(v/t),v%=t,p.splice(v++,0,g)}return A(p)}function O(e){var t,n,i,a,r,o,s,c,u,d,_,m,v,A,w,O=[];for(m=(e=g(e)).length,t=128,n=0,r=72,o=0;o<m;++o)(_=e[o])<128&&O.push(p(_));for(i=a=O.length,a&&O.push("-");i<m;){for(s=l,o=0;o<m;++o)(_=e[o])>=t&&_<s&&(s=_);for(s-t>f((l-n)/(v=i+1))&&h("overflow"),n+=(s-t)*v,t=s,o=0;o<m;++o)if((_=e[o])<t&&++n>l&&h("overflow"),_==t){for(c=n,u=36;!(c<(d=u<=r?1:u>=r+26?26:u-r));u+=36)w=c-d,A=36-d,O.push(p(b(d+w%A,0))),c=f(w/A);O.push(p(b(c,0))),r=y(n,v,i==a),n=0,++i}++n,++t}return O.join("")}s={version:"1.4.1",ucs2:{decode:g,encode:A},decode:w,encode:O,toASCII:function(e){return v(e,(function(e){return u.test(e)?"xn--"+O(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?w(e.slice(4).toLowerCase()):e}))}},void 0===(a=function(){return s}.call(t,n,t,e))||(e.exports=a)}()}).call(this,n("YuTi")(e),n("yLpj"))},Gjsa:function(e,t,n){(function(t){var n;n="function"==typeof t?function(e){t(e)}:function(e){setTimeout(e,0)},e.exports=n}).call(this,n("URgk").setImmediate)},GtpT:function(e,t,n){"use strict";n.r(t),n.d(t,"getDataFromDOM",(function(){return l}));var i=n("Y6JH"),a=n("HaOv"),r=n("xTMR");var o=function(e){var t,n=e.album,o=n.url,s=n.title,l=n.photos_count_label,c=n.restriction,u="AlbumItem al_album";n.thumb?t=n.thumb:c||(u+=" AlbumItem--empty");var d,_="";if(c){var f={};f[c.type]=!0,_=Bem.class("AlbumItem__restriction",f,"--")}if(c&&"geo"===c.type)d={inner:[{inner:[Object(i.default)({icon:Object(a.getDoNotDisturbOutline56Icon)()})],class:_,tag:"div"}],class:"AlbumItem__thumb",tag:"div"};else{var p=[Bem.class("AlbumItem__thumb",{blur:c&&"blur"===c.type},"--")];d={inner:[c&&c.type?{inner:[Object(i.default)({icon:Object(r.getHideOutline56Icon)()})],class:_,tag:"div"}:null],class:p,"data-thumb-id":n.thumb_id,style:"background-image: url("+t+")",tag:"div"}}return{inner:[{inner:[d],class:"AlbumItem__thumbWrap",tag:"div"},{inner:[{inner:[s],class:"AlbumItemInfo__title",tag:"div"},{inner:[l],class:"AlbumItemInfo__subtitle",tag:"div"}],class:"AlbumItemInfo",tag:"div"}],href:o,class:u,onclick:e.onClick,tag:"a"}},s=n("OcsD");function l(e){if(!e.classList.contains("AlbumItem"))return{};var t=Object(s.val)($(".AlbumItemInfo__title",e))||"",n=Object(s.val)($(".AlbumItemInfo__subtitle",e))||"",i=e.getAttribute("href"),a=$(".AlbumItem__thumb",e),r=/url\("(.*)"\)/.exec(a.style.backgroundImage),o=!!r&&r[1],l=$(".AlbumItem__restriction",e),c=!1;return l&&(l.classList.contains("AlbumItem__restriction--blur")?c={type:"blur"}:l.classList.contains("AlbumItem__restriction--geo")&&(c={type:"geo"})),{album:{title:Wd.wrap(t),photos_count_label:n,url:i,thumb:o,restriction:c},onClick:e.getAttribute("onclick")}}t.default=o},Gzds:function(e,t,n){"use strict";n.r(t);var i,a,r=n("+cqQ"),o=n("wkhI"),s=n("UxAg"),l=n("DOEQ"),c=n("OcsD"),u=n("fdw3"),d=n("zvhO"),_=n("W9Tc"),f=n("cZev");onDOMReady((function(){f.default.onStickerPanelUpdate((function(){if(cur.waitingStickerPanel)clog("Show sticker panel after waiting"),p.stickersToggle(null,!0);else if("mail"!==cur.module){var e=Object(s.$)("#stickers_panel");Object(c.domData)(e,"need-update",1),e&&"none"!==e.style.display&&p.stickersToggle(null,!1)}}))}));var p={curGif:null,onStickersTabSelected:Object(r.default)(),onStickerClick:Object(r.default)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var r=!1;if(each(i,(function(e,t){if("submit"===t.type)return r=t,!1})),r)return append(a,i),window.al&&n.ver?nav.go(r,t):i.submit()}return!0},saveDraft:function(e,t,n,i){if(e&&e.preventDefault(),!i||!i.classList.contains("CreatePostButtons__item--disabled")){var a=ge("feed_add_form"),r=qs2obj(nav.params),s={act:"post",save_draft:1,redirect:n,hash:t};r.comment&&(s.comment=r.comment),each(a.elements,(function(e,t){if(!["submit","file"].includes(t.type)){if(Object(o.isFieldIgnored)(t))return;s[t.name]="checkbox"===t.type?(+t.checked).toString():t.value}})),ajax.post(window.nav.path,s)}},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var a=geByClass1("wi_actions_wrap",i),r=geByClass1("wi_actions",a),o=geByClass1("wi_actions_btn",i);p.wallActionsHide(),addClass("wi_actions_opened",i);var s=getY(i)+45+getH(r)+7,l=scrollTop()+getCh();toggleClass("wi_actions_top",a,s>l),n.addHandler(p.wallActionsHide),n.show(a,o)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,a){return void 0===a&&(a=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?p.hideGif(e,t,a):(a||Gif.autoplayTest(),p.showGif(e,t,n,a))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach((function(n,i){n!==e&&p.hideGif(n,!1,t)}))},showGif:function(e,t,n,r){var o=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(o.loadedGifs||(o.loadedGifs={}),!o.loadedGifs[e.href]&&!confirm(n))return!1;o.loadedGifs[e.href]=!0}if(clearInterval(i),!r){var l=getY(e),c=scrollTop();scrollTop(c-(l-getY(e)))}geByClass("current_gif","mcont").forEach((function(e,t){p.hideGif(e,!1,r)}));var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports()&&e.href.includes("&mp4"),d=function(t,n){hasClass("current_gif",e)&&(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),"VIDEO"===a.tagName&&document.body.contains(a)?a.play():append(a,e),p.curGif=e,n&&n())};if(u){var _=geByClass1("ph_img",e).src;(a=Object(s.$)("video.gif_original",e)||ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:_})).setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.setAttribute("controls",!0),a.controls=!1,a.readyState>=2&&"VIDEO"===a.tagName?(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),a.play(),d()):a.load()}else a=ce("img",{src:e.href,className:"gif_original"});return e.classList.add("current_gif"),e.classList.contains("gif_opened")||e.classList.add("gif_loading"),u?a.oncanplay=function(){e!==p.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,r?1:0),d())}:i=setInterval((function(){a.complete&&(statlogsValueEvent("gif_play",0,"gif",null,r?1:0),d(),clearInterval(i))}),100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach((function(e){"VIDEO"===e.tagName?e.pause():remove(e)})),!n){var i=Gif.getState(),a=i.currentAutoplayElement,r=i.ignore;a===e&&(r.push(e),Gif.setState("ignore",r))}return p.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,(function(){t.push(escapeRE(this[0]))})),new RegExp("^("+t.join("|")+")")},stickerPanelInit:function(){if(Object(s.$)("#stickers_panel"))return!0;var e=!1;if("mail"===cur.module&&window.isNewMail)e=Object(s.$)(".uMailWrite__popupStickers").childNodes[0];else{var t=Object(s.$)(".RepliesField_wrap")||(Object(s.$)(".create_post")||{}).parentNode;if(!t)return!1;e=(Array.from(t.children).find((function(e){return!(!e||!e.nextSibling||e.nextSibling.nodeType!==Node.COMMENT_NODE)}))||{}).nextSibling}if(e&&e.nodeType===Node.COMMENT_NODE){var n,i=f.default.getStickerPanel();if(!i)return!1;var a=document.createElement("div");return a.innerHTML=i,e&&(n=e).after.apply(n,a.childNodes),e&&e.remove(),p.stickersInit(),!0}return!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=Object(s.$)("#stickers_panel");if(!n)return!p.stickerPanelInit()||(p.stickersInit(),"cached");var i=geByClass1("sp_body",n),a=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push((function(){e.scroller.destroy()})),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(a),e.tabScroller.init(),e.destroy.push((function(){e.tabScroller.destroy()})),p.onStickersInit(!0)}},replyTo:function(e,t,n,i,a){var r=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var o=ge("nc_form"),s=ge("nc_message"),l=geByClass1("nc_reply_name",o),c=gpeByClass("near_btn",l),u=ge("nc_reply_as"),d=val(s),_=p.replyNamesRE();if(n){var f=ge(t+"_"+n),h=getY(f)+getH(f),m=scrollTop();after(o,f),addClass("nc_current_reply",geByClass1("pi_reply_wrap",f)),scrollTop(m+getY(f)+getH(f)-h);var v=r.replyNames[i]||{},g=v[0]||"",A=v[1]||"";d=d?_?d.replace(_,g):d:g,p.onReplyClick(!0,g)}else{append(o,geByClass1("wall_replies")),scrollToEl(o);A="";d=_?d.replace(_,""):d}return val(s,replaceEntities(d)),val(l,A),toggle(c,n),u&&(val(u,+a),toggleClass("cp_post_as_group",o,+a)),val("nc_reply_to",n),r.replyTo=n,elfocus(s),!1},stickersToggle:function(e,t){var n=window.cur;if(!f.default.getStickers())return f.default.checkStickers(),!0;isUndefined(t)&&(t=!isVisible("stickers_panel")),!t&&n.waitingStickerPanel&&delete n.waitingStickerPanel;var i=ge("write_form")||ge("nc_form"),a=ge("stickers_panel"),r=geByClass1("cp_sticker_btn",i);if(!a){var o=p.stickersInit();if("cached"===o)return p.stickersToggle(e,t);if(!0===o)return n.waitingStickerPanel=!0,void f.default.checkStickers()}if(n.waitingStickerPanel&&delete n.waitingStickerPanel,!t&&Object(c.domData)(a,"need-update")){var l=Object(u.getState)("target")||safeGet(window.store,"mail.cur.peerId"),d=f.default.getStickerPanel(l),_=document.createElement("div");_.innerHTML=d;var h=Object(s.$)(".stickers_panel",_);a.innerHTML=h.innerHTML,p.stickersInit()}return toggle(a,t),toggleClass("cp_sticker_btn_sel",r,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach((function(e){return e(t)})),!1},saveCurrentStickersPanelToCache:function(){if(Object(_.partConfigEnabled)("mvk_stickers_panel_optimize")){var e=Object(s.$)(".stickers_panel");if(e){var t=safeGet(window.store,"mail.cur.peerId"),n=(Object(u.getState)("target")||"").toString()||(t?"mail"+t:"");if(n){var i=f.default.getStickerPanel(),a=document.createElement("div");a.innerHTML=i,Object(s.$)(".stickers_panel",a).innerHTML=e.innerHTML.replace(new RegExp(n,"g"),"mail0"),f.default.saveStickerPanel(a.innerHTML)}}}},stickersClick:function(e,t){var n=f.default.getStickers();return n&&n[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),p.stickersToggle(null,!0),p.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return setTimeout((function(){f.default.checkStickers({force:!0})}),1e3),ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getStickersTabHTML:function(e){var t=(f.default.getStickers()||[])[e],n=window.isNewMail?16:8,i=[];if(t&&t.length)for(var a=0;a<t.length/n;a++)i.push(t.slice(a*n,a*n+n));var r=i.map((function(e){return e&&Object(c.isArray)(e)?'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map((function(e){var t=p.fromStickerToObject(e),n=t.id,i=t.size,a=t.url,r=t.animationUrl,o=t.recent,s=t.ref,l="",c="";return r&&(l=" sticker_animation",c='\n          data-animation-path="'+r+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+l+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(o)+", '"+s+"');\"")+" "+c+'>\n              <img src="'+a+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '})).join("\n")+"\n          </div>\n        </div>\n      ":""})).join("\n"),o='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",s=i.map((function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '})).join("\n");return'\n        <div class="sp_cont scroller_wrap">\n          <div class="scroller_cont">\n            '+(t&&t.length?r:o)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(i.length>1?s:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),a=geByClass1("sp_body",i),r=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(a,p.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",r),addClass("sp_tab_selected",e);var o=getY(i),s=o+getW(i),l=scrollTop(),c=l+getCh();return(o<l||s>c)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),p.saveCurrentStickersPanelToCache(),window.isNewMail&&p.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){window.cur;var i=gpeByClass("sticker_item",e);if(f.default.getStickers()&&i){var a=Object.keys(f.default.getStickers()).reduce((function(e,n){return e||f.default.getStickers()[n].find((function(e){return p.fromStickerToObject(e).id===t}))}),null);if(!a)throw new Error("Sticker "+t+" not found");var r=p.fromStickerToObject(a),o=r.id,l=r.size,c=r.url,u=r.animationUrl,_=f.default.getStickers()[-1]||[];(_=_.filter((function(e){return p.fromStickerToObject(e).id!==o}))).unshift(p.fromObjectToSticker({id:o,size:l,url:c,animationUrl:u,recent:1,ref:"recent"})),_=_.filter((function(e,t){return t<(window.isNewMail?16:8)})),f.default.setStickerTab(-1,_);var h=-1;if(!n){var m=Object(s.$)(".stickers_panel .sp_tab_selected"),v=m&&m.className.split(" ").find((function(e){return/sp_tab.([0-9])*/.test(e)})).split("sp_tab")[1];Object(d.isNumber)(+v)&&(h=+v)}p.stickersSelectTab(!1,h)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&p.onStickerClick(t,i))return p.addRecentSticker(e,t,!1),!1;var a=window.cur;if(a.scroller&&!a.scroller.canClick())return!1;p.stickersToggle(e,!1);var r=ge("write_submit"),o={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(o.url_params.media_from="recent"),a.ref&&(o.url_params.ref=a.ref,a.ref=void 0),a.refSource&&(o.url_params.ref_source=a.refSource,a.refSource=void 0),!i){var s=attr(e,"href");s&&(i=s.split("sticker_referrer=")[1].split("&")[0])}return i&&(o.url_params.sticker_referrer=i),p.addRecentSticker(e,t,n),r?ajax.click(r,extend({save:!0},Dialog),o):(r=ge("nc_submit"))?(Replies.getCurrentTimestamp()||Replies.setCurrentTimestamp(-1),setTimeout((function(){Replies.setCurrentTimestamp(0)}),0),ajax.click(r,{},o)):void 0},toggleMarkAsAds:function(e,t){var n=Object(s.$)("input[name='from_group']");if(n&&!n.checked)return cancelEvent(t);var i=Object(s.$)("input",e);if(i.disabled)return cancelEvent(t);var a=Object(s.$)("input[name='mute_notifications']");a&&(a.checked=i.checked,a.disabled=i.checked),p.checkCopyright()},toggleDonut:function(e,t){var n=Object(s.$)("input[name='from_group']");if(!n||n.checked){var i=Object(s.$)("#feed_add_form"),a=Object(s.$)('input[name="donut_only"]'),r=Object(s.$)("#select-donut-duration"),u=Object(s.$)('[name="'+l.POST_PARAM_DONUT_DURATION+'"]',i),d=!a.checked,_=Object(s.$)("input",r);Object(o.setFieldIgnored)(u,d),r.classList.toggle("post__select_hidden",d),Object(c.domData)(_,"ignore-field",d);var f=Object(s.$)("input[name='marked_as_ads']");if(f){var p="1"===Object(c.domData)(f,"value");a.checked?(Object(c.domData)(f,"value",f.checked?"1":"0"),f.checked=!1):(Object(c.domData)(f,"value",null),f.checked=p),f.disabled=a.checked}}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input"),i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications","donut_only"]},a=Object(s.$)("input[name='marked_as_ads']");Object(s.$)("input[name='donut_only']");$$(".Control.Control_type_switcher.Row").forEach((function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)(n.checked&&!i.group.includes(t.name)||!n.checked&&i.user.includes(t.name))&&(t.disabled=!n.checked),"mute_notifications"===t.name&&a&&a.checked&&(t.disabled=!0);else{var r=Object(s.$)(".header__user"),o=Object(s.$)(".header__group"),l=Object(s.$)("#select-timer"),c=Object(s.$)("input[name=postpone]"),u=Object(s.$)("input#add_post_btn");if(n.checked?(r.classList.add("header_hidden"),o.classList.remove("header_hidden"),l.style.display="inline-block",c.disabled=!1):(r.classList.remove("header_hidden"),o.classList.add("header_hidden"),l.style.display="none",c.disabled=!0),u){var d=u.value;u.value=u.dataset.value,u.dataset.value=d}}}})),p.checkCopyright()},checkCopyright:function(){var e=Object(s.$)("input[name='marked_as_ads']"),t=Object(s.$)("input[name='from_group']"),n=ge("select-copyright"),i=Object(s.$)('input[name="copyright"]'),a=Object(s.$)(".create_post__source-option");if(n){var r=Object(s.$)(".Btn",a),o=Object(s.$)(".Btn__text",r);e&&e.checked&&(!t||t.checked)?(hide(n),attr(r,"disabled",!0),a.classList.add("create_post__source-option--disabled"),o.innerHTML=getLang("mobile_wall_post_copyright_add_button")):(attr(r,"disabled",!1),a.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),o.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):o.innerHTML=getLang("mobile_wall_post_copyright_add_button"))}}};t.default=p,window.post=p},H5mD:function(e,t,n){"use strict";n.r(t),n.d(t,"IPHONE_SAFARI_BOTTOM_BAR",(function(){return r})),n.d(t,"IPHONE_X_SAFARI_BOTTOM_BAR",(function(){return o})),n.d(t,"IPHONE_KEYBOARD_REJECT_OFFSET",(function(){return s})),n.d(t,"IOS_NO_KEYBOARD_ALLOWED_OFFSET",(function(){return l})),n.d(t,"isIPad",(function(){return d})),n.d(t,"isIPhone",(function(){return _})),n.d(t,"isIOS",(function(){return f})),n.d(t,"isIPadOS",(function(){return u})),n.d(t,"iosMajor",(function(){return i})),n.d(t,"iosMinor",(function(){return a})),n.d(t,"isWKWebView",(function(){return m})),n.d(t,"isScrollBasedViewport",(function(){return h})),n.d(t,"isIPhoneX",(function(){return v})),n.d(t,"isIOSChrome",(function(){return g})),n.d(t,"isLandscapePhone",(function(){return A})),n.d(t,"checkIPadOS",(function(){return b}));var i,a,r=45,o=85,s=180,l=70,c=navigator.userAgent.toLowerCase(),u=b(c),d=u||-1!==c.indexOf("ipad"),_=!d&&-1!==c.search(/iphone|ipod/),f=_||d,p=f&&navigator.userAgent.match(/OS ([\d_]+) like Mac OS X/i);u&&(i=13,a=0),p&&(p=p[1].split("_"),i=+p[0],a=+p[1]),p=null;var h=i<13&&!(11===i&&a<3),m=f&&function(e){if(window.webkit&&window.webkit.messageHandlers)return!0;var t=/constructor/i.test(window.HTMLElement),n=!!window.indexedDB;if(-1===e.indexOf("safari")||-1===e.indexOf("version")||navigator.standalone){if(!n&&t||!window.statusbar||!window.statusbar.visible);else if(!t||n)return!0}else;return!1}(c),v=f&&375===screen.width&&812===screen.height&&3===window.devicePixelRatio,g=-1!==c.search(/crios/i);function A(){return 90===Math.abs(window.orientation)&&!d}function b(e){var t=!/ipad|iphone|ipod/.test(e);return!(!/mac os/.test(e)||!t||"boolean"!=typeof navigator.standalone)}},HGMY:function(e,t,n){"use strict";n.r(t),n.d(t,"MailPreSendList__Msg",(function(){return r})),n.d(t,"getElem",(function(){return s})),n.d(t,"setMsgs",(function(){return l})),n.d(t,"addMsg",(function(){return c})),n.d(t,"removeMsg",(function(){return u})),n.d(t,"getMsg",(function(){return d}));n("TYsd");var i=n("/Id8"),a=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}};function r(e){var t=store.mail,n=t.members[e.authorId],a=e.peerId,r=t.peers[a],o=Object(i.Msg__authorName)(n,a,t.cur.userId);return Object(i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:o,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:r.isChannel&&r.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,ts:e.ts,maxDepth:store.mail.cur.maxMsgDepth})}var o=n("UxAg");function s(){return Object(o.$)(".MailPreSendList__box")}function l(e){s().innerHTML=e.map((function(e){return r(e)})).join("")}function c(e){s().insertAdjacentHTML("beforeend",r(e)),MailScrap.peerGoToBottom()}function u(e){var t=i.default.getElem(e.sendId);t&&t.remove()}function d(e){return i.default.getElem(e.sendId)}t.default=a},"HN+/":function(e,t,n){var i=n("vOyG"),a=i.length;function r(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}e.exports=function(e,t){var n=e.nodeType,o=e.nodeName;1===n&&function(e,t){for(var n=t.attributes,i=e.attributes,a=null,r=null,o=null,s=null,l=i.length-1;l>=0;--l)s=i[l],o=s.name,a=s.namespaceURI,r=s.value,a?(o=s.localName||o,t.getAttributeNS(a,o)!==r&&t.setAttributeNS(a,o,r)):t.hasAttribute(o)?t.getAttribute(o)!==r&&("null"===r||"undefined"===r?t.removeAttribute(o):t.setAttribute(o,r)):t.setAttribute(o,r);for(var c=n.length-1;c>=0;--c)!1!==(s=n[c]).specified&&(o=s.name,(a=s.namespaceURI)?(o=s.localName||o,e.hasAttributeNS(a,o)||t.removeAttributeNS(a,o)):e.hasAttributeNS(null,o)||t.removeAttribute(o))}(e,t);3!==n&&8!==n||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);"INPUT"===o?function(e,t){var n=e.value,i=t.value;r(e,t,"checked"),r(e,t,"disabled"),n!==i&&(t.setAttribute("value",n),t.value=n);"null"===n&&(t.value="",t.removeAttribute("value"));e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===o?function(e,t){r(e,t,"selected")}(e,t):"TEXTAREA"===o&&function(e,t){var n=e.value;n!==t.value&&(t.value=n);if(t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t);!function(e,t){for(var n=0;n<a;n++){var r=i[n];e[r]?t[r]=e[r]:t[r]&&(t[r]=void 0)}}(e,t)}},HdGT:function(e,t,n){"use strict";n.r(t),n.d(t,"onStopped",(function(){return v})),n.d(t,"onSent",(function(){return g})),n.d(t,"onFailed",(function(){return A})),n.d(t,"onCaptcha",(function(){return b})),n.d(t,"onErrorMessage",(function(){return y})),n.d(t,"onMessage",(function(){return w})),n.d(t,"onMessageRemove",(function(){return O})),n.d(t,"QUEUE_MAX_FAILS",(function(){return S})),n.d(t,"QUEUE_NAME",(function(){return k})),n.d(t,"ready",(function(){return C})),n.d(t,"getItems",(function(){return E})),n.d(t,"send",(function(){return j})),n.d(t,"retry",(function(){return T})),n.d(t,"remove",(function(){return I}));var i=n("W38l"),a=n("OcsD"),r={},o={};function s(e,t){var n=r[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),d(e)}function l(e){var t=r[e];t.failed=t.failed.concat(t.pending),t.pending=[],o[e]="idle",t.sendingItemId=null,t.onStopped(),d(e)}function c(e){var t=r[e];return t.loaded?Promise.resolve():(t.retrieving||(t.retrieving=function(e){return new Promise((function(t){var n=Object(a.lsGet)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter((function(e){return!!n.items[e]})),n.pending=[],t(n)}))}(e).then((function(t){var n=t.pending,i=t.failed,a=t.items,o=r[e];o.retrieving=null,o.loaded=!0,o.pending=n,o.failed=i,o.items=a}))),t.retrieving)}function u(e,t){if(!1!==navigator.onLine){var n=r[e];if("sending"!==o[e]&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],a=n.items[i];if(!a.fails||t)o[e]="sending",n.sendingItemId=i,n.onSend(a.id,a.data);else{var s=Math.pow(2,Math.max(a.fails-2,0));n.backoffTimer=setTimeout((function(){n.backoffTimer=null,u(e,!0)}),1e3*s)}}}}function d(e){var t=r[e],n=t.pending,i=t.failed,o=t.items;Object(a.lsSet)("q_"+e,{pending:n,failed:i,items:o})}window.addEventListener("online",(function(){Object.keys(r).forEach((function(e){u(e)}))}));var _,f,p=n("qHA9"),h=n("+cqQ"),m=n("j80l"),v=Object(h.default)(),g=Object(h.default)(),A=Object(h.default)(),b=Object(h.default)(),y=Object(h.default)(),w=Object(h.default)(),O=Object(h.default)(),S=5,k="mail_send";function C(){return c(k)}function E(){return{pending:(e=r[k]).pending,failed:e.failed,items:e.items};var e}function j(e){C().then((function(){var t;i.logQueueSize((t=r[k])?t.pending.length:0);var n=Object(p.sendDataToMessage)(e);!function(e,t,n){var i={id:t,data:n,fails:0},a=r[e];s(e,t),a.items[t]=i,a.pending.push(t),u(e),d(e)}(k,n.sendId,{data:e}),w(n)}))}function T(e,t){var n,i=(n=e,r[k].items[n]||null);t&&(i.data=t(i.data)),s(k,e),j(i.data.data)}function I(e,t){s(k,e),"silent"!==t&&O(e)}f={onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",a="edit_message"===e.act;a?Object.keys(e).forEach((function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]})):(n=Object(m.makeUrl)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach((function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t||delete e[t]}))),i.log(t,a?"edit":"send");var s=function(e){var n,s,l;i.mark(t,"server"),a&&!e.was_modified&&O(t),g(),s=r[n=k],(l=s.sendingItemId)&&(s.pending[0]===l&&s.pending.shift(),delete s.items[l]),o[n]="idle",s.sendingItemId=null,u(n),d(n)};Object(p.mailRequest)(n,e).then(s,(function e(n){var a=n.type,c=n.code,d=n.message,_=n.data;if(i.error(t,"server_send",a),"captcha"!==a&&i.clean(t),"server"===a&&c&&c!==p.UNKNOWN_ERROR)return d&&y(d),void l(k);"captcha"!==a?(function(e){var t=r[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void l(e)}o[e]="idle",t.sendingItemId=null,u(e)}(k),A()):b(_,(function(n){if(!n)return i.clean(t),void l(k);n.then(s,e)}))}))}(t.data,e)},onStopped:v,maxFails:S},r[_=k]={pending:[],failed:[],items:{},onSend:f.onSend,onStopped:f.onStopped,maxFails:0|f.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},o[_]="idle"},I2ZF:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,a=n;return[a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]]].join("")}},I7Du:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=e.on_change;return{class:[e.mix||e.class,i.default.class("Select",{disabled:e.disabled})],inner:[{class:"Select__native",tag:"select",name:e.name,disabled:e.disabled,onchange:e.nativeOnChange?e.onChange:t?["Select._onChange","this",t]:null,required:e.required,inner:e.options.map((function(e){return e?{class:"Select__option",tag:"option",value:e.value,selected:e.selected?"selected":null,inner:e.label,attrs:e.attrs}:null}))}]}};t.default=a},Ibf7:function(e,t,n){"use strict";var i=n("Gjsa");e.exports=function(e,t,n){e&&i((function(){e.apply(n||null,t||[])}))}},IetZ:function(e,t,n){"use strict";n.r(t),n.d(t,"cutTextToHighlight",(function(){return i}));function i(e){var t=null;document.querySelectorAll(e+":not(.cutTextToHighlight)").forEach((function(e){if(e.classList.add("cutTextToHighlight"),null===t){var n=getComputedStyle(e).font;i=n,(a=document.createElement("canvas").getContext("2d")).font=i,t=function(e){var t=a.measureText(e).width;return Math.ceil(t)}}var i,a;e.innerHTML=function(e,t,n){void 0===n&&(n="…");var i=e.querySelector(".highlight");if(!i)return e.innerHTML;var a=e.innerHTML.indexOf('<em class="highlight">');if(i.offsetLeft+i.offsetWidth<=e.offsetWidth-15)return e.innerHTML;if(i.offsetWidth<e.offsetWidth-15){for(var r=0,o="",s=a;s>0&&r+i.offsetWidth<=e.offsetWidth;){var l=e.innerHTML.lastIndexOf(" ",s-1);if(-1===l&&(l=0),o=e.innerHTML.substring(l,s)+o,!((r=t(n+o.trim()))+i.offsetWidth<=e.offsetWidth-15))break;s=l}a=s}if(a>0)return n+e.innerHTML.substring(a).trim();return e.innerHTML}(e,t)}))}},JCKH:function(e,t,n){"use strict";n.r(t),n.d(t,"GroupCallSnippet",(function(){return a})),n.d(t,"GroupCallSnippetSkin",(function(){return l}));var i=n("ZMWW"),a={join:function(e){i.SAKIntegration.isIntegrated&&i.SAKIntegration.sendMessage("call_join",{callData:e,peerId:store.mail.cur.peerId})}},r=n("Y6JH"),o=n("fdw3"),s=n("5fby");function l(e){var t=e.data,n=t?{inner:[Object(o.getLang)("mobile_mail_snippet_groupcall_connect")],class:"GroupCallSnippet__link",tag:"div"}:{inner:[Object(o.getLang)("mobile_mail_snippet_groupcall_ended")],class:"GroupCallSnippet__ended",tag:"div"};return{inner:[{inner:[Object(r.default)({icon:Object(s.getPhone24Icon)()})],class:"GroupCallSnippet__left",tag:"div"},{inner:[{inner:[Object(o.getLang)("mobile_mail_snippet_groupcall_title")],class:"GroupCallSnippet__title",tag:"div"},n],class:"GroupCallSnippet__main",tag:"div"}],class:"MailButton GroupCallSnippet",type:"button",onClick:t?["GroupCallSnippet.join",t]:"",tag:"button"}}window.GroupCallSnippet=a},JlTo:function(e,t,n){"use strict";n.r(t),n.d(t,"tmrTrackPage",(function(){return o})),n.d(t,"tmrTrackRegistration",(function(){return s})),n.d(t,"tmrTrackCustomGoal",(function(){return l}));var i=n("J8bf");function a(){return window.vk&&window.vk.id?window.vk.id:0}function r(e){window.vk&&window.vk.zero||window.__dev||(window._tmr=window._tmr||[],window._tmr.push(e))}function o(e,t){r({id:"2579437",url:e,referrer:t,type:"pageView",start:(new Date).getTime(),pid:a(),userid:a()}),Object(i.getCookie)("remixtmr_login")&&(Object(i.setCookie)("remixtmr_login","",-1),r({id:"2579437",type:"reachGoal",goal:"mt_login",userid:a()}))}function s(){r({id:"2579437",type:"reachGoal",goal:"mt_registration",userid:a()})}function l(e,t){void 0===t&&(t={}),r({id:"2579437",type:"reachGoal",goal:e,userid:a(),params:t})}},KMpi:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),r=n("fdw3"),o=function(e){var t,n,o=e.photos||[e.photo],c=(o=Object(r.isArray)(o)?o:[o]).length,u=!!e.isContact,d="";if(u&&e.name)d+=function(e){for(var t="",n=e.split(" "),i=n.length,a=0;a<i;a++)t+=n[a].substr(0,1);return'<div class="Avatar__contact">'+(t=t.substr(0,2))+"</div>"}(e.name);else if(c>1)for(var _=0;_<c;_++)d+=s(o[_],_);n=40===e.size?"m":36===e.size?"s":e.size?e.size:"xl";return Object(a.default)({mix:i.default.class(e.mix,"Avatar",(t={},t[c]=!0,t.size=n,t)),url:u?"":e.url,attrs:1===c?l(o[0]):"",inner:d})};function s(e,t){var n;return Object(a.default)({mix:i.default.class("Avatar__image",(n={},n[t]=!0,n)),attrs:l(e)})}function l(e){return i.default.attr("style","background-image: url('"+e+"')")}t.default=o;window.Avatar=o},KiYr:function(e,t,n){"use strict";n.r(t);var i=n("LmmP");t.default=i.default},L9Nh:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"QueueManager",(function(){return QueueManager}));var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("wx14"),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("OcsD"),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t]},QueueManager.start=function(){QueueManager.started||(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach((function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))})),curNotifier.lpMakeRequest&&curNotifier.lpMakeRequest(curNotifier.frame_url,params,(function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}),(function(){return!0}))},QueueManager.init=function(e){window.curNotifier=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.default)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__.createIframe)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path,ariaHidden:!0});var t=setInterval((function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())}),500);setTimeout((function(){return clearInterval(t)}),1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},LmmP:function(e,t,n){"use strict";n.r(t),n.d(t,"Alert",(function(){return a}));var i=n("z9sQ");function a(e){return{inner:[e.title?{inner:[e.title],class:"Alert__title",tag:"div"}:null,{inner:[e.text||e.inner],class:"Alert__description",tag:"div"}],class:[e.class,i.default.class("Alert",{theme:e.theme})].join(" "),tag:"div"}}t.default=a},Mc5h:function(e,t,n){"use strict";n.r(t);var i=n("2IoG");t.default=i.default,window.Brick=i.default},MzAf:function(e,t){function n(e){return function(t){t.$control.closest(a.sms).classList.toggle(r[e])}}function i(e,t){var n=t.$select,i=t.value;n.closest(a.sms).classList.toggle(r.pmUsersVisible,e.includes(i)||e.includes(Number(i)))}window.SettingsSms={},SettingsSms._onEnabledChange=n("enabled"),SettingsSms._onTimeLimitedChange=n("timeLimited"),SettingsSms._onFrequencyChange=i;var a={sms:".settingsSms"},r={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},N4ZS:function(e,t,n){"use strict";function i(e){return"https://vk.com/web/away.php?to="+e}function a(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return i})),n.d(t,"wrapAwayIfExternal",(function(){return a}))},O5lf:function(e,t,n){"use strict";n.r(t);var i=n("9y81"),a=n("Y6JH"),r=n("z9sQ"),o=n("Fbxv"),s=function(e){void 0===e&&(e={});var t=e.mix||"",n="pageLoader"===(e.type||"gray"),s=r.default.class("Spinner",{pageLoader:n,hidden:e.isHidden,fixed:e.isFixed},"--"),l=t+" "+s;if(n)return Wd.html({inner:[Object(a.default)(Object(o.getLoading40Icon)())],class:l,tag:"div"});return Object(i.default)({mix:l,icon:"spinner"})};var l=n("jE6c");var c={show:function(e){Object(l.isElement)(e)&&e.classList.remove("Spinner--hidden")},hide:function(e){Object(l.isElement)(e)&&(e.classList.contains("Spinner--hidden")||e.classList.add("Spinner--hidden"))}};Object.assign(s,c),window.Spinner=s;t.default=s},OGWK:function(e,t){window.SubscribeBtn={onClick:function(e,t,n,i,a,r){try{var o=r+"_unsubscribe",s=r+"Icon",l=r+"Icon_unsubscribe",c=r+"Icon_subscribe",u=hasClass(e,o),d=u?i:n,_=u?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),f=!u,p=geByClass1(s,e),h=function(e){var t=intval(domData(e,"block-id"));if(!t){var n=domCA(e,".feedAssistance");t=intval(domData(n,"block-id"))||null}return t}(e),m=domData(e,"from")||null;p&&(toggleClass(l,p,f),toggleClass(c,p,!f)),attr(e,"aria-label",escapeAttr(_)),toggleClass(o,e,f),"group"===a?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(t,d,u):function(e,t,n,i,a){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,a)}(t,d,u,m,h)}catch(e){console.trace(e)}return!1}}},OGfC:function(e,t,n){"use strict";n.r(t);var i=n("JX7q"),a=n("dI71"),r=n("W9Tc");function o(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n.charCodeAt(a);return i}var s=n("W0P9"),l=n("Xrg9"),c=function(){function e(e,t){var n=this;this.sw=e,this.SWClient=t,vk.id&&this.canBeEnabled().then((function(e){e&&(n.listenPermission(),n.loadEndpoint()&&n.update().then(n.checkMessageState.bind(n)))}))}e.getPermission=function(){return Notification.permission};var t=e.prototype;return t.cleanNotification=function(){this.sw.action("cleanNotification")},t.canBeEnabled=function(){return Promise.resolve(this.isSupported())},t.isSupported=function(){return"PushManager"in window&&"Notification"in window&&this.SWClient.isSupported()},t.loadEndpoint=function(){return l.default.get("push_notifier_endpoint"+vk.id)||!1},t.saveEndpoint=function(e){l.default.set("push_notifier_endpoint"+vk.id,e||!1)},t.action=function(e,t){return this.sw.action(e,t)},t._needupdate=function(e){var t=Date.now(),n=this.loadEndpoint(),i=l.default.get("push_notifier_subscribed_ts"+vk.id),a=!1;return(n!==e.endpoint||!i||t-i>6e4)&&(l.default.set("push_notifier_subscribed_ts"+vk.id,t),a=!0),a},t.listenPermission=function(){var e=this;Object(r.partConfigEnabled)("push_notifier")&&navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then((function(t){t.onchange=function(){return e.update()}}))},t.update=function(){var t=this;return this.updatePermission().then((function(n){return n===e.PUSH_NOTIFIER_PERMISSION_GRANTED?t.subscribe().catch((function(t){t!==e.SUBSCRIBE_ERROR_NETWORK&&Object(s.error)("can not update subscribe")})):Promise.reject("premession_not_granted")})).catch(s.error)},t.updatePermission=function(){var t=e.getPermission();if(t!==e.PUSH_NOTIFIER_PERMISSION_GRANTED){var n=this.loadEndpoint();if(n)return this.unsubscribe(n).then((function(){return t}))}return Promise.resolve(t)},t.processSubscribe=function(t){return t.subscribe({userVisibleOnly:!0,applicationServerKey:o(e.SERVER_KEY)})},t.setupSubscription=function(){var t=this;return new Promise((function(n,i){var a=e.getPermission(),r=function(){t.subscribe(!0).then((function(){n()})).catch((function(){i()}))};a!==e.PUSH_NOTIFIER_PERMISSION_DENIED?a!==e.PUSH_NOTIFIER_PERMISSION_GRANTED?a===e.PUSH_NOTIFIER_PERMISSION_DEFAULT&&t.requestPermission().then((function(t){t===e.PUSH_NOTIFIER_PERMISSION_GRANTED?r():i()})):r():i(e.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS)}))},t.subscribe=function(t){var n=this;return this.sw.getRegistration().then((function(e){var t=e.pushManager;return t.getSubscription().then((function(e){if(e){var i=e.expirationTime;return i&&Date.now()>i-432e6?n.unsubscribe(n.loadEndpoint()).then((function(){return n.processSubscribe(t)})):e}return n.processSubscribe(t)}))})).then((function(i){return new Promise((function(a,r){if(t||n._needupdate(i)){var o=i.getKey("p256dh"),s=i.getKey("auth");window.ajax.post(e.SERVER_URL,{act:"a_subscribe",hash:n.sw.getParams().push_hash,endpoint:i.endpoint,key:o?btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("p256dh")))):null,token:s?btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("auth")))):null},{onDone:function(e){e?(n.saveEndpoint(i.endpoint),a()):r()},onFail:function(){return r(e.SUBSCRIBE_ERROR_NETWORK),!0}})}else a()}))}))},t.unsubscribe=function(t){var n=this;return this.sw.register().then((function(i){return i.pushManager.getSubscription().then((function(i){return i?i.unsubscribe().then((function(i){return i?new Promise((function(i,a){ajax.post(e.SERVER_URL,{act:"a_unsubscribe",endpoint:t},{onDone:function(e){e?(n.saveEndpoint(!1),i()):a()}})})):Promise.reject("ERROR: can not unsubscribe")})):(n.saveEndpoint(!1),Promise.reject("ERROR: no subscription"))}))}))},t.requestPermission=function(){var t=e.getPermission();return t===e.PUSH_NOTIFIER_PERMISSION_DEFAULT?new Promise((function(e,t){var n=Notification.requestPermission((function(t){e(t)}));n instanceof Promise&&n.then(e,t)})):Promise.resolve(t)},t.checkMessageState=function(){var t=this;return new Promise((function(e){return setTimeout(e,5e3)})).then((function(){return t.action("getMessagesMetaData")})).then((function(t){return"object"==typeof t&&Object.keys(t).length?new Promise((function(n,i){window.ajax.post(e.SERVER_URL,{act:"a_update_messages_state",data:Object.entries(t)},{onDone:function(e){e?n(e):i("ERROR: act error")},onFail:function(){return i("ERROR: network error"),!0}})})):Promise.resolve({})})).then((function(e){try{return JSON.parse(e)}catch(e){return{}}})).then((function(e){return t.action("updateMessageNotifications",e)})).catch((function(e){return Object(s.error)(e)}))},e}();c.SERVER_KEY="BPrntRk2W1_ISFwlgY-vz9tQDg9i1oSQ3-N8xyjdbNAbIOdZIGFdh5FlO7zn730UwU9Sayoec-Fpqq4JZFTyv60",c.SERVER_URL="push_notifier",c.PUSH_NOTIFIER_PERMISSION_GRANTED="granted",c.PUSH_NOTIFIER_PERMISSION_DEFAULT="default",c.PUSH_NOTIFIER_PERMISSION_DENIED="denied",c.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS="BLOCKED_BY_BROWSER_SETTINGS",c.SUBSCRIBE_ERROR_NETWORK="SUBSCRIBE_ERROR_NETWORK";var u=c,d=n("PovR"),_=function(e){function t(t,n){var a;return a=e.call(this,t,n)||this,vk.id&&a.canBeEnabled().then((function(e){e&&(a.updateHeadClass(),a.handlerMessagesLP=a.handlerMessagesLP.bind(Object(i.default)(a)),page.onChange((function(){return a.updateHeadClass()})))})),a}Object(a.default)(t,e);var n=t.prototype;return n.canBeEnabled=function(){return e.prototype.canBeEnabled.call(this).then((function(e){return e?t.isNativeAppInstalled().then((function(e){return!e})):Promise.resolve(!1)}))},n.isSupported=function(){return e.prototype.isSupported.call(this)&&(browser.chrome||browser.mozilla)},n.updateHeadClass=function(){var e=u.getPermission();document.head&&(removeClass(document.head,"push_notifier_"+u.PUSH_NOTIFIER_PERMISSION_GRANTED),removeClass(document.head,"push_notifier_"+u.PUSH_NOTIFIER_PERMISSION_DENIED),removeClass(document.head,"push_notifier_"+u.PUSH_NOTIFIER_PERMISSION_DEFAULT),e&&addClass(document.head,"push_notifier_"+e),addClass(document.head,"push_notifier_supported"))},n.handlerMessagesLP=function(e,t){this.sw.action("removeMessageNotification",{peerId:t,msgId:e})},n.cleanNotification=function(){this.sw.action("cleanNotification")},n.removeLongPollListener=function(){this.lp&&this.lp.off(),this.lp=null},n.addLongPollListener=function(){window.isNewMail&&window.isNewLongpoll&&!this.lp&&(this.lp=window.im.onMsgReadByMe(this.handlerMessagesLP))},t.isNativeAppInstalled=function(){var e=Date.now(),n=l.default.get(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS),i=l.default.get(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS);return new Promise((function(a){null!==i&&n&&e-n<t.PUSH_NOTIFIER_LS_TTL_RELATED_APPS?a(!!i):"getInstalledRelatedApps"in navigator?navigator.getInstalledRelatedApps().then((function(n){var i=Object.values(n).some((function(e){return"com.vkontakte.android"===e.id}));l.default.set(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS,e),l.default.set(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS,i),a(i)})).catch((function(){a(!1)})):a(!1)}))},n.update=function(){var t=this;return e.prototype.update.call(this).then((function(){t.updateHeadClass(),t.addLongPollListener()}))},n.unsubscribe=function(t){var n=this;return e.prototype.unsubscribe.call(this,t).then((function(){return n.removeLongPollListener()}))},t}(u);_.PUSH_NOTIFIER_LS_KEY_RELATED_APPS="push_notifier_related_apps",_.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS="push_notifier_related_apps_ts",_.PUSH_NOTIFIER_LS_TTL_RELATED_APPS=d.HOUR/2;t.default=_},Ogzf:function(e,t,n){"use strict";n.r(t),n.d(t,"onLongpress",(function(){return r})),n.d(t,"onLongpressOrClick",(function(){return s}));var i=n("wx14"),a=n("OcsD");function r(e,t,n,i){void 0===t&&(t=350);var r,o=void 0===i?{}:i,s=o.eventsRelease,l=void 0===s?"touchcancel touchend touchmove mouseout mouseup mousemove scroll":s,c=o.initialTouchStartEvent,u=o.onRelease,d=o.onStart,_=function(n){var i=n.target;Object(a.addEvent)(e,l,f,{passive:!0}),null==d||d(n),(0===n.button||Object(a.isUndefined)(n.button))&&(r=setTimeout(p.bind(i,n),t))},f=function t(n){clearTimeout(r),Object(a.removeEvent)(e,l,t,{passive:!0}),null==u||u(n)};function p(t){var i,o;t.touches?(i=t.touches[0].pageX,o=t.touches[0].pageY):(i=t.pageX,o=t.pageY),n({pageX:i,pageY:o}),Object(a.removeEvent)(e,l,f,{passive:!0}),clearTimeout(r)}return Object(a.addEvent)(e,"touchstart mousedown",_,{passive:!0}),c&&c instanceof Event&&_(c),function(){clearTimeout(r),Object(a.removeEvent)(e,"touchstart mousedown",_,{passive:!0})}}var o=function(e){(function(e){return"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()};function s(e,t,n,a,s){void 0===s&&(s={});var l=!1,c=s.shouldPreventDefault,u=void 0!==c&&c;return r(e,t,(function(){l||(n.apply(void 0,arguments),l=!0,setTimeout((function(){l=!1})))}),Object(i.default)({eventsRelease:"touchend touchmove mouseleave mouseup scroll",onRelease:function(t){"mouseup"===t.type&&!l&&(a(t),l=!0,setTimeout((function(){l=!1}))),u&&e.removeEventListener("touchend",o)},onStart:function(){u&&e.addEventListener("touchend",o,{passive:!1})}},s))}},PU8N:function(e,t,n){"use strict";n.r(t),n.d(t,"isMvk",(function(){return a})),n.d(t,"getVideoDuration",(function(){return r})),n.d(t,"getMediaBlob",(function(){return o})),n.d(t,"getBlobType",(function(){return s})),n.d(t,"noop",(function(){return l})),n.d(t,"getAverageRGB",(function(){return c})),n.d(t,"loadImage",(function(){return u})),n.d(t,"loadImages",(function(){return d})),n.d(t,"loadFontFace",(function(){return _})),n.d(t,"loadFontFacePromise",(function(){return f})),n.d(t,"getCroppedImage",(function(){return p}));var i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){return!!window.isMVK}function r(e){return void 0===e&&(e=""),new Promise((function(t,n){var i=document.createElement("video");i.addEventListener("loadedmetadata",(function(){return t(i.duration)}),{once:!0}),i.addEventListener("error",n,{once:!0}),i.crossOrigin="anonymous",i.preload="metadata",i.src=e}))}function o(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(404===i.response.status)return n();t(i.response)},i.onerror=n,i.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var l=function(){};function c(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var i=-4,a=0;(i+=20)<t.data.length;)++a,n.r+=t.data[i],n.g+=t.data[i+1],n.b+=t.data[i+2];return n.r=~~(n.r/a),n.g=~~(n.g/a),n.b=~~(n.b/a),n}function u(e){return new Promise((function(t,n){var i=new Image;i.crossOrigin=e.startsWith("data:")?null:"Anonymous",i.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},i.onload=function(){return t(i)},i.src=e}))}var d=function(e){return new Promise((function(t){var n=e.map((function(e){return u(e)}));Promise.all(n).then((function(e){return t(e)})).catch((function(){}))}))};function _(e,t){var n,i,a,r,o,s,l,c,u={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},_={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function f(e){var t=[];return each(e,(function(e,n){t.push(e+":"+n)})),t.join(";")}function p(e,t,n){return Math.abs(e.width-t.offsetWidth)>n||Math.abs(e.height-t.offsetHeight)>n}function h(){r||(utilsNode.appendChild(o),r=!0,a={sansSerif:{width:l.offsetWidth,height:l.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(l.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(l,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),r&&a&&(p(a.sansSerif,l,t.tolerance)||p(a.serif,s,t.tolerance))?(re(o),t.success()):(new Date).getTime()-i.getTime()>t.timeout?(re(o),t.error()):!r&&"requestAnimationFrame"in window?window.requestAnimationFrame(h):window.setTimeout(h,t.delay)}for(var m in d)t.hasOwnProperty(m)||(t[m]=d[m]);_["font-weight"]=t.weight,_["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(n=setTimeout((function(){t.error()}),t.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(i){i.family.toLowerCase()===e.toLowerCase()&&(u[i.weight]||i.weight)===""+t.weight&&i.style===t.style&&i.load().then((function(){t.success(),clearTimeout(n)}))}))}(n)):(c="AxmTYklsjo190QW"+t.glyphs,i=new Date,o=ce("div"),l=ce("div",{innerHTML:c}),s=ce("div",{innerHTML:c}),l.setAttribute("style",f(extend({"font-family":"sans-serif"},_))),s.setAttribute("style",f(extend({"font-family":"serif"},_))),o.appendChild(l),o.appendChild(s),h())}function f(e,t){return new Promise((function(n,a){_(e,i(i({},t),{glyphs:"",success:function(){var e=function(){n(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){a(),(null==t?void 0:t.error)&&t.error()}}))}))}function p(e,t,n,i,a){return new Promise((function(r,o){("string"==typeof e?u(e):Promise.resolve(e)).then((function(e){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var l=s.getContext("2d");if(l){l.drawImage(e,0,0);var c=l.getImageData(t,n,i,a),d=document.createElement("canvas");d.width=i,d.height=a;var _=d.getContext("2d");if(_)return _.putImageData(c,0,0),u(d.toDataURL("image/jpeg",1)).then(r).catch(o);r(e)}else r(e)})).catch(o)}))}},PUg3:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=n("TYsd"),o=n("Mc5h"),s=n("9y81"),l=n("AXyT"),c=n("gy8s"),u=n("29dZ"),d=n("Y6JH"),_=n("/Id8"),f=(n("BoyB"),n("fdw3")),p=n("e0pj"),h=n("UknS"),m=n("f2Fr"),v=n("FoBY"),g=n("/nc2"),A=n("6atH"),b=n("DKoU"),y=n("i4v4"),w=n("hgAR"),O=n("1GqV"),S=n("jVsh");function k(){var e=Object(i.default)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return k=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return C=function(){return e},e}function E(){var e=Object(i.default)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return E=function(){return e},e}function j(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return j=function(){return e},e}function T(){var e=Object(i.default)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return T=function(){return e},e}function I(){var e=Object(i.default)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return I=function(){return e},e}function M(){var e=Object(i.default)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return M=function(){return e},e}function D(){var e=Object(i.default)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return D=function(){return e},e}function P(){var e=Object(i.default)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return P=function(){return e},e}function x(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return x=function(){return e},e}function L(){var e=Object(i.default)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return L=function(){return e},e}function B(){var e=Object(i.default)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n      </div>\n    "]);return B=function(){return e},e}var R=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel)return"";var l=i.kickedMessage||e.mobile_msg_mail_privacy_error,u=Object(s.default)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"});return a.default.html(B(),u,l)}var _=a.default.onSubmit("uMailWrite._onSubmit","event","this"),k=a.default.onClick("uMailWrite.onToBottomClick"),C=Object(o.default)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:""}),E=H(null),j=U(n),D=function(e){var t=window.lang,n=store.mail,i=n.cur,o=n.queue,l=a.default.onMouseDown("uMailWrite._onStickersClick","event"),u=a.default.onMouseDown("uMailWrite._onKeyboardClick","event"),_=n.peers[e],k=i.groupId,C=Math.abs(k),E=k?"&community="+C:"",j=!Object(f.isSAKIntegration)(),T=!Object(f.isSAKIntegration)()&&_.canSendGift,M=!Object(f.isSAKIntegration)()&&_.canSendGift,D=!Object(f.isSAKIntegration)(),x=Object(f.isSAKIntegration)(),L=Object(f.isSAKIntegration)(),B=!Object(f.isSAKIntegration)(),R=Object(c.default)({icon_html:r.default.html(Object(d.default)(Object(p.getAttachOutline28Icon)())),name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:Object(d.default)(Object(h.getPictureOutline28Icon)()),attrs:a.default.onClick("mediaUpload.onUnfoldItemClick","event","this")},B?{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+E,icon:Object(d.default)(Object(m.getCameraOutline28Icon)())}:null,x?{text:t.mobile_attachments_add_device_video,icon:Object(d.default)(Object(v.getVideoOutline28Icon)()),attrs:a.default.onClick("SAKIntegration.sendMessage","attach_video",{peerId:e})}:null,D?{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+E,icon:Object(d.default)(Object(v.getVideoOutline28Icon)())}:null,j?{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+E,icon:Object(d.default)(Object(g.getMusicOutline28Icon)())}:null,{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+E,icon:Object(d.default)(Object(A.getDocumentOutline28Icon)())},L?{text:t.mobile_attachments_add_device_document,icon:Object(d.default)(Object(A.getDocumentOutline28Icon)()),attrs:a.default.onClick("SAKIntegration.sendMessage","attach_document",{peerId:e})}:null,T?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:Object(d.default)(Object(b.getGiftOutline28Icon)())}:null,M?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+E,icon:Object(d.default)(Object(y.getMoneyTransferOutline28Icon)())}:null,_.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+E,icon:Object(d.default)(Object(w.getPollOutline28Icon)()),mix:"uMailWrite__pollUnfoldItem"}:null]}),N=a.default.onKeyUp("uMailWrite._onKeyUp"),H=a.default.onInput("uMailWrite._onInput","event","this"),U=a.default.onKeyDown("uMailWrite._onKeyDown","event","this"),V=a.default.onFocus("uMailWrite._onFocus","event","this"),$=a.default.onBlur("uMailWrite._onBlur","event","this"),W=a.default.onClick("uMailWrite._onClick","event","this"),q=a.default.onTouchEnd("uMailWrite._onSendTouchEnd","event","this"),z=r.default.html({class:"uMailWrite__buttonSendIcon Icon_send",inner:Object(d.default)(Object(O.getSendOutline28Icon)())}),Y=r.default.html({class:"uMailWrite__buttonSendIcon Icon_send Icon_active",inner:Object(d.default)(Object(O.getSendOutline28Icon)())}),Q=F("accept"),G=F("remove"),K=F("templates"),X=F("templatesActive"),J=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"}),Z=r.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker",inner:Object(d.default)(Object(S.getSmileOutline28Icon)())}),ee=r.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker Icon_active",inner:Object(d.default)(Object(S.getSmileOutline28Icon)())}),te=a.default.html(I()),ne=_.attachmentsHTML.length,ie=i.msgAttached[i.peerId],ae=ie&&ie.length,re=!!(o[i.peerId]||[]).length,oe=a.default.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(ne>150||ae),loading:re});return a.default.html(P(),R,u,te,l,Z,ee,oe,q,z,Y,J,Q,G,K,X,t.mobile_mail_message_placeholder,V,N,H,U,V,$,W)}(n),x=a.default.html(M()),R=function(){var e=window.lang,t=Object(s.default)({icon:"plus"}),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,r="/mail?act=template&from="+n+i,o=a.default.onClick("uMailWrite.loadTemplatePage","event","this",r);return a.default.html(T(),e.mobile_mail_templates_panel_title,r,o,t)}(),V=N(),$=a.default.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});return a.default.html(L(),$,n,i.hashSend,t.cur.communityParam,_,k,V,E,j,D,C,x,R)};function N(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,r=i?Object(l.default)({mix:"uMailWrite__toBottomValue",value:i}):"",o=Object(s.default)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"});return a.default.html(x(),r,o)}function F(e){return a.default.html(D(),e)}function H(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,r=t.msgReply[i],o=null;r&&(o=store.mail.forwards[r]||store.mail.msgs[r]);var s="",l="";if(o){var c=Object(_.Msg__authorName)(n[o.authorId],i,t.userId);s=Object(_.Msg__reply)(o,c,e),l='\n      <input type="hidden" name="attached_messages" value="'+r+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(l+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=a.default.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:a.default.onClick("uMailWrite.onReplyClose")});return a.default.html(j(),u,s,d,l)}function U(e){var t,n=store.mail,i=n.cur,r=n.peers[e].attachmentsHTML,o=a.default.class("uMailWrite__attachments",((t={})[e]=!0,t)),l=i.msgAttached[e]||[],c=l.length,u="";c>0&&(u=function(e,t){var n=window.lang,i=a.default.onClick("uMailWrite.onAttachedMsgsRemove"),r=Object(s.default)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"}),o=Object(s.default)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i}),l=langNumeric(e,n.mobile_mail_messages),c=function(e){return a.default.html(k(),e)}(t);return a.default.html(C(),c,o,r,l)}(c,l.join(";")));return a.default.html(E(),o,u,r)}var V=n("UxAg"),$=n("+cqQ"),W=n("jk6M"),q=n("rKp0"),z=n("V4qE"),Y=n("HGMY"),Q=n("t7Ww"),G=n("r/ag");function K(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((function(e,t){return e+t})))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}var X=n("N4ZS"),J=n("9M99"),Z=n("H5mD"),ee=n("aiw/"),te=n("Qz23"),ne=n("jE6c"),ie=n("UlUB"),ae=n("hw56"),re=n("j80l"),oe=n("wcVR"),se=n("B+U2");function le(e){var t=e.length,n=!t;return r.default.html([ce(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map((function(e,n){return function(e,t,n){var i=t>0&&t===n-1,o=store.mail.cur.communityParam,s=store.mail.cur.peerId,l=e.name,u=e.text;l=Object(J.emojiToHTML)(l),u=ue(u,!0);var d="_touched uMailWrite__templatesRow";d+=" uMailWrite__templatesRow"+e.id,e.deleting&&(d+=" uMailWrite__templatesRow_hidden");return{class:d,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:r.default.html(l)},{class:"uMailWrite__templatesRowText",inner:r.default.html(u)}]},{class:"uMailWrite__templatesRowMore",inner:[r.default.wrap(Object(c.default)({mix:"",icon:"more",position:i?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+o+"&from="+s},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:a.default.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)}))}])}function ce(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=a.default.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},Object(u.default)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function ue(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,a=store.mail.cur,r=i[a.peerId],o=i[a.userId],s=i[a.groupId],l=r.raw_name.replace(r.firstName,"").trim(),c=o.raw_name.replace(o.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,r.firstName)).replace(/{user surname}/g,l)).replace(/{admin name}/g,o.firstName)).replace(/{admin surname}/g,c)).replace(/{community}/g,s.name)).match(/{greeting}/g)){var u,d=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());u=d>=3&&d<12?lang.mobile_mail_templates_greeting_morning:d>=12&&d<17?lang.mobile_mail_templates_greeting_afternoon:d>=17&&d<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,u)}return t&&(e=Object(J.emojiToHTML)(e)),e}var de=n("HdGT"),_e=n("qHA9"),fe=n("cZev"),pe=n("W9Tc");Object.assign(R,{onToBottomClick:Object($.default)(),onAttachedMsgsRemove:Object($.default)(),onReplyClose:Object($.default)(),onMessage:Object($.default)(),showToBottom:function(){if(Oe)return;Se&&(clearTimeout(Se),Se=null);addClass("uMailWrite__toBottom_visible",Object(V.$)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(null),Se=setTimeout((function(){removeClass("uMailWrite__toBottom_visible",Object(V.$)(".uMailWrite__toBottom"))}),100)},preventShowToBottom:function(){Oe=!0,setTimeout((function(){Oe=!1}),300)},openStickersPanel:Fe,redrawReply:Ze,uiRedrawAttachments:et,redrawToBottom:function(){Object(V.$$)(".uMailWrite__toBottom").forEach((function(e){return e.innerHTML=N()}))},drawStickers:Be,setModifiers:function(e){Object(V.$$)(".uMailWrite").forEach((function(t){var n=a.default.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",a.default.class("uMailWrite",Object.assign({},n,e)))}))},hideStickersPanel:Ne,setText:vt,renderKeyboardIfNeeded:At,openKeyboard:yt,init:function(){var e=store.mail,t=e.cur,n=e.msgs,i=e.pendingReplies,a=t&&Object(ae.getPeerDraft)(t.viewerId,t.peerId);a&&!t.editing&&a.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;Object(V.$$)(".uMailWrite__textarea").forEach((function(e){return e.value=n}));var i=Object(V.$)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");Te()}(a.text);"templates"===Object(ae.getKeyboardType)()?ze():At();Et(),Me(),a&&!t.editing&&Array.isArray(a.msgs)&&(t.msgAttached[t.peerId]=a.msgs);if(a&&!t.editing&&isFinite(a.reply)){var r=_.default.getReplyDataFromHTML(a.reply);r&&(t.msgReply[t.peerId]=a.reply,i[a.reply]=r)}Ze(),et(t.peerId),Object.keys(n).forEach((function(e){CasperTimer.init(e)})),Object(V.$$)(".uMailWrite__textarea").forEach((function(e){Object(te.setScrollView)(e,{topBanner:!1,overscrollY:!1})})),Object(V.$$)(".uMailWrite__attachments").forEach((function(e){Object(te.setScrollView)(e,{topBanner:!1,allowY:!1})}))},reset:function(){Object(ae.setKeyboardType)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)}}),uVK.onReady(Ie),R._onBlur=ut,R._onKeyUp=it,R._onKeyDown=st,R._onFocus=ct,R._onInput=at,R._onSubmit=tt,R._onClick=lt,R._onAttachClick=Qe,R._onStickersClick=Re,R._onKeyboardClick=He,R._onKeyboardButtonClick=Ue,R._onDeleteTemplate=Ot,R._onConfirmDeleteTemplate=St,R._onSendTouchEnd=nt,R._onRetryFailedMsg=Tt,R._onDeleteFailedMsg=It,R._onCancelPendingMsg=Mt,R._onConfirmSendGeo=Ve,mediaUpload.onRemove(De),mediaUpload.onComplete(Le),mediaUpload.onStart(Pe),mediaUpload.onError(xe),post.onStickersTabSelected(Ge),post.onStickerClick(Ke),fe.default.onStickerPanelUpdate(Xe),de.onSent(Ct),de.onErrorMessage(Dt),_.default.onPendingClick(jt),c.default.onOpen("uMailWrite_attachments")(je),R.onToBottomClick((function(){var e=Object(V.$)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),q.default.removeDivider()})),R.onReplyClose((function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,Object(ae.setPeerDraft)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),Ze()})),R.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some((function(e){if(e.id===n)return i=e,!0})),i&&vt(ue(i.text)))},Mention.onOpen((function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},(function(e){Object.assign(store.mail.members,e);var t=rt(n);Mention.update({items:t,defaultItems:t})}),(function(){t[n]=!1})))}}));var he,me,ve="uMailWrite__popupAttach_open",Ae="uMailWrite__popupStickers_open",be="uMailWrite_canAttachPoll",ye=".uMailWrite",we=".attachment_type_poll",Oe=!1,Se=null,ke=[],Ce=Object(ie.throttle)(_t,100),Ee=Object(ie.throttle)(dt,1e3);function je(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}Object(V.$$)("a.Unfold__item").forEach((function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)})),Object(V.$$)("input.inline_upload").forEach((function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))}))}function Te(){var e=Object(V.$)(".uMailWrite__textareaGhost").offsetHeight;Object(V.$$)(".uMailWrite__textarea").forEach((function(t){return setStyle(t,"height",e)})),Object(V.$$)(".uMailWrite__main").forEach((function(t){return setStyle(t,"height",e+8)})),Object(V.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(t){setStyle(t,"bottom",e+8+-5)})),_t()}function Ie(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,Object(V.$$)(".uMailWrite__attachments").forEach((function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)})),function(){var e=Object(V.$)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=Object(V.$)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",mt,!0):e.removeEventListener("mousedown",mt,!0)}()}}}function Me(){var e=store.mail.cur;e&&e.peerId&&(ke=rt(e.peerId),Mention.init({defaultItems:ke,items:ke,appendTo:geByClass1("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=Object(V.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,Te(),dt(i,e.viewerId,e.peerId)}}))}function De(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,et(a)),e.closest(we))Object(V.$)(ye).classList.add(be)}}function Pe(){store.mail.cur&&(Ie(),_t())}function xe(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&(et(n),Messenger.scrollConvoToBottom())}}function Le(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,_t())}}function Be(){var e=store.mail.cur,t=Object(V.$)(".uMailWrite__popupStickers"),n=Object(pe.partConfigEnabled)("mvk_stickers_panel_optimize");e&&t&&!t.childElementCount&&(n?(fe.default.checkStickers(),t.innerHTML=fe.default.getStickerPanel("mail"+e.peerId),t.innerHTML||(e.waitingStickerPanel=!0)):t.innerHTML=e.stickersPanelHTML.replace(/mail0/g,"mail"+e.peerId),Object(V.$$)(".sp_body",t).forEach((function(e){Object(te.setScrollView)(e,{topBanner:!1})})),Object(V.$$)(".scroller_wrap",t).forEach((function(e){Object(te.setScrollView)(e,{topBanner:!1,allowY:!1})})),post.stickersSelectTab(null,-1))}function Re(e){var t=Object(V.$)(".uMailWrite__popupStickers"),n=hasClass(Ae,t);e.preventDefault(),Be(),wt("stickers"),n?Ne():Fe()}function Ne(){"stickers"===Object(ae.getKeyboardType)()&&Object(ae.setKeyboardType)("");var e=Object(V.$)(".uMailWrite__popupStickers");removeClass(Ae,e),ft(!1);var t=ge("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none"),domData(e,"need-update")&&(clog("[mail sticker panel] inject new sticker panel after close"),Je(),domData(e,"need-update",null))}function Fe(){Object(ae.setKeyboardType)("stickers");var e=Object(V.$)(".uMailWrite__popupStickers");addClass(Ae,e),post.stickerPanelInit(),post.stickersInit(),ft(!0)}function He(e){var t=Object(V.$)(".uMailWrite__keyboard"),n=hasClass("uMailWrite__keyboard_open",t);e.preventDefault(),wt("buttons"),n?$e({store:!0}):We({store:!0})}function Ue(e,t,n){var i,r,o=n.authorId,s=n.inline,l=n.msgId,c=JSON.parse(Object(ne.replaceEntities)(n.action)),d=c.type,_=c.payload,f=c.rawLabel,p=store.mail,h=p.cur,m=p.members,v=p.peers,g=p.msgs,A=m[o],b=K();if(l){var y=g[l];i=y.peerId,r=y.conversationMsgId}else i=h.peerId;var w,O=v[i],S=f||"";if(i>=2e9)if(A.domain)w="@"+A.domain+" "+S;else{var k=A.url.replace(/^\//,"");w="@"+k+" ("+A.firstName+") "+S}else w=S;var C=d,E=s?"inline":"normal";if("open_app"===C&&(C="app"),statlogsValueEvent("message_send_from_keyboard",0,h.viewerId,i,o,C,E),"vkpay"!==d)if("open_app"!==d)if("open_link"!==d)if("location"!==d){if("callback"===d)return u.default.setLoading(e,!0,"spinner"),void ajaxRequest("/mail",{act:"sendEvent",peer_id:i,author_id:o,message_id:l,conversation_message_id:r,payload:_,hash:O.hashSend},(function(t){var n=t.result.event_id;clog("waiting for "+n+" event callback"),Object(ae.registerCallbackButtonEvent)(i,e,n,l)}),(function(){z.init({type:z.SNACKBAR_TYPE_ERROR,text:lang.mobile_unknown_error}),u.default.setLoading(e,!1)}));ht({act:"send",to:i,from:"dialog",hash:O.hashSend,message:w,media:"",_af:h._af,random_id:b,payload:_}),s&&!h.peerId&&nav.go(Object(re.makeUrl)("/mail",{act:"show",peer:i,community:nav.getQuery("community")}))}else{oe.default.init()?(u.default.setLoading(e,!0,"blue"),oe.default.getCurrentPosition((function(t){var n=t.coords,r=n.latitude,o=n.longitude;u.default.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmSendGeo",r,o,_,w,i)})}),(function(){u.default.setLoading(e,!1),z.init({text:lang.mobile_mail_geo_not_available})}),{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):z.init({text:lang.mobile_mail_geo_not_available})}else{var j=c.link,T=Object(X.wrapAwayIfExternal)(j,!0);nav.hard_go(T)}else{var I=c.app_id,M=c.hash,D=Object(re.makeUrl)("/app"+I,{from:nav.cur.slice(1)});nav.go(D+"#"+M)}else{var P=c.hash,x=Object(re.makeUrl)("/app6217559",{from:nav.cur.slice(1)});nav.go(x+"#"+P)}}function Ve(e,t,n,i,a){var r=store.mail,o=r.cur,s=r.peers[a],l=K();ht({act:"send",to:a,from:"dialog",hash:s.hashSend,message:i,media:"",_af:o._af,random_id:l,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go(Object(re.makeUrl)("/mail",{act:"show",peer:a,community:nav.getQuery("community")}))}function $e(e){"buttons"===Object(ae.getKeyboardType)()&&Object(ae.setKeyboardType)("");var t=Object(V.$)(".uMailWrite__keyboard");if(removeClass("uMailWrite__keyboard_open",t),pt(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(he[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",he))}}function We(e){Object(ae.setKeyboardType)("buttons");var t=Object(V.$)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass("uMailWrite__keyboard_open",t),pt(!0);var i=Object(ae.getKeyboardState)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=r.default.render(Object(se.default)({keyboard:i.keyboard,pressed:Pt(t.peerId)})),o=Object(V.$)(".uMailWrite__keyboard");o.innerHTML=a,Object(te.setScrollView)(o,{topBanner:!1}),Object(ae.getKeyboardState)(t.peerId).rendered=!0}(),e&&e.store&&qe()}function qe(){var e=store.mail.cur.peerId;Object(ae.clearCallbackButtons)(e),he&&(delete he[e],lsSet("mail_keyboard_hidden",he))}function ze(){Object(ae.setKeyboardType)("templates");var e=Object(V.$)(".uMailWrite__templates");addClass("uMailWrite__templates_open",e),_t(),bt()}function Ye(){"templates"===Object(ae.getKeyboardType)()&&Object(ae.setKeyboardType)("");var e=Object(V.$)(".uMailWrite__templates");removeClass("uMailWrite__templates_open",e),_t()}function Qe(e){var t=Object(V.$)(".uMailWrite__popupAttach"),n=Object(V.$)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(Ae,n)&&removeClass(Ae,n),hasClass(ve,t)?removeClass(ve,t):(addClass(ve,t),addEvent(window,"click",(function e(n){removeClass(ve,t),removeEvent(window,"click",e)})))}function Ge(){store.mail.cur&&(geByClass1("sp_body")&&(cur.scroller&&cur.scroller.destroy(),geByClass1("sp_body").scrollTop=0,removeClass("scroller_wrap",geByClass1("sp_cont")),geByClass("sp_page").forEach((function(e){return removeClass("scroller_page",e)}))))}function Ke(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,r=(geByClass1("uMailWrite"),Object(V.$)(".uMailWrite__popupStickers")),o=K(),s=0===t.indexOf("suggestion"),l={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:o,sticker_referrer:t};post.addRecentSticker(!1,e,!1);var c=i.msgReply[i.peerId];if(c&&(l.attached_messages=c,l.has_reply=!0,Object(ae.setPeerDraft)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),s){var u=Object(V.$)(".uMailWrite__textarea");u.value="",dt("",i.viewerId,i.peerId),at({},u)}return ht(l),_t(),Ze(),Object(V.$)(".sp_tab_selected",r).classList.contains("sp_tab-1")&&setTimeout((function(){post.stickersSelectTab(!1,-1)})),!0}}function Xe(){var e=Object(V.$)(".uMailWrite__popupStickers");if(!Object(pe.partConfigEnabled)("mvk_stickers_panel_optimize"))return!1;if(!e)return!1;clog("[mail sticker panel] received panel update event");var t=e.classList.contains("uMailWrite__popupStickers_open"),n=!e.innerHTML;t&&!n?domData(e,"need-update",1):(clog("[mail sticker panel] redraw closed sticker panel"),n&&Be(),Je())}function Je(){var e=store.mail.cur,t=Object(V.$)(".uMailWrite__popupStickers");if(!t)return!1;var n=Object(V.$)("#stickers_panel");if(!n)return!1;var i=Object(V.$)(".sp_tab_selected",n),a=Array.from(i.classList).reduce((function(e,t){if(t.startsWith("sp_tab")){var n=parseInt(t.split("sp_tab")[1]);isNaN(n)||(e=n)}return e}),0);return t.innerHTML=fe.default.getStickerPanel("mail"+e.peerId),post.stickersSelectTab(!1,a),!0}function Ze(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var r=n[i];r&&(a=r.preview_url)}else{var o=i&&_.default.getElem(i);if(o){var s=Object(V.$)(".thumbs_map .thumb_map_img_as_div",o);(a=s&&s.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}Object(V.$$)(".uMailWrite__reply").forEach((function(e){e.outerHTML=H(a)}))}function et(e){Object(V.$$)(".uMailWrite__attachments_"+e).forEach((function(t){t.outerHTML=U(e)})),Ie(),Object(V.$)(".uMailWrite__textarea")&&_t();var t=Object(V.$)(ye);if(t){var n=!!t.$(we);t.classList.toggle(be,!n)}}function tt(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=Object(V.$)(".uMailWrite__textarea"),i=store.mail,a=i.cur,r=i.peers,o=K(),s=store.mail.cur.editing,l=s&&store.mail.msgs[s],c=l?{act:"edit_message",id:s,peerId:l.peerId,hash:r[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:r[a.peerId].hashSend,_af:a._af,random_id:o,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!gt())return l?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&!Object(_e.isChatPeer)(a.peerId)&&(t=Object(V.$)(".uMailWrite__templates"),wt("templates"),hasClass("uMailWrite__templates_open",t)?Ye():ze()),!1;each(geByClass1("uMailWrite"),(function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(c[t.name]=t.value))))))})),s?(uMailHat.onCancelEditing(!0),ht(c)):(ht(c),store.mail.cur.mvk_entrypoint="",Object(ae.popPeerAttachments)(a.peerId),n.value="",dt("",a.viewerId,a.peerId),Object(ae.setPeerDraft)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,at({},n)),q.default.onSystemMessageClick(),et(a.peerId),Ze(),StickersHints.actualizeVisibility(),Z.isIOS?(n.focus(),setTimeout((function(){return n.focus()}))):W.default.msie_edge||(n.focus(),requestAnimationFrame((function(){return n.focus()})))}function nt(e){W.default.msie_edge&&(e.preventDefault(),tt(e))}function it(){var e=it,t=e.typingData||(e.typingData={});if(!(0===Object(V.$)(".uMailWrite__textarea").value.length||store.mail.cur&&store.mail.cur.editing)){var n=Date.now(),i=store.mail,a=i.cur,r=i.peers,o=a.peerId;o<=-2e9||t[o]&&n-t[o]<5e3||(t[o]=n,ajaxRequest("/mail",{_ajax:1,act:"typing",peer:o,hash:r[o].hashTyping,community:nav.getQuery("community")}))}}function at(e,t){var n=Object(V.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,r=n.offsetHeight;Object(V.$$)(".uMailWrite__textarea").forEach((function(e){return setStyle(e,"height",r)})),Object(V.$$)(".uMailWrite__main").forEach((function(e){return setStyle(e,"height",r+8)})),Object(V.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(e){setStyle(e,"bottom",r+8+-5)})),Ce(),a&&Ee(i,a.viewerId,a.peerId),ot(e,t,(function(){Mention.onKeyUp(e,t)}))}function rt(e){var t=store.mail,n=t.peers,i=t.members,a=t.cur,r=n[e].memberIds||[],o=[],s=[];return r.forEach((function(e,t){if(e!==a.viewerId){var n=i[e];if(n){var r=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];o.push(r)}else{var l=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];s.push(l)}}})),o.concat(s)}function ot(e,t,n){ke.length&&(!hasClass("Mention_inited",geByClass1("uMailWrite__main"))&&Me(),n(e,t))}function st(e,t){ot(e,t,(function(){Mention.onKeyDown(e,t)})),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&tt()}function lt(e,t){ot(e,t,(function(){Mention.onClick(e,t)}))}function ct(e,t){Object(ae.setKeyboardType)("text");var n=function(){store.mail.cur&&(Be(),wt("text"),StickersHints.init({peerId:store.mail.cur.peerId}),ot(e,t,(function(){Mention.onFocus(e,t)})))};Z.isIOS?n():requestAnimationFrame((function(){requestAnimationFrame((function(){n()}))})),ee.onOpen("bottom")}function ut(e,t){if("text"===Object(ae.getKeyboardType)()&&Object(ae.setKeyboardType)(""),ee.onClose(),Ee._timer&&clearTimeout(Ee._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,a=n.peerId;dt(t.value,i,a)}}function dt(e,t,n){var i=store.mail.cur.editing;Object(ae.setPeerDraft)(t,n,{text:e},i)}function _t(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t&&t.peerId){var i=!gt(),r=!mediaUpload.checkUploading(),o=!!t.editing,s={sendActive:!i&&!o&&!r,loading:r,editAccept:o&&!i,editRemove:o&&i},l=n.templates&&!(o||!t.groupId||Object(_e.isChatPeer)(t.peerId)||!i||s.loading||s.uploading);s.templates=l&&"templates"!==Object(ae.getKeyboardType)(),s.templatesActive=l&&"templates"===Object(ae.getKeyboardType)();var c=!(s.sendActive||s.loading||s.editAccept||s.editRemove||s.templates||s.templatesActive);s.disabled=c;var u=a.default.class("uMailWrite__button","uMailWrite__buttonSend",s);Object(V.$$)(".uMailWrite__buttonSend").forEach((function(e){return e.className=u}))}}function ft(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});Object(V.$$)(".uMailWrite__buttonStickers").forEach((function(e){return e.className=t}))}function pt(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});Object(V.$$)(".uMailWrite__buttonKeyboard").forEach((function(e){return e.className=t}))}function ht(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,a=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),de.send(e),a){var r=store.mail.peers[a];if(r&&r.keyboard&&r.keyboard.one_time)r.keyboard=null,Object(ae.getKeyboardState)(a).updateTime=Date.now(),At()}_t()}}function mt(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function vt(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=Object(V.$$)(".uMailWrite__textarea");i.forEach((function(e){return e.value=n})),at({},i[0])}function gt(){return function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!Object(V.$)(".uMailWrite__textarea").value.trim()}function At(e){if(Object(V.$)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,r=n.peers,o=i.peerId&&r[i.peerId];t=!(i.groupId||!o||o.closed||o.kicked)&&!(!o.keyboard||!o.keyboard.buttons.length);var s=Object(V.$)(".uMailWrite"),l=a.default.parseClass("uMailWrite",s.className);if(l.keyboard!==t&&(s.className=a.default.class("uMailWrite",Object.assign({},l,{keyboard:t}))),Object(ae.getKeyboardState)(i.peerId).rendered=!1,t){he||(he=lsGet("mail_keyboard_hidden")||{});var c=o.keyboard,u=he[i.peerId];e&&!0===e.update&&Object(ae.clearCallbackButtons)(i.peerId);var d=!Object(ae.getKeyboardType)()||"buttons"===Object(ae.getKeyboardType)()||"text"===Object(ae.getKeyboardType)(),_=!1;u&&(u==c.chat_local_id?d=!1:_=!0),d?yt("buttons",{store:_}):_&&qe()}else $e()}}function bt(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=Object(V.$)(".uMailWrite__templatesBody"),r=t.templates;if(a)return r?void function(e,t){e.innerHTML=le(t)}(a,r):(function(e){e.innerHTML=Loading({mix:"uMailWrite__templatesLoading"})}(a),me||(me=new Promise((function(e){ajaxRequest("/mail",{act:"get_templates"},(function(t){e(t)}),(function(t){e()}))}))),void me.then((function(e){me=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),bt()})))}}function yt(e,t){switch(wt(e),e){case"stickers":Fe();break;case"buttons":We(t);break;case"text":(n=Object(V.$)(".uMailWrite__textarea"))&&n.focus();break;case"templates":ze()}var n}function wt(e){var t;"stickers"!==e&&Ne(),"buttons"!==e&&$e(),"text"!==e&&(t=Object(V.$)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&Ye()}function Ot(e){var t=store.mail.cur.templates.find((function(t){return t.id===e}));if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",Object(J.emojiToHTML)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function St(e){var t=store.mail.cur.templates,n=t.findIndex((function(t){return t.id===e}));if(-1!==n){var i=t[n],a=Object(V.$)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},(function(n){if(n.error)kt(e);else{var i=t.findIndex((function(t){return t.id===e}));t.splice(i,1),bt()}}),(function(){kt(e)}))}MailDialog.close()}function kt(e){var t=store.mail.cur.templates,n=Object(V.$)(".uMailWrite__templatesRow"+e),i=t.findIndex((function(t){return t.id===e})),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var r=lang.mobile_mail_templates_delete_error;r=r.replace("{name}",a.name),z.init({text:r,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;z.close(n)}}})}function Ct(){q.default.clearSystemMessage2(),remove(geByClass1("message__newMsgsDivider")),remove(geByClass1("Unfold__item_returnToChat"))}function Et(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,a=[],r=n.failed[t.peerId]||[],o=n.pending[t.peerId]||[];(r.length||o.length)&&(r.concat(o).map((function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))R.onMessage(t);else{if(t.reply){var r=_.default.getReplyDataFromHTML(t.reply);r&&(i[t.reply]=r)}a.push(t)}})),Y.setMsgs(a))}function jt(e,t,n){var i;n?i=[Object(Q.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),Object(Q.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[Object(Q.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var a=Object(Q.default)({class:"",close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});G.default.open(r.default.elem(a),!0)}function Tt(e,t){Q.default.close(e);var n=store.mail.presend.msgs[t];Object(ae.removeFailedMsg)(n),de.retry(t,(function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e}))}function It(e,t){Q.default.close(e),de.remove(t)}function Mt(e,t){Q.default.close(e),de.remove(t)}function Dt(e){z.init({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;z.close(n)}}})}function Pt(e){return store.mail&&store.mail.cur&&store.mail.cur.pressedButtons?store.mail.cur.pressedButtons.peers[e]:{}}t.default=R;window.uMailWrite=R},"Po+v":function(e,t,n){"use strict";n.r(t),t.default=function(e){void 0===e&&(e={});var t=[];if(e.on_overlay_click_native)t=e.on_overlay_click_native;else{var n=!0;"boolean"==typeof e.hide_on_overlay_click&&(n=e.hide_on_overlay_click),t=["Popup._onOverlayClick","this",e.on_overlay_click||null,n]}e.content||(e.content=e.inner);return{id:e.id,class:[e.mix?e.mix:e.class,Bem.class("Popup",{open:e.open,scrollable:e.scrollable})],inner:[e.rel?e.rel:null,{class:"Popup__overlay",onclick:t},{class:"Popup__wrap",inner:{tag:"div",class:"Popup__content",role:"dialog","aria-modal":"true",inner:[e.header?{class:"Popup__header",inner:[e.header.title?{class:"Popup__headerTitle",inner:e.header.title}:null,e.header.corner?{class:["Popup__headerCorner",e.header.corner.class],inner:e.header.corner.text,href:e.header.corner.url,onclick:e.header.corner.onclick,attrs:e.header.corner.attrs}:null]}:null,e.scrollable?{class:"Popup__scroll ScrollView",inner:{class:"Popup__scrollContent",inner:e.content}}:e.content,e.footer?{class:"Popup__footer",inner:e.footer}:null]}}]}}},PovR:function(e,t,n){"use strict";n.r(t),n.d(t,"SECOND",(function(){return i})),n.d(t,"MINUTE",(function(){return a})),n.d(t,"HOUR",(function(){return r})),n.d(t,"DAY",(function(){return o})),n.d(t,"PUSH_NOTIFIER_PERMISSION_GRANTED",(function(){return s})),n.d(t,"PUSH_NOTIFIER_PERMISSION_DEFAULT",(function(){return l})),n.d(t,"PUSH_NOTIFIER_PERMISSION_DENIED",(function(){return c}));var i=1e3,a=60*i,r=60*a,o=24*r,s="granted",l="default",c="denied"},PzH3:function(e,t,n){"use strict";(function(t){var i=n("bBst"),a=n("Ys8N"),r=t.document,o=function(e,t,n,i){return e.addEventListener(t,n,i)},s=function(e,t,n,i){return e.removeEventListener(t,n,i)},l=[];function c(e,t,n){var i=function(e,t,n){var i,a;for(i=0;i<l.length;i++)if((a=l[i]).element===e&&a.type===t&&a.fn===n)return i}(e,t,n);if(i){var a=l[i].wrapper;return l.splice(i,1),a}}t.addEventListener||(o=function(e,n,i){return e.attachEvent("on"+n,function(e,n,i){var a=c(e,n,i)||function(e,n,i){return function(n){var a=n||t.event;a.target=a.target||a.srcElement,a.preventDefault=a.preventDefault||function(){a.returnValue=!1},a.stopPropagation=a.stopPropagation||function(){a.cancelBubble=!0},a.which=a.which||a.keyCode,i.call(e,a)}}(e,0,i);return l.push({wrapper:a,element:e,type:n,fn:i}),a}(e,n,i))},s=function(e,t,n){var i=c(e,t,n);if(i)return e.detachEvent("on"+t,i)}),e.exports={add:o,remove:s,fabricate:function(e,t,n){var o=-1===a.indexOf(t)?new i(t,{detail:n}):function(){var e;r.createEvent?(e=r.createEvent("Event")).initEvent(t,!0,!0):r.createEventObject&&(e=r.createEventObject());return e}();e.dispatchEvent?e.dispatchEvent(o):e.fireEvent("on"+t,o)}}}).call(this,n("yLpj"))},Q8gl:function(e,t,n){"use strict";n.r(t),n.d(t,"Control_switcher",(function(){return c})),n.d(t,"Control_checkbox",(function(){return s})),n.d(t,"Control_radio",(function(){return l}));var i=n("OcsD"),a=n("z9sQ"),r=n("UWnA"),o=n("fdw3");function s(e){return u(Object(o.extend)(e,{type:"checkbox"}))}function l(e){return u(Object(o.extend)(e,{type:"radio"}))}function c(e){return u(Object(o.extend)(e,{type:"switcher"}))}function u(e){void 0===e&&(e={});var t,n=e.name,i=e.description,s=e.label||e.inner,l=e.type,c=e.checked,u=e.disabled,d=e.on_change||e.onChange,_=e.ariaHiddenLabel?e.ariaHiddenLabel:"true",f="value"in e?e.value:"1",p=[e.class||e.mix,a.default.class("Control",{type:l})],h=e.attrs||[];h=Object(o.extend)({onclick:!0},h),"switcher"===l&&(t="switch");var m=e.name+"_"+f+"_label",v={inner:[{id:e.input_id,class:"Control__native",name:n,value:f,checked:!!c&&"checked",disabled:!!u&&"disabled",type:"switcher"===l?"checkbox":l,onChange:d?["Control._onChange","this",d]:null,"aria-labelledby":s?m:null,role:t,tag:"input"},{class:"Control__icon",tag:"div"},{inner:[{inner:[s],id:m,"aria-hidden":_,tag:"span"},i?{inner:[i],class:"Control__description",tag:"div"}:""],class:"Control__label",tag:"div"}],tag:"div"}.inner;return e.withoutWrap?{inner:[v],class:p,attrs:h,tag:"label"}:(h.role="menuitem",Object(r.default)({inner:[v],tag:"label",class:p,attrs:h}))}var d=u,_=n("TYsd"),f={setChecked:function(e,t){void 0===t&&(t=!0);g(e).checked=t},isChecked:function(e){return g(e).checked}},p=f;f._onChange=v;var h=".Control",m=".Control__native";function v(e,t){_.default.handle(t,{$control:e.closest(h),name:e.name,checked:e.checked,value:e.value})}function g(e){return e.$(m)}var A=Object(i.extend)(d,p);t.default=A;window.Control=A},QBkA:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("9y81"),r=n("sYro"),o=function(e){var t=window.lang,n=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!n}),e.mix],inner:[SVGIcon(Object(r.getSearchOutline16Icon)()),{class:"mailFilter__input",tag:"input",placeholder:t.mobile_search,value:n,oninput:["MailFilter._onInput","this"],attrs:i.default.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[Wd.wrap(Object(a.default)({mix:"mailFilter__clear",icon:"close12",attrs:i.default.onMouseDown("MailFilter._onClearMouseDown","this")}))]}]})};var s=n("UxAg"),l=n("+cqQ"),c=n("jk6M"),u=n("aiw/");function d(e){requestAnimationFrame((function(){var t=e.value;p(e.value),o.onChange(t)}))}function _(){u.onOpen("top")}function f(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(c.default.ios?setTimeout:requestAnimationFrame)((function(){p(""),t.value="",n&&t.focus(),o.onClear(),o.onChange("")}))}function p(e){Object(s.$$)(".mailFilter").forEach((function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)}))}Object.assign(o,{onChange:Object(l.default)("query"),onClear:Object(l.default)(),setQuery:function(e){var t=Object(s.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,o.onChange(e),p(e))},setQuerySilently:function(e){var t=Object(s.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,p(e))}}),o._onInput=d,o._onClearMouseDown=f,o._onFocus=_;t.default=o;window.MailFilter=o},QMH7:function(e,t,n){"use strict";n.r(t),n.d(t,"healScroll",(function(){return u})),n.d(t,"unhealScroll",(function(){return d}));var i=n("OcsD"),a=n("UxAg"),r=n("Qz23");n("H5mD").isIOS&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",l);var o=".ScrollView",s="_scrollViewHealed";function l(){(c(),document.body)&&new MutationObserver(c).observe(document.body,{childList:!0,subtree:!0})}function c(){Object(a.$$)(o).forEach(u)}function u(e){if(!e[s]){e[s]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),a=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=a+1+"px",_(e),Object(r.setScrollView)(e,{override:!1}),Object(i.hasClass)("messenger__body",e)||Object(i.addEvent)(e,"scroll",p),Object(i.addEvent)(e,"scroll",f)}}function d(e){e[s]&&(e[s]=null,e.style.paddingTop="",e.style.paddingBottom="",Object(r.cleanScrollView)(e),Object(i.removeEvent)(e,"scroll",p),Object(i.removeEvent)(e,"scroll",f))}function _(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function f(e){var t=e.target,n=t[s];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){t[s]&&_(t)}),50))}function p(){onBodyScroll(!0)}},QQoL:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),r=n("9y81"),o=function(e){var t=window.lang,n=e.count;return i.default.html({class:[a.default.class("Bell",{empty:!n}),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[i.default.html(Object(r.default)({mix:"Bell__icon",icon:"bell"})),{class:"Bell__counter",inner:n,tag:"em"}]})};var s=n("UxAg");Object.assign(o,{setCount:function(e){Object(s.$$)(c).forEach((function(t){var n=t.$(u);t.classList.toggle(l,!e),n.innerText=e}))}});var l="Bell_empty",c=".Bell",u=".Bell__counter";t.default=o;window.Bell=o},Qg0H:function(e,t,n){"use strict";n.r(t);var i=n("UxAg"),a=n("TYsd"),r=n("+cqQ");window.Voting={cls:"Voting",setLoading:m,setHtml:function(e,t){f(e).forEach((function(e){e.outerHTML=t})),f(e).forEach((function(e){e.classList.add(s)})),setTimeout((function(){f(e).forEach((function(e){e.classList.remove(s),Voting.onHtmlUpdate(e)}))}),30)},getVotingsById:f,onHtmlUpdate:Object(r.default)("$voting")},Voting._onSubmit=v,Voting._onSingleAnswerClick=h,Voting._onCheckboxClick=p,Voting._onRevoteClick=g;var o="Voting_loading",s="Voting_beforeAnimation",l="Voting_hasCheckedOptions",c=".Voting",u=function(e){return'.Voting[data-id="'+e+'"]'},d=".Voting__option",_=".Voting__optionControl";function f(e){return Object(i.$$)(u(e))}function p(e){var t=e.closest(c),n=Array.from(Object(i.$$)(_)).some((function(e){return e.checked}));e.closest(d).setAttribute("aria-checked",e.checked),t.classList.toggle(l,n)}function h(e){var t=e.name,n=e.value,i=e.closest("form"),a=i.getAttribute("action");i._Voting_singleAnswerAction=a+"&"+t+"="+encodeURIComponent(n)}function m(e){e.classList.add(o)}function v(e,t,n){var i;if(e.preventDefault(),t._Voting_singleAnswerAction)i=t._Voting_singleAnswerAction,m(t);else{var r=Array.from(t.$$("input:checked"));if(0===r.length)return;var o=r[0].name,s=r.map((function(e){return e.value})).join(","),l=t.getAttribute("action"),c=l.includes("?")?"&":"?";m(t),i=""+l+c+o+"="+s+"&is_board="+t.$('input[name="is_board"]').value}a.default.handle(n,{$voting:t,url:i})}function g(e,t){var n=e.closest(c);a.default.handle(t,{$voting:n})}},Qz23:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"init",(function(){return g})),n.d(t,"preventDocumentScroll",(function(){return A})),n.d(t,"restoreDocumentScroll",(function(){return b})),n.d(t,"cleanDocumentViews",(function(){return y})),n.d(t,"allowScrolling",(function(){return w})),n.d(t,"setScrollView",(function(){return k})),n.d(t,"cleanScrollView",(function(){return C})),n.d(t,"hideTopBanner",(function(){return F})),n.d(t,"showTopBanner",(function(){return H}));var i,a,r,o,s,l,c,u=n("UxAg"),d=n("aiw/"),_=n("H5mD"),f=!0,p=!1,h="closed",m=!1,v=[];function g(e){m&&y(),A(e)}function A(e){void 0===e&&(e={}),_.isIOS&&(!0!==e.stack&&m||(c={initialized:!1,scrollViews:[]},v.push(c),e.layoutElement&&e.layoutElement.nodeType?c.layoutElement=e.layoutElement:c.layoutElement=Object(u.$)(e.layoutElement||".layout")),!1===e.topBanner?c.topBanner=!1:c.topBanner=!0,m||(m=!0,addEvent(window,"focusin",L),addEvent(window,"focusout",B),addEvent(document,"touchmove",D,{capture:!0}),addEvent(document,"touchmove",P,{capture:!1}),addEvent(window,"resize",j),d.onCloseCallback(R),_.isWKWebView||(addEvent(window,"orientationchange",T),requestAnimationFrame((function(){Object(_.isLandscapePhone)()?T(null,!0):(j(),c&&!c.topBanner?requestAnimationFrame(F):r||requestAnimationFrame(H))})))))}function b(){m&&(m=!1,y(),1===v.length&&(c.layoutOffset=null,U(),document.body.style.height=""),c.layoutElement=null,v.pop(),(c=v.length?v[v.length-1]:null)&&U(),removeEvent(window,"focusin",L),removeEvent(window,"focusout",B),removeEvent(document,"touchmove",D,{capture:!0}),removeEvent(document,"touchmove",P,{capture:!1}),removeEvent(window,"resize",j),removeEvent(window,"orientationchange",T),removeEvent(window,"resize",I),removeEvent(window,"scroll",M),d.offCloseCallback(R))}function y(){c.scrollViews.forEach((function(e){return C(e)})),c.scrollViews=[]}function w(e){var t=e.currentTarget.__ScrollView;if("prevented"!==t.state){if(!("start"!==t.state||t.allowX&&t.allowY)){var n=Math.abs(t.startX-e.changedTouches[0].clientX),i=Math.abs(t.startY-e.changedTouches[0].clientY);if(!t.allowX&&n>i)return void(t.state="prevented");if(!t.allowY&&i>n)return void(t.state="prevented")}if("allowed"!==t.state&&(t.state="allowed"),f=!1,!t.overscrollX){var a=e.currentTarget.scrollLeft,r=t.startX-e.changedTouches[0].clientX;(a<=0&&r<=0||a>=t.maxX&&r>=0)&&(f=!0,t.standalone&&e.preventDefault())}if(!t.overscrollY){var o=e.currentTarget.scrollTop,s=t.startY-e.changedTouches[0].clientY;(o<=0&&s<=0||o>=t.maxY&&s>=0)&&(f=!0,t.standalone&&e.preventDefault())}}}function O(e){var t=e.currentTarget,n=t.__ScrollView;n.state="start",n.startX=e.changedTouches[0].clientX,n.startY=e.changedTouches[0].clientY,n.maxX=n.overscrollX?null:t.scrollWidth-t.clientWidth,n.maxY=n.overscrollY?null:t.scrollHeight-t.clientHeight}function S(e){e.currentTarget.__ScrollView.state=""}function k(e,t){if(void 0===t&&(t={}),_.isIOS&&(!1!==t.override||!e.__ScrollView)){if(!0!==t.standalone){if(!m)return;e.__ScrollView||c.scrollViews.push(e)}e.__ScrollView={allowX:!1!==t.allowX,allowY:!1!==t.allowY,overscrollX:!1!==t.overscrollX,overscrollY:!1!==t.overscrollY,standalone:!0===t.standalone},c&&(_.isWKWebView||(!1!==t.topBanner&&(e.__ScrollView.topBanner=t.topBanner||{hide:30,show:60}),addEvent(e,"scroll",E))),addEvent(e,"touchstart",O),addEvent(e,"touchmove",w),addEvent(e,"touchend",S)}}function C(e){e.__ScrollView=null,removeEvent(e,"touchstart",O),removeEvent(e,"touchmove",w),removeEvent(e,"touchend",S),removeEvent(e,"scroll",E)}function E(e){if("closed"!==h||Object(_.isLandscapePhone)())return p=!1,void(o&&clearTimeout(o));p=!0;var t=e.target.__ScrollView.topBanner;c&&c.topBanner&&t?N(e.target,t.show,t.hide):N(e.target,1/0,0),o&&clearTimeout(o),o=setTimeout((function(){p=!1,j()}),100)}function j(){if(!p)if(l)l=!1;else if(!Object(_.isLandscapePhone)()){window.pageYOffset;"closed"===h&&(_.isWKWebView||(i=document.documentElement.offsetHeight,a=innerHeight,r=i===a,"show"===s?(s=null,requestAnimationFrame(H)):"hide"===s&&(s=null,requestAnimationFrame(F))))}}function T(e,t){_.isIPad?c.topBanner||setTimeout((function(){F()}),400):90===Math.abs(window.orientation)?(addEvent(window,"resize",I),document.body.style.height="",c.layoutHeight=null,t?setTimeout((function(){window.scrollTo(0,-300),I()})):setTimeout((function(){window.scrollTo(0,-300)}),400)):(removeEvent(window,"resize",I),c.layoutOffset=null,U(),c.topBanner||setTimeout((function(){F()}),400))}function I(){if("closed"===h){var e=document.body.offsetHeight,t=e-innerHeight;c.layoutOffset=t,U(),window.scrollTo(0,e)}}function M(){pageYOffset&&(h="opened",removeEvent(window,"scroll",M))}function D(e){f=!0}function P(e){f&&e.preventDefault()}function x(e){var t=e&&e.target,n=0===e.eventPhase&&t.getAttribute("autofocus"),i=!1;return"textarea"!==t.tagName.toLowerCase()||n||(i=!0),"input"!==t.tagName.toLowerCase()||["checkbox","radio","image","submit"].includes(t.type)||n||(i=!0),"select"===t.tagName.toLowerCase()&&(i=!0),i}function L(e){if(x(e)){var t,n=e&&e.target;h="opening",addEvent(window,"scroll",M),window.isCustomScroll&&(t=n.dataset.scrollviewposition),d.onOpen(t,{exitIfStarted:!0})}}function B(e){x(e)&&d.onClose({exitIfStarted:!0})}function R(){removeEvent(window,"scroll",M),h="closed",setTimeout((function(){Object(_.isLandscapePhone)()?I():j()}),100)}function N(e,t,n){var i=e.scrollTop;i<=-t&&(r||s)?(s="show",window.scrollTo(0,-10)):i>=n&&(!r||s)&&(s="hide",window.scrollTo(0,10))}function F(){window.scrollTo(0,300)}function H(){window.setImmediate?e((function(){window.scrollTo(0,-300)})):window.scrollTo(0,-300)}function U(){var e=c.layoutOffset;c.layoutElement.style.top=e?e+"px":""}}.call(this,n("URgk").setImmediate)},RJa5:function(e,t,n){"use strict";var i,a,r,o;n.r(t),n.d(t,"AnalyticsArea",(function(){return i})),n.d(t,"AnalyticsEventTable",(function(){return a})),n.d(t,"ECommGoodsEvent",(function(){return r})),n.d(t,"ECommOrdersEvent",(function(){return o})),function(e){e.MARKET="market",e.GROUP="group",e.USER_PROFILE="user_profile",e.BOOKMARKS="bookmarks"}(i||(i={})),function(e){e.GOODS="ecomm_goods",e.ORDERS="ecomm_orders"}(a||(a={})),function(e){e.TRANSITION_TO_ITEM="transition_to_item",e.TRANSITION_TO_ALBUM="transition_to_album",e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.TRANSITION_TO_ITEM_LEFT="transition_to_item_left",e.TRANSITION_TO_ITEM_RIGHT="transition_to_item_right",e.VIEW_ITEM="view_item",e.VIEW_ALBUM="view_album",e.CLOSE_ITEM="close_item",e.TRANSITION_TO_OWNER="transition_to_owner",e.VIEW_ITEM_MEDIA="view_item_media",e.ADD_ITEM_TO_CART="add_item_to_cart",e.EXPAND_ITEM_DESCRIPTION="expand_item_description",e.ADD_ITEM_TO_BOOKMARKS="add_item_to_bookmarks",e.REMOVE_ITEM_FROM_BOOKMARKS="remove_item_from_bookmarks",e.EXPAND_COMMENTS="expand_comments",e.COMMENT="comment",e.ADD_TO_CART_HS="add_to_cart_hs",e.OPEN_WIKI="open_wiki",e.SEND_MESSAGE_TO_OWNER="send_message_to_owner",e.OPEN_CHAT_WITH_OWNER="open_chat_with_owner",e.LIKE_ITEM="like_item",e.UNLIKE_ITEM="unlike_item",e.SHARE_ITEM="share_item",e.CTA_LINK="cta_link",e.CREATE_ITEM="create_item",e.CREATE_ALBUM="create_album",e.EDIT_ITEM="edit_item",e.EDIT_ALBUM="edit_album",e.DELETE_ITEM="delete_item",e.DELETE_ALBUM="delete_album",e.GROUP_ITEMS="group_items",e.ADD_PROPERTY="add_property",e.ADD_PROPERTY_VALUE="add_property_value",e.DELETE_PROPERTY="delete_property",e.DELETE_PROPERTY_VALUE="delete_property_value",e.TRANSITION_TO_EDIT_PROPERTIES="transition_to_edit_properties",e.TRANSITION_TO_EDIT_ALBUMS="transition_to_edit_albums",e.TRANSITION_TO_ADD_ALBUM="transition_to_add_album",e.TRANSITION_TO_ADD_ITEM="transition_to_add_item",e.TRANSITION_TO_EDIT_ITEM="transition_to_edit_item",e.TRANSITION_TO_DELETE_ALBUM="transition_to_delete_album",e.TRANSITION_TO_GROUP_ITEMS="transition_to_group_items"}(r||(r={})),function(e){e.EVENT_MAKE_ORDER="make_order",e.CANCEL_ORDER="cancel_order",e.EXPAND_ORDER_INFO="expand_order_info",e.TRANSITION_TO_ORDERS="transition_to_orders",e.OPEN_MARKET_GROUP_ORDERS="open_market_group_orders",e.OPEN_MARKET_GROUP_ITEMS="open_market_group_items",e.OPEN_MARKET_GROUP_SETTINGS="open_market_group_settings",e.OPEN_MARKET_GROUP_DELIVERY="open_market_group_delivery",e.TRANSITION_TO_MARKET_SUPPORT="transition_to_market_support",e.OPEN_ORDER_INFO="open_order_info",e.ADD_TRACK_CODE="add_track_code",e.ADD_INTERNAL_COMMENT="add_internal_comment",e.CHANGE_ORDER_STATUS="change_order_status",e.OPEN_CHAT_WITH_CUSTOMER="open_chat_with_customer",e.SEND_MESSAGE_TO_CUSTOMER="send_message_to_customer",e.OPEN_ORDER_HISTORY="open_order_history",e.FILTER_ORDERS_BY_STATUS="filter_orders_by_status",e.EXPORT_ORDERS_DATA="export_orders_data"}(o||(o={}))},"S6+Z":function(e,t,n){"use strict";n.r(t),n.d(t,"emojiRegex",(function(){return i})),n.d(t,"skinToneModifierRegex",(function(){return a})),n.d(t,"EMOJI_PREFIXED_REPLACES",(function(){return r})),n.d(t,"EMOJI_REPLACES",(function(){return o})),n.d(t,"EMOJI_HINTS",(function(){return s}));var i=function(){return/(?:\uD83C\uDFF4)(?:(?:\uDB40\uDC67)(?:\uDB40\uDC62)(?:(?:\uDB40\uDC65)(?:\uDB40\uDC6E)(?:\uDB40\uDC67)|(?:\uDB40\uDC77)(?:\uDB40\uDC6C)(?:\uDB40\uDC73)|(?:\uDB40\uDC73)(?:\uDB40\uDC63)(?:\uDB40\uDC74))(?:\uDB40\uDC7F)|\u200D\u2620\uFE0F?)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC68)(?:\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D)?(?:\uD83D\uDC68)|(?:\uD83D[\uDC68\uDC69])\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83D[\uDC68\uDC69]))|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:(?:\uD83D\uDC41)\uFE0F?\u200D(?:\uD83D\uDDE8)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|(?:\uD83D\uDC68)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F?|(?:\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF]))\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|(?:\uD83D\uDC69)\u200D[\u2695\u2696\u2708])\uFE0F?|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC68)(?:\u200D(?:(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC66\uDC67]))|(?:\uD83C[\uDFFB-\uDFFF]))|(?:\uD83C\uDFF3)\uFE0F?\u200D(?:\uD83C\uDF08)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)|(?:\uD83C\uDDF6)(?:\uD83C\uDDE6)|(?:\uD83C\uDDFD)(?:\uD83C\uDDF0)|(?:\uD83C\uDDF4)(?:\uD83C\uDDF2)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C\uDDED)(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|(?:\uD83C\uDDEC)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|(?:\uD83C\uDDEA)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|(?:\uD83C\uDDE8)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\uD83C\uDDF2)(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|(?:\uD83C\uDDF3)(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|(?:\uD83C\uDDFC)(?:\uD83C[\uDDEB\uDDF8])|(?:\uD83C\uDDFA)(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|(?:\uD83C\uDDF0)(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|(?:\uD83C\uDDEF)(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C\uDDF8)(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|(?:\uD83C\uDDEE)(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|(?:\uD83C\uDDFF)(?:\uD83C[\uDDE6\uDDF2\uDDFC])|(?:\uD83C\uDDEB)(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|(?:\uD83C\uDDF5)(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|(?:\uD83C\uDDE9)(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|(?:\uD83C\uDDF9)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|(?:\uD83C\uDDE7)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|[#\*0-9]\uFE0F?\u20E3|(?:\uD83C\uDDF1)(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|(?:\uD83C\uDDE6)(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|(?:\uD83C\uDDF7)(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|(?:\uD83C\uDDFB)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|(?:\uD83C\uDDFE)(?:\uD83C[\uDDEA\uDDF9])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])|(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])\uFE0F?|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDD1-\uDDDD])/g},a=/\uFE0F?\uD83C[\uDFFB-\uDFFF]/,r={e29da4:/(\s|^)([0OО]:\))([\s\.,]|$)/g,f09f9887:/(\s|^)(;-\)+)([\s\.,]|$)/g,f09f9889:/(\s|^)([XХxх]-?D)([\s\.,]|$)/g,f09f9886:/(\s|^)(B-\))([\s\.,]|$)/g,f09f988e:/(\s|^)(3-\))([\s\.,]|$)/g,f09f988c:/(\s|^)(&gt;\()([\s\.,]|$)/g,f09f98a0:/(\s|^)(;[oоOО])([\s\.,]|$)/g,f09f98b0:/(\s|^)(8\|)([\s\.,]|$)/g,f09f98b3:/(\s|^)(8-?[oоOО])([\s\.,]|$)/g,f09f98b2:/(\s|^)(8-\))([\s\.,]|$)/g,f09f988d:/(\s|^)(:[XХ])([\s\.,]|$)/g,f09f98b7:/(\s|^)(:[oоOО])([\s\.,]|$)/g,f09f98a8:/(\s|^)(&lt;3)([\s\.,]|$)/g},o={f09f988a:/(:-\))([\s\.,]|$)/g,f09f9883:/(:-D)([\s\.,]|$)/g,f09f989c:/(;-[PР])([\s\.,]|$)/g,f09f988b:/(:-[pр])([\s\.,]|$)/g,f09f9892:/(:-\()([\s\.,]|$)/g,e298ba:/(:-?\])([\s\.,]|$)/g,f09f988f:/(;-\])([\s\.,]|$)/g,f09f9894:/(3-?\()([\s\.,]|$)/g,f09f98a2:/(:&#039;\()([\s\.,]|$)/g,f09f98ad:/(:_\()([\s\.,]|$)/g,f09f98a9:/(:\(\()([\s\.,]|$)/g,f09f9890:/(:\|)([\s\.,]|$)/g,f09f98a1:/(&gt;\(\()([\s\.,]|$)/g,f09f989a:/(:-\*)([\s\.,]|$)/g,f09f9888:/(\}:\))([\s\.,]|$)/g,f09f918d:/(:like:)([\s\.,]|$)/g,f09f918e:/(:dislike:)([\s\.,]|$)/g,e2989d:/(:up:)([\s\.,]|$)/g,e29c8c:/(:v:)([\s\.,]|$)/g,f09f918c:/(:ok:|:ок:)([\s\.,]|$)/g},s={e29da4:[0,"<3"],f09f988a:[1,":-)"],f09f9883:[2,":-D"],f09f9889:[3,";-)"],f09f9886:[4,"xD"],f09f989c:[5,";-P"],f09f988b:[6,":-p"],f09f988d:[7,"8-)"],f09f988e:[8,"B-)"],f09f9892:[9,":-("],f09f988f:[10,";-]"],f09f9894:[11,"3("],f09f98a2:[12,":'("],f09f98ad:[13,":_("],f09f98a9:[14,":(("],f09f98a8:[15,":o"],f09f9890:[16,":|"],f09f988c:[17,"3-)"],f09f98a0:[18,">("],f09f98a1:[19,">(("],f09f9887:[20,"O:)"],f09f98b0:[21,";o"],f09f98b3:[22,"8|"],f09f98b2:[23,"8o"],f09f98b7:[24,":X"],f09f989a:[25,":-*"],f09f9888:[26,"}:)"],f09f918d:[27,":like:"],f09f918e:[28,":dislike:"],e2989d:[29,":up:"],e29c8c:[30,":v:"],f09f918c:[31,":ok:"]}},SNk7:function(e,t,n){"use strict";n.r(t);var i=n("fdw3"),a=n("Y6JH"),r=n("DsG2"),o=function(){return{inner:[{inner:[Object(a.default)({icon:Object(r.getBomb24Icon)()})],class:"CasperHiddenMessages__buttonIcon","aria-hidden":"true",tag:"span"},{inner:[Object(i.getLang)("mobile_casper_chat_message_has_gone")],class:"CasperHiddenMessages__buttonText",tag:"span"}],class:"CasperHiddenMessages__button",onClick:["CasperHiddenMessages.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false","aria-controls":"mail-dialog",tag:"button"}};var s=n("iS9e"),l=n("TYsd"),c=n("CQvH"),u=null,d={clickHandler:function(e){s.default.open({body:l.default.html({inner:[{inner:[Object(i.getLang)("mobile_casper_message_modal_info")],class:"CasperHiddenMessages__paragraph",tag:"p"}],class:"CasperHiddenMessages__box",tag:"div"}),title:Object(i.getLang)("mobile_casper_message_modal_title"),class:"CasperHiddenMessages__dialog",buttons:l.default.html({inner:[{inner:[Object(i.getLang)("mobile_casper_message_modal_install_vk_me")],tag:"span"}],class:"Btn Btn_theme_regular CasperHiddenMessages__dialogButton mailDialog__button mailDialog__confirmButton",tag:"button"}),onConfirm:function(e){if(u(),!(store&&store.mail&&store.mail.cur&&store.mail.cur.vkmeLink))throw new Error("Cannot find a link to VK Me app");nav.hard_go(store.mail.cur.vkmeLink)},onClose:function(){u(),s.default.close()}}),(u=Object(c.expandPopup)(e)).exitIntent=function(){s.default.close()}}};window.CasperHiddenMessages=d;t.default=o},STl5:function(e,t,n){"use strict";n.r(t);var i=n("QQoL"),a=function(){var e=window.store,t="/feed?section=notifications";return Object(i.default)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})};t.default=a;window.uBell=a},T24x:function(e,t,n){"use strict";n.r(t);var i=n("BZzM"),a=(n("CQvH"),n("QMH7")),r=n("Y6JH"),o=n("qHA9"),s=n("9b/I"),l={onChange:se(),onChanged:se(),onRestore:se(),fast_load:!1,need_hard_go:!1,getHash:function(e){if("#player"===e.hash)return e.path+e.hash;var t=qs2obj(e.params);return delete t.z,e.path+obj2qs(t)},getAlias:function(e){if(!e)return!1;var t=(e||"").split("?"),n=t[0],i=qs2obj(t[1]);return i.from&&delete i.offset,delete i.from,delete i.z,delete i.ref,Object.keys(i).forEach((function(e){0===e.indexOf("_")&&delete i[e]})),n+obj2qs(i)},set:function(e,t,n,r){void 0===n&&(n={});var s=window,c=s.zlayer,u=s.cur,d=s.nav,_=s.menu,f=s.audioplayer,p=$("body.fixed"),h=p?Math.abs(parseInt(getStyle(p,"top"),10)):scrollTop(),m=null;if(window.isNewMail){var v=e.split("?");toggleClass("vk__page_mail",window.bodyNode,Object(o.isNewMailPage)(v[0],v[1]))}c.opened()&&(h=c._st);var g=n.forceUpdate&&t.newHTML,A=!g&&d.hasUpdate(r,e,t),b=!!A||d.needUpdate(r,e,t),y=0;if(!n.force&&!A&&b||g?(y=scrollTop(),m=remove("m"),each(geByClass("_cntr",m),(function(){remove(this)})),each(geByClass("ScrollView",m),(function(){Object(a.unhealScroll)(this)})),remove(geByClass1("_cntrs",m))):each(geByClass("ScrollView",geByClass1("m")),(function(){Object(a.unhealScroll)(this)})),!n.after&&!l.fast_load){var w=l.getHash(d),O=r||t.options||{};r&&r.is_native_back&&(O.prev_tab=O.native_prev),l.save(w,{html:null,st:h,page:m,state:l.stash(),cur:window.cur,options:O},!0)}if(n.before||l.clear(),(n.before||!n.before&&!n.after)&&(window.lm_qsearch_counter?window.lm_qsearch_counter++:window.lm_qsearch_counter=1),n.before){var S=r&&r.target;l.fast_load=!0,S&&addClass("__al_target",S);var k=m.cloneNode(!0);S&&removeClass("__al_target",S);var C=geByClass1("__al_target",k);removeClass("__al_target",C),n.beforeAppend&&n.beforeAppend(k,C),after(k,"l"),scrollTop(y),u.toggleHeaderSearch&&u.toggleHeaderSearch(!1),n.afterAppend&&n.afterAppend(k),_&&_.clear_hover(),_&&_.closeSearch(),_&&_.enabled(!0)}else{r&&r.zProcess&&r.zProcess(0,!0)&&delete r.zProcess;var E=!1;if(r&&d.set(r),l.need_hard_go)return d.hard_go(d.cur,null,{replace:!0});if(!n.force&&!A&&b||g){var j;if(t.title&&(document.title=t.title),g?((j=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(j,t.newHTML)):(j=t.page)?E=!0:((j=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(j,t.html)),_.opened()){var T=ce("div",{id:"m_helper",onclick:_.close});append(T,j)}after(j,"l")}l.fast_load=!1,thover.clear(),!A&&b&&(t.lm&&_.refresh(t.lm),t.bc&&(window.bodyNode.className=t.bc),c.opened(),r&&r.zProcess?r.zProcess(0,!1)&&delete r.zProcess:c.close()),n.force||(E&&(window.qsearch.isCachedPage=!0),t.js&&evalJs(t.js),E&&(window.qsearch.isCachedPage=!1),t.state&&l.stash(t.state),t.cur&&extend(window.cur,t.cur),r&&(t.options=r),post.wallActionsHide(),l.save(e,t));var I=r?r.nav&&r.nav.hash:d.hash;if(A||b)if(A)Tabbar.showUpdateButton(A.currentCache.d.page);else if(t.st||!I){var M=window.isCustomScroll&&hasClass("ScrollView","mcont")?1:0;scrollTop(t.st||M),scrollTop(t.st||M,10)}else I?scrollToHash(I):n.no_scroll&&!n.force?(scrollTop(h),scrollTop(h,10)):scrollToHash();else;f&&f.initAudio(),AudioMessagePlayer&&AudioMessagePlayer.redrawWaves()}var D=window.Tabs;onBodyResize(D.actualizeShowMoreVisibility),D.actualizeShowMoreVisibility(),Object(i.resizePosters)(),l.onChange(!0,r&&r.nav&&r.nav.push),(n.al_transition||n.restored)&&l.onChanged(!0)},save:function(e,t,n){if(e){var i=window.nav,a=n?i.page_get(e,t.options.prev_tab):{};a&&i.page_set(e,extend(a,t),l.getAlias(e))}},restore:function(e){var t=window.nav,n=t.page_get(e);return n||(n=t.page_get(l.getAlias(e))),!!n&&(l.onRestore(!0),n)},stash:function(e){var t=window.cur;return window.cur&&t.stash&&t.stash(e)||!1},clear:function(){var e=window.cur,t=window.zlayer,n=window.menu,i=window.tooltip;onBodyScroll("__clear"),onBodyResize("__clear"),n&&n.initEvents(),t.isReady&&t.initEvents(),i&&i.clear(),window.cur&&e.destroy&&each(e.destroy,(function(){this()})),window.cur={destroy:[]}},hideHeader:function(e){var t=geByClass1("mhead",e);hide(t)},setMhead:function(e,t,n,i,a){void 0===a&&(a={});var o=geByClass1("mhead",e),l=geByClass1("mhb_logo",o),c=geByClass1("mh_header",e),u=!1,d=window.nav,_=document.body,f=geByClass1("SliderTabs",o),p=geByClass1("header__right",o),h=geByClass1("header__gear",o);f&&remove(f),p&&remove(p),h&&remove(h),removeClass("vk_header_tabs",_);var m="header__title hb_btn mh_header mhi_back";if(a.movable&&(m+=" header__title--movable header__title--initial-position"),n){!0===n?u=d.path+(d.params?"?"+d.params:""):n&&(u=n),t||(t=val(c)||"&nbsp;");var v=geByClass1("mhb_back",e),g="",A=hasClass("mh_nobr",v)?" mh_nobr":"",b=i?' onclick="'+i+'"':"";if("/"==u)g='<div class="hb_wrap mhb_back'+A+'"'+b+'><h1 class="hb_btn mh_header">'+t+"</h1></div>";else{var y=Wd.html(Object(r.default)(Object(s.getBackOutline28Icon)()));g='\n        <div class="header__center hb_wrap mhb_back '+A+'">\n          <a class="header__back al_back" href="'+escapeAttr(u)+'" accesskey="0" '+b+">"+y+'</a>\n          <h1 class="'+m+'">\n            <div class="header__text">\n                '+t+"\n            </div>\n          </h1>\n        </div>\n      "}if(o&&l){var w=geByClass1("mhb_notify",e);val(o,(window.al&&window.al.menu?'<a href="/" class="hb_wrap mhb_home" accesskey="*" onclick="return menu.toggle(event);"><div class="hb_btn mhi_home">&nbsp;</div></a>':'<a href="/" class="hb_wrap mhb_home mhb_vkhome" accesskey="*"><div class="hb_btn mhi_home mhi_vkhome">&nbsp;</div></a>')+'<div id="header_msgs" class="hb_wrap mhb_notify'+(!w||hasClass("mhb_no_notify",w)?" mhb_no_notify":"")+'">'+val(w)+"</div>"+g)}else v&&(v.outerHTML=g);var O=$(".header__center");O&&O.classList.toggle("is_unfold",$(".Unfold",O))}else t&&val(c,t)}};window.page=l,t.default=l},TYsd:function(e,t,n){"use strict";n.r(t),n.d(t,"_Wd_toFlatArray",(function(){return a})),n.d(t,"_Wd_innerItemToString",(function(){return r}));var i=n("1By4");t.default=i.default;var a=i.default._Wd_toFlatArray,r=i.default._Wd_innerItemToString;window.Wd=i.default},Tjn9:function(e,t){function n(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout((function(){addClass(e,"profileEdit_animated"),setTimeout((function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")}),1e3)}),1500))}function i(e){(e=ge(e))&&setTimeout((function(){var t=getXY(e)[1],i=getSize("mhead")[1],a=scrollGetY(),r=getCh();t<i+a||t>a+r?setTimeout((function(){scrollTo(0,t-i),n(e)}),0):n(e)}),0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&i(geByClass1("_"+e))},highlightRow:n,scrollHighlightRow:i}},TxR4:function(e,t,n){"use strict";n.r(t),n.d(t,"emojiSymbolToByteHex",(function(){return a})),n.d(t,"emojiByteHexToSymbol",(function(){return r})),n.d(t,"emojiRemoveSkinToneModifiers",(function(){return o}));var i=n("S6+Z");function a(e){return encodeURIComponent(e.replace(/\uFE0F/gi,"")).replace(/%/gi,"").toLowerCase()}function r(e){var t,n=e.length%2==1,i=n?e.slice(0,1):"",a=n?e.slice(1):e,r="";try{r=decodeURIComponent("%"+(t=a,t.split("").reduce((function(e,t,n){return e+t+((n+1)%2==0?" ":"")}),"").trim().split(/\s+/)).join("%"))}catch(e){}return i+r}function o(e){return e.replace(Object(i.emojiRegex)(),s)}function s(e){return e.replace(i.skinToneModifierRegex,"")}},U34x:function(e,t){var n="dropdown_open",i={_onTogglerClick:function(e,t){preventEvent(e),stopEvent(e);var i=gpeByClass("dropdown",t);if(toggleClass(i,n),!1!==i.isFirstClick){i.isFirstClick=!1;var a=function(){removeClass(i,n)};addEvent(window,"click",a),window.cur.destroy.push((function(){removeEvent(window,"click",a),i.isFirstClick=!0}))}}};window.Dropdown=i},UWnA:function(e,t,n){"use strict";n.r(t);var i=n("WWoJ");n.d(t,"RowLabeledSelect",(function(){return i.RowLabeledSelect})),n.d(t,"RowLabeledInput",(function(){return i.RowLabeledInput})),t.default=i.default},Ubt6:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");t.default=function(e){return{class:[e.class,i.default.class("Tooltip",{pos:e.pos,onboarding:e.onboarding,theme:e.theme||"",closeOnOverlayClick:e.closeOnOverlayClick})],"tooltip-id":e["tooltip-id"],inner:{class:i.default.class("Tooltip__inner",{pos:e.pos,theme:e.theme||""}),inner:e.inner},onclick:e.onclick}}},UlUB:function(e,t,n){"use strict";function i(e,t){var n,i,a=!1;return function r(){if(a)return n=arguments,void(i=this);e.apply(this,arguments),a=!0,setTimeout((function(){a=!1,n&&(r.apply(i,n),n=i=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return i}))},UvyM:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("BoyB"),r=n("TYsd"),o=n("fdw3");t.default=function(e){void 0===e&&(e={});var t=e.url,n=e.is_icon,s=e.icon,l=e.tag||"button",c=e.on_click||e.onClick||e.onclick,u=e.use_native_onclick,d=e.inner||e.children;Object(o.isArray)(d)&&1===d.length&&"string"==typeof d[0]&&(d=d[0]);var _=!1;"function"==typeof c&&(u=!0,_=!0);c&&!u&&(c=["Btn._onClick","event","this",c]);var f={class:[e.class,i.default.class("Btn",{theme:e.theme||"regular",size:e.size||"",stretch:e.stretch})],onclick:c,attrs:e.attrs,ref:e.ref};_&&(f.onClick=c,delete f.onclick);var p=e.hide?"; display: none;":"",h=e.style?e.style+p:p,m=null;e.isLoading&&(f.class.push("Btn_loading"),m=r.default.wrap(Object(a.default)({mix:"Btn__loader",white:"secondary"===e.theme?"white":"",large:!0,spinner:e.spinner})));if(t)return Object(o.mergeObjects)(f,{_:r.default.getInternalData(),tag:"a",href:t,role:"button",style:h,inner:s?[{class:"Btn__icon",inner:s},{class:"Btn__text",inner:d}]:n?d:{class:"Btn__text",inner:d},target:(e.open_in_new_tab?"_blank":e.target)||""});var v=e.is_submit?"submit":null,g=e.type||v;return Object(o.mergeObjects)(f,{_:r.default.getInternalData(),"aria-label":e["aria-label"]||"",tag:l,style:h,disabled:e.disabled,type:g,inner:s?[m,{class:"Btn__icon",inner:s},{class:"Btn__text",inner:d}]:n?[m,d]:[m,{class:"Btn__text",inner:d}]})}},V2dH:function(e,t,n){"use strict";n.r(t);var i=n("rKUZ"),a=n("iWgD"),r=function(){return Object(i.default)(o())};function o(){var e,t,n=store.mail.cur.peerId,i=Object(a.uTyping_getPeerTyping)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:Object(a.uTyping_getNames)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}Object.assign(r,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.default.getElem("curConvo"),t=o();q.parseClass("typing",e.className).animation===t.animation?i.default.setTyping(e,t):e.outerHTML=Object(i.default)(t)}});t.default=r;window.uCurConvoTyping=r},V4qE:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return C})),n.d(t,"close",(function(){return T})),n.d(t,"SNACKBAR_POSITION_COMMON",(function(){return v})),n.d(t,"SNACKBAR_POSITION_MAIL",(function(){return g})),n.d(t,"SNACKBAR_TYPE_SUCCESS",(function(){return y})),n.d(t,"SNACKBAR_TYPE_ERROR",(function(){return w})),n.d(t,"SNACKBAR_TYPE_BOOKMARK",(function(){return O})),n.d(t,"SNACKBAR_TYPE_BULLYING",(function(){return S}));var i=n("z9sQ"),a=n("29dZ"),r=n("Y6JH"),o=n("fdw3"),s=n("xlrz"),l=n("XJmI"),c=n("EXPB"),u=n("0qaj"),d=function(e){void 0===e&&(e={});var t=e.position||"bottom",n=!(!e.type||e.image),d={class:i.default.class("SnackbarItem__cell",{left:!0,image:!!e.image,top:e.avatar&&"left"===e.avatar_position,icon:n})},_={class:i.default.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar})},f=!1,p=!1;if(e.type){f=!0;var h=null;switch(e.type){case 1:h=Object(r.default)(Object(s.getSnackbarDone24Icon)());break;case 2:h=Object(r.default)(Object(l.getSnackbarError24Icon)());break;case 3:h=Object(r.default)(Object(c.getFavorites24Icon)());break;case 4:h=Object(r.default)(Object(u.getErrorFill24Icon)())}d.inner={class:"SnackbarItem__icon",inner:h}}e.image&&(f=!0,d.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(p=!0,_.inner=Object(a.default)({theme:"none",class:"SnackbarItem__action",url:e.action.url,target:e.action.target,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));if(e.avatar){var m={tag:"img",class:"SnackbarItem__avatar",src:e.avatar};e.avatar_position&&"right"!==e.avatar_position?"left"===e.avatar_position&&(f=!0,d.inner=m):(p=!0,_.inner=m)}return{style:e.style?e.style:"",class:Object(o.concatValues)("SnackbarItem_"+e.id+" SnackbarItem--"+t+" ",i.default.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:n},"--")),attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[f?d:null,e.text?{class:i.default.class("SnackbarItem__cell",{text:!0}),inner:{class:"SnackbarItem__text",inner:Object(o.isObject)(e.text)?e.text:Wd.wrap(e.text)}}:null,p?_:null]}]}};var _=n("OcsD"),f=n("UxAg"),p=n("kr3z"),h=n("zq7H"),m=n("ZMWW");window.Snackbar={init:C,close:T,_onActionClick:function(e,t){var n=b[t];if(!n)return void Object(_.hide)(t);var i=n.callback,a=n.url;i?"function"==typeof i?i.call(null,e,{id:t,url:a}):Wd.handle2(i,e,{id:t,url:a}):Object(_.hide)(t)},_onRestoreClick:function(e,t,n){var i=t.closest(".SnackbarItem"),a=Object(_.domData)(i,"snackbar-id"),r=b[a];e.stopPropagation(),e.preventDefault();var o=r.callback;o&&("function"==typeof o?o.call(null,e,{id:a,url:n}):Wd.handle2(o,e,{id:a,url:n}));T(a),p.default.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var v="common",g="mail",A=0,b={},y=1,w=2,O=3,S=4,k=[];function C(e){if(!m.SAKIntegration.isIntegrated){var t=isFinite(e.duration)?e.duration:5e3,n=A++,i=e.action&&e.action.callback,a=e.action&&e.action.url;e.position=e.position||v;var r=e.position;e.id=n,i&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var o,s=Wd.elem(SnackbarItem(e));return function(e,t){if(t.position===v)Object(_.append)(e,document.body);else if(t.position===g){var n="msg"===window.store.mail.cur.page?Object(f.$)(".messenger__layer_page .messenger__header"):Object(f.$)(".messenger__layer_convo .messenger__header");Object(_.append)(e,n)}setTimeout((function(){e.classList.add("SnackbarItem_added")}),100)}(s,e),t&&(o=j(n,t)),Object(_.addEvent)(s,"touchstart",R,{passive:!0}),Object(_.addEvent)(s,"touchmove",N,{capture:!1}),Object(_.addEvent)(s,"touchcancel touchend",F,{passive:!0}),b[n]={id:n,timer:o,callback:i,url:a,duration:t,position:r},k.push(n),E(),n}m.SAKIntegration.sendMessage("show_snackbar",{type:e.type,text:e.text})}function E(){var e=(k=k.filter((function(e){var t=b[e],n=I(e);return!(!t||!n)}))).reduce((function(e,t){var n=b[t];return e[n.position]||(e[n.position]=[]),e[n.position].push(t),e}),{});Object.keys(e).forEach((function(t){var n=e[t],i=0,a=t===g?8:12;n.forEach((function(e,n){var r=I(e),o=Object(_.getH)(r);b[e].vertical=t===g?i:-i,_.setStyle.transform(r,1,[0,b[e].vertical]),i+=o+a}))}))}function j(e,t){return setTimeout((function(){T(e,!1)}),t)}function T(e,t){var n=b[e],i=I(e);n&&(n.timer&&clearTimeout(n.timer),delete b[e]),i&&function(e,t){if(Object(_.removeEvent)(e,"touchstart",R,{passive:!0}),Object(_.removeEvent)(e,"touchmove",N,{capture:!1}),Object(_.removeEvent)(e,"touchcancel touchend",F,{passive:!0}),t)return Object(_.remove)(e),void E();e.classList.add("SnackbarItem--closing");if(!e)return;e.classList.add("SnackbarItem_removed"),setTimeout((function(){Object(_.remove)(e),E()}),600)}(i,t)}function I(e){return Object(f.$)(".SnackbarItem_"+e)}onDOMReady((function(){onBodyResize(E)}));var M=!1,D=null,P=!1,x=0,L=!1,B=Object(_.getCw)();function R(e){if(B=Object(_.getCw)(),e.touches&&e.touches.length>1)M=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=Object(_.domData)(t,"snackbar-id");if(B>=h.DESKTOP_WIDTH&&(L=!0),b[n].position===g){L=!1;var i=Object(f.$)(".messenger");B=Object(_.getW)(i),b[n].parentXY=Object(_.getXY)(i)}else b[n].parentXY=Object(_.getXY)(bodyNode);b[n].timer&&clearTimeout(b[n].timer),D=e.touches[0],x=e.touches[0].clientX,M=!0,P=n,document.body.style.overflow="hidden"}}function N(e){var t=P;if(e.preventDefault(),e.touches&&e.touches.length>1)M=!1;else if(D&&M){var n=e.touches[0],i=e.target.closest(".SnackbarItem"),a=-(x-n.clientX);L&&(a=Math.min(a,0));var r=Object(_.getX)(i),o=(Object(_.getW)(i)+a)/2+r-b[t].parentXY[0],s=o>=.95*B||o<=B/.95-B;b[t].canClose=s,_.setStyle.transform(i,1,[a,b[t].vertical])}}function F(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=Object(_.domData)(t,"snackbar-id"),i=b[n];if(b[n].dragging=!1,P=!1,document.body.style.overflow="visible",i.canClose){var a=Object(_.getX)(t)>0?Object(_.getCw)():-Object(_.getCw)();return Object(_.getCw)()>=h.DESKTOP_WIDTH&&(a=Object(_.getX)(t)>Object(_.getCw)()/2?Object(_.getCw)():-Object(_.getCw)()),_.setStyle.transform(t,1,[a,b[n].vertical||0]),void T(n)}b[n].timer=j(n,i.duration),t&&_.setStyle.transform(t,1,[0,b[n].vertical||0])}t.default=d;window.SnackbarItem=d},VRji:function(e,t,n){"use strict";n.r(t),n.d(t,"initAutogrow",(function(){return o}));var i=n("fdw3");var a=function(e){return void 0===e&&(e={}),Object(i.extend)({tag:"textarea",class:["Textarea",e.mix],name:e.name,placeholder:e.placeholder,rows:e.rows?e.rows:3,inner:e.text,maxlength:e.maxlength},e.attrs)},r=n("OcsD");function o(e,t){void 0===t&&(t=3);var n=Object(r.ce)("span",{className:"Textarea__ghost"});Object(r.setStyle)(n,{width:e.clientWidth+"px",padding:Object(r.getStyle)(e,"padding"),lineHeight:Object(r.getStyle)(e,"line-height")}),n.innerText="_",Object(r.append)(n,e.parentNode);var i=n.clientHeight;Object(r.addEvent)(e,"input",(function(){var a=e.value.replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");("\n"===Object(r.last)(a)||a.endsWith("<br />"))&&(a+="&nbsp;"),n.innerHTML=a,e.rows=Math.max(1,Math.min(t,Math.ceil(n.clientHeight/i)))}))}t.default=a},VzJG:function(e,t,n){"use strict";n.r(t),n.d(t,"rebuildNotifications",(function(){return s})),n.d(t,"recordClick",(function(){return l})),n.d(t,"showMenuItems",(function(){return c}));var i=n("UxAg"),a=n("TYsd"),r=n("dONA"),o=n("zq7H");function s(){var e=Object(i.$)(".MainMenu__menu");if(e){var t=store.menuNotifications;if(t){var n=Object(i.$)(".MainMenu__menuItem--apps .MainMenu__menuItemTitle",e);if(n){var s=Object(i.$)('[data-id="menu-apps-notification"]',n);!t[o.COUNTERS_POS_APPS]&&s&&s.remove(),t[o.COUNTERS_POS_APPS]&&!s&&(n.innerHTML+=a.default.render(Object(r.default)({id:"menu-apps-notification"})))}}}}function l(e){ajax.post("/",{act:"menu_item_click_record",menu_item:e})}function c(e){Object(i.$$)(".MainMenu__menuItem--hidden").forEach((function(e){e.classList.remove("MainMenu__menuItem--hidden")})),e.classList.add("MainMenu__menuItem--hidden")}},W0P9:function(e,t,n){"use strict";n.r(t),n.d(t,"log",(function(){return r})),n.d(t,"warn",(function(){return o})),n.d(t,"error",(function(){return s})),n.d(t,"debug",(function(){return l}));var i=n("W9Tc");function a(){return window.console&&Object(i.partConfigEnabled)("js_console_logs")}function r(){var e;a()&&(window.console.log&&(e=window.console).log.apply(e,arguments))}function o(){var e;a()&&(window.console.warn?(e=window.console).warn.apply(e,arguments):r.apply(void 0,arguments))}function s(){var e;a()&&(window.console.error?(e=window.console).error.apply(e,arguments):r.apply(void 0,arguments))}function l(){var e;a()&&(window.console.debug?(e=window.console).debug.apply(e,arguments):r.apply(void 0,arguments))}},W38l:function(e,t,n){"use strict";n.r(t),n.d(t,"log",(function(){return s})),n.d(t,"mark",(function(){return l})),n.d(t,"error",(function(){return c})),n.d(t,"clean",(function(){return u})),n.d(t,"logQueueSize",(function(){return d}));var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function a(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}var r=n("WwUR"),o={};function s(e,t){var n={action:t,startTime:Date.now(),networkType:a(),lpState:r.default.isLongPollingEnabled()};o[e]=n}function l(e,t){if(o[e]){var n=o[e],i=n.startTime,a=n.action,r=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,a,t,r,s)}}function c(e,t,n){if(o[e]){var i=o[e],a=i.action,r=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,a,t,n,r,s)}}function u(e){delete o[e]}function d(e){statlogsValueEvent("mvk_mail_send_queue_size",e,a())}},WCKs:function(e,t){},WWoJ:function(e,t,n){"use strict";n.r(t),n.d(t,"Row",(function(){return c})),n.d(t,"RowBtn",(function(){return u})),n.d(t,"RowLabeledText",(function(){return d})),n.d(t,"RowLabeledInput",(function(){return _})),n.d(t,"RowLabeledSelect",(function(){return f}));var i=n("8ZMO"),a=n("p5n7"),r=n("I7Du"),o=n("9y81"),s=n("29dZ"),l=n("z9sQ");function c(e){void 0===e&&(e={});var t=e.anchor,n=e.attrs||{},a=e.style||{},r=e.url,s=e.count,c=r&&!a.no_go_icon&&!s,u=e.tag;u||(u=r?"a":"div");var d=null;return c?d=Wd.wrap(Object(o.default)({mix:"Row__right",icon:"chevron_right"})):s&&(d={inner:[s],class:"Row__right Row__count",tag:"div"}),{class:[e.mix||e.class,l.default.class("Row",{go:c,style_withBorder:a.with_border,style_withBorderForce:a.with_border_force,style_withHover:a.with_hover,style_smallPaddings:a.small_paddings,style_noPaddingTop:a.no_padding_top,style_noPaddingBottom:a.no_padding_bottom,style_tinyPaddingTop:a.tiny_padding_top,style_tinyPaddingBottom:a.tiny_padding_bottom,paddingTop_short:a.padding_top_short})],tag:u,href:r,attrs:n,role:e.role,inner:[t?Object(i.default)({id:t}):null,d,e.icon?{inner:[e.icon],class:"Row__icon "+e.icon_class,tag:"div"}:null,e.content||e.inner]}}function u(e){return c({content:Object(s.default)(e)})}function d(e){return p({anchor:e.anchor,url:e.url,label:e.label,content:e.text,is_mini:!0})}function _(e){return p({anchor:e.anchor,label:e.label,style:e.style,content:Object(a.default)(e)})}function f(e){return p({anchor:e.anchor,style:e.style,label:e.label,content:Object(r.default)(e)})}function p(e){return c({anchor:e.anchor,url:e.url,style:e.style,content:[h({is_mini:e.is_mini,label:e.label}),m({content:e.content})]})}function h(e){return{inner:[e.label],class:[l.default.class("Row__label",{mini:e.is_mini}),e.class||""].join(" "),tag:"div"}}function m(e){return{inner:[e.content],class:["Row__labeledContent",e.class||""].join(" "),tag:"div"}}t.default=c},WwUR:function(e,t,n){"use strict";n.r(t);var i=n("OcsD"),a=n("+cqQ");function r(e,t){var n,i=new Promise((function(i){n=i,setTimeout(i.bind(null,t),1e3*e)}));return{pause:function(){return i},abort:function(){n(t)}}}var o=n("cGUQ"),s=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i};function l(e,t,n){return t&&(t.im_v=3),new Promise((function(i,a){window.ajax.post(e,t,{timeout:n,onDone:function(){i.apply(null,[s(arguments)])},onFail:function(){return a.apply(null,s(arguments)),!0}})}))}var c=n("jE6c");function u(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var d={};function _(e){if(d[e])return d[e];for(var t=e?e.length:0,n=[],i=[],a="",r=0;r<t;r++){var o=e[r],s=o.charCodeAt(0);s>=48&&s<=57||"_"===o||"-"===o?a+=o:"("!==o&&")"!==o&&":"!==o&&","!==o||(""!==a&&(i.push(a),n.push("id"),a=""),i.push(o),n.push(o))}a.length>0&&(i.push(a),n.push("id"));var l=function e(t,n,i,a){if(void 0===i&&(i=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var r=[],o="";i<t.length;){var s=t[i];if("id"===s)o=n[i];else if(","===s&&o)r.push(u(o)),o="";else if("("===s){var l=e(t,n,i+1,a+1),c=l[0];i=l[1],r.push(u(o,c)),o=""}else if(")"===s)return""!==o&&r.push(u(o)),[r,i];i++}return o&&r.push(u(o)),[r,i]}(n,i)[0];return Object.keys(d).length>300&&(d={}),d[e]=l,l}function f(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:_(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?n.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(c.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(c.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(c.intval)(e["attach"+i+"_call_receiver_id"])}):n.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}var p=function(e){var t,n=e[0],i=e[1],a=e[2],r=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],_=Object.assign({},s||{},l||{});return{messageId:n,flags:i,peerId:a,date:r,attaches:f(_,n),subject:s.title||"",text:o,kludges:_,randomId:c,userId:(t=a,t>2e9?Number(_.from):a),update_time:d,chat_local_id:u}},h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function m(e){switch(e[0]){case 0:return{type:"event_delete",localId:e[1]};case 1:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_replace_flags",messageId:t,mask:n,peerId:i}}(e);case 2:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_flags",messageId:t,flags:n,peerId:i}}(e);case 3:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_flags",messageId:t,flags:n,peerId:i}}(e);case 4:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4],r=e[5],o=e[6],s=e[7],l=e[8],c=e[9],u=e[10],d=e[11];return h(h({type:"event_add_message"},p([Number(t),Number(n),Number(a),Number(r),o,s,l,c,u,d])),{minorSortId:i})}(e);case 5:return v(e);case 6:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_inbound",peerId:t,upToId:n,unread:i}}(e);case 7:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_outbound",peerId:t,upToId:n,unread:i}}(e);case 10:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 11:return function(e){var t=e[1],n=e[2];return{type:"event_replace_directories",peerId:t,mask:n}}(e);case 12:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 13:return function(e){var t=e[1],n=e[2];return{type:"event_delete_dialog",peerId:t,localId:n}}(e);case 18:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4],r=e[5],o=e[6],s=e[7],l=e[8],c=e[9],u=e[10];return h({type:"event_replace_message"},p([Number(t),Number(n),Number(i),Number(a),r,o,s,l,c,u]))}(e);case 19:return function(e){var t=e[1];return{type:"event_invalidate_event",messageId:t}}(e);case 20:return function(e){var t=e[1],n=e[2];return{type:"event_convo_major_id_changed",peerId:t,majorId:n}}(e);case 21:return function(e){var t=e[1],n=e[2];return{type:"event_convo_minor_id_changed",peerId:t,minorId:n}}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:"event_chat_changed",chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_chat_updated",peerId:n,updateType:t,updateArg:i}}(e);case 63:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_typing",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_recoding_audio",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:"event_video_call",userId:t,callId:n}}(e);case 80:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_unread_count",count:t,countNotMuted:n,showOnlyNotMuted:i}}(e);case 114:return function(e){var t=e[1]||{},n=t.peer_id,i=t.sound,a=t.disabled_until;return{type:"event_notify_settings_changed",peerId:n,sound:i,disabledUntil:a}}(e);case 115:return function(e){var t=e[1];return{type:"incoming_call",payload:t}}(e);case 116:return function(e){var t=e[1]||{},n=t.id,i=t.flags,a=t.peer_id,r=t.date,o=t.message,s=t.kludges,l=t.random_id,c=t.chat_local_id,u=t.update_time,d=t.title;return v([5,n,i,a,r,o,Object.assign({},s||{},{title:d||""}),{},l,c,u])}(e);case 117:return function(e){var t=e[1]||{},n=t.uuid,i=t.device_name;return{type:"event_audio_start",uuid:n,deviceName:void 0===i?"":i}}(e);case 119:return function(e){var t=e[1],n=t.event_id,i=t.owner_id,a=t.peer_id,r=t.action;return{type:"event_keyboard_callback_received",event_id:n,owner_id:i,peer_id:a,action:r}}(e);case-1:return{type:"event_resync"};case-2:return function(e){var t=e[1],n=e[2];return{type:"event_refresh_lp_key",key:t,url:n}}(e);case-3:return function(e){var t=e[1];return{type:"event_waiting_for_reconnect",timeout:t}}(e);case-4:return{type:"event_reconnecting"};case-5:return{type:"event_reconnected"};default:return function(e){return{type:"event_empty",params:e}}(e)}}function v(e){var t=e[1],n=e[2],i=e[3],a=e[4],r=e[5],o=e[6],s=e[7],l=e[8],c=e[9],u=e[10];return h({type:"event_edit_message"},p([Number(t),Number(n),Number(i),Number(a),r,o,s,l,c,u]))}var g=function(){return(g=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function A(e,t){e.waitAbortFns.push(t)}function b(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=function(e,t,n){void 0===n&&(n={});var i=new XMLHttpRequest;return{request:new Promise((function(a,r){var s,l=Date.now(),c=n.timeout||60,u=Object(o.toQueryString)(t);i.onreadystatechange=function(){4==i.readyState&&(window.clearInterval(s),i.status>=200&&i.status<300?a([i.responseText,i]):r([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return r([e,i])}i.send(),s=window.setInterval((function(){Date.now()-l>1e3*c&&(window.browser.safari&&i.abort(),r(["",{}]),window.clearInterval(s))}),1e3)})),cancel:function(){i.abort()}}}(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],i=t[1];return window.lpDebug&&(window.lpDebug=g(g({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,i),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=g(g({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?r(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},i=n.abort,a=n.pause;switch(t.failed){case 1:return A(e,i),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(a).then((function(){return b(e)}));case 2:return A(e,i),e.onKeyExpired(e,t).then((function(t){var n=t[0],i=t[1],a=t[2],r=t[3];return e.onResult({ts:+r,updates:[[-2,n,i+"/"+a],[-1]]})})).then(a).then((function(){return b(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function y(e){e.isStoppedFn()||b(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&w(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),w(e,-3);var n=r(e.waitTimeout,null),i=n.abort,a=n.pause;return A(e,i),a().then((function(){return w(e,-4)}))}(e,t)})).then((function(){return y(e)}))}function w(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function O(e){return e||function(){}}function S(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}function k(e,t,n){var i=0,a=e,r=[],o=!1;function s(){!r.length||i>0||o||(t(r),r=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,s())},onLp:function(e,t,i){o||(a>=e?(a=t,r.push.apply(r,i),s()):n&&(o=!0,n(a).then((function(e){var t=e[1],n=e[2];a=t,o=!1,r.push.apply(r,n),s()}))))}}}var C,E=function(){return(E=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};!function(e){e.Online="online"}(C||(C={}));var j=function(e){var t=this,n=e.getQueue,i=e.registerQueue;this.QUEUE_KEY_TTL=3e4,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var n=E({},e);t.intervalId=window.setInterval((function(){t.registerQueue(n,(function(e,i){if(function(e){return void 0!==e.err}(i))t.restart();else{n.ts=i.ts;for(var a=0,r=i.events;a<r.length;a++)for(var o=r[a],s=0,l=t.listeners;s<l.length;s++)(0,l[s])(o)}}))}),t.QUEUE_KEY_TTL)})).catch((function(){setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=i,this.getQueue=n};var T=n("ZMWW"),I=n("L9Nh"),M={onNewMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(a.default)("msgId","dialogId"),onMsgReadByOther:Object(a.default)("msgId","dialogId"),onOnlineChange:Object(a.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onConvoSortIdChanged:Object(a.default)("peerId","{ majorSortId, minorSortId }"),onTyping:Object(a.default)("dialogId","authorId"),onMultiTyping:Object(a.default)("peerId","userIds","totalCount"),onRecordingAudio:Object(a.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(a.default)("msgId"),onMsgImportantAdd:Object(a.default)("msgId"),onMsgRequestChange:Object(a.default)("peerId","type"),onMsgRemove:Object(a.default)("msgId"),onMsgListen:Object(a.default)("msgId"),onMsgRestore:Object(a.default)("msgId"),onPeerKeyboard:Object(a.default)("peerId"),onPeerBanner:Object(a.default)("peerId"),onPeerConvert:Object(a.default)("peerId","convertId"),onPeerAdmin:Object(a.default)("peerId","userId","isAdmin"),onDialogImportant:Object(a.default)("peerId","isImportant"),onDialogMarkedUnread:Object(a.default)("peerId","isMarkedUnread"),onDialogAdTag:Object(a.default)("peerId"),onDialogRemove:Object(a.default)("peerId"),onUnreadCount:Object(a.default)("count"),onIncomingCall:Object(a.default)("event"),onKeyboardCallback:Object(a.default)("eventId","peerId","ownerId","action"),onResync:Object(a.default)(),_onLpEvents:Object(a.default)("Array<Object>"),init:function(e){M._lpConnect&&(M._onLpEvents.off(),M._lpConnect.stopConnection(),M._lpQueue=null,M._lpConnect=null),M._unsubscribeEventQueue&&(M._unsubscribeEventQueue(),M._unsubscribeEventQueue=null),M._lpConfig=e},isLongPollingEnabled:function(){return!(!M._lpConnect||M._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",D),window.addEventListener("offline",D),M._unsubscribeEventQueue||M._createEventQueue(),M._lpConnect?M._lpConnect.reinitConnection():M._createLongpoll(M._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",D),window.removeEventListener("offline",D),M._lpConnect&&M._lpConnect.stopConnection(),M._unsubscribeEventQueue&&(M._unsubscribeEventQueue(),M._unsubscribeEventQueue=null)},pause:function(){clog("[longpoll] pause"),M._lpQueue&&M._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),M._lpQueue&&M._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),M._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!M._lpConnect){var t=k(e.ts,(function(e){M._onLpEvents(e)})),n=function(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||12,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&r(i.ts,e.ts,e.updates.map(m))},onData:O(t.onData),onRequestError:O(t.onRequestError),onHistoryLost:S(t.onHistoryLost),onKeyExpired:S(t.onKeyExpired),onLpBroken:S(t.onHistoryLost)},a=t.onEvents;function r(e,t,n){i.ts=t;for(var r=0;r<n.length;++r)"event_refresh_lp_key"===n[r].type&&(i.key=n[r].key||"",i.url=n[r].url||"");a(e,t,n)}var o={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",s),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",s),w(i,-4),n=!1,y(i)},abortWaiting:function(){i.waitAbortFns.forEach((function(e){return e()})),i.waitAbortFns=[],i.waitTimeout=2},onLp:r};function s(){o.abortWaiting()}return document.addEventListener("resume",s),y(i),o}(e,{onEvents:function(e,n,i){i.length?i.forEach((function(i){t.onLp(e,n,[i])})):t.onLp(e,n,[])},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),l("/mail",{act:"get_key",user_id:e.id})},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});M._lpQueue=t,M._lpConnect=n,M._onLpEvents((function(e){try{e.forEach(M._onEvent)}catch(e){console.error(e)}}))}},_onEvent:function(e){var t=e.type;switch("edu"===T.SAKIntegration.type&&T.SAKIntegration.sendMessage("longpoll",{event:e},"mvk_embedded_background"),t){case"event_replace_flags":var n=e.flags,a=e.messageId;e.peerId;8&n?M.onMsgImportantAdd(a):M.onMsgImportantRemove(a),128&n||64&n?M.onMsgRemove(a):M.onMsgRestore(a);break;case"event_set_flags":var r=e.flags,o=e.messageId,s=e.peerId;8&r&&M.onMsgImportantAdd(o),(128&r||64&r)&&M.onMsgRemove(o,s),4096&r&&M.onMsgListen(o);break;case"event_reset_flags":var l=e.flags,c=e.messageId;e.peerId;8&l&&M.onMsgImportantRemove(c),(128&l||64&l)&&M.onMsgRestore(c);break;case"event_add_message":case"event_edit_message":case"event_replace_message":var u=e.messageId,d=e.peerId,_=e.randomId,f=e.text,p=e.minorSortId,h=e.flags,m=e.attaches,v=e.kludges,g=e.date,A=Object(i.toInt)(v.from_admin)||null,b=function(e){if(2&e.flags)return M._lpConfig.id;return e.userId}(e),y=!!v.source_act,w="event_edit_message"===t||"event_replace_message"===t,O=2&h,S=!!(65536&h),k={peerId:d,id:u,authorId:b,attaches:m,text:f,ts:g,flags:h,adminId:A,randomId:_,isService:w?void 0:y,edited:!!w||void 0,replaced:"event_replace_message"===t,keyboard:v.keyboard,isStealth:S,isOut:O,hasReply:function(e,t){t&1<<21&&function(e){e.fwd_count}(e)}(v,h),ttl:v.ttl||v.expire_ttl&&parseInt(v.expire_ttl)||null,isExpired:v.is_expired};w?M.onEditMsg(k):M.onNewMsg(k,p);break;case"event_read_inbound":case"event_read_outbound":var C=e.peerId,E=e.upToId;e.unread;"event_read_inbound"===t?M.onMsgReadByMe(E,C):M.onMsgReadByOther(E,C);break;case"event_reset_directories":case"event_set_directories":var j=e.mask,I=e.peerId;e.local;1&j?M.onDialogImportant(I,"event_set_directories"===t):32768&j?M.onDialogAdTag(I):j&1<<20&&M.onDialogMarkedUnread(I,"event_set_directories"===t);break;case"event_replace_directories":var D=e.mask,P=e.peerId;e.local;M.onDialogImportant(P,!!(1&D));break;case"event_delete_dialog":var x=e.peerId;M.onDialogRemove(x);break;case"event_convo_major_id_changed":var L=e.peerId,B=e.majorId;M.onConvoSortIdChanged(L,{majorSortId:B});break;case"event_convo_minor_id_changed":var R=e.peerId,N=e.minorId;M.onConvoSortIdChanged(R,{minorSortId:N});break;case"event_chat_updated":var F=e.peerId,H=e.updateType,U=e.updateArg;if(11===H&&M.onPeerKeyboard(F),10===H&&M.onPeerBanner(F),13===H&&M.onPeerConvert(U,F),12===H){var V="";switch(U){case 3:V="created";break;case 2:V="rejected";break;case 1:V="accepted";break;case 0:V="canceled"}M.onMsgRequestChange(F,V)}3===H&&M.onPeerAdmin(F,U,!0),9===H&&M.onPeerAdmin(F,U,!1);break;case"event_typing":var $=e.peerId,W=e.userIds,q=e.totalCount;e.ts;M.onMultiTyping($,W,q);break;case"event_recoding_audio":var z=e.peerId,Y=e.userIds,Q=e.totalCount;e.ts;M.onRecordingAudio(z,Y,Q);break;case"event_video_call":break;case"event_unread_count":var G=e.count,K=e.countNotMuted,X=e.showOnlyNotMuted;M.onUnreadCount(X?K:G);break;case"event_notify_settings_changed":break;case"incoming_call":M.onIncomingCall(e);break;case"event_keyboard_callback_received":var J=e.owner_id,Z=e.peer_id,ee=e.event_id,te=e.action;M.onKeyboardCallback(ee,Z,J,te);break;case"event_resync":M.onResync()}},_createEventQueue:function(){if(!M._unsubscribeEventQueue){var e=new j({getQueue:function(){return l("/mail",{act:"queue_params"}).then((function(e){return e[0]}))},registerQueue:function(e,t){I.QueueManager.addQueue(e,t),I.QueueManager.start()}});M._unsubscribeEventQueue=e.subscribe(M._onEventQueueEvent)}},_onEventQueueEvent:function(e){switch(e.entity_type){case C.Online:M.onOnlineChange({userId:e.data.user_id,isOnline:e.data.online,onlinePlatform:[1,2,3,4,5].includes(e.data.platform)?"mobile":"desktop",lastActionTime:e.data.last_seen})}}};t.default=M;function D(e){"online"===e.type?(clog("[longpoll] online"),M._lpConnect.reinitConnection()):(clog("[longpoll] offline"),M._lpConnect.stopConnection())}},XCiN:function(e,t,n){"use strict";n.r(t);var i=n("izth");window.isBootstrapInited||(window.cur={destroy:[]},window.lang={},Object(i.setDocumentDomain)(),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.isBootstrapInited=!0)},XLP4:function(e,t){window.FeedAssistanceImportContacts={importContacts:function(e,t,i){if(!window.XMLHttpRequest||i)return;var a=domData(e,"service-id");return window.open(t),n[a]=e,!1}};var n={},i="feedAssistanceImportContacts__desc",a=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement((function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(a=!0)})),Friends.onImportSuccess((function(){var e=arguments[0],t=arguments[2],r=n[e];if(r){var o=geByClass1(i,r);o.textContent=getLang("mobile_join_friends_found_count",t)}a&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,r,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})})),Friends.onImportFailed((function(e){var t=n[e];t&&(geByClass1(i,t).textContent=getLang("mobile_friends_import_error"))}))},Y6JH:function(e,t,n){"use strict";n.r(t);var i=n("fdw3");var a=function(e,t){var n,a;if(void 0===t&&(t=""),t){var r=Object(i.inlineIconResolver)(t);r&&(n=r.icon,a=r.name)}else Object(i.isObject)(e)&&(n=e.icon,a=e.name,Object(i.isObject)(e.icon)&&(n=e.icon.icon,a=e.icon.name));return{inner:[Wd.wrap(n)],"aria-hidden":"true",class:"svgIcon svgIcon-"+a,tag:"div"}};t.default=a;window.SVGIcon=a},YS7c:function(e,t,n){"use strict";(function(t){var i=n("8/JR"),a=n("PzH3"),r=n("n6yW"),o=document,s=o.documentElement;function l(e,n,i,r){t.navigator.pointerEnabled?a[n](e,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[i],r):t.navigator.msPointerEnabled?a[n](e,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[i],r):(a[n](e,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[i],r),a[n](e,i,r))}function c(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function u(e){var t=e.getBoundingClientRect();return{left:t.left+d("scrollLeft","pageXOffset"),top:t.top+d("scrollTop","pageYOffset")}}function d(e,n){return void 0!==t[n]?t[n]:s.clientHeight?s[e]:o.body[e]}function _(e,t,n){var i,a=(e=e||{}).className||"";return e.className+=" gu-hide",i=o.elementFromPoint(t,n),e.className=a,i}function f(){return!1}function p(){return!0}function h(e){return e.width||e.right-e.left}function m(e){return e.height||e.bottom-e.top}function v(e){return e.parentNode===o?null:e.parentNode}function g(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||function e(t){if(!t)return!1;if("false"===t.contentEditable)return!1;if("true"===t.contentEditable)return!0;return e(v(t))}(e)}function A(e){return e.nextElementSibling||function(){var t=e;do{t=t.nextSibling}while(t&&1!==t.nodeType);return t}()}function b(e,t){var n=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(t),i={pageX:"clientX",pageY:"clientY"};return e in i&&!(e in n)&&i[e]in n&&(e=i[e]),n[e]}e.exports=function(e,t){var n,d,y,w,O,S,k,C,E,j,T,I=arguments.length;1===I&&!1===Array.isArray(e)&&(t=e,e=[]);var M,D=null,P=t||{};void 0===P.moves&&(P.moves=p),void 0===P.accepts&&(P.accepts=p),void 0===P.invalid&&(P.invalid=Y),void 0===P.containers&&(P.containers=e||[]),void 0===P.isContainer&&(P.isContainer=f),void 0===P.copy&&(P.copy=!1),void 0===P.copySortSource&&(P.copySortSource=!1),void 0===P.revertOnSpill&&(P.revertOnSpill=!1),void 0===P.removeOnSpill&&(P.removeOnSpill=!1),void 0===P.direction&&(P.direction="vertical"),void 0===P.ignoreInputTextSelection&&(P.ignoreInputTextSelection=!0),void 0===P.mirrorContainer&&(P.mirrorContainer=o.body);var x=i({containers:P.containers,start:q,end:Q,cancel:Z,remove:J,destroy:F,canMove:W,dragging:!1});return!0===P.removeOnSpill&&x.on("over",ae).on("out",re),B(),x;function L(e){return-1!==x.containers.indexOf(e)||P.isContainer(e)}function B(e){var t=e?"remove":"add";l(s,t,"mousedown",U),l(s,t,"mouseup",K)}function R(e){l(s,e?"remove":"add","mousemove",V)}function N(e){var t=e?"remove":"add";a[t](s,"selectstart",H),a[t](s,"click",H)}function F(){B(!0),K({})}function H(e){M&&e.preventDefault()}function U(e){if(S=e.clientX,k=e.clientY,!(1!==c(e)||e.metaKey||e.ctrlKey)){var t=e.target,n=$(t);n&&(M=n,R(),"mousedown"===e.type&&(g(t)?t.focus():e.preventDefault()))}}function V(e){if(M)if(0!==c(e)){if(!(void 0!==e.clientX&&Math.abs(e.clientX-S)<=(P.slideFactorX||0)&&void 0!==e.clientY&&Math.abs(e.clientY-k)<=(P.slideFactorY||0))){if(P.ignoreInputTextSelection){var t=b("clientX",e)||0,n=b("clientY",e)||0;if(g(o.elementFromPoint(t,n)))return}var i=M;R(!0),N(),Q(),z(i);var a=u(y);w=b("pageX",e)-a.left,O=b("pageY",e)-a.top,r.add(j||y,"gu-transit"),oe(),ie(e)}}else K({})}function $(e){if(!(x.dragging&&n||L(e))){for(var t=e;v(e)&&!1===L(v(e));){if(P.invalid(e,t))return;if(!(e=v(e)))return}var i=v(e);if(i)if(!P.invalid(e,t))if(P.moves(e,i,t,A(e)))return{item:e,source:i}}}function W(e){return!!$(e)}function q(e){var t=$(e);t&&z(t)}function z(e){ue(e.item,e.source)&&(j=e.item.cloneNode(!0),x.emit("cloned",j,e.item,"copy")),d=e.source,y=e.item,C=E=A(e.item),x.dragging=!0,x.emit("drag",y,d)}function Y(){return!1}function Q(){if(x.dragging){var e=j||y;X(e,v(e))}}function G(){M=!1,R(!0),N(!0)}function K(e){if(G(),x.dragging){var t=j||y,i=b("clientX",e)||0,a=b("clientY",e)||0,r=ne(_(n,i,a),i,a);r&&(j&&P.copySortSource||!j||r!==d)?X(t,r):P.removeOnSpill?J():Z()}}function X(e,t){var n=v(e);j&&P.copySortSource&&t===d&&n.removeChild(y),te(t)?x.emit("cancel",e,d,d):x.emit("drop",e,t,d,E),ee()}function J(){if(x.dragging){var e=j||y,t=v(e);t&&t.removeChild(e),x.emit(j?"cancel":"remove",e,t,d),ee()}}function Z(e){if(x.dragging){var t=arguments.length>0?e:P.revertOnSpill,n=j||y,i=v(n),a=te(i);!1===a&&t&&(j?i&&i.removeChild(j):d.insertBefore(n,C)),a||t?x.emit("cancel",n,d,d):x.emit("drop",n,i,d,E),ee()}}function ee(){var e=j||y;G(),se(),e&&r.rm(e,"gu-transit"),T&&clearTimeout(T),x.dragging=!1,D&&x.emit("out",e,D,d),x.emit("dragend",e),d=y=j=C=E=T=D=null}function te(e,t){var i;return i=void 0!==t?t:n?E:A(j||y),e===d&&i===C}function ne(e,t,n){for(var i=e;i&&!a();)i=v(i);return i;function a(){if(!1===L(i))return!1;var a=le(i,e),r=ce(i,a,t,n);return!!te(i,r)||P.accepts(y,i,d,r)}}function ie(e){if(n){e.preventDefault();var t=b("clientX",e)||0,i=b("clientY",e)||0,a=t-w,r=i-O;n.style.left=a+"px",n.style.top=r+"px";var o=j||y,s=_(n,t,i),l=ne(s,t,i),c=null!==l&&l!==D;(c||null===l)&&(D&&h("out"),D=l,c&&h("over"));var u=v(o);if(l!==d||!j||P.copySortSource){var f,p=le(l,s);if(null!==p)f=ce(l,p,t,i);else{if(!0!==P.revertOnSpill||j)return void(j&&u&&u.removeChild(o));f=C,l=d}(null===f&&c||f!==o&&f!==A(o))&&(E=f,l.insertBefore(o,f),x.emit("shadow",o,l,d))}else u&&u.removeChild(o)}function h(e){x.emit(e,o,D,d)}}function ae(e){r.rm(e,"gu-hide")}function re(e){x.dragging&&r.add(e,"gu-hide")}function oe(){if(!n){var e=y.getBoundingClientRect();(n=y.cloneNode(!0)).style.width=h(e)+"px",n.style.height=m(e)+"px",r.rm(n,"gu-transit"),r.add(n,"gu-mirror"),P.mirrorContainer.appendChild(n),l(s,"add","mousemove",ie),r.add(P.mirrorContainer,"gu-unselectable"),x.emit("cloned",n,y,"mirror")}}function se(){n&&(r.rm(P.mirrorContainer,"gu-unselectable"),l(s,"remove","mousemove",ie),v(n).removeChild(n),n=null)}function le(e,t){for(var n=t;n!==e&&v(n)!==e;)n=v(n);return n===s?null:n}function ce(e,t,n,i){var a="horizontal"===P.direction;return t!==e?function(){var e=t.getBoundingClientRect();if(a)return r(n>e.left+h(e)/2);return r(i>e.top+m(e)/2)}():function(){var t,r,o,s=e.children.length;for(t=0;t<s;t++){if(r=e.children[t],o=r.getBoundingClientRect(),a&&o.left+o.width/2>n)return r;if(!a&&o.top+o.height/2>i)return r}return null}();function r(e){return e?A(t):t}}function ue(e,t){return"boolean"==typeof P.copy?P.copy:P.copy(e,t)}}}).call(this,n("yLpj"))},"YU/R":function(e,t,n){"use strict";n.r(t),n.d(t,"ContextMenu",(function(){return r})),n.d(t,"ContextMenuItem",(function(){return o}));var i=n("OcsD"),a=n("wTbK");function r(e){return Object(a.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[e.list?{tag:"ul",class:"ContextMenu__list",inner:e.withoutWrap?e.list:Wd.wrap(e.list)}:null]})}function o(e){return{inner:[{inner:[e.title],"data-ref":e.ref,href:e.href,target:e.target,class:"ContextMenu__listLink",onclick:e.onclick,tag:"a"}],class:"ContextMenu__listItem","data-name":e.name,tag:"li"}}var s=n("t7Ww"),l=n("UxAg"),c={open:function(e,t,n){void 0===n&&(n={});var i=e.closest(t),a=Object(l.$)(d,i);if(a)return a=s.default.open(a,n.appendToBody,"",{withoutPopupCloning:n.withoutPopupCloning}),u=function(){f(a)},nav.onBeforeGo(u),a;return!1},close:f},u=function(){},d=".ContextMenu",_=".ContextMenu.Popup_open";function f(e){return e||(e=Object(l.$)(".Popup_open.ContextMenu")||Object(l.$)(_)),e&&s.default.close(e),nav.onBeforeGo.off(u),!1}Object(i.extend)(r,c);t.default=r;window.ContextMenu=r},Ys8N:function(e,t,n){"use strict";(function(t){var n=[],i="",a=/^on/;for(i in t)a.test(i)&&n.push(i.slice(2));e.exports=n}).call(this,n("yLpj"))},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},ZD4m:function(e,t,n){"use strict";function i(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}function a(){var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function r(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n&&i?{width:n,height:i}:{width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"getElementOffset",(function(){return i})),n.d(t,"getViewportSize",(function(){return a})),n.d(t,"getElementSize",(function(){return r})),n.d(t,"getJsonDataValue",(function(){return o})),n.d(t,"setGlobalCustomProperty",(function(){return s}));var o=function(e,t){var n=e.getAttribute(t);if(n)try{return JSON.parse(n)}catch(e){return}},s=function(e,t){document.documentElement.style.setProperty(e,t)}},ZMWW:function(e,t,n){"use strict";n.r(t),n.d(t,"SAKIntegration",(function(){return a}));var i=n("Bm7g"),a={isIntegrated:!1,origin:"",name:"",type:"",onMessage:new(n("uQjJ").default),init:function(e){if(a.isIntegrated=!0,a.origin=function(e){var t=e.origin;if(!t)try{t=sessionStorage.getItem("_sak_embed_origin")}catch(e){}if(t)try{sessionStorage.setItem("_sak_embed_origin",t)}catch(e){}return t||""}(e),a.type=e.type,a.isNewMail=e.isNewMail,a.origin||window.parent!==window){var t=e.name||(a.isNewMail?"mvk_embedded_mail":"mvk_embedded_other");document.documentElement.style.setProperty("display","none","important"),a.name=t,a.embedded=new i.Embedded({name:t,target:window.parent,origin:a.origin,onMessage:function(e,t){a.onMessage.emit("embed",e,t),"click"===e&&a.doClick(t.selector)}}),a._ready=a.embedded.sendMessage("ready",{}).then((function(){document.documentElement.classList.remove("vk_sak_embed_hidden"),document.documentElement.style.removeProperty("display")}))}else document.documentElement.classList.remove("vk_sak_embed_hidden")},sendMessage:function(e,t,n){if(void 0===n&&(n=""),a.isIntegrated)if(a._ready){if(!n||!a.name||a.name===n)return a._ready.then((function(){return a.embedded.sendMessage(e,t)}))}else console.error("SAKIntegration not ready")},doClick:function(e){if(e){var t=document.querySelector(e);t&&t.click()}}}},a0wW:function(e,t,n){"use strict";n.r(t),n.d(t,"FLAG_MP4",(function(){return o})),n.d(t,"FLAG_GIF_AUTOPLAY",(function(){return s})),n.d(t,"FLAG_SUPPORTS_HISTORY_API",(function(){return l}));var i=n("jk6M"),a=n("J8bf"),r={},o=0,s=1,l=2,c=function(){function e(){}return e.getFeatures=function(){return r},e.detectMp4Support=function(){var e=i.default.meizu||i.default.mi||i.default.uc_mini||0!==i.default.ios&&i.default.ios<10||i.default.chrome&&i.default.version.split(".")[0]<53,t=!1,n=document.createElement("video");return n.canPlayType&&""!==n.canPlayType("video/mp4")&&(t=!0),r.mp4=t,this.setFlag(o,t&&!e),t},e.detectAutoplay=function(){var e=this;return new Promise((function(t){if(r.autoplay)t(!0);else{if(i.default.ios&&i.default.safari_mobile&&parseInt(i.default.version,10)>=10)return r.autoplay=!0,void t(!0);r.autoplay=!1;var n=ce("video"),a=ce("source");a.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var o=ce("source");o.src="data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",append(o,n),append(a,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),append(n,document.body);var s=ge("base64testvideo");if(i.default.mobile&&i.default.ios&&i.default.ios<10)return r.autoplay=!1,remove(n),t(!1),void clearTimeout(e.autoDetectTimeout);if(!i.default.safari_mobile||i.default.safari_mobile&&parseInt(i.default.version,10)>=10){var l=n.play();void 0!==l&&l.then((function(){r.autoplay=!0,remove(n),t(!0),clearTimeout(e.autoDetectTimeout)})).catch((function(i){r.autoplay=!1,remove(n),t(!1),clearTimeout(e.autoDetectTimeout)}))}s.onplay=function(){r.autoplay=!0,remove(n),t(!0),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout((function(){s.paused||(r.autoplay=!0),remove(n),t(r.autoplay)}),250)}}))},e.getFlags=function(){return(Object(a.getCookie)("remixff")||"").split("").map((function(e){return+e?"1":"0"})).join("")},e.getFlag=function(e){var t=this.getFlags();return!!toInt(t[e])},e.setFlag=function(e,t){void 0===t&&(t=!1);var n=(Object(a.getCookie)("remixff")||"").split("");e>=n.length&&(n=Array.from(Array(e),(function(e,t){return n[t]||"0"}))),n[e]=t?"1":"0";var i=n.join("");Object(a.setCookie)("remixff",i,10)},e}();onDOMReady((function(){c.detectMp4Support()})),t.default=c},aJgW:function(e,t,n){"use strict";n.r(t),n.d(t,"ColorSchemeMode",(function(){return i})),n.d(t,"ColorSchemeName",(function(){return a})),n.d(t,"ColorScheme",(function(){return s})),n.d(t,"colorScheme",(function(){return o}));var i,a,r=n("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(i||(i={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(a||(a={}));var o,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var n=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){n.currentMode===i.Auto&&n.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?a.Dark:a.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(r.setCookie)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var n=!1;switch(t){case i.Light:n=!1;break;case i.Dark:n=!0;break;case i.Auto:if(e.isSchemesAutoSwitchingSupported())n=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(n),this.isModeSavingAllowed&&Object(r.setCookie)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var n,i=(null===(n=this.schemesMap)||void 0===n?void 0:n[t])||t;e.setAttribute("scheme",i)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();o=window.colorScheme?window.colorScheme:new s,window.colorScheme=o,window.isSchemesSupported=s.isSchemesSupported.bind(null)},"aiw/":function(e,t,n){"use strict";n.r(t),n.d(t,"onOpen",(function(){return q})),n.d(t,"onClose",(function(){return z})),n.d(t,"isKeyboardOpen",(function(){return Y})),n.d(t,"onCloseCallback",(function(){return Q})),n.d(t,"offCloseCallback",(function(){return G})),n.d(t,"onOpenCallback",(function(){return K})),n.d(t,"offOpenCallback",(function(){return X}));var i=0,a=0,r=null,o=null;function s(){var e=pageYOffset;e!==i&&999999!==e&&(i=e,a=Math.max(a,e),scrollTo(0,999999)),clearTimeout(o),o=setTimeout((function(){o=null,window.removeEventListener("scroll",s),scrollTo(0,999999),setTimeout((function(){return scrollTo(0,999999)}),1e3)}),150)}var l,c,u,d,_,f,p,h,m,v=n("H5mD"),g=0,A=0,b="",y=!1,w={},O=0;function S(e){if(b=e,y=!1,l=!1,u=0,d=0,f=0,p=0,w={},void 0,h="start",m=0,O=0,v.isIPhone)if("top"===b||"bottom"===b){I()<v.IPHONE_KEYBOARD_REJECT_OFFSET&&M(0);var t=document.body;_=t.offsetHeight,t.offsetWidth,window.addEventListener("scroll",C),"top"===b&&Object(v.isLandscapePhone)()||(j(),E())}else document.body.classList.add("ScrollViewsDisabled")}function k(){"top"===b||"bottom"===b?(c&&clearTimeout(c),window.removeEventListener("scroll",C)):document.body.classList.remove("ScrollViewsDisabled"),y=!1,b="",l=!1,_=0,0}function C(){if(j(),"top"!==b){if("bottom"===b){var e=pageYOffset,t=I();l&&(l=!1,e===f)||(v.isWKWebView?p<=5&&E():e>v.IPHONE_KEYBOARD_REJECT_OFFSET?e>t?(M(e),v.isWKWebView||E()):e<t?w[e]||e>T(t)?(w[e]=!0,E(_)):E():e!==T(t)&&E():t||(e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?(u===e?d++:(u=e,d=1),d>=3&&(window.removeEventListener("scroll",C),M(u)),setTimeout((function(){E()}),300)):E()))}}else{if(Object(v.isLandscapePhone)())return;if(v.isWKWebView)return void(0!==pageYOffset&&E(0));var n=innerHeight;if("start"===h&&(n<_?h="animate":E(1)),"animate"===h)if(m=_-n,O||(O=Math.max(1,Math.min(4,Math.floor(m/10)))),m<=0)h="stop";else{var i=v.isIPad?v.iosMajor<11?3:2:1;E(Math.min(m,O)*i)}"stop"===h&&E(1)}}function E(e){l=!0;var t,n=I();"bottom"===b?t=e||(!n||v.isWKWebView||v.isIPad?_:T(n)):"top"===b&&(t=isFinite(e)?e:1),p++,f=t,window.scrollTo(0,t)}function j(){c&&clearTimeout(c),y||(c=setTimeout((function(){y=!0,c=null,window.removeEventListener("scroll",C)}),500))}function T(e){return v.isIPad||v.isWKWebView||90===Math.abs(window.orientation)&&screen.width>=375||(v.isIPhoneX?e-=v.IPHONE_X_SAFARI_BOTTOM_BAR:e-=v.IPHONE_SAFARI_BOTTOM_BAR),e}function I(){return 90===Math.abs(window.orientation)?g:A}function M(e){90===Math.abs(window.orientation)?g=e:A=e}var D=null,P=0,x=0;function L(){if(!(visualViewport.height>=P)){var e=P-visualViewport.height;x!==e&&(!v.isWKWebView&&e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?scrollTo(0,0):scrollTo(0,e))}}var B=!1,R=!1,N=!1,F=null,H=[],U=[],V=null,$=v.isScrollBasedViewport&&(v.isIPad||v.isWKWebView),W=v.isScrollBasedViewport&&v.iosMajor<=12;function q(e,t){void 0===e&&(e="default");var n=(void 0===t?{}:t).exitIfStarted,l=void 0!==n&&n;if(v.isIOS&&!(v.iosMajor<8)&&!(R&&l||B)){if(V=e,R=!0,F&&(clearTimeout(F),F=null),"bottom"===e){if((Object(v.isLandscapePhone)()||!$&&!W)&&!function(){if(D||(D={onceBlocked:!1}),D.onceBlocked&&(D.opened=!0),!D.onceBlocked&&!D.opened){D.onceBlocked=!0;var e=document.activeElement;return e.blur(),e.focus(),!1}return D.opened=!0,window.visualViewport&&(P=visualViewport.height,x=0,setTimeout(L),visualViewport.addEventListener("scroll",L),visualViewport.addEventListener("resize",L)),!0}())return;!$&&W&&S(e),$&&function(e){void 0===e&&(e="default"),r&&(clearTimeout(r),r=null),o&&(clearTimeout(o),o=null),i=0,0,0,a=0,window.addEventListener("scroll",s),setTimeout((function(){scrollTo(0,999999)}),10),setTimeout((function(){scrollTo(0,999999)}),100),setTimeout((function(){scrollTo(0,999999)}),200),setTimeout((function(){scrollTo(0,999999)}),300),setTimeout((function(){scrollTo(0,999999)}),400),setTimeout((function(){scrollTo(0,999999)}),500)}()}else!$&&W&&S(e);U.length&&U.forEach((function(e){return e()})),B=!0,R=!1}}function z(e){var t=(void 0===e?{}:e).exitIfStarted,n=void 0!==t&&t;if(v.isIOS&&!(v.iosMajor<8)&&(!N||!n)){if(N=!0,"bottom"===V){if((Object(v.isLandscapePhone)()||!$&&!W)&&(!D||D.onceBlocked&&!D.opened||(window.visualViewport&&(setTimeout(L),visualViewport.removeEventListener("scroll",L),visualViewport.removeEventListener("resize",L)),D=null,P=0,x=0,0)))return;if(!B)return;!$&&W&&k(),$&&(clearTimeout(r),clearTimeout(o),i=0,0,0,r=null,o=null,window.removeEventListener("scroll",s))}else!$&&W&&k();B=!1,N=!1,V=null,F&&clearTimeout(F),F=setTimeout((function(){scrollTo(0,0),H.length&&H.forEach((function(e){return e()}))}),10)}}function Y(){return B}function Q(e){-1===H.indexOf(e)&&H.push(e)}function G(e){var t=H.indexOf(e);-1!==t&&H.splice(t,1)}function K(e){-1===U.indexOf(e)&&U.push(e)}function X(e){var t=U.indexOf(e);-1!==t&&U.splice(t,1)}},b6Sp:function(e,t,n){"use strict";function i(e,t){var n=t;return e&&(n=[e]).push(t),n}function a(e){var t=e.elements,n={};return Array.from(t).forEach((function(e){if(e.name)switch(e.type){case"submit":break;case"radio":e.checked&&(n[e.name]=e.value);break;case"checkbox":e.checked&&(n[e.name]=i(n[e.name],e.value));break;default:n[e.name]=i(n[e.name],e.value)}})),n}n.r(t),n.d(t,"getFormValues",(function(){return a}))},bBst:function(e,t,n){(function(t){var n=t.CustomEvent;e.exports=function(){try{var e=new n("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?n:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}).call(this,n("yLpj"))},bKAG:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_STORY_VIDEO_DURATION",(function(){return c})),n.d(t,"StoryType",(function(){return i})),n.d(t,"StoryEntryPoint",(function(){return a})),n.d(t,"StorySource",(function(){return r})),n.d(t,"getStoryUploadUrl",(function(){return u})),n.d(t,"uploadStoryBlobToServer",(function(){return d})),n.d(t,"saveStoryOnServer",(function(){return _}));var i,a,r,o=n("jE6c"),s=n("PU8N"),l=function(){return(l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=16;function u(e){return new Promise((function(t,n){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",l({act:"get_upload_url"},e),{onDone:t,onError:n,onFail:n})}))}function d(e,t){var n=new FormData,i=encodeURIComponent("edited_"+Object(o.irand)(0,99999)+".jpg");return n.append("file0",e,i),fetch(t,{method:"POST",body:n}).then((function(e){return e.json()}))}function _(e,t){return new Promise((function(n,i){window.ajax.post(Object(s.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:n,onError:i,onFail:i})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(a||(a={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(r||(r={}))},bRFj:function(e,t){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(e,t,i,a,r,o,s,l){void 0===i&&(i="");void 0===a&&(a=null);void 0===r&&(r="");void 0===o&&(o="");void 0===s&&(s=null);void 0===l&&(l=null);n("accept",e,t,i,a,r,o,s,l)},decline:function(e,t,i,a,r,o,s,l){void 0===i&&(i="");void 0===a&&(a=null);void 0===r&&(r="");void 0===o&&(o="");void 0===s&&(s=null);void 0===l&&(l=null);n("decline",e,t,i,a,r,o,s,l)},makeImportRequest:function(e,t,n){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},(function(e){return function(e,t,n){var a=parseJSON(e),r=a.user,o=a.user_hash,s=a.contacts,l="/friends.php?act=save_contacts&type="+n;if(a.error)return void i(n);ajax.post(l,{_ajax:1,user:r,userhash:o,hash:t,contacts:s},{onDone:function(e,t){return function(e,t,n){var i=geByClass1("friendsImport__loading"),a=geByClass1("friendsImport__result");addClass("friendsImport__loading_hidden",i),a&&(a.innerHTML=t,addClass("friendsImport__result_shown",a));autoScroll((function(){return geByClass1("friendsList__footerBtn_showMore")}),ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,n),window.opener&&window.opener.Friends.onImportSuccess(e,t,n)}(n,e,t)},onFail:function(){return i(n)}})}(e,t,n)}),(function(){return i(n)}),!0)}};function n(e,t,n,i,a,r,o,s,l){var c={act:e,hash:n,id:t};i&&(c.from=i),a&&(c.block_id=a),r&&(c.ref=r),o&&(c.track_code=o);var u="/friends"+obj2qs(c);ajax.post(u,{_ajax:1},{onDone:s,onFail:l})}function i(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},"bZ/P":function(e,t,n){"use strict";n.r(t);var i={};function a(e,t){return e+'="'+t+'"'}function r(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(e,o(n))}}function o(e){return e[0]+"("+e.slice(1).map(s).join(", ")+")"}function s(e){return"number"==typeof e||"event"===e||"this"===e?e:JSON.stringify(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e,t){var n,i=[];"string"==typeof t&&((n={})[t]=!0,t=n);return Object.keys(t).forEach((function(n){var a=t[n];!0===a?i.push(e+"_"+n):a&&i.push(e+"_"+n+"_"+a)})),i}Object.assign(i,{html:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a="";return e.forEach((function(e,t){var i=n[t];a+=e+(i||0===i?i:"")})),a}}),Object.assign(i,{attr:a,onBlur:r("onblur"),onClick:r("onclick"),onFocus:r("onfocus"),onInput:r("oninput"),onKeyDown:r("onkeydown"),onKeyPress:r("onkeypress"),onKeyUp:r("onkeyup"),onMouseDown:r("onmousedown"),onMouseUp:r("onmouseup"),onScroll:r("onscroll"),onSubmit:r("onsubmit"),onTouchEnd:r("ontouchend"),onTouchMove:r("ontouchmove"),onTouchStart:r("ontouchstart"),onWheel:r("onwheel"),onChange:r("onchange")}),Object.assign(i,{list:function(e,t){void 0===t&&(t=null);Array.isArray(e)||(e=[e]);return t?e.map(t).join(""):e.join("")}}),Object.assign(i,{class:function(){for(var e=[],t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){"string"==typeof n?(e.push(n),t=n):n&&(e=e.concat(l(t,n)))})),e.join(" ")},parseClass:function(e,t){var n={};return t.trim().split(/\s+/).forEach((function(t){if(t!==e){var i=t.replace(e+"_","").split("_");n[i[0]]=!(i.length>1)||i[1]}})),n}});t.default=i;window.q=i},cGUQ:function(e,t,n){"use strict";n.r(t),n.d(t,"fromQueryString",(function(){return l})),n.d(t,"toQueryString",(function(){return s}));var i=n("jE6c"),a={},r=function(e){if(a[e])return e;try{return encodeURIComponent(e)}catch(e){return""}},o=function(e){try{return decodeURIComponent(e)}catch(t){return a[e]=1,e}};function s(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)&&null!=e[a]&&!Object(i.isFunction)(e[a]))if(Object(i.isArray)(e[a]))for(var o=0,s=0,l=e[a].length;o<l;++o)null==e[a][o]||Object(i.isFunction)(e[a][o])||(n.push(r(a)+"["+s+"]="+r(e[a][o])),++s);else n.push(r(a)+"="+r(e[a]));return t||n.sort(),n.join("&")}function l(e){if(!e)return{};var t={};return e=e.split("&"),Object(i.each)(e,(function(e,n){var i=n.split("=");if(i[0]){var a=o(i[1]+"");if("[]"===i[0].substr(i.length-2)){var r=o(i[0].substr(0,i.length-2));t[r]||(t[r]=[]),t[r].push(a)}else t[o(i[0])]=a}})),t}},cLcH:function(e,t){function n(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,n,i,a,r){var s=hasClass(e,"post__subscribeBtn_unsubscribe"),l=s?i:n,c=s?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),u=!s,d=geByClass1("post__subscribeBtnIcon",e),_=(f=e,p=domCA(f,".post_exploreBait"),intval(domData(p,"block-id")));var f,p;d&&(toggleClass("post__subscribeBtnIcon_unsubscribe",d,u),toggleClass("post__subscribeBtnIcon_subscribe",d,!u));attr(e,"aria-label",escapeAttr(c)),toggleClass("post__subscribeBtn_unsubscribe",e,u),"group"===a?function(e,t,n,i){var a=n?Groups.leave:Groups.enter,r=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;i&&o(r),a.call(Groups,e,t,"feed")}(t,l,s,r):function(e,t,n,i,a){var r=n?Friends.decline:Friends.accept,s=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&o(s),r.call(Friends,e,t,"feed",i)}(t,l,s,_,r);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(e._exploreBaitClickHandlerAdded)return;a=!0,addEvent(e,"click",(function(e){!function(e){for(var t,i=e.target,a=n(s);!(t=a()).done;){if(!0===t.value.call(null,i))return}}(e)})),e._exploreBaitClickHandlerAdded=!0}})),nav.onBeforeGo((function(e){if(!a)return void(r=!1);if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;r=hasClass("item_replies",e),function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){if(hasClass(n[t],e))return o(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)})),window.page&&page.onChange((function(){if(!a)return;r&&function(){var e=ge("nc_submit");addEvent(e,"click",(function(){o(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_COMMENT)}))}()}));var a=!1,r=!1;function o(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var s=[function(e){if("A"!==e.tagName||!hasClass("item_sel",e))return hasClass("item_like",e)||(hasClass("i_like",e)||hasClass("v_like",e))&&!hasClass("item_sel",domPN(e))?(o(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):void 0},function(e){if(domData(e,"post-owner-type"))return o("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return o(t),!0}]},cZev:function(e,t,n){"use strict";n.r(t);var i=n("Xrg9"),a=n("J8bf"),r=n("kr3z"),o=n("fdw3"),s=n("+cqQ"),l=n("UxAg"),c=n("zvhO"),u=n("OcsD"),d=n("W9Tc"),_=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i},f=function(){function e(){}return e.saveStickerPanel=function(e,t){i.default.set("sticker_panel",e),t&&Object(a.setCookie)("remixstickers_hash",t),window.cur.sticker_panel=e},e.getStickerPanel=function(e){if(void 0===e&&(e=""),e||(e=Object(o.getState)("target")||""),!Object(d.partConfigEnabled)("mvk_stickers_panel_optimize"))return cur.sticker_panel&&cur.sticker_panel.replace(/mail0/g,e);var t=i.default.get("sticker_panel")||window.cur.sticker_panel;return t?e?t.replace(/mail0/g,e):t:""},e.saveStickers=function(t){e.stickers=t,i.default.set("stickers",t)},e.setStickerTab=function(e,t){return void 0===t&&(t=[]),Object(d.partConfigEnabled)("mvk_stickers_panel_optimize")?(this.getStickers(),this.stickers[e]||(this.stickers[e]=[]),t&&(this.stickers[e]=t),this.saveStickers(this.stickers),this.stickers[e]):cur.stickers&&cur.stickers[e]},e.getStickers=function(){if(!Object(d.partConfigEnabled)("mvk_stickers_panel_optimize"))return cur.stickers;if(this.stickers)return this.stickers;var t=i.default.get("stickers");return!t&&cur.stickers&&(t=cur.stickers,this.saveStickers(t)),e.stickers||(e.stickers=t),e.stickers},e.setNewStickersCount=function(t,n){var i=n||e.getStickerPanel();if(!Object(c.isNumber)(t))return n;var a=ce("div");a.innerHTML=i;var r=Object(l.$)(".sp_badge",a),o=window.devicePixelRatio>=1.5?"_2x":"";return Object(u.setStyle)(r,{"background-image":t>0?"url(/images/mobile/badge"+t+o+".png)":""}),a.innerHTML},e.checkStickers=function(t){var n=this;if(void 0===t&&(t={}),Object(d.partConfigEnabled)("mvk_stickers_panel_optimize")){if(!window.vk)return setTimeout((function(){var t;return(t=n.checkStickers).call.apply(t,_([e],arguments))}),1e3);if(window.vk.id){if(this.getStickers()&&this.getStickerPanel()&&Object(a.getCookie)("remixstickers_hash")){if(!t.force&&Date.now()-i.default.get("stickers_last_load")<3e5)return clog("[StickerCache] Stickers check was fired in less than 5 minutes. Prevent loading"),!1}else clog("[StickerCache] Stickers cache isn't loaded or broken"),Object(a.setCookie)("remixstickers_hash","");t.ignore_hash&&Object(a.setCookie)("remixstickers_hash",""),i.default.set("stickers_last_load",Date.now()),r.default.post("/?act=load_stickers",{},{onDone:function(t){if(i.default.set("stickers_last_load",Date.now()),t){if(t.part_load){clog("[StickerCache] Force loaded some categories");var n=t.stickers_data,a=t.new_items;if(Object(c.isNumber)(a)){var r=e.setNewStickersCount(a);e.saveStickerPanel(r)}var o=extend(e.getStickers()||{},n);e.saveStickers(o)}else{clog("[StickerCache] New version of stickers async loaded");r=t.sticker_panel,n=t.stickers_data;e.saveStickerPanel(r,t.hash),e.saveStickers(JSON.parse(n))}e.onStickerPanelUpdate()}else clog("[StickerCache] Stickers already exists.")}})}else clog("[StickerCache] User unauthorized.")}},e.stickers=null,e.onStickerPanelUpdate=Object(s.default)(),e}();t.default=f},ciqL:function(e,t){var n={show:function(e,t){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){n.onCallback(e)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+t})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(e){if(grecaptcha&&e){var t=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",t);i&&(val(i,""),grecaptcha.render(i,{sitekey:e,callback:n.onResponse}))}}};window.ReCaptcha=n},dONA:function(e,t,n){"use strict";n.r(t);var i=function(e){return{class:"MainMenuNotificationDot","data-id":e.id,tag:"span"}};t.default=i},drfJ:function(e,t,n){"use strict";n.r(t);var i=n("STl5"),a=n("DkIl"),r=n("fdw3"),o=n("UknS"),s=n("vmnM"),l=n("/Nch"),c=n("SCqW"),u=n("2cdU"),d=n("gmmu"),_=n("+7CI"),f=n("K95L"),p=n("OwA7"),h=n("iNof"),m=n("NTGm"),v=n("jyox"),g=n("PssS"),A=n("0jkK"),b=n("IxZu");function y(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel,a=w("markAsUnread",null,'onmousedown="uMessenger.onMarkDialogAsUnreadClick()"');return e>-2e9&&e<0?[w("showMedias",n.showMedia),a,w("deleteHistory",n.flushHistory),w("blockCommunity",n.blockCommunity),w("unblockCommunity",n.unblockCommunity),w("blockNotify",n.blockNotify)]:Object(r.isChatPeer)(e)?[w("chatInfo",n.chatInfo,"",i),w("chatAdd",n.addToChat),Object(r.isSAKIntegration)()?"":w("inviteLink",n.inviteLink,"",i),w("showMedias",n.showMedia),n.unpinMsg?w("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?w("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?w("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",a,w("chatDeleteHistory",n.flushHistory),w("chatReturn",n.returnToChat,"",i),w("chatLeave",n.leaveChat,"",i)]:t.cur.groupId?[w("showMedias",n.showMedia),Object(r.isSAKIntegration)()?"":w("markAsAnswered",n.communityMarkAsAnswered),a,n.isDialogImportant?w("removeImportantMark",n.communityToggleImportant):w("markAsImportant",n.communityToggleImportant),Object(r.isSAKIntegration)()?"":n.isBlacklisted?w("unbanUser",n.userBan):w("banUser",n.userBan),w("deleteHistory",n.flushHistory)]:[w("showMedias",n.showMedia),a,w("deleteHistory",n.flushHistory)]}function w(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1);var a=window.lang;if(!t&&!n)return null;var r={showMedias:[a.mobile_mail_show_medias,Object(o.getPictureOutline28Icon)()],deleteHistory:[a.mobile_mail_delete_history,Object(s.getDeleteOutline28Icon)()],blockCommunity:[a.mobile_mail_block_community,Object(l.getRemoveCircleOutline28Icon)()],blockNotify:[a.mobile_mail_block_community_notify,Object(l.getRemoveCircleOutline28Icon)()],unblockCommunity:[a.mobile_mail_unblock_community,Object(c.getAddCircleOutline28Icon)()],chatAdd:[a.mobile_mail_add_to_chat,Object(c.getAddCircleOutline28Icon)()],chatUnpinMsg:[a.mobile_mail_unpin_msg,Object(u.getUnpinOutline28Icon)(),"unpin"],chatShowPinnedMsg:[a.mobile_mail_pin_show,Object(d.getPinOutline28Icon)(),"showPinned"],chatHidePinnedMsg:[a.mobile_mail_pin_hide,Object(_.getHideOutline28Icon)(),"hidePinned"],chatInfo:[a.mobile_mail_chat_info,Object(f.getInfoOutline28Icon)()],chatDeleteHistory:[a.mobile_mail_delete_chat_history,Object(s.getDeleteOutline28Icon)()],chatReturn:[i?a.mobile_mail_return_to_channel:a.mobile_mail_chat_return,Object(p.getChevronLeftOutline28Icon)(),"returnToChat"],chatLeave:[i?a.mobile_mail_channel_leave:a.mobile_mail_chat_leave,Object(h.getCancelCircleOutline28Icon)(),"leaveChat"],markAsAnswered:[a.mobile_mail_mark_as_answered,Object(m.getDoubleMarkOutline28Icon)()],removeImportantMark:[a.mobile_mail_remove_important_mark,Object(v.getUnfavoriteOutline28Icon)()],markAsImportant:[a.mobile_mail_mark_as_important,Object(g.getFavoriteOutline28Icon)()],markAsUnread:[a.mobile_mail_mark_as_unread,Object(A.getMarkUnreadOutline28Icon)()],unbanUser:[a.mobile_settings_blacklist_unban_user,Object(c.getAddCircleOutline28Icon)()],banUser:[a.mobile_settings_blacklist_ban_user,Object(l.getRemoveCircleOutline28Icon)()],inviteLink:[i?a.mobile_mail_channel_invite_link:a.mobile_mail_invite_link,Object(b.getLinkOutline28Icon)()]},y={text:r[e][0],icon:SVGIcon(r[e][1]),attrs:n,url:t};return r[e][2]&&(y.name=r[e][2]),y}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=Object(r.isChatPeer)(e),o=Object(r.isContactPeer)(e),s=Object(r.isCommunityPeer)(e),l={title:n.title,photos:n.avatarImages,actions:y(e),editing:t.cur.editing,peerProfile:{isEnabled:t.flags.isPeerProfileEnabled,tagsData:n.peerProfileTagsData||{},tags:t.peerProfileTags||[]},viewerIsCommunity:!!t.cur.groupId,unableToWrite:!!n.unableToWrite,closed:!!n.closed,isCommunity:s};if(i){var c=i?e-2e9:null;if(l.url="/mail?act=info&chat="+c,l.membersCount=n.countMembers,l.hasPinnedMsg=n.hasPinnedMsg,l.isChannel=n.isChannel,l.isCasper=n.isCasper,l.isChannel||n.isCommunityChat){var u=-n.ownerId;l.url="/club"+u}else if(n.viewerId<0){var d=-n.viewerId;l.url="/mail?act=info&chat="+c+"&community="+d}}else l.url=n.profileUrl,l.isOnline=n.isOnline,l.onlinePlatform=n.onlinePlatform,l.offlineText=n.offlineText,l.isContact=o;return Object(a.MailHat_convo)(l)}(e);if(t)return function(e){return Object(a.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=!!t,r=n?"&community="+t:"",o=n?"?community="+t:"";return Object(a.MailHat_main)({folder:e.folder,urls:{all:"/mail"+o,unrespond:"/mail?act=unrespond"+r,unread:"/mail?act=unread"+r,important:"/mail?act=important"+r,adTag:"/mail?act=ad_tag"+r,createChatUrl:"/mail?act=new_chat"},unreadCount:e.countUnread,importantCount:e.countImportant,withUnrespond:n,withAdTag:n,forwarding:!!e.forwardFromId,notifier:Object(i.default)()})}()}},eGQV:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return u})),n.d(t,"isStandalone",(function(){return d})),n.d(t,"isOfflineCapable",(function(){return _}));var i=function(){function e(){this.registration=null,this._handlers=[],this.params=null}e.isSupported=function(){try{return!(!window.fetch||window.fetch.polyfill&&!window.fetch.forcedPolyfill||!navigator.serviceWorker)}catch(e){return!1}};var t=e.prototype;return t.listenMessages=function(){navigator.serviceWorker.addEventListener("message",this._onmessage.bind(this))},t.register=function(t){if(!e.isSupported())return Promise.reject("SW: serviceWorker is unavailable");var n=t&&t.url;return n?(this.params=t,navigator.serviceWorker.register(n,{scope:"/",updateViaCache:"none"}).then(function(e){return this.registration||(this.registration=e),e}.bind(this))):Promise.reject("SW: incorrect url")},t.getRegistration=function(){return e.isSupported()?navigator.serviceWorker.ready.then(function(e){return this.registration||(this.registration=e),e}.bind(this)):Promise.reject("SW: serviceWorker is unavailable")},t.unregister=function(){this.registration&&this.registration.unregister(),this._handlers.forEach((function(e){return e[0].removeEventListener(e[1],e[2])})),this._handlers=[]},t.update=function(){this.registration&&this.registration.update()},t.getParams=function(){return this.params||{}},t._addEventListener=function(e,t,n,i){void 0===i&&(i=!0);var a=!1;this._handlers.forEach((function(i){i[0]===e&&i[1]===t&&i[2]===n&&(a=!0)})),a&&!i||(this._handlers.push([e,t,n]),e.addEventListener(t,n))},t.action_devicePixelRatio=function(){return window.devicePixelRatio},t.action_pushHash=function(){return this.getParams().push_hash},t.storePushHash=function(){var e=this.getParams().push_hash;this.action("storePushHash",{hash:e})},t.action=function(e,t){var n=null;return n=Array.isArray(e)?e:[[e,t]],this._message({actions:n}).then((function(e){return e.answers?Promise.resolve(1===n.length?e.answers[0]:e.answers):Promise.reject(new Error("ServiceWorker answer is incorrect"))}))},t._message=function(e){var t=this;return this.getRegistration().then((function(){return new Promise(function(t,n){var i=new MessageChannel;i.port1.onmessage=function(e){this._messageCheck(e)?t(e.data.data):n(new Error("ServiceWorker message is incorrect"))}.bind(this),this.registration.active.postMessage(this._messageWrap(e),[i.port2])}.bind(t))}))},t._onmessage=function(e){if(this._messageCheck(e)){var t=e.data.data;if(t.actions&&Array.isArray(t.actions)){var n=[];t.actions.forEach(function(t){var i="action_"+t[0],a=t[1],r=this[i]?this[i](a,e):void 0;r instanceof Promise||(r=Promise.resolve(r)),n.push(r)}.bind(this)),Promise.all(n).then(function(t){var n={};t.forEach((function(e,t){void 0!==e&&(n[t]=e)})),Object.keys(n).length&&e.ports[0].postMessage(this._messageWrap({answers:n}))}.bind(this))}}},t._messageCheck=function(e){return(""===e.origin||e.origin.match(/^https:\/\/([a-zA-Z0-9\-\.]+\.)?vk\.com$/))&&e.data&&e.data.data&&"sw"===e.data.type},t._messageWrap=function(e){return{type:"sw",data:e}},e}();i.SW_NOT_AVAILABLE_ERROR="SW: serviceWorker is unavailable";var a,r=n("H5mD"),o=function(){if(!("fetch"in window))return function(){};var e=["standalone","fullscreen","minimal-ui"],t=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple");function n(e,t,n){void 0===n&&(n=!1);var a=i(e);if((a.drawImage(e,0,0),!n)&&255==a.getImageData(0,0,1,1).data[3])return null;return a.globalCompositeOperation="destination-over",a.fillStyle=t,a.fillRect(0,0,e.width,e.height),a.canvas.toDataURL()}function i(e){var t=void 0===e?{width:1,height:1}:e,n=t.width,i=t.height,a=document.createElement("canvas");return a.width=n,a.height=i,a.getContext("2d")}return function(){if(t){var a=document.head.querySelector('link[rel="manifest"]'),o=a?a.href:"",s=function(e){for(var t=function(t){var n=e[t];try{return new URL("",n),{v:function(e){return new URL(e,n).toString()}}}catch(e){}},n=0;n<e.length;++n){var i=t(n);if("object"==typeof i)return i.v}return function(e){return e}}([o,window.location]);Promise.resolve().then((function(){if(!o)throw'can\'t find <link rel="manifest" href=".." />\'';var e={};return"use-credentials"===o.crossOrigin&&(e.credentials="include"),window.fetch(o,e)})).then((function(e){return e.json()})).then((function(t){return function(t,a){var o=(t.icons||[]).filter((function(e){return"apple-splashscreen"===e.purpose}));o.sort((function(e,t){return parseInt(t.sizes,10)-parseInt(e.sizes,10)}));var s=o.map((function(e){return{href:a(e.src),sizes:e.sizes}})),l=t.display,c=-1!==e.indexOf(l);(function(e){var t=function(e){var t=i();return t.fillStyle=e,t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data}(e).map((function(e){var t=e/255;return t<.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),n=.2126*t[0]+.7152*t[1]+.0722*t[2];Math.abs(1.05/(n+.05))})(t.background_color||"#ffffff"),t.name||t.short_name||document.title;navigator.standalone||(u="apple-mobile-web-app-capable",(d=c)&&(!0===d&&(d="yes"),function(e,t){var n=document.createElement(e);for(var i in t)n.setAttribute(i,t[i]);document.head.appendChild(n)}("meta",{name:u,content:d})));var u,d;function _(e,n,a){var r=e.width,o=e.height,s=window.devicePixelRatio,l=i({width:r*s,height:o*s});if(l.scale(s,s),l.fillStyle=t.background_color||"#ffffff",l.fillRect(0,0,r,o),l.translate(r/2,(o-32)/2),a){var c=a.width/s,u=a.height/s;u>128&&(c/=u/128,u=128),c>=48&&u>=48&&(l.drawImage(a,c/-2,u/-2,c,u),l.translate(0,u/2+32))}var d=document.createElement("link");return d.setAttribute("rel","apple-touch-startup-image"),d.setAttribute("media","screen and (orientation: "+n+")"),d.setAttribute("href",l.canvas.toDataURL()),d}var f=new Set;function p(e){var t=_(window.screen,"portrait",e),n=_({width:window.screen.height,height:r.isIPad?window.screen.height:window.screen.width},"landscape",e);f.forEach((function(e){return e.remove()})),document.head.appendChild(t),document.head.appendChild(n),f.add(t),f.add(n)}if(p(null),!s.length)return;var h=s[0],m=new Image;m.crossOrigin="anonymous",m.onload=function(){if(p(m),t.background_color){var e=n(m,t.background_color);null!==e&&(h.href=e,s.slice(1).forEach((function(e){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var a=n(i,t.background_color,!0);e.href=a},i.src=e.href})))}},m.src=h.href}(t,s)})).catch((function(e){return console.warn("pwacompat.js error",e)}))}}}(),s=n("OGfC"),l=new i;window.sw_client=l,window.SWClient=i,window.initPushNotifier=function(){try{window.PushNotifier=s.default,window.pushNotifier=new s.default(l,i)}catch(e){}};var c=!1;function u(){window.addEventListener&&(!function(){if(c=!0===navigator.standalone||window.matchMedia&&matchMedia("(display-mode: standalone)").matches,!history.replaceState)return;var e=location.search;if((e=(e=(e=e.replace(/(\?|&)mode\=([^&]+)(&)?/,"$1")).replace(/(\?|&)__appshell_fallback\=([^&]+)(&)?/,"$1")).replace(/(\?|&)+$/,""))!==location.search){var t=location.pathname+e+location.hash;history.replaceState(null,"",t)}}(),function(){if(!i.isSupported())return;l.listenMessages()}(),window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault()})),window.addEventListener("appinstalled",(function(){statlogsValueEvent("pwa_installed_event",1)})),"complete"===document.readyState?f():window.addEventListener("load",(function(){f()})))}function d(){return c}function _(){return void 0===a&&(a=!(!i.isSupported()||!navigator.serviceWorker.controller)),a}function f(){window.vk&&window.vk.sw&&(l.register(window.vk.sw).then((function(e){l.storePushHash()}),(function(e){if(e!==i.SW_NOT_AVAILABLE_ERROR)throw e})),i.isSupported()&&navigator.serviceWorker.getRegistration().then((function(e){!function(e){if(!_())return;e&&e.active&&e.installing&&e.installing.postMessage({action:"activate"})}(e)})),o())}u()},eJy5:function(e,t){var n=need("Voting");function i(e){r(e.$voting,e.url)}function a(e,t){r(t.$voting,e,!0)}function r(e,t,i){var a=setTimeout((function(){n.setLoading(e)}),140);ajax.post(t,{_ajax:1},{onDone:function(t,r){domData(e,"is-web-view")&&n._onPollChanged&&n._onPollChanged(e,i),clearTimeout(a),n.setHtml(t,r)}})}window.uVoting={},uVoting._onSubmit=i,uVoting._onRevoteClick=a},eWFs:function(e,t,n){"use strict";n.r(t),n.d(t,"uConvo_getLastMsgId",(function(){return f}));n("bZ/P");var i=n("TYsd"),a=(n("Mc5h"),n("s0aB")),r=n("iWgD"),o=n("/Id8"),s=n("fdw3"),l=function(e,t){void 0===t&&(t=null);var n="last"===t,i=store.mail,r=i.peers[e],o=Object(s.isContactPeer)(e),l=r.url,_=null;if(t){var f;n||(l=l+"&msg="+t),(f=n?p(e):i.msgs[t])&&(_={text:c(f),date:f.dateShort,unreadCount:d(e),muted:r.isMuted,typing:h(e),pending:f.pending,failed:f.failed})}return Object(a.default)({id:e,url:l,photos:r.avatarImages,title:r.title,online:u(r),important:r.isImportant,profileUrl:r.profileUrl,isLast:n,peerProfile:{tagsData:r.peerProfileTagsData||{},tags:i.peerProfileTags||[]},isMarkedUnread:r.isMarkedUnread,more:_,isCasper:r.isCasper,isContact:o,name:r.title})};function c(e){var t=window.lang,n=store.mail,a=!!e.attaches.call;if(e.isExpired){var r=Object(s.getLang)("mobile_mail_you")+": "+Object(s.getLang)("mobile_casper_chat_message_disappeared");return i.default.html({inner:[r],tag:"span"})}if(e.isService&&!a)return i.default.html({tag:"span",inner:[i.default.wrap(e.serviceText)]});var l=e.body?i.default.wrap(Object(o.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:Object(o.Msg__attachPreview)(e)}}(e),c="";return e.authorId===n.cur.userId&&e.peerId!==n.cur.userId?c=t.mobile_mail_you:Object(s.isChatPeer)(e.peerId)&&e.authorId&&(c=(c=n.members[e.authorId].shortName).replace(/\.$/,"")),c&&(c+=": "),i.default.html({tag:"span",inner:[i.default.wrap(c),l]})}function u(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function d(e){var t=_(e).countUnread;if(0===t){var n=store.mail,i=p(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function _(e){return store.mail.peers[e]}function f(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],a=t.presend&&t.presend.failed[e];if(i&&i.length)for(var r=i.length-1;r>=0;r--){var o=i[r];if(-1===o.indexOf("edit"))return o}if(a&&a.length)for(var s=a.length-1;s>=0;s--){var l=a[s];if(-1===l.indexOf("edit"))return l}return n&&n.length?last(n):null}function p(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,a=f(e);return i&&i[a]?i[a]:a?t[a]:null}function h(e){var t,n,i=Object(r.uTyping_getPeerTyping)(e),a=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!a||Object(r.uTyping_getNames)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}n("+cqQ");Object.assign(l,{onTap:a.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=u(t);a.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=d(e),n=_(e).isMarkedUnread;a.default.setUnreadCount(e,t,n)},redrawLastMsg:function(e){var t=p(e);t&&a.default.setLastMsg(e,c(t),{dateShort:t.dateShort,pending:t.pending,failed:t.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=Object(r.uTyping_getPeerTyping)(e),n=(t&&1===t.count&&t.users[0],h(e));a.default.setTyping(e,n)},redrawImportant:function(e,t){a.default.setImportant(e,t)},updateAdTag:function(e){var t=store.mail.peers[e];a.default.updateAdTag(e,t.peerProfileTagsData)}});t.default=l;window.uConvo=l},eoxF:function(e,t){var n=function(){var e=null,t=!1,i=!1,a={},r=[],o=0,s=null,l="",c="";function u(e,t){return!t&&g(e)}function d(e){i=!1;var n=ge("medias_map"),a=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),append(n,a));var r=+e[1]||0,o=e[3]||"",s=e[4]||"",l=e[5]||"",c=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",n),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+o+(l?", "+l:s?", "+s:"")+"</div>",_='<input type="hidden" name="place_id" value="'+r+'"><input type="hidden" name="place" value="'+c+'">';if(u)val(u,d+_);else{d='<div class="medias_map">'+d+_+"</div>";val(n,d)}addClass("cp_geo_btn_sel","geo_btn"),t=!0,show(n)}function _(t){return g(e)}function f(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function p(t,n){h();var i=a[n];i&&(e={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):m(e,i))}function h(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function m(e,n){i=!0;var a=ge("medias_map"),r=ge("attached_wrap");a||(a=ce("div",{id:"medias_map",className:"pi_medias"}),r.appendChild(a));var o=e.latitude,s=e.longitude,l=(window.devicePixelRatio,n&&n[4]||!1),c=geByClass1("medias_map",a),u=l?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+l+"</div>":"",d='<input type="hidden" name="map" value="'+(o+"_"+s+"_0")+'">';c?val(c,u+""+d):val(a,'<div class="medias_map">'+u+d+"</div>");t=!0,addClass("cp_geo_btn_sel","geo_btn"),show(a)}function v(){e=null,a={},r=[],o=0,ajax.post(c,{_ajax:1}),remove("medias_map")}function g(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,a=gpeByTag("form","geo_btn"),r=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!a)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var o=!1;return each(a,(function(e,t){if("submit"===t.type)return o=t,!1})),o?(append(r,a),window.al&&t.ver?nav.go(o,null,{removeAfterNextResponse:!1}):a.submit()):void 0}function A(t){t&&t.coords&&u(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0})}function b(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},addNewPlace:function(){var t=val("place_name_fld"),n=val("place_address_fld");return t?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:e.latitude,longitude:e.longitude,title:t,address:n,hash:l},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(a,n),r.splice(r[0]?0:1,0,e),f(),p(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(t,n){var i=window.lang,a="/places.php"+obj2qs({act:"add_place",latitude:e.latitude,longitude:e.longitude,hash:l});val("place_add_box",'<h3 class="sub_header">'+i.mobile_geo_new_place_header+'</h3><div class="form_item fi_fat"><form id="place_add_form" action="'+a+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(t)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),t?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:f,selectPlace:p,changePlace:_,back:h,refreshCurrentPosition:function(){geo.getCurrentPosition(A,b)},getCurrentAddress:function(){return a[0]&&a[0][5]||""},savePlaces:function(e){extend(a,e)},add:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(A,b),show("geo_waiting"))},add_place:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(A,b),show("geo_waiting"))},remove:function(){t=!1,removeClass("cp_geo_btn_sel","geo_btn"),v()},stash:function(n){if(!n)return[e,t,i,a,r,o,s];e=n[0],t=n[1],i=n[2],a=n[3],r=n[4],o=n[5],s=n[6]},init:function(u,d,_){return hide("geo_waiting"),e=null,t=!1,i=!1,a={},r=[],o=0,s=null,l=d||"",c=_||"",u&&n.add(u),geo.init()}}}();window.checkin=n},eyw1:function(e,t){var n=function(){function e(e,t,n,i,a,r){var o="/club"+t+obj2qs({act:e,hash:n,id:t,from:i});ajax.post(o,{_ajax:1},{onDone:a,onFail:r})}return{enter:function(t,n,i,a,r){void 0===a&&(a=null),void 0===r&&(r=null),e("enter",t,n,i,a,r)},leave:function(t,n,i,a,r){void 0===a&&(a=null),void 0===r&&(r=null),e("leave",t,n,i,a,r)}}}();window.Groups=n},fWqt:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"onConfirmDelete",(function(){return u})),n.d(i,"open",(function(){return d})),n.d(i,"close",(function(){return _})),n.d(i,"isDeleteMessagesForAll",(function(){return f}));var a=n("MUpH"),r=n("bZ/P"),o=n("+cqQ"),s=n("iS9e");function l(){var e=Object(a.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=null,u=Object(o.default)();function d(e){s.default.open({body:p(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:r.default.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:r.default.onClick("MsgDeleteDialog.close")})}function _(){var e=$(".MsgDeleteDialog__checkboxInput");e&&(c=e.checked,lsSet("delete_message_for_all_checked",c)),s.default.close()}function f(){var e=$(".MsgDeleteDialog__checkboxInput");return!!e&&e.checked}function p(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var o=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(o,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var s=lang.mobile_mail_delete_for_all;n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="MsgDeleteDialog__checkboxInput" '+(function(){if("boolean"!=typeof c){var e=!!lsGet("delete_message_for_all_checked");c=e}return c}()?"checked":"")+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+s+"</span>\n        </label>\n      </div>\n    "}return r.default.html(l(),t,n)}t.default=i;window.MsgDeleteDialog=i},fYoA:function(e,t){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=a;var n=".settingsNotifyGroup",i=".settingsNotifyGroup__description";function a(e,t){t.$control.closest(n).$(i).innerHTML=e}},fdw3:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"isObject",(function(){return isObject})),__webpack_require__.d(__webpack_exports__,"isJS",(function(){return isJS})),__webpack_require__.d(__webpack_exports__,"log",(function(){return log})),__webpack_require__.d(__webpack_exports__,"mergeObjects",(function(){return mergeObjects})),__webpack_require__.d(__webpack_exports__,"mergeArrays",(function(){return mergeArrays})),__webpack_require__.d(__webpack_exports__,"concatValues",(function(){return concatValues})),__webpack_require__.d(__webpack_exports__,"isFinite",(function(){return isFinite})),__webpack_require__.d(__webpack_exports__,"getLang",(function(){return getLang})),__webpack_require__.d(__webpack_exports__,"getLangNumeric",(function(){return getLangNumeric})),__webpack_require__.d(__webpack_exports__,"langNumeric",(function(){return langNumeric})),__webpack_require__.d(__webpack_exports__,"insertBetween",(function(){return insertBetween})),__webpack_require__.d(__webpack_exports__,"stringifyJSON",(function(){return stringifyJSON})),__webpack_require__.d(__webpack_exports__,"parseJSON",(function(){return parseJSON})),__webpack_require__.d(__webpack_exports__,"wrapCommunityMailUrl",(function(){return wrapCommunityMailUrl})),__webpack_require__.d(__webpack_exports__,"mailReplaceMentions",(function(){return mailReplaceMentions})),__webpack_require__.d(__webpack_exports__,"mailReplaceDomainMentions",(function(){return mailReplaceDomainMentions})),__webpack_require__.d(__webpack_exports__,"getState",(function(){return getState})),__webpack_require__.d(__webpack_exports__,"wdToFlatArray",(function(){return wdToFlatArray})),__webpack_require__.d(__webpack_exports__,"fromCharCode",(function(){return fromCharCode})),__webpack_require__.d(__webpack_exports__,"timestamp",(function(){return timestamp})),__webpack_require__.d(__webpack_exports__,"formatDuration",(function(){return formatDuration})),__webpack_require__.d(__webpack_exports__,"arrayUnique",(function(){return arrayUnique})),__webpack_require__.d(__webpack_exports__,"arrayFlat",(function(){return arrayFlat})),__webpack_require__.d(__webpack_exports__,"isArray",(function(){return isArray})),__webpack_require__.d(__webpack_exports__,"arrayIncludes",(function(){return arrayIncludes})),__webpack_require__.d(__webpack_exports__,"inlineIconResolver",(function(){return inlineIconResolver})),__webpack_require__.d(__webpack_exports__,"isSAKIntegration",(function(){return isSAKIntegration})),__webpack_require__.d(__webpack_exports__,"classNames",(function(){return classNames})),__webpack_require__.d(__webpack_exports__,"arraySomeEqual",(function(){return arraySomeEqual})),__webpack_require__.d(__webpack_exports__,"preactCallback",(function(){return preactCallback})),__webpack_require__.d(__webpack_exports__,"getLangReplace",(function(){return getLangReplace})),__webpack_require__.d(__webpack_exports__,"winToUtf",(function(){return winToUtf})),__webpack_require__.d(__webpack_exports__,"getNumShort",(function(){return getNumShort}));var _mobile_emoji_html__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("9M99");__webpack_require__.d(__webpack_exports__,"emojiToHTML",(function(){return _mobile_emoji_html__WEBPACK_IMPORTED_MODULE_0__.emojiToHTML}));var _mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("qHA9");__webpack_require__.d(__webpack_exports__,"isChatPeer",(function(){return _mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.isChatPeer})),__webpack_require__.d(__webpack_exports__,"isContactPeer",(function(){return _mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.isContactPeer})),__webpack_require__.d(__webpack_exports__,"isCommunityPeer",(function(){return _mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.isCommunityPeer})),__webpack_require__.d(__webpack_exports__,"isForwardedMessageId",(function(){return _mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.isForwardedMessageId}));var _mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("OcsD");__webpack_require__.d(__webpack_exports__,"extend",(function(){return _mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.extend})),__webpack_require__.d(__webpack_exports__,"isFunction",(function(){return _mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isFunction}));var _mobile_lib_Url__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("j80l");__webpack_require__.d(__webpack_exports__,"makeUrl",(function(){return _mobile_lib_Url__WEBPACK_IMPORTED_MODULE_3__.makeUrl}));var _mobile_lib_Withdom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("TYsd"),_shared_lib_SAKIntegration__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ZMWW"),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("xt6h");function _createForOfIteratorHelperLoose(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function isObject(e){return Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isObject)(e)}function isJS(){return!0}function log(){var e;(e=console).log.apply(e,arguments)}function mergeObjects(){return Object.assign.apply(Object,arguments)}function mergeArrays(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):[]}function concatValues(e,t){return e+t}function isFinite(e){return window.isFinite(e)}function getLang(){var e;return(e=window).getLang.apply(e,arguments)}function getLangNumeric(){return _mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.langNumeric.apply(void 0,arguments)}function langNumeric(e,t,n){return void 0===n&&(n=!1),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.langNumeric)(e,t,n)}function insertBetween(e,t){var n=[];return e.forEach((function(i,a){var r=e[a+1],o=e[a+2];i&&n.push(i),i&&(r||o)&&n.push(t)})),n}function stringifyJSON(e){return JSON.stringify(e)}function parseJSON(e){return JSON.parse(e)}function wrapCommunityMailUrl(e){return Object(_mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.wrapCommunityUrl)(e)}function mailReplaceMentions(e,t){return e.replace(_mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.MENTION_REGEXP,t)}function mailReplaceDomainMentions(e,t){return e.replace(_mobile_lib_Mail__WEBPACK_IMPORTED_MODULE_1__.MENTION_DOMAIN_REGEXP,t)}function getState(e){return window.isomorphicState&&window.isomorphicState[e]||[]}function wdToFlatArray(e){return _mobile_lib_Withdom__WEBPACK_IMPORTED_MODULE_4__.default.toFlatArray(e).map(_mobile_lib_Withdom__WEBPACK_IMPORTED_MODULE_4__.default.innerItemToString)}function fromCharCode(e){return String.fromCharCode(e)}function timestamp(){return Date.now()/1e3}function formatDuration(e){if(!e)return"";var t=Math.floor(e/3600),n=Math.floor(e/60)%60,i=e%60;return i>=3600?[t].concat([n,i].map((function(e){return e<10?"0"+e:""+e}))).join(":"):[n].concat([i].map((function(e){return e<10?"0"+e:""+e}))).join(":")}function arrayUnique(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}function arrayFlat(e){return e.flat()}function isArray(e){return Array.isArray(e)}function arrayIncludes(e,t){return e.includes(t)}function inlineIconResolver(){return null}function isSAKIntegration(){return _shared_lib_SAKIntegration__WEBPACK_IMPORTED_MODULE_5__.SAKIntegration.isIntegrated}function classNames(){return _vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_6__.classNames.apply(void 0,arguments)}function arraySomeEqual(e,t,n){for(var i,a=_createForOfIteratorHelperLoose(e);!(i=a()).done;){if(i.value[t]===n)return!0}return!1}function preactCallbackKeywordsReplace(e,t,n){return e.map((function(e){return"event"===e?n:"this"===e?t:e}))}function preactCallback(callback){for(var _len=arguments.length,argsA=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)argsA[_key-1]=arguments[_key];if(!callback)return null;if(Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isFunction)(callback)&&0===argsA.length)return callback;if(isArray(callback)&&Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.flatArray)(callback).every((function(e){return!Boolean(e)})))return null;var evalCaller=function evalCaller(code,context){return function(){return code.includes("return")?eval("(function(event) { "+code+" }).call(this, event)"):void eval("(function(event) { "+code+" }).call(this, event)")}.call(context)};return function(e){void 0===e&&(e={});var t=e.target;if(Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isString)(callback))return evalCaller(callback,t);if(Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isFunction)(callback))return callback.apply(void 0,preactCallbackKeywordsReplace(argsA,t,e));if(isArray(callback)){var n=callback[0],i=callback.slice(1).concat(argsA),a=preactCallbackKeywordsReplace(i,t,e);if(Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isFunction)(n))return n.apply(void 0,a);if(Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.isString)(n)){var r=i.reduce((function(e,t,n,i){return e+="event"!==t&&"this"!==t?"'"+t+"'":t,n!==i.length-1?e+=", ":e=e.trim(),e}),"");return evalCaller(n+"("+r+");",t)}}}}function getLangReplace(e,t){for(var n in void 0===t&&(t={}),t)if(t.hasOwnProperty(n)){var i="{"+n+"}";e=e.replace(i,t[n])}return e}function winToUtf(e){return Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_2__.winToUtf)(e)}function getNumShort(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=e;(e>=1e4&&e<1e6?i=Math.floor(e/1e3)+"K":e>=1e6&&(i=Math.round(e/1e6,1)+"M"),t)&&(i=e<1e4?getLangNumeric(e,t,n):getLangNumeric(789,t).replace(new RegExp(789,"g"),i));return i}},g3t9:function(e,t,n){"use strict";n.r(t),n.d(t,"Separator",(function(){return a}));var i=n("z9sQ");function a(e){return void 0===e&&(e={}),{class:[e.class,i.default.class("Separator",{hideOnDesktop:e.hideOnDesktop,noOffset:e.noOffset,gray:e.gray},"--")],tag:"div"}}t.default=a},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o})),n.d(t,"getVisibilityState",(function(){return c})),n.d(t,"getVisiblityEvent",(function(){return u}));var i=n("uQjJ"),a=n("PU8N"),r=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,n){Object(a.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(a.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,i.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&r||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&s(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&r||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNTM:function(e,t){var n=function(){var e=null,t=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var a=e.latitude,r=e.longitude,o=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",l='<input type="hidden" name="map" value="'+(a+"_"+r+"_0")+'">';o?val(o,s+""+l):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+l+"</div>");show(n)}function a(){e=null,remove("medias_map")}function r(t){var n;t&&t.coords&&(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0},n=e,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:o}))}function o(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},add:function(n){!n&&t||(t=!0,addClass("cp_geo_btn_sel","geo_btn"),n&&(n.latitude||n.longitude)?i(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.label):(geo.getCurrentPosition(r,o),show("geo_waiting")))},remove:function(){t&&(t=!1,removeClass("cp_geo_btn_sel","geo_btn"),a())},init:function(e){return e&&n.add(e),geo.init()}}}();window.geoloc=n},gy8s:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),r=n("9y81"),o=n("AXyT"),s=n("Y6JH"),l=n("0oyq"),c=function(e){var t="unfold-"+Date.now()+"-"+Math.round(9999*Math.random());e.uniqueId=t;var n=i.default.class(e.mix,"Unfold",{position:e.position,asIcon:!!e.icon||!!e.icon_html,open:e.opened,withTitle:!!e.title}),a=i.default.list(e.items,d);return Wd.html({class:n,"data-name":e.name,onclick:e.onclick,inner:[{class:"Unfold__trigger",tag:e.triggerWrapperTag||"div",inner:u(e)},{id:t,class:["Unfold__popup","ScrollView",e.popup_class].filter((function(e){return e})).join(" "),inner:Wd.wrap(a),role:"menu"}]})};function u(e){var t,n=e.title;if(e.icon)t=Object(r.default)({icon:e.icon});else if(e.icon_html)t=e.icon_html;else{for(var o=e.items,c=o.length,u="",d="",_=0;_<c;_++){var f=o[_];if(f&&f.active){u=f.text,d=f.activeCount;break}}t=[Object(a.default)({mix:"Unfold__triggerText",tag:"div",inner:[Wd.html({class:"Unfold__triggerContent",inner:n?[{class:"Unfold__triggerContentTitle",inner:n},{class:"Unfold__triggerContentSubTitle",inner:u}]:[u,d?Wd.html(Object(a.default)({mix:"Unfold__triggerTextCount",inner:d})):""]})]}),Wd.html({class:"Unfold__triggerIcon",inner:Object(s.default)(Object(l.getDropdown16Icon)())})],t=i.default.list(t)}var p=e.opened?e.close_url:e.open_url;return{tag:"button",type:"button","aria-haspopup":"true","aria-expanded":"false","aria-controls":e.uniqueId,href:p,class:"Unfold__trigger",onclick:["Unfold._onTriggerClick","this"],attrs:e.trigger_attrs,inner:Wd.wrap(t)}}function d(e){if(!e)return"";var t="";return e.svgIcon?t=Wd.html({class:"Unfold__itemIcon",inner:e.svgIcon}):e.icon&&(t="string"==typeof e.icon?Object(r.default)({mix:"Unfold__itemIcon",icon:e.icon}):Object(a.default)({mix:i.default.class("Unfold__itemIcon"),inner:Wd.html(e.icon)})),e.attrs+=' data-name="'+e.name+'" role="menuitem" tabindex="-1"',e.active&&(e.attrs+=' aria-current="true"'),e.preventNavigation&&(e.attrs+=' data-prevent-navigation="1"'),Object(a.default)({mix:i.default.class(e.mix,"_touched","replaceState","Unfold__item",{active:e.active,name:e.name,disabled:e.disabled,replaceState:e.replaceState}),url:e.url,tag:e.tag,attrs:e.attrs,inner:[t,Object(a.default)({mix:"Unfold__itemText",inner:[e.text,e.count?Object(a.default)({mix:"Unfold__itemCountHidden",inner:e.count}):""]}),e.count?Object(o.default)({mix:"Unfold__itemCount",gray:!0,value:e.count}):""]})}var _=n("OcsD"),f=n("UxAg"),p=n("jk6M"),h=n("CQvH");Object.assign(c,{onOpen:befall.kind("unfoldName"),getByName:function(e){return Object(f.$)(S.unfoldByName(e))},setActive:k,setCount:function(e,t,n){var i=e.$(S.itemCountByName(t));o.default.setValue(i,n)},setTitle:function(e,t,n){e.$(S.itemByName(t)).$(S.itemText).innerText=n},toggleItemEnabled:function(e,t,n){void 0===n&&(n=!0);var i=e.$(S.itemByName(t));i&&i.classList.toggle(v,!n)},changePosition:function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!1);var i;e.classList.remove(A,b,y,w),i=t?n?A:y:n?b:w;e.classList.add(i)}}),c._onTriggerClick=C;var m="Unfold__item_active",v="Unfold__item_disabled",g="Unfold_open",A="Unfold_position_topLeft",b="Unfold_position_topRight",y="Unfold_position_bottomLeft",w="Unfold_position_bottomRight",O="Unfold__item_replaceState",S={unfold:".Unfold",unfoldByName:function(e){return'.Unfold[data-name="'+e+'"]'},itemActive:"."+m,itemByName:function(e){return".Unfold__item_name_"+e},itemCountByName:function(e){return S.itemByName(e)+" .Unfold__itemCount"},item:".Unfold__item",itemDisabled:"."+v,triggerText:".Unfold__triggerText",itemText:".Unfold__itemText",popup:".Unfold__popup"};function k(e,t){var n,i;if(1===arguments.length?e=(i=e).closest(S.unfold):i=e.$(S.itemByName(t)),(n=e.$(S.itemActive))&&i){n.classList.remove(m),i.classList.add(m);var a=e.$(S.triggerText),r=i.$(S.itemText);a.innerText=r.textContent.trim()}}function C(e){var t=e.closest(S.unfold),n=p.isTouch?"touchend":"mousedown",i=p.isTouch?"touchend":"mouseup",a=!p.isTouch&&window.innerWidth<882,r=t.getAttribute("data-name"),o=!1;r&&c.onOpen(r)(),t.classList.add(g),document.addEventListener("touchmove",m),p.default.msie_mobile?document.addEventListener(i,v,!0):document.addEventListener(n,A,!0);var s=function(){},l=function(){},u=Object(f.$)(S.popup,t);function d(){t.classList.remove(g),document.removeEventListener("touchmove",m),document.removeEventListener(n,A,!0),document.removeEventListener(i,v,!0),Object(h.onTransitionEnd)(u).then((function(){l&&l(),s&&s()}))}function m(e){e.target.closest(S.popup)||d(),o=!0}function v(){document.addEventListener(n,A,!0)}function A(e){if(o)o=!1;else{var t=e.target.closest(S.itemDisabled);if(!t){var n=e.target.closest(S.item+"[href]");if(n){if(p.default.safari&&p.default.safari_mobile&&p.default.version<9)setTimeout(d,500);else{Object(_.cancelEvent)(e);var i=Object(_.domData)(n,"prevent-navigation");if(i||nav.onBeforeGo((function(){d()})),n.classList.contains(O))k(n.closest(S.unfold),Object(_.domData)(n,"name"));i?d():nav.go(n)}return}if(n=e.target.closest(S.item+"[onclick]")||e.target.closest(S.item+"[onmousedown]"))return void setTimeout(d);if(n=e.target.closest("label"+S.item))return void(p.default.safari&&p.default.safari_mobile&&p.default.version<9?setTimeout(d,500):setTimeout(d));if(n=e.target.closest("input[onchange]"))return void(p.default.safari&&p.default.safari_mobile&&p.default.version<9?setTimeout(d,500):setTimeout(d))}(p.isTouch||a||t)&&(e.preventDefault(),e.stopImmediatePropagation()),(a||!p.isTouch&&t)&&document.addEventListener("click",b,!0),t||d()}}function b(e){e.preventDefault(),e.stopImmediatePropagation(),document.removeEventListener("click",b,!0)}u&&Object(h.onTransitionEnd)(u).then((function(){(l=Object(h.expandPopup)(e)).exitIntent=function(){return!1},(s=Object(h.setMenuNavigation)(u))&&(s.exitIntent=function(){return d(),!1})}))}t.default=c;window.Unfold=c},h8oe:function(e,t,n){"use strict";n.r(t),n.d(t,"rescan",(function(){return E})),n.d(t,"trackMarketEvent",(function(){return j})),n.d(t,"trackMarketArea",(function(){return T}));var i=n("Fkq0"),a=n("z9Td"),r=n("tGJf"),o=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,a++)i[a]=r[o];return i};function s(e,t,n,a){var s=window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getHash();if(s){var c=n.slice(0,10),u=0,d=r.vkLocalStorage.getItem("market_event_count");d&&(u=parseInt(d)),u>=20&&(l(e),u=0);var _=Date.now(),f="market_event_item_"+Math.floor(1e5*Math.random())+"_"+_+"_"+t;c.unshift(_),c.unshift(t),c.push(s),r.vkLocalStorage.setItem(f,JSON.stringify(c)),r.vkLocalStorage.setItem("market_event_count",String(++u)),a&&l(e),i.marketDebug.apply(void 0,o(["debug","event",t],n))}else Object(i.marketDebug)("warn","events","Hash error")}function l(e){for(var t=[],n=0;n<r.vkLocalStorage.length();++n){var o=r.vkLocalStorage.key(n);o&&0===o.lastIndexOf("market_event_item_")&&t.push(o)}if(!(t.length<=0)){r.vkLocalStorage.setItem("market_event_count",String(0));var s=[],l="";t.forEach((function(e){var t=r.vkLocalStorage.getItem(e);if(r.vkLocalStorage.removeItem(e),t)try{var n=JSON.parse(t);l?n.pop():l=n.pop(),s.push(Object.values(n))}catch(e){Object(i.marketDebug)("error","event error","Unable to assemble events pack",e)}})),!l||s.length<1||(!window.MarketAnalyticsManager||window.MarketAnalyticsManager.isEnabled()?window.ajax.post(e===a.PLATFORM_MVK?"market.php":"al_market.php",{act:"log_events",hash:l,events:s},{onDone:function(){Object(i.marketDebug)("warn","events sent",s.length+" events sent")}}):Object(i.marketDebug)("error","event error","analytics disabled"))}}var c=function(){function e(){}return e.prototype.connectMutator=function(t){if(this.mutationObserver)throw new Error("{Observer #"+t.getObserverId()+"} MutationObserver already connected to observer");var n=document.querySelector(t.getContainerQuery());n instanceof HTMLElement&&(this.mutationObserver=new MutationObserver((function(n){n.forEach((function(n){if(n.addedNodes)for(var i=0;i<n.addedNodes.length;i++){var a=n.addedNodes[i];if(a instanceof HTMLElement){var r=e.resolveNodes(a,t).filter((function(e){return!!e}));r&&(r.forEach((function(e){t.add(e)})),t.scan())}}}))})),this.mutationObserver.observe(n,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},e.prototype.disconnectMutator=function(e){e.isRunning()&&this.mutationObserver&&this.mutationObserver.disconnect()},e.resolveNodes=function(e,t){var n=[];if(t.getSelectorQuery(!1).split(",").forEach((function(t){if(e.matches(t))return n.push(e),!1})),n.length<1){var i=e.querySelectorAll(t.getSelectorQuery(!1));n=Array.from(i)}return n},e}(),u=n("BJj/"),d={};function _(){var e=r.vkSessionStorage.getItem("market_stat_data");return e&&JSON.parse(e)||{}}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},p=function(){function e(e,t,n,i,a,r){var o;if(void 0===n&&(n=""),void 0===i&&(i=!1),void 0===a&&(a=""),this.observerId=e,this.itemSelector=t,this.container=n,this.isUnifyNodes=i,this.platform=a,this.getExtraItemParams=r,this.trackingItems={},this._debounceTimeout=20,this.uniqueNodeCounter=0,this.nodes=[],this.isWatching=!1,this.mutatorList=[],(o=this).getObserverId()in d&&(d[o.getObserverId()].stop(),delete d[o.getObserverId()]),d[o.getObserverId()]=o,!this.itemSelector.types&&!this.itemSelector.selectors)throw new Error("Empty itemSelector definition");this.container||(this.container=this.observerId)}return Object.defineProperty(e.prototype,"debounceTimeout",{set:function(e){this._debounceTimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemReachedCallback",{set:function(e){this._itemReachedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preCheckReachedCallback",{set:function(e){this._preCheckReachedCallback=e},enumerable:!0,configurable:!0}),e.prototype.getObserverId=function(){return this.observerId},e.prototype.getItemSelector=function(){return this.itemSelector},e.prototype.getPlatform=function(){return this.platform},e.prototype.add=function(e){this.nodes.push(e)},e.prototype.getTrackingItems=function(){return this.trackingItems},e.prototype.addMutators=function(e){this.mutatorList=this.mutatorList.concat(e)},e.prototype.isRunning=function(){return this.isWatching},e.prototype.watch=function(){this.isWatching||(this.update(),this.startObserving(),this.connectMutators(),this.isWatching=!0)},e.prototype.stop=function(){this.isWatching&&(this.trackUntracked(),this.stopObserving(),this.disconnectMutators(),this.isWatching=!1)},e.prototype.scan=function(){this.viewportScanner()},e.prototype.trackUntracked=function(){var e=this.getTrackingItems();for(var t in e)if(e[t]){var n=e[t];!n.isTracked&&n.isReached&&(this.track(n),this.persist(n))}},e.prototype.connectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.connectMutator(e)}))},e.prototype.disconnectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.disconnectMutator(e)}))},e.prototype.getContainerQuery=function(){var e=this.container.substr(0,1);return"#"===e||"."===e?this.container:'[data-stat-container="'+(this.container?this.container:this.observerId)+'"]'},e.prototype.getSelectorQuery=function(e){void 0===e&&(e=!0);var t=this.getContainerQuery(),n=[];return this.itemSelector.selectors?n=this.itemSelector.selectors.split(",").map((function(n){return e?t+" "+n:n})):this.itemSelector.types&&(n=this.itemSelector.types.split(",").map((function(n){return e?t+' [data-stat-item^="'+n+'|"]':'[data-stat-item^="'+n+'|"]'}))),n.join(",")},e.prototype.update=function(){var e=document.querySelectorAll(this.getSelectorQuery());this.nodes=Array.from(e)},e.parseStatAttribute=function(e){var t=e.getAttribute("data-stat-item"),n=null==t?void 0:t.split("|");return n?{type:n[0],ownerId:parseInt(n[1]),itemId:n[2]}:{type:"",ownerId:0,itemId:0}},e.prototype.getNodeKey=function(e,t){var n=String(t.itemId);this.isUnifyNodes&&(this.unifyNode(e),n=n+"_"+e.getAttribute("data-stat-id"));return this.observerId+"_"+n},e.prototype.isItemReached=function(e){return!(void 0!==this._preCheckReachedCallback&&!this._preCheckReachedCallback(e))&&this.isReached(e)},e.prototype.filterItem=function(e){return!e.isTracked&&!e.isReached&&(this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.persist(e),!0))},e.prototype.track=function(e){e.isTracked||(e.viewEnd=Date.now(),e.duration=e.viewEnd-e.viewStart,this._itemReachedCallback(e),e.isReached=!1,e.isTracked=!0)},e.prototype.persist=function(e){this.trackingItems[e.key]=e},e.prototype.getTrackingItem=function(t){var n=e.parseStatAttribute(t);if(!n.type||!n.itemId)return null;var i=this.getNodeKey(t,n);return i?i in this.trackingItems?this.trackingItems[i]:this.createTrackingItem(t,n):null},e.prototype.createTrackingItem=function(e,t){var n=this.getNodeKey(e,t),i=this.getExtraItemParams&&this.getExtraItemParams()||{};return this.trackingItems[n]=f(f({},i),{key:n,type:t.type,observerId:this.observerId,ownerId:t.ownerId,itemId:t.itemId,isTracked:!1,isReached:!1,viewStart:0,viewEnd:0,duration:0,node:e,viewTimer:0,data:{},platform:this.getPlatform(),city:_().city,screen:_().screen}),this.trackingItems[n]},e.prototype.getNextUnifyId=function(){return++this.uniqueNodeCounter},e.prototype.unifyNode=function(e){e.getAttribute("data-stat-id")||e.setAttribute("data-stat-id",String(this.getNextUnifyId()))},e.prototype.startObserving=function(){var e=this;this.update(),this.viewportScanner=Object(u.debounce)((function(){e.nodes=e.nodes.filter((function(t){var n=e.getTrackingItem(t);return!!n&&e.filterItem(n)}))}),this._debounceTimeout),this.scrollEventListener=function(){return e.scan()},document.addEventListener("scroll",this.scrollEventListener,{passive:!0}),this.scan()},e.prototype.stopObserving=function(){document.removeEventListener("scroll",this.scrollEventListener),this.nodes=[],this.viewportScanner=function(){},this.scrollEventListener=function(){}},e}();var h,m=(h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return m(t,e),t.prototype.filterItem=function(e){return!e.isTracked&&(e.isReached&&!this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.isItemReached(e.node)&&this.view(e),this.persist(e),!0))},t.prototype.view=function(e){var t=this;e.isTracked||(e.isReached=!0,e.viewStart||(e.viewStart=Date.now()),e.viewTimer&&(clearTimeout(e.viewTimer),e.viewTimer=0),e.viewTimer=window.setTimeout((function(){var n=e.node;!t.isItemReached(n)||function(e){var t=e.viewStart;return Date.now()-t>3e4}(e)?t.track(e):t.view(e)}),3e3))},t.prototype.track=function(t){t.viewTimer&&(clearTimeout(t.viewTimer),t.viewTimer=0),e.prototype.track.call(this,t)},t}(p),g=n("ZD4m"),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(e){function t(n,i,a,r,o,s,l){void 0===a&&(a=""),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===s&&(s="");var u=e.call(this,n,i,a,r,s,l)||this;return u.observerId=n,u.itemSelector=i,u.container=a,u.isUnifyNodes=r,u.isDynamicNodes=o,u.gap=null,o&&u.addMutators([new c]),u.gap=t.getViewportGap(u.getPlatform()),u}return A(t,e),t.prototype.isReached=function(e){if(!Object(i.isElementVisible)(e))return!1;var t,n=this.gap,a=e.closest("[data-stat-viewport]");if(a){var r=a.getBoundingClientRect();n={top:r.top,left:r.left},t={width:r.left+r.width,height:r.top+r.height}}return Object(i.isElementInViewport)(e,45,n,t)},t.create=function(e){return new t(e.observerId,e.itemSelector,null==e?void 0:e.container,null==e?void 0:e.isUnifyNodes,null==e?void 0:e.isDynamicContent,null==e?void 0:e.platform,null==e?void 0:e.getExtraItemParams)},t.getViewportGap=function(e){void 0===e&&(e="");var t={left:0,top:0},n="";return n=e===a.PLATFORM_MVK?"#vk_head":"#page_header_wrap,#market_search_input",document.querySelectorAll(n).forEach((function(e){var n=Object(g.getElementSize)(e);t.top=t.top+n.height})),t},t}(v),y=n("RJa5"),w=[],O=!1;function S(e,t){void 0===t&&(t=0);var n=k(t);return!!n&&e.includes(n.event)}function k(e){return void 0===e&&(e=0),w.length>e?w[w.length-(1+e)]:null}function C(e){O||(window.addEventListener("beforeunload",(function(){!function(){for(var e in d){if(d[e])d[e].stop()}}(),l(e)})),O=!0)}function E(){!function(){for(var e in d){if(d[e])d[e].scan()}}()}function j(e){if(function(e){var t=k();if(t){if(e===y.ECommGoodsEvent.CLOSE_ITEM&&t.event===y.ECommGoodsEvent.CLOSE_ITEM)return!1;if(e===y.ECommGoodsEvent.TRANSITION_TO_ITEM){if(S([y.ECommGoodsEvent.TRANSITION_TO_ITEM_LEFT,y.ECommGoodsEvent.TRANSITION_TO_ITEM_RIGHT]))return!1;if(S([y.ECommGoodsEvent.SWITCH_ITEM_VARIANT_1,y.ECommGoodsEvent.SWITCH_ITEM_VARIANT_2]))return!1}}return!0}(e.event))if(e.event||e.table){e.table||(Object.values(y.ECommGoodsEvent).includes(e.event)?e.table=y.AnalyticsEventTable.GOODS:Object.values(y.ECommOrdersEvent).includes(e.event)?e.table=y.AnalyticsEventTable.ORDERS:Object(i.marketDebug)("error","table not specified")),e.screen=e.screen?e.screen:window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getScreen(),e.platform=e.platform?e.platform:"web",C(e.platform);var t=String(e.event),n=e.table+":"+t;e.instant?function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!0)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration):function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!1)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration),w.push(e),w.length>3&&w.shift()}else Object(i.marketDebug)("error","event and table not specified",e)}function T(e,t){var n;switch(void 0===t&&(t=""),C(t),l(t),Object(i.marketDebug)("warn","analytics: start tracking area",e),e){case y.AnalyticsArea.MARKET:n=function(e){var t=0;void 0!==window.cur.aid&&(t=window.cur.aid),j({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?t:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var r=b.create({observerId:"market_products",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});r.itemReachedCallback=n;var o=b.create({observerId:"market_albums",itemSelector:{types:"market_album"},isUnifyNodes:!0,isDynamicContent:!1,platform:t});o.itemReachedCallback=n,t!==a.PLATFORM_MVK&&(o.preCheckReachedCallback=function(e){var t,n=e.offsetTop,i=null===(t=e.parentNode)||void 0===t?void 0:t.parentNode;return i&&n<i.offsetHeight}),r.watch(),o.watch();break;case y.AnalyticsArea.GROUP:n=function(e){j({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?0:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var s=b.create({observerId:"market_module",itemSelector:{types:"market_item"},isUnifyNodes:!0,platform:t});s.itemReachedCallback=n;var c=b.create({observerId:"group_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});c.itemReachedCallback=n,s.watch(),c.watch();break;case y.AnalyticsArea.USER_PROFILE:var u=b.create({observerId:"user_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});u.itemReachedCallback=function(e){j({event:"market_item"===e.type?y.ECommGoodsEvent.VIEW_ITEM:y.ECommGoodsEvent.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,duration:e.duration,time:e.viewStart,albumId:"market_item"===e.type?0:e.itemId,platform:e.platform})},u.watch();break;case y.AnalyticsArea.BOOKMARKS:var d=b.create({observerId:"bookmarks",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});d.itemReachedCallback=function(e){j({table:y.AnalyticsEventTable.GOODS,event:y.ECommGoodsEvent.VIEW_ITEM,ownerId:e.ownerId,itemId:e.itemId,duration:e.duration,time:e.viewStart,albumId:0,platform:e.platform})},d.watch()}}},he4e:function(e,t,n){"use strict";n.r(t),n.d(t,"clear",(function(){return d})),n.d(t,"onClear",(function(){return l})),n.d(t,"onClearConfirm",(function(){return _})),n.d(t,"onClearDecline",(function(){return f})),n.d(t,"isCleared",(function(){return u}));var i=n("OcsD"),a=n("+cqQ"),r=n("UxAg"),o=n("r/ag"),s=n("29dZ"),l=Object(a.default)(),c={};function u(e){var t=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(e)[2];return!!c[t]||!!c[e]}function d(e,t,n,a,r,o){if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),o){s.default.setLoading(e,!0,"white");var l="restr_"+Object(i.srand)(),c=e.closest(".PostPhotoRestriction");Object(i.domData)(c,"clear-id",l),function(e,t,n,i,a){photoview._toggleTouches(!1),clog("[PostPhotoRestriction] Show confirm to unblur "+i),Confirm(t,"PostPhotoRestriction.onClearConfirm('"+e+"', '"+i+"', '"+a+"')","PostPhotoRestriction.onClearDecline('"+e+"')",{id:e,ok_text:n})}(l,n,a,r,o)}else clog("[PostPhotoRestriction] No hash was provided")}function _(e,t,n){o.default.close(Object(i.ge)(e)),photoview._toggleTouches(!0),ajax.post(t+"?act=unblur&hash="+n,{},{onDone:function(n){var a=Object(r.$)('[data-clear-id="'+e+'"]');if(a){var o=Object(r.$)(".SplashScreen__more .Btn",a);s.default.setLoading(o,!1),a.classList.add("PostPhotoRestriction--clear")}else clog("[PostPhotoRestriction] Can't find restriction el with clear id "+e);var u=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(t),d=u[2],_=u[3],f=[];n?(f.push.apply(f,Object(r.$$)('.thumb_map_img--blur[data-id^="'+d+'"]')),f.push.apply(f,Object(r.$$)('.thumb_map_img--blur[href^="/photo'+d+'"]'))):(f.push(Object(r.$)('.thumb_map_img--blur[data-id="'+d+"_"+_+'"]')),f.push(Object(r.$)('.thumb_map_img--blur[href^="/photo'+d+"_"+_+'"]'))),f.forEach((function(e){if(e){e.classList.remove("thumb_map_img--blur");var t=Object(r.$)(".PostPhotoRestriction--blur,.PostPhotoRestriction--blurWithText",e);Object(i.re)(t)}})),n&&(c[""+d]=!0),c[t]=!0,l(t);var p=[];n?p.push.apply(p,Object(r.$$)('.PhotosPhotoItem__photo[data-id^="'+d+'"]')):p.push(Object(r.$)('.PhotosPhotoItem__photo[data-id="'+t.replace("photo","")+'"]')),p.forEach((function(e){if(e){e.classList.remove("PhotosPhotoItem__photo--blur");var t=Object(r.$)(".PhotosPhotoItem__restriction",e);Object(i.re)(t)}}));var h=[];n?h.push.apply(h,Object(r.$$)('.AlbumItem__thumb--blur[data-thumb-id^="'+d+'"]')):h.push(Object(r.$)('.AlbumItem__thumb--blur[data-thumb-id="'+t.replace("photo","")+'"]')),h.forEach((function(e){if(e){e.classList.remove("AlbumItem__thumb--blur");var t=Object(r.$)(".AlbumItem__restriction",e);Object(i.re)(t)}})),setTimeout((function(){Object(i.remove)(a)}),500)}})}function f(e){var t=Object(r.$)('[data-clear-id="'+e+'"]'),n=Object(r.$)(".SplashScreen__more .Btn",t);photoview._toggleTouches(!0),o.default.close(Object(i.ge)(e)),s.default.setLoading(n,!1)}nav.onBeforeGo((function(){Object(r.$$)(".Confirm[id^=restr]").forEach((function(e){f(e.id)}))}))},hw56:function(e,t,n){"use strict";n.r(t),n.d(t,"getKeyboardState",(function(){return l})),n.d(t,"getKeyboardType",(function(){return c})),n.d(t,"setKeyboardType",(function(){return u})),n.d(t,"clearCallbackButtons",(function(){return _})),n.d(t,"stopCallbackButtonWaiting",(function(){return f})),n.d(t,"registerCallbackButtonEvent",(function(){return p})),n.d(t,"loadDrafts",(function(){return h})),n.d(t,"getPeerDraft",(function(){return m})),n.d(t,"setPeerDraft",(function(){return v})),n.d(t,"pushPeerAttachments",(function(){return g})),n.d(t,"popPeerAttachments",(function(){return A})),n.d(t,"setPeerTyping",(function(){return b})),n.d(t,"removePeerTypingUser",(function(){return y})),n.d(t,"filterPeerTypingUser",(function(){return w})),n.d(t,"replacePeer",(function(){return S})),n.d(t,"removePeer",(function(){return k})),n.d(t,"addPeer",(function(){return C})),n.d(t,"addPendingMsg",(function(){return E})),n.d(t,"getPendingMsg",(function(){return j})),n.d(t,"removePendingMsg",(function(){return T})),n.d(t,"removeFailedMsg",(function(){return I})),n.d(t,"failAllPendingMsgs",(function(){return M})),n.d(t,"queueToPresendMsgs",(function(){return D})),n.d(t,"saveFolderScroll",(function(){return P})),n.d(t,"restoreFolderScroll",(function(){return x}));var i=n("wx14"),a=(n("2IoG"),n("qHA9")),r=n("29dZ"),o=n("jE6c"),s=n("OcsD");function l(e){var t=store.mail.cur.keyboards,n=t[e];return n||(n=t[e]={}),n}function c(){return store.mail.cur&&store.mail.cur.keyboardType||""}function u(e){store.mail.cur&&(store.mail.cur.keyboardType=e)}var d={};function _(e,t){void 0===t&&(t=!1),store.mail.cur.pressedButtons&&(t?delete store.mail.cur.pressedButtons.msgs[t]:delete store.mail.cur.pressedButtons.peers[e])}function f(e){var t=d[e];if(t){var n,i=t.peerId,a=t.msgId,o=t.position,s=t.button,l=t.inline;if(l?store.mail.cur.pressedButtons.msgs[a]&&delete store.mail.cur.pressedButtons.msgs[a][o.join(",")]:store.mail.cur.pressedButtons.peers[i]&&delete store.mail.cur.pressedButtons.peers[i][o.join(",")],delete d[e],!bodyNode.contains(s))(n=l?$(".msg_id_"+a+" .BotsKeyboard__main"):$(".uMailWrite__keyboard .BotsKeyboard__main"))&&(s=$('.BotsKeyboard__button[data-position="'+o.join(",")+'"]',n));s&&r.default.setLoading(s,!1)}}function p(e,t,n,i){var a=(Object(s.domData)(t,"position")||"").split(",");if(!a)return r.default.setLoading(t,!1),clog("Can't find button position for callback event"),!1;d[n]={time:Object(o.vkNow)(),peerId:e,msgId:i,button:t,position:a,inline:!!i},store.mail.cur.pressedButtons||(store.mail.cur.pressedButtons={peers:{},msgs:{}}),a[0]&&a[1]&&(i?(store.mail.cur.pressedButtons.msgs[i]||(store.mail.cur.pressedButtons.msgs[i]={}),store.mail.cur.pressedButtons.msgs[i][a.join(",")]=n):(store.mail.cur.pressedButtons.peers[e]||(store.mail.cur.pressedButtons.peers[e]={}),store.mail.cur.pressedButtons.peers[e][a.join(",")]=n)),setTimeout((function(){f(n)}),6e4)}function h(e){var t=store.mail.cur.drafts;return t||(t=lsGet("mail_drafts_"+e),t=store.mail.cur.drafts=t||{}),t}function m(e,t){var n=h(e);return n[t]||(n[t]={})}function v(e,t,n,a){var r=store.mail.cur.drafts;if(r||(r=store.mail.cur.drafts=r||{}),a){var o=r[t],s=o&&o.editing&&o.editing.id===a?o.editing:void 0;r[t]=Object(i.default)({},o,{editing:Object(i.default)({},s,{},n,{id:a})})}else r[t]=Object(i.default)({},r[t],{},n,{editing:void 0});lsSet("mail_drafts_"+e,r)}function g(e,t){var n=store.mail.peers[e];n.attachmentsStack.push(n.attachmentsHTML),n.attachmentsHTML=t}function A(e){var t=store.mail.peers[e],n=t.attachmentsStack.pop();n||(n=Brick({mix:"cp_attached_wrap",attrs:'id="attached_wrap"'})),t.attachmentsHTML=n}function b(e,t){var n=store.mail.cur.typings[e];if(n||(n=store.mail.cur.typings[e]={}),"text"!==t.type&&"audio"!==t.type||(t.count?n[t.type]=t:n[t.type]=null),n.text&&n.audio){var i=O(n.text,n.audio);n.mixed=i.count>1?i:null}else n.mixed=null}function y(e,t){var n=store.mail.cur.typings[e];if(n){var i=n.audio,a=n.text;if(i&&((i=w(i,t)).count?n.audio=i:n.audio=null),a&&((a=w(a,t)).count?n.text=a:n.text=null),n.text&&n.audio){var r=O(n.text,n.audio);n.mixed=r.count>1?r:null}else n.mixed=null}}function w(e,t){var n=e.users.filter((function(e){return e!==t}));return n.length!==e.users.length&&(e.count=e.count-(e.users.length-n.length),e.users=n),e}function O(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return e.count+=t.count,t.users.reduce((function(e,t){return-1===e.users.indexOf(t)?e.users.push(t):e.count--,e}),e)}),{users:[],count:0,type:"mixed"})}function S(e,t){var n=store.mail,i=n.scraps.folder,a=i.indexOf(e);-1!==a&&(t?i.splice(a,1,t):i.splice(a,1)),Object.keys(n.rolls.folder).forEach((function(i){var a=n.rolls.folder[i],r=a.indexOf(e);-1!==r&&(t?a.splice(r,1,t):a.splice(r,1))})),t&&(n.rolls.peer[t]=n.rolls.peer[e],n.reached.peer.before[t]=n.reached.peer.before[e],n.reached.peer.after[t]=n.reached.peer.after[e]),e!==t&&(n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(i){var a=n.msgs[i];a&&(t?(a.peerId=t,a.authorId===e&&(a.authorId=t)):delete n.msgs[i])})),delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e],delete n.members[e],delete n.peers[e])}function k(e,t){void 0===t&&(t={});var n=store.mail;if(!1!==t.lists){var i=n.scraps.folder,a=i.indexOf(e);-1!==a&&i.splice(a,1),Object.keys(n.rolls.folder).forEach((function(t){var i=n.rolls.folder[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)}))}!1!==t.msgs&&n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(e){n.msgs[e]&&delete n.msgs[e]})),!1!==t.lists&&(delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e]),!1!==t.data&&(delete n.members[e],delete n.peers[e])}function C(e,t){void 0===t&&(t={});var n=store.mail;if(t.msgs){var i=t.msgs;n.rolls.peer[e]=i,n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1}else n.rolls.peer[e]||(n.rolls.peer[e]=[],n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1);var a=n.msgs[n.rolls.peer[e][0]];n.rolls.folder.all.unshift(e),n.cur.folder&&n.scraps.folder.unshift(e),a&&(a.isUnread&&n.rolls.folder.unread.unshift(e),a.isImportant&&n.rolls.folder.important.unshift(e))}function E(e){var t=store.mail.presend;t.pending[e.peerId]||(t.pending[e.peerId]=[]),t.msgs[e.sendId]=e,t.pending[e.peerId].push(e.sendId)}function j(e,t){var n=store.mail.presend;return n.pending[t]?n.msgs[e]:null}function T(e){var t=store.mail.presend;if(t.pending[e.peerId]){var n=e.sendId;delete t.msgs[n],t.pending[e.peerId]=t.pending[e.peerId].filter((function(e){return e!==n}))}}function I(e){var t=store.mail.presend;if(t.failed[e.peerId]){var n=e.sendId;delete t.msgs[n],t.failed[e.peerId]=t.failed[e.peerId].filter((function(e){return e!==n}))}}function M(){var e=store.mail.presend,t={};Object.keys(e.msgs).forEach((function(n){var i=e.msgs[n];i.pending=!1,i.failed=!0,t[i.peerId]||(t[i.peerId]=[]),t[i.peerId].push(n)}),{}),e.pending={},e.failed=t}function D(e){var t={};Object.keys(e.items).forEach((function(n){var i=e.items[n];t[n]=Object(a.sendDataToMessage)(i.data.data,-1!==e.failed.indexOf(n))}));var n={};e.pending.forEach((function(e){var i=t[e];n[i.peerId]||(n[i.peerId]=[]),n[i.peerId].push(e)}),{});var i={};e.failed.forEach((function(e){var n=t[e];i[n.peerId]||(i[n.peerId]=[]),i[n.peerId].push(e)}),{}),store.mail.presend={msgs:t,pending:n,failed:i}}function P(e,t){var n=store.mail.cur;n&&(n.folderScroll||(n.folderScroll={}),n.folderScroll[e]=t)}function x(e){var t=store.mail.cur;if(t){t.folderScroll||(t.folderScroll={});var n=t.folderScroll[e]||0;return t.folderScroll[e]=0,n}}},iS9e:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function r(){var e=Object(i.default)(['\n    <div class="','" role="dialog" id="mail-dialog">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            ',"\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return r=function(){return e},e}var o=function(e){var t=e.onClose||a.default.onClick("MailDialog._onDialogClose"),n=a.default.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");var o="";o=e.buttons?e.buttons:'<div class="BtnStack">\n      <div class="Btn Btn_theme_regular mailDialog__button mailDialog__confirmButton" '+e.onConfirm+">"+e.confirmText+'</div>\n      <div class="Btn Btn_theme_secondary mailDialog__button mailDialog__closeButton" '+t+">"+e.cancelText+"</div>\n    </div>";return a.default.html(r(),n,t,t,i,e.body,o)};var s,l=n("UxAg"),c=n("OcsD");function u(){var e=Object(l.$)(".messenger__dialog");s=null,e.innerHTML=""}Object.assign(o,{open:function(e){s={},"function"==typeof e.onConfirm&&(s.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(s.onClose=e.onClose,e.onClose="");var t=Object(l.$)(".messenger__dialog"),n=o(e),i=Object(c.ceFromString)(n);s.onConfirm&&(Object(l.$)(".mailDialog__confirmButton",i).onclick=function(e){return s.onConfirm(e,t)});s.onClose&&Object(l.$$)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",i).forEach((function(e){e.onclick=function(e){return s.onClose(e,t)}}));t.innerHTML="",t.appendChild(i)},close:u,_onDialogClose:u});t.default=o;window.MailDialog=o},iWgD:function(e,t,n){"use strict";n.r(t),n.d(t,"uTyping_getPeerTyping",(function(){return i})),n.d(t,"uTyping_getNames",(function(){return a}));n("rKUZ");function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function a(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,a=[],r=0;r<i;r++){var o=t[n[r]];if(o){var s=1===i?o.name:o.shortName;a.push(s)}}return a}},iwo4:function(e,t,n){"use strict";n.r(t),n.d(t,"audioRepeat",(function(){return i}));var i={NONE:0,ALL:1,ONE:2}},izth:function(e,t,n){"use strict";function i(){var e=document.domain||"";if(!["oauth.","api."].some((function(t){return e.includes(t)}))){var t=e.match(/(m\.)?([a-zA-Z]+\.[a-zA-Z]+\.?)$/);window.locDomain="https:"===location.protocol?t[2]:t[0];var n=navigator.userAgent.toLowerCase();!/opera/i.test(n)&&/msie 6/i.test(n)&&document.domain===window.locDomain||(document.domain=window.locDomain)}}n.r(t),n.d(t,"setDocumentDomain",(function(){return i}))},j1wj:function(e,t,n){"use strict";n.r(t),n.d(t,"getTimeFromStart",(function(){return a}));var i=0;function a(){return performance?performance.now():i?Date.now()-i:0}window.onDOMReady((function(){i=Date.now()}))},j80l:function(e,t,n){"use strict";function i(e,t){var n=need("nav");if(!t)return e;var i=e.split("?"),a=i[0],r=i[1],o={},s=[];return r&&r.split("&").map((function(e){var n=e.split("="),i=n[0],a=n[1];i in t||(t[i]=a)})),Object.keys(t).forEach((function(e){var i,a=t[e];!0===a&&(a=n.getQuery(e)),("string"==typeof(i=a)&&i||function(e){return"number"==typeof e&&!isNaN(e)}(a))&&(o[e]=a)})),Object.keys(o).forEach((function(e){s.push(e+"="+encodeURIComponent(o[e]))})),0===s.length?a:a+"?"+s.join("&")}n.r(t),n.d(t,"makeUrl",(function(){return i})),n.d(t,"parseURL",(function(){return r})),t.default=window.Url={make:i};var a=["protocol","hostname","host","pathname","port","search","hash","href"];function r(e){var t=window.ce("a",{href:e}),n=a.reduce((function(e,n){return e[n]=t[n],e}),{});return n.requestUri=""+n.pathname+n.search,n}},"k+Df":function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("TYsd"),r=n("9y81"),o=n("29dZ"),s=n("tlMv");t.default=function(e){void 0===e&&(e={});var t=null;e.icon_raw?t=e.icon_raw:e.icon&&(t=Object(r.IconWd)({class:"SplashScreen__icon",icon:e.icon,svg:e.is_svg_icon}));var n=a.default.wrap(e.more_text);"primary"!==e.more_type&&"regular"!==e.more_type&&"outlineMono"!==e.more_type||(n=Object(o.default)({inner:[e.more_text],theme:e.more_type,url:e.more_url,onClick:e.more_onclick,attrs:{ontouchend:e.more_ontouchend},use_native_onclick:e.more_native_onclick}),e.more_url=null);var l=[e.class,i.default.class("SplashScreen",e.mix||{})];e.small&&l.push("SplashScreen--small");return[e.separator?Object(s.default)({hideOnDesktop:!e.separator_desktop}):null,{class:l,inner:e.inner||[e.before,t,e.title?{class:"SplashScreen__title",inner:a.default.wrap(e.title)}:null,e.text?{class:[e.text_class,"SplashScreen__text"],inner:a.default.wrap(e.text)}:null,e.more_text?{class:"SplashScreen__more",inner:n,href:e.more_url}:null,e.action_text?{class:"SplashScreen__action",inner:{class:"SplashScreen__actionButton",inner:a.default.wrap(e.action_text),href:e.action_url}}:null]}].filter((function(e){return e}))}},kYGI:function(e,t){var n={tt:!1,handlers:[],show:function(){n.shown||(n.tt=Array.prototype.slice.call(arguments))},hide:function(){n.tt&&(n.tt=!1)},addHandler:function(e){e&&n.handlers.push(e)},removeHandler:function(e){e?each(n.handlers,(function(t){if(e===this)return n.handlers.splice(t,1),!1})):n.handlers=[]},onClose:function(){each(n.handlers,(function(){this()}))},clear:function(){n.tt&&(n.hide(),n.onClose(),n.removeHandler())},closeByTap:function(e){if(!n.tt||!e.target)return!1;var t=e.target;do{for(var i=0;i<n.tt.length;i++)if(t===n.tt[i])return!1}while(t=t.parentNode);return n.hide(),n.onClose(),!0}};window.tooltip=n},kr3z:function(e,t,n){"use strict";n.r(t);var i=n("wx14"),a=n("UxAg"),r=n("+cqQ"),o=n("jk6M"),s=n("jE6c"),l=n("OcsD"),c=n("j80l"),u=n("eGQV"),d=n("tgcV"),_=n("cGUQ"),f=n("izth"),p=n("Cbap"),h=function(e){void 0===e&&(e={});var t=["AudioPlaylistRoot",e.class].filter((function(e){return e})).join(" ");return{attrs:{"data-playlist-id":e.playlist_id},inner:e.inner,class:t}};var m=n("g3t9"),v=n("fdw3"),g=n("0hva"),A=n("z1UI"),b=n("GtpT"),y=n("vOib"),w=n("v+Uj");var O=function(e){void 0===e&&(e={});var t=window.lang,n=e.items||[],i=e.count||null,a=e.href,r=n.map((function(e){return{inner:[Object(b.default)({album:e})],class:"AlbumsBlock__album",tag:"div"}})),o={text:Object(v.getLang)("mobile_subheader_show_all"),class:"al_albums",url:a},s=Object(w.default)({inner:[{inner:[r],class:"AlbumsBlock__albums",tag:"div"}]});return{inner:[{name:"albums",tag:"a"},Object(y.default)({title:t.mobile_photos_block_albums_title,count:i,corner:o,content:s,no_border:!0,noShadow:!0})],class:"AlbumsBlock",tag:"div"}},S=n("1VZq");var k=function(e){var t=window.lang,n=e.items||[],i=e.count||null,a=e.buttons||{},r=e.href,o=e.hide_header||!1,s=e.label||t.mobile_photos_block_photos_title,l="PhotosBlock",c="PhotosBlock__photos";!!e.autoload&&(l+=" PhotosBlock--autoload",c+=" photos_page");var u={inner:[n.map((function(e){return Object(S.default)({photo:e})}))],class:c,tag:"div"},d=null;return r&&(d={text:Object(v.getLang)("mobile_subheader_show_all"),class:"al_empty",url:r}),{inner:[{name:"photos",tag:"a"},Object(y.default)({inner:[{inner:[a.prev,u,a.more],tag:"div"}],title:o?null:s,corner:d,count:i,noShadow:!0,no_border:!0})],class:l,tag:"div"}},C=n("tlMv");var E=function(e){var t=window.lang,n=e.pretag,i=e.buttons||{},a=e.is_owner,r=[],o=e.section,s=e.albums,l=e.albums_count,c=e.albums_href,u=e.photos,d=e.photos_count,_=e.new_tags_photos,f=e.new_tags_count,p=e.new_tags_href;if("all"===o){var h=s.map((function(e){return Object(b.default)({album:e})}));h&&r.push({inner:[i.prev?i.prev:null,{inner:[h],class:"AlbumsPage__items album_items photos_page bl_cont",tag:"div"},i.more?i.more:null],tag:"div"})}else s&&s.length&&r.push(O({items:s,count:l,href:c})),_&&_.length&&r.push(k({label:t.mobile_photos_block_tags_title,items:_,count:f,href:p})),u&&u.length&&r.push(k({autoload:!0,items:u,count:d,buttons:i}));if(!r.length){var m=a?t.mobile_albums_can_store_photos:t.mobile_albums_no_albums;return Object(A.default)({separator:!0,text:m,more_type:"primary",more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_url:e.add_url})}return{inner:["all"!==o?Object(C.default)({hideOnDesktop:!0}):null,{inner:[r],class:"upanel bl_cont",tag:"div"},n],class:"AlbumsPage PageBlock PageBlock_bottomPadding",tag:"div"}},j=n("GVTI"),T=n("W9Tc"),I=n("gF8j"),M=n("r/ag"),D=n("29dZ"),P=n("vk58");var x,L=function(e){var t=function(e){var t=e.buttons,n=Object.keys(t).map((function(n){var i=t[n],a=i.theme;a="yes"!==n||a?"secondary":"regular";var r={"data-key":n,"data-force":e.force?1:0};return Object(D.default)({inner:[i.text],theme:a,url:i.href,attrs:r,on_click:"ConfirmPopup.onButtonClick(this, event);",use_native_onclick:!0})}));return Object(P.default)({inner:[n]})}(e),n={title:e.title};return Object(M.default)({inner:[Wd.wrap(e.text),{inner:[t],class:"Popup__buttons",tag:"div"}],class:"ConfirmPopup",header:n,scrollable:!0,on_overlay_click_native:"ConfirmPopup.onOverlayClick(this, event);"})},B=n("zq7H"),R=n("j1wj");if(!window.ajax){var N={onBeforeRedirect:Object(r.default)("url"),onBeforePageParse:Object(r.default)(),onPostsLoad:Object(r.default)(),onRedirect:Object(l.se)(),onNavDone:Object(r.default)(),_tStart:!1,_tAlStart:!1,RESPONSE_ARGUMENTS:0,RESPONSE_REDIRECT:1,RESPONSE_CAPTCHA:2,RESPONSE_PAGE:3,RESPONSE_FAILED_AUTH:4,RESPONSE_CONFIRM:5,RESPONSE_IGNORE:100,_getreq:function(){return new XMLHttpRequest},_al_reqs:[],_last_req:null,save_req:function(e){N._al_reqs.push(e||N._last_req)},abort_reqs:function(){Object(l.each)(N._al_reqs,(function(e,t){t.abort()})),N._al_reqs=[]},_failed_relogin:!1,_failed_reqs:[],save_failed_req:function(e,t,n,i){N._failed_reqs.push([e,t,n,i])},repeat_reqs:function(){Object(l.each)(N._failed_reqs,(function(){var e=this.shift();N._post.apply(null,this),Object(l.remove)(e)})),N._failed_reqs=[]},_error_displayed:null,plainpost:function(e,t,n,i,a,r,o,s){var c="string"!=typeof t?Object(_.toQueryString)(t,!0):t,d={"Content-Type":"application/x-www-form-urlencoded"};a||s||(d["X-Requested-With"]="XMLHttpRequest"),s||(Object(u.isStandalone)()&&(d["X-View-Mode"]="pwa"),r&&r.headers&&Object.assign(d,r.headers));var f=new AbortController,p=f.signal,h=new Request(e,{credentials:"same-origin",method:"POST",headers:d,body:c,signal:p}),m=fetch(h).then((function(e){return e.text().then((function(t){return e.status>=200&&e.status<300?n&&n(t,e):i&&i(t,e),{response:e,text:t}}))})).catch((function(e){var t=!1;if(i&&i(e&&e.message,null)&&(t=!0),"AbortError"===e.name)return null;if(window.isBasicOffline&&("true"===h.headers.get("X-Ajax-Nav")&&history.back(),!t&&(!N._error_displayed||N._error_displayed<=Date.now()-1e4))){var n=Object(l.getLang)("mobile_general_snackbar_error");navigator.onLine||(n=Object(l.getLang)("mobile_pwa_offline_network_lost")),Object(l.statlogsValueEvent)("mvk_ajax_error_snackbar",Number(navigator.onLine)),Snackbar.init({text:n}),N._error_displayed=Date.now()}throw e})),v={request:h,abort:f.abort.bind(f),promise:m};return N._last_req=v,v},post:function(e,t,n){return"/"!=e.substr(0,1)&&(e="/"+e),e=e.split("#")[0],N._post(e,t,n||{})},onPrepared:Object(l.se)(),prepare_click:function(e){var t=window.al;if(o.default.ios&&!(o.default.ios>=7)&&window.al&&t.ver){var n=[],i=!1;e&&"a"==(e.tagName||"").toLowerCase()?n.push(e):Object(l.isArray)(e)?n=e:(n=Object(l.geByTag)("a",e),i=!0);for(var a=0,r=n.length;a<r;a++){var s=n[a],c=s&&s.target||"";if(s&&s.getAttribute&&(!i||!s.getAttribute("data-href")&&Object(l.checkElementNav)(s,{skip_onclick:!0})&&"_blank"!=c)){var u=s.getAttribute("href");if(null==u||!Object(l.isHttpHref)(u))continue;Object(l.attr)(s,"data-href",Object(l.getHref)(s)),Object(l.attr)(s,"href",!1)}}}},click:function(e,t,n){var i=window.nav;t=t||{};var a,r=!1,o={_ajax:1},s=Object(l.extend)(t,{link:e});if(n=n||{},(n=Object(l.extend)({closeContextMenu:!0},n)).closeContextMenu&&ContextMenu.close(),t.onStart){var c=N.tAlGetParam();N.tAlStart=(new Date).getTime(),c&&(o._talstat=c)}if(n.use_cache){var u=Object(l.ge)(!0===n.use_cache?"preload_data":n.use_cache),d=u.innerHTML.replace(/(^<!--|-->$)/g,""),_=d.split("--\x3e\x3c!--");if(d)u.innerHTML="",t.onStart&&t.onStart.apply(s),n.nav&&i.go(r,null,{push_only:!0}),t.onDone&&t.onDone.apply(s,_),(e=Object(l.geByClass1)("show_more",Object(l.geByClass1)("pcont","mcont")))&&N.click(e,{onDone:function(){var e="";Object(l.each)(arguments,(function(t,n){e+="\x3c!--"+(n||"")+"--\x3e"})),u.innerHTML=e,Object(l.ge)("show_more_loading")&&N.click(!1,t,n),N.onPostsLoad()}},{closeContextMenu:!1});else t.onStart&&t.onStart.apply(s),n.nav&&i.go(r,null,{push_only:!0});return!1}if(!e)return!0;if(e.form){if(e.disabled)return!0;var f=e.form,p={};r=(f.action||"").replace(/^https?:\/\/[^\/]+/i,""),Object(l.each)(f,(function(t,n){return!(n.name&&!n.disabled)||("radio"===n.type&&!n.checked||("checkbox"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==e||("image"===n.type&&n!==e||void(p[n.name]=n.value))))))})),"image"==e.type&&(p[e.name]=e.value,p[e.name+".x"]=1,p[e.name+".y"]=1),f.method&&"get"!=f.method?Object(l.extend)(o,p):r=r.split("?",1).shift()+Object(l.obj2qs)(p)}else e.getAttribute&&(r=e.getAttribute("data-href")||e.getAttribute("href"));if(r||(r=e.pathname?e.pathname+e.search+e.hash:e),!r)return!0;Object(l.extend)(o,n.url_params||{});var h=window.pStats,m=h.getSeenData();if(m){var v=window.cur;o._pstat=m.data,v&&v.module&&(o._pstatref=v.module)}return(a=N.post(r,o,{onDone:function(){m&&h.onSend(m.seen),n.lock&&Object(l.unlockButton)(e),t.onDone&&t.onDone.apply(s,arguments),(n.nav||n.scroll)&&Object(l.scrollToHash)()},onFail:function(){n.lock&&Object(l.unlockButton)(e),t.onFail&&t.onFail.apply(s,arguments),(n.nav||n.scroll)&&Object(l.scrollToHash)()}}))&&(t.onStart&&t.onStart.apply(s),n.nav&&i.go(r,null,{push_only:!0}),n.lock&&Object(l.lockButton)(e)),!a},nav:function(e,t){var n=window.nav,r=window.page,u=window.menu,_=window.cur,f=window.Tabbar;(t=t||{}).nav=t.nav||{};var p,A=Object(l.getHref)(e),y=r.getHash(t.nav);if(!(A=n.checkUrl(A)))return!1;"/"!=A.substr(0,1)&&(A="/"+A),u.close(null,!0),N.navStart=Object(R.getTimeFromStart)();var w=N.tGetParam();if(N.tStart=(new Date).getTime(),t.need_restore&&u&&u.closeSearch(),window.isNewMail&&(t.need_restore&&t.nav.push&&!t.need_check_updates&&N.abort_reqs(),n.onBeforeGo2(t.nav.path,Object.assign({},Object(l.qs2obj)(t.nav.params),t.params),t.nav.push,t)))return N.abort_reqs(),!0;if(t.need_restore&&t.nav.push&&(p=r.restore(y))&&(N.abort_reqs(),N._failed_relogin=!1,p.lm&&Object(l.extend)(p.lm,{tn:!1,bn:!1}),r.set(y,p,{restored:!0},t),t.zProcess&&(t.zProcess(p.st),delete t.zProcess),n.set(t),N.tModule=window.cur.module,N.tRestoreRender=(new Date).getTime(),!t.need_check_updates))return!0;var O=!1,S=!1;if(t.need_check_updates&&n.isTabHaveCache(t.tab,y));else if(t.fast)O=!0,r.set(y,!1,{before:!0,beforeAppend:t.beforeAppend,afterAppend:t.afterAppend}),S=t.onAfterFast||!1;else if(t.target&&t.target.className&&!_.ignoreFastNav){(k=/(?:^|\s)(al_([a-z_]+)(-?[0-9]+)?)(?:\s|$)/i.exec(t.target.className))&&k[1];var k,C=k&&k[2]||!1;switch(C){case"menu":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){var n=Object(a.$)(".vk__page");if(n.className=n.className.replace("vk__page_notifications",""),window.isNewMail){var i=Object(l.geByClass1)("mcont",e)||Object(l.geByClass1)("layout__basis");Object(l.val)(i,'<div class="pcont bl_cont"><div id="al_loading"></div></div>')}else Object(l.val)(Object(l.geByClass1)("mcont",e),'<div class="pcont bl_cont"><div id="al_loading"></div></div>');r.setMhead(e,Object(l.attr)(t.target,"data-header"),"/")},afterAppend:function(){window.isNewMail&&"/mail"===y?Object(l.alLoadingFix)(Object(l.geByClass1)("layout").offsetHeight):Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"tab":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){Object(l.val)(Object(l.geByClass1)("upanel",e),'<div id="al_loading"></div>'),Object(l.val)(Object(l.geByClass1)("basisDefault",e),'<div id="al_loading"></div>');var t=Object(l.geByClass1)("tabs_block",e)||Object(l.geByClass1)("tabs",e),n=Object(l.geByClass1)("active",t);n&&(Object(l.hasClass)("tab_item_top",n)?(Object(l.removeClass)("tab_item_cur",Object(l.geByClass1)("tab_item_cur",t)),Object(l.addClass)("tab_item_cur",Object(l.geByClass1)("tab_item",t))):(Object(l.removeClass)("tab_item_cur",Object(l.geByClass1)("tab_item_cur",t)),Object(l.addClass)("tab_item_cur",n)))},afterAppend:function(){Object(l.alLoadingFix)()}},t);break;case"post":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(l.clone)(Object(l.gpeByClass)("post_item",t.target)),a=i.id,o=Object(l.outer)(Object(l.gpeByTag)("a",Object(l.geByClass1)("pi_img",i))).replace("pi_img","op_img"),s=Object(l.gpeByTag)("div",Object(l.geByClass1)("pi_author",i)),c=Object(l.remove)(Object(l.geByClass1)("pi_date",i)),u=Object(l.outer)(Object(l.remove)(Object(l.geByClass1)("explain",s))),d=Object(l.remove)(Object(l.geByClass1)("pi_fronly",i)),_=Object(l.outer)(s),f=Object(l.geByClass1)("pi_body",i),p=Object(l.geByClass1)("pi_text_more",f),h=(c=Object(l.geByClass1)("pi_date",i),Object(l.geByClass1)("pi_info",f)),m=Object(l.geByClass1)("pi_links",f),v=Object(l.geByClass1)("replies_link",m),g=Object(l.val)(Object(l.remove)(Object(l.geByClass1)("pi_actions_wrap",i))),A=Object(l.val)(Object(l.remove)(Object(l.geByClass1)("item_replies",h)))?Object(l.val)(v):n.mobile_wall_post_replies_title,b=v?'<a name="comments"></a><h3 class="slim_header">'+(A||"")+'</h3><div id="al_loading"></div>':"";if(p){var y=p.nextSibling?p:p.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}Object(l.val)(m,Object(l.outer)(Object(l.geByClass1)("like_wrap",f))),c&&Object(l.attr)(c,"data-date")&&Object(l.val)(c,Object(l.attr)(c,"data-date")),r.setMhead(e,Object(l.attr)(t.target,"data-header"),!0),Object(l.val)(Object(l.geByClass1)("mcont",e),function(e,t,n,i,a,r,o,s){return'<div class="pcont bl_cont"><div class="owner_panel">'+(t||"")+'<div class="op_cont">'+(n||"")+'<div class="op_info"><span class="item_date">'+(i||"")+'</span></div></div></div><div id="'+(e||"")+'" class="post_item single_post_item"><div class="pi_cont"><div class="pi_head">'+(a||"")+'</div><div class="pi_body">'+(r||"")+"</div></div>"+(s||"")+"</div>"+(o||"")+"</div>"}(a,o,_,Object(l.val)(c)+(d?'<b class="pi_fronly"></b>':""),u,Object(l.val)(f),b,g))},afterAppend:function(e){var n=Object(l.geByTag1)("h3",e);n&&Object(l.alLoadingFix)(t.nav.hash?Object(l.getCh)()-n.offsetHeight:0),t.nav.hash?Object(l.scrollToHash)(t.nav.hash):Object(l.scrollTop)(0)}},t);break;case"wall":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(l.clone)(Object(l.hasClass)("wall_item",t.target)?t.target:Object(l.gpeByClass)("wall_item",t.target)),a=i.id,o=Object(l.geByClass1)("wi_body",i),s=Object(l.geByClass1)("wi_buttons",i),c=Object(l.geByClass1)("item_like",s),u=Object(l.geByClass1)("v_like",c),d=Object(l.geByClass1)("item_share",s),_=Object(l.geByClass1)("v_share",d),f=Object(l.remove)(Object(l.geByClass1)("item_replies",s)),p=!!f&&Object(l.geByClass1)("v_replies",f),h=+Object(l.stripTags)(Object(l.val)(p)).replace(/\D/g,""),v=Object(l.geByClass1)("pi_text_more",o),g=Object(l.geByClass1)("wi_date",i),A=h?Object(l.langNumeric)(h,n.mobile_wall_post_comments):n.mobile_wall_post_replies_title,b=f&&h<50?'<a name="comments"></a><h3 class="slim_header">'+(A||"")+'</h3><div id="al_loading"></div>':"";if(clog("item_replies",f),Object(l.remove)(Object(l.geByClass1)("wi_actions_btn",i)),Object(l.remove)(Object(l.geByClass1)("post__subscribeBtn",i)),Object(l.remove)(Object(l.geByClass1)("post__extraHeader",i)),u?Object(l.val)(u):Object(l.append)(Object(l.ce)("span",{className:"v_like"}),c),_?Object(l.val)(_):Object(l.append)(Object(l.ce)("span",{className:"v_share"}),d),v){var y=v.nextSibling?v:v.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}g&&Object(l.attr)(g,"data-date")&&Object(l.val)(g,Object(l.attr)(g,"data-date")),r.setMhead(e,Object(l.attr)(t.target,"data-header"),!0);var w=Wd.html(Object(m.Separator)({hideOnDesktop:!0}));Object(l.val)(Object(l.geByClass1)("mcont",e),function(e,t,n,i){return'<div class="pcont"><div class="PageBlock">'+e+'<div class="wall_item single_wall_item" id="'+(t||"")+'">'+(n||"")+"</div>"+(i||"")+"</div></div>"}(w,a,Object(l.val)(i),b)),Object(l.addClass)("vk__page_singlePost",document.body)},afterAppend:function(e){var n=Object(l.geByTag1)("h3",e);n&&Object(l.alLoadingFix)(t.nav.hash?Object(l.getCh)()-n.offsetHeight:0),t.nav.hash?Object(l.scrollToHash)(t.nav.hash):Object(l.scrollTop)(0)}},t);break;case"pinfo":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){var t=window.lang,n=Object(l.geByClass1)("owner_panel",e),i=Object(l.geByClass1)("pp_img",n),a=Object(l.geByClass1)("op_header",n),o=Object(l.geByClass1)("lvi",a),s=Object(l.geByClass1)("pp_last_activity",n),c=Object(l.ce)("div");Object(l.addClass)("mhi_back",Object(l.geByClass1)("mh_header",e)),Object(l.val)(n,'<img src="'+Object(l.escapeAttr)(Object(l.attr)(i,"src")||"")+'" class="op_img"><div class="op_cont"><h2 class="op_header">'+Object(l.stripTags)(Object(l.val)(a))+'</h2><div class="pp_online">'+(o?t.mobile_online:Object(l.val)(s))+"</div></div>"),Object(l.val)(Object(l.geByClass1)("ipanel",e),"<div>"+Object(l.val)(c)+'</div><div id="al_loading"></div>'),r.setMhead(e,!1,!0)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0,10)}},t);break;case"player":O=!0;var I=Object(l.qs2obj)(t.nav.params).playlist_id;r.set(y,!1,{before:!0,beforeAppend:function(e){var t=window,n=t.lang,i=t.audio,a=(i.playlist(),i.playlist_q());r.setMhead(e,n.mobile_menu_player_head_title,!0),Object(l.val)(Object(l.geByClass1)("mcont",e),'\n                <div class="pcont audioPage">\n                  <div class="PageBlock">\n                    <div class="audioPage__header">\n                      '+AudioPlaylist.tplPlayerSearch(I)+'\n                    </div>\n                    <div id="au_search_items" class="upanel bl_cont">\n                      <div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(a)+'"></div>\n                    </div>\n                  </div>\n                </div>'),Object(l.val)("m",e.innerHTML)}},t),S=function(){var e=window,n=e.qsearch,i=e.audio,a=i.playlist(),s="/audio"+Object(l.obj2qs)({act:"player",list:I}),c=[],u={},d=i.getCurrentId();Object(l.each)(a,(function(e,t){t.chartInfo=null,c.push(t.fullId),u[t.fullId]=[t.performer+" "+t.title,t]}));var _=c.indexOf(d),f=_>-1?Math.min(_+10,c.length):50,p=[];n.init({action:s,al_action:s,container:"au_search_items",field:Object(l.ge)("au_search_field"),btn:Object(l.ge)("au_search_btn"),top_items:c,_cache:u,forceRerender:!0,tpl:function(e,t,n,a){var r="";if(t){if(a)return a;r=""==a?'<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(t)+'">'+e+"</div>":'<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(t)+'"><div class="al_loading qs_loading">&nbsp;</div></div>'}else r='<div class="audios_block audios_list _si_container" data-query="'+Object(l.escapeAttr)(i.playlist_q())+'">'+e+"</div>";return Wd.html(h({playlist_id:I,inner:Wd.wrap(r)}))},item_tpl:function(e){var t=window.audioplayer;return p.push(e),t&&t.getDOMFromAudio(e,!0,this.q,!0)||""},null_tpl:function(e){var t=window.lang;return'<div class="service_msg_box">\n                  <div class="service_msg service_msg_null">\n                  '+(e?t.mobile_audio_search_not_found.replace("%s",Object(l.htsc)(e)):t.mobile_audio_no_audio)+"\n                  </div>\n                </div>"},soft_filter:!0,need_invalid_keys:o.default.desktop,top_len:f,global_search:!0,onRendered:function(){var e=window,t=e.audioplayer,n=e.audio;t&&t.initAudio(),n.addToPlaylist(p),Object(l.alLoadingFix)()},al_need:!0,init_offset:0});var m=window.audioplayer.getCurrentElem();if(m){var v=Object(l.getY)(m)+m.offsetHeight/2-Object(l.getCh)()/2;Object(l.scrollTop)(v,100),r.save(y,{html:null,st:Object(l.scrollTop)(),page:Object(l.ge)("m"),state:r.stash(),cur:window.cur,options:t||{}},!1)}};break;case"photo":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n=Object(l.geByTag1)("img",t.target),i=(Object(l.attr)(n,"data-src_big")||"").split("|"),a=(i[0],i[1],i[2],n&&n.src||"/images/mobile/blank.gif"),o=n&&n.width||+i[1]||0,s=n&&n.height||+i[2]||0,c=(domData(n,"info-title"),domData(n,"info-subtitle"),function(e,t){return Wd.html(Object(j.default)({is_loading:!0,photo:e}))}({src:a,width:o,height:s}));Object(l.val)(Object(l.geByClass1)("mcont",e),c),Object(l.alLoadingFix)(),r.setMhead(e,lang.mobile_photos_photo_title)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"album":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n,o=t.target.href,s=/((?:album|tag)(-?\d+)(?:(?:_(\d+))?))/.exec(o);s&&(n=s[1]);var u=n&&Object(v.getState)(n)||{},d=Object(a.$)(".AlbumItemInfo__title",t.target),_=!1;t.target.classList.contains("AlbumItem--empty")&&(_=!0);var p=Object(c.makeUrl)("/"+n,{act:"select_album"}),h=Object(i.default)({},u,{title:u.title||Object(l.val)(d)||lang.mobile_page_title_album,description:Wd.wrap(u.description),is_empty:_,add_url:p}),m=function(e){return void 0===e&&(e={}),Wd.html(Object(g.default)(Object(i.default)({},e,{title:Wd.wrap(e.title),is_loading:!e.is_empty})))}(h);Object(l.val)(Object(l.geByClass1)("mcont",e),m),Object(l.alLoadingFix)(),r.setMhead(e,h.title,!0,!1,{movable:!0})},afterAppend:function(){Object(g.initAlbumPage)(),Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"albums":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n=t.target.closest(".AlbumsBlock"),r=[];n&&(r=Array.from(Object(a.$$)(".AlbumItem",n)).map((function(e){return Object(b.getDataFromDOM)(e).album})));var o=function(e){return void 0===e&&(e={}),Wd.html(E(Object(i.default)({},e,{section:"all"})))}({albums:r});Object(l.val)(Object(l.geByClass1)("mcont",e),o),Object(l.alLoadingFix)()},afterAppend:function(){Object(g.initAlbumPage)(),Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"u":case"g":case"p":case"e":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"playlists":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}});break;case"empty":case"artist":case"playlist":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(l.alLoadingFix)(),Object(l.scrollTop)(0)}},t);break;case"news_subsection":O=!0,r.set(y,!1,{before:!0,beforeAppend:function(e){var t=Object(l.geByClass1)("news_subsections",e);t&&!Object(l.hasClass)("summary_loading",t.firstChild)&&Object(l.before)(Object(l.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}});break;case"tabbar":O=!0,t.is_fast=!0;var M=!1,D={options:{is_fast:!0,tab:t.tab,prev_tab:t.prev_tab}};t.need_check_updates&&p&&(D=Object(l.extend)(D,p),M=!0),r.set(y,D,{before:!M,beforeAppend:function(e){r.setMhead(e,Object(l.attr)(t.target,"data-header"),!1),f.drawSkeletonLoader(e,t.tab),document.body.classList.contains("vk_tabbar_bottom")&&r.hideHeader(e)},afterAppend:function(){Object(l.alLoadingFix)()}});break;default:_=window.cur;var P=!!Object(l.geByClass1)("mhi_logo","mhead");if(O=!0,_.al_fast&&_.al_fast[C])r.set(y,!1,_.al_fast[C](t),t);else if(!P){var x={options:{is_fast:!0,tab:t.tab,removeAfterNextResponse:t.removeAfterNextResponse}};r.set(y,x,{before:!0,afterAppend:function(){Object(l.alLoadingFix)()}})}}}if(t.need_check_updates||N.abort_reqs(),t.local){var L=!0;r.set(y,{},{after:!0,no_scroll:!0,force:!0},!1),S&&S()}else{var B=Object(T.partConfigEnabled)("mvk_fix_nav_params")?{}:Object(l.qs2obj)(t.nav.params);Object(l.extend)(B,t.params||{}),window.al&&!window.al.inited?B[u.NEED_MENU_PARAM]=u.FORCE_NEED_MENU:window.al&&window.al.menu||(B[u.NEED_MENU_PARAM]=u.NEED_MENU),w&&(B._tstat=w);var F=window.pStats,H=F.getSeenData();H&&(B._pstat=H.data,_&&_.module&&(B._pstatref=_.module)),t.target&&Object(s.isElement)(t.target)&&(B._ref=domData(t.target,"ref")),B._ref||(B._ref=(n.path||"").substr(1));var U=A.split("#");!B._hash&&U.length>1&&(B._hash="#"+U[1]),Object(d.preloadStaticForNavigation)(A);var V=Object.assign({},t.headers,{"X-Ajax-Nav":"true"});L=N.post(A,B,{onPageDone:function(e,n,i,o,s){N.fastNav=!1;var l=window.cur;if(H&&F.onSend(H.seen),N.tProcess=(new Date).getTime(),r.set(y,{title:e,html:n,js:i,lm:o,bc:s,st:t.st||0},{after:O,no_scroll:O,al_transition:!0},!O&&t),t.back){var c=Object(a.$)(".layout");r.setMhead(c,!1,t.back)}N.tModule=l.module,N.tRender=(new Date).getTime(),N.onNavDone()},redirectToLoginPage:t.redirectToLoginPage,headers:V});N.save_req()}return O&&(t.zProcess&&(t.zProcess(),delete t.zProcess),n.set(t),N.tModule=_.module,N.tFastRender=(new Date).getTime(),N.fastNav=!0),L},confirm:function(e){function t(t,n,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i){return!!confirm(t)&&N.click(e,i,{url_params:{hash:n}})})),_post:function(e,t,n){var i=function(e,t){n.onFail&&n.onFail.call(window,0,e,t)},a=window.debuglogSent?window.debuglogSent(e):-1;return N.plainpost(e,t,(function(r,o){if(204===o.status&&o.headers.get("X-AppShell-Fallback")){var s=location.href;return history.replaceState(null,null,Object(c.makeUrl)(location.href,{__appshell_fallback:o.headers.get("X-AppShell-Fallback")})),void location.replace(s)}var u=!1;try{u=Object(l.parseJSON)(r)}catch(t){if(o.getResponseHeader("Content-Type").includes("text/html"))return nav.hard_go(e,null,n);u=!1}!1===u?i():(N.parseResponse(u,e,t,n),N._debugLog(a,u.debugLog))}),i,null,{headers:n.headers})},_debugLog:function(e,t){window.debuglogGot&&window.debuglogGot(e,t)},parseResponse:function(e,t,n,i){var r,o=window.al,s=window.nav,c=window.menu,u=window.page,_=e.version,h=e.counters,m=e.notifications,v=e.type,g=e.statsMeta,A=t.indexOf("community")>=0,b=!1;if(v!==N.RESPONSE_IGNORE)switch(A?(b=!(!window.al||_===o.ver))&&Object(l.statlogsValueEvent)("mvk_version_reload",1,_,o.ver,"old_force_reload_community"):window.al&&_!==o.ver?Object(T.partConfigEnabled)("mvk_lazy_static_reload")?v===N.RESPONSE_ARGUMENTS?x||(x=new I.default({id:"mvk_static_manager",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:6e5,onIdleCb:function(){Object(l.statlogsValueEvent)("mvk_version_reload",1,_,o.ver,"new_idle_reload"),x.stop(),location.reload()}})).start():(Object(l.statlogsValueEvent)("mvk_version_reload",1,_,o.ver,"new_force_reload"),b=!0):(Object(l.statlogsValueEvent)("mvk_version_reload",1,_,o.ver,"old_force_reload"),b=!0):!window.menu||e.lm_data&&e.lm_data.lm||c.isMenuHasItems()&&((b=!c.refreshCounters(h))&&Object(l.statlogsValueEvent)("mvk_version_reload",1,_,o.ver,"old_force_reload_change_menu"),c.refreshNotifications(m)),void 0===h||!1===h||A||Object(l.setNotify)(h[B.COUNTERS_POS_MESSAGES]),e.lm_data&&e.lm_data.lm&&(h&&(e.lm_data.counters=h),m&&(e.lm_data.notifications=m)),g&&window.vk&&(window.vk.statsMeta=g),v){case N.RESPONSE_ARGUMENTS:if(b)return s.hard_go(s.cur,null,{replace:!0});var y=e.data;if(r=y&&Object(l.isObject)(y[0])&&y[0]._snackbar){if(Snackbar.init(r),2===r.type)return photoview.opened()?void photoview.close():Stories.opened?void Stories.close():zlayer.opened()?void zlayer.close():void(N.fastNav&&history.back());delete y[0]._snackbar}i&&i.onDone&&i.onDone.apply(window,y);break;case N.RESPONSE_REDIRECT:var w=e.location;N.onRedirect(!0,w);var O=e.hard,S=e.frame,k=e.clear,C=e.restore,E=e.replace;if(!S&&window.isNewMail&&N.onBeforeRedirect(w))break;if(k&&s.clear(),(r=e._snackbar)&&(Snackbar.init(r),delete e.snackbar),b||O)s.hard_go(w,null,{replace:E});else if(S){Object(f.setDocumentDomain)();var j=w+(-1==w.indexOf("?")?"?":"&")+"__extra=1",M=Object(l.createIframe)({src:j})}else E&&w===s.prev_cur?history.back():s.go(w,null,{ignore_cur_process:!0,need_restore:C,replace:E});break;case N.RESPONSE_CAPTCHA:var D=e.location,P=e.img,R=e.post,F=e.key;i&&i.onFail?i.onFail(v,D,{location:D,img:P,post:R,key:F}):s.hard_go(D);break;case N.RESPONSE_PAGE:var H=e.lm_data;if(u.need_hard_go=b,H&&H.rdr&&window.al&&o.menu&&Object(l.getW)("vk_wrap")>=614){s.go(H.rdr,null,{replace:!0});break}p.default.getRouter().deactivateAllRoutes(),cur.share&&"destroy"in cur.share&&cur.share.destroy(),(i=i||{}).onPageDone||(i.onPageDone=function(e,n,i,a,r){s.go(t,null,{push_only:!0}),u.set(u.getHash(s),{title:e,html:n,js:i,lm:a,bc:r})});var U=e.title,V=e.html,$=e.js,W=e.body_class,q=e.top_bar,z=Object(l.ge)("vk_topbar");q&&!z?(z=Object(l.ce)("div",{id:"vk_topbar",innerHTML:q}),Object(l.before)(z,Object(a.$)(".layout"))):Object(l.val)(z,q),e.env&&e.env.pe&&(window.vk.pe=e.env.pe),Object(d.addStatic)(e.static_files).then((function(){i.onPageDone(U,V,$,H,W)}));break;case N.RESPONSE_FAILED_AUTH:if(i.redirectToLoginPage)return window.location=e.location,!1;if(!N._failed_relogin){var Y=e.location;Object(f.setDocumentDomain)();M=Object(l.createIframe)({src:Y})}N._failed_relogin=!0,N.save_failed_req(M,t,n,i);break;case N.RESPONSE_CONFIRM:var Q=e.data,G=L(Q),K=Wd.elem(G);Popup.open(K,!0);break;case N.RESPONSE_IGNORE:return}},onReLoginDone:function(){N.repeat_reqs(),N._failed_relogin=!1},tGetParam:function(){if(N.tStart&&N.tModule){var e=N.tFastRender-N.tStart,t=N.tRestoreRender-N.tStart,n=N.tProcess-N.tStart,i=N.tRender-N.tProcess,a=["/"==N.tModule.substr(0,1)?N.tModule.substr(1):N.tModule,e,t,n,i];for(var r in a)(!a[r]||a[r]<0)&&(a[r]=0);return N.tStart=!1,a.join(",")}},tAlGetParam:function(){if(N.tAlStart&&N.tAlModule){var e=N.tAlProcess-N.tAlStart,t=N.tAlRender-N.tAlProcess,n=["al_"+("/"==N.tAlModule.substr(0,1)?N.tAlModule.substr(1):N.tAlModule),e,t];for(var i in n)(!n[i]||n[i]<0)&&(n[i]=0);return N.tAlStart=!1,n.join(",")}},refreshLinks:function(e,t){if(e){var n=Object(l.geByClass1)("mmi_fv","lm_cont"),i=n&&Object(l.geByClass1)("lfm_item",n),a=Object(l.geByClass1)("mmi_fv","mfoot"),r=a&&Object(l.geByClass1)("lfm_item",a),o=Object(l.ge)("fv_link"),s=Object(l.ge)("menu_fv_link"),c=Object(l.geBySel1)('link[rel="canonical"]');Object(l.attr)(i,"href",e),Object(l.attr)(r,"href",e),Object(l.attr)(o,"href",e),Object(l.attr)(c,"href",Object(l.attr)(Object(l.ge)("mcont"),"data-canonical")),window.nav.prev_fv_link&&Object(l.attr)(s,"href",window.nav.prev_fv_link),window.nav.fv_link=e}if(t){var u=Object(l.geByClass1)("mmi_app","lm_cont"),d=u&&Object(l.geByClass1)("lfm_item",u),_=Object(l.geByClass1)("mmi_app","mfoot"),f=_&&Object(l.geByClass1)("lfm_item",_),p=Object(l.ge)("app_link"),h=!!t&&"return nav.app_go(this, event, '"+Object(l.escapeStr)(t)+"');";Object(l.attr)(d,"onclick",h),Object(l.attr)(f,"onclick",h),Object(l.attr)(p,"onclick",h)}}};window.ajax=N}t.default=window.ajax},l51W:function(e,t){var n=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(a),val(a.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(a)}}}();window.GroupsInvite=n},ldCb:function(e,t){window.Informer={close:function(e){hide(e)}}},lkNA:function(e,t,n){"use strict";function i(e,t){var n,i=t.timeout,a=t.onLoad,r=t.onError,o=document.createElement("script");function s(e){o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||(c(),a&&a())}function l(e){c(),r&&r()}function c(){clearTimeout(n),o.removeEventListener("load",s),o.removeEventListener("readystatechange",s),o.removeEventListener("error",l)}return o.addEventListener("load",s),o.addEventListener("readystatechange",s),o.addEventListener("error",l),o.src=e,document.head.appendChild(o),i&&(n=setTimeout(l,i)),{destroy:function(){c()}}}n.r(t),n.d(t,"loadScript",(function(){return i}))},mPGc:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedGroups"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER){var t,n,i=e.querySelector(".Slider__scroll").dataset.code;if(i)null==(t=window.RecommendedGroupsSlider)||t.viewBlock(i),null==(n=window.RecommendedGroupsSlider)||n.onScroll();if(e._groupsSliderHandlersAdded)return;e._groupsSliderHandlersAdded=!0}}))},myok:function(e,t,n){"use strict";n.r(t),n.d(t,"setLoading",(function(){return f})),n.d(t,"setDisabled",(function(){return _}));var i=n("TYsd"),a=n("BoyB"),r={className:"Btn",setLoading:f,setDisabled:_};t.default=r,r._onClick=d;var o="Btn_loading",s="Btn_theme_secondary",l="Btn__loader",c="Btn__loader--white",u={loader:"."+l};function d(e,t,n){e.preventDefault(),i.default.handle(n,{$btn:t})}function _(e,t){void 0===t&&(t=!0),e.disabled=t}function f(e,t,n){if(void 0===n&&(n=""),e){var i=e.classList.contains(o);if(t){if(i)return;var r=e.classList.contains(s),d=e.classList.contains(c);!n&&r&&(n="white");var _=!1;"spinner"===n&&(_=!0,n=!1);var f=Object(a.default)({mix:l,white:"white"===n||d,large:!0,spinner:_});e.classList.add(o),e.insertAdjacentHTML("afterbegin",f)}else{if(!i)return;var p=e.$(u.loader);e.classList.remove(o),p.remove()}}}},n6yW:function(e,t,n){"use strict";var i={};function a(e){var t=i[e];return t?t.lastIndex=0:i[e]=t=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)","g"),t}e.exports={add:function(e,t){var n=e.className;n.length?a(t).test(n)||(e.className+=" "+t):e.className=t},rm:function(e,t){e.className=e.className.replace(a(t)," ").trim()}}},nXjO:function(e,t){var n={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout((function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()}),this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),(function(){this.src=n})),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=n},nj7l:function(e,t,n){"use strict";n.r(t),n.d(t,"setShown",(function(){return d})),n.d(t,"canShow",(function(){return f})),n.d(t,"close",(function(){return _})),n.d(t,"initShownTooltips",(function(){return u})),n.d(t,"initEnabledTooltips",(function(){return c}));var i=n("UxAg"),a=n("OcsD"),r=n("Xrg9"),o=n("kr3z");u();var s={},l={};function c(e){l=e}function u(){s=r.default.get("shown_tooltips")||{}}function d(e){if(!e)return!1;var t=r.default.get("shown_tooltips")||{};t[e]=!0,_(e),r.default.set("shown_tooltips",t),s[e]=!0,o.default.post("/?act=tooltip_click&id="+e)}function _(e){var t=Object(i.$)('.Tooltip[tooltip-id="'+e+'"]');Object(a.re)(t)}function f(e){return!!e&&(u(),Object(a.isUndefined)(l[e])?!s[e]:!s[e]&&l[e])}Object(a.addEvent)(window,"click",(function(e){var t=e.target&&e.target.classList.contains("Tooltip")?e.target:e.target.closest(".Tooltip");if(t&&(e.preventDefault(),e.stopPropagation()),t&&t.classList.contains("Tooltip_onboarding")){var n=t.getAttribute("tooltip-id");d(n),_(n)}}),{capture:!0}),Object(a.addEvent)(window,"touchstart mousedown click",(function(){for(var e=document.querySelectorAll(".Tooltip_closeOnOverlayClick[tooltip-id]"),t=0;t<e.length;t++)_(e[t].getAttribute("tooltip-id"))}),{passive:!0,capture:!0})},p5n7:function(e,t,n){"use strict";n.r(t),n.d(t,"getValue",(function(){return p})),n.d(t,"setPrefix",(function(){return h})),n.d(t,"onBlur",(function(){return b})),n.d(t,"onFocus",(function(){return g})),n.d(t,"getNative",(function(){return m})),n.d(t,"filter",(function(){return v})),n.d(t,"onChange",(function(){return y}));var i=n("z9sQ"),a=n("fdw3"),r=n("TYsd"),o=function(e){void 0===e&&(e={});var t=e.style||[],n=e.class||e.mix,o=e.prefix,s=e.postfix,l=function(e){var t=[];Object(a.isArray)(e.on_key_down)?(e.on_key_down.push("event"),t=e.on_key_down):e.on_key_down&&(t=[e.on_key_down,"event"]);var n=e.on_key_press;return{class:"TextInput__native",id:e.id,tag:"input",type:e.type,name:e.name,value:e.value,spellcheck:e.spellcheck+"",placeholder:r.default.wrap(e.placeholder),autocapitalize:!1===e.autocapitalize?"off":null,autocomplete:!1===e.autocomplete?"off":e.autocomplete,tabindex:e.tabindex,readonly:e.readonly,disabled:e.disabled,oninput:Object(a.concatValues)("TextInput.onChange(event)",e.on_change?"; "+(r.default.isAttrHandler("oninput",e.on_change)?r.default.prepareHandler(e.on_change):e.on_change):""),onkeydown:t,onkeypress:n,onblur:Object(a.concatValues)("TextInput.onBlur(event, this)",e.onblur?"; "+(r.default.isAttrHandler("onblur",e.onblur)?r.default.prepareHandler(e.onblur):e.onblur):""),onfocus:Object(a.concatValues)("TextInput.onFocus(event, this)",e.onfocus?"; "+(r.default.isAttrHandler("onfocus",e.onfocus)?r.default.prepareHandler(e.onfocus):e.onfocus):""),autofocus:e.autofocus,maxlength:e.maxlength,pattern:e.pattern,required:e.required,inputmode:e.inputmode,"aria-describedby":e["aria-describedby"]}}(e),c=e.error;c&&(t.error=!0);var u=!(o||s||"string"==typeof c);return{role:"presentational",class:[i.default.class("TextInput",{style_stretch:t.stretch,prefixed:!!o,hidden:"hidden"===e.type,error:t.error,native:u,disabled:!!e.disabled||!!e.readonly}),n],tag:"label",onclick:e.on_click,inner:[{class:"TextInput__content",inner:u?l:[o?{class:i.default.class("TextInput__prefix",{rightPadding:o.with_right_padding,gray:o.gray}),inner:o.text}:null,{class:"TextInput__nativeWrap",inner:l},s?{class:"TextInput__postfix",inner:s.text}:null]},"string"==typeof c?{inner:[c],class:"TextInput__errorLabel",tag:"span"}:null]}};var s=n("UxAg"),l=n("zvhO"),c=n("OcsD"),u=n("CQvH");Object.assign(o,{setPrefix:h,getValue:p,filter:v,onFocus:g,onBlur:b,onChange:y});var d=".TextInput",_=".TextInput__native",f=".TextInput__prefix";function p(e){return e.$(_).value}function h(e,t){e.$(f).innerText=t}function m(e){return Object(s.$)(_,e)}function v(e,t,n){switch(e){case"number":var i=Object(c.val)(n)+String.fromCharCode(t.which);Object(l.isNumber)(parseInt(i))||Object(c.cancelEvent)(t),Object(c.val)(n,Object(c.val)(n).split("").filter((function(e){return Object(l.isNumber)(+e)})).join(""))}}function g(e,t){var n=t.closest(d);setTimeout((function(){n.classList.add("TextInput--focused")}))}function A(e){var t=e.target.closest(d);Object(c.removeEvent)(e.target,"blur",A),t&&t.classList.remove("TextInput--focused")}function b(e,t){var n,i=t.closest(d),a=null==(n=e.relatedTarget)?void 0:n.closest(d),r=Object(s.$)(_,i);i!==a||Object(u.isTabbing)()?(setTimeout((function(){var e;"BUTTON"===(null==(e=document.activeElement)?void 0:e.tagName)&&i.contains(document.activeElement)&&Object(c.addEvent)(document.activeElement,"blur",A)})),a!==i&&setTimeout((function(){i.classList.remove("TextInput--focused")}))):r.focus()}function y(e){var t=e.target.value;e.target.closest(d).classList.toggle("TextInput--notEmpty",!!t)}t.default=o;window.TextInput=o},qHA9:function(e,t,n){"use strict";n.r(t),n.d(t,"MENTION_REGEXP",(function(){return c})),n.d(t,"MENTION_DOMAIN_REGEXP",(function(){return u})),n.d(t,"MENTION_CLIENTSIDE_REGEXP",(function(){return d})),n.d(t,"UNKNOWN_ERROR",(function(){return _})),n.d(t,"STICKER_HEIGHT",(function(){return f})),n.d(t,"isContactPeer",(function(){return p})),n.d(t,"isCommunityPeer",(function(){return h})),n.d(t,"isChatPeer",(function(){return m})),n.d(t,"isUser",(function(){return v})),n.d(t,"formatTime",(function(){return g})),n.d(t,"wrapMention",(function(){return b})),n.d(t,"wrapCommunityUrl",(function(){return y})),n.d(t,"sendDataToMessage",(function(){return w})),n.d(t,"getMsgSendId",(function(){return O})),n.d(t,"mailRequest",(function(){return S})),n.d(t,"getStickerSize",(function(){return k})),n.d(t,"prepareKeyboard",(function(){return C})),n.d(t,"isForwardedMessageId",(function(){return E})),n.d(t,"isNewMailPage",(function(){return j}));var i=n("wTgh");n.d(t,"wrapLinks",(function(){return i.wrapLinks}));var a,r=n("wMVj"),o=n("9M99"),s=n("OcsD"),l=n("jE6c"),c=/\[((id|club)\d+)\|([\S\s]+?)]/g,u=/\[((id|club)\d+)\|@([\S\s]+?)]/g,d=/\[([^\$]+?)\|([^\$]+?)\]/g,_=10,f=128;function p(e){return e>19e8&&e<=2e9}function h(e){return e>-1e9&&e<0}function m(e){return e>2e9}function v(e){return e>0&&e<=19e8}function g(e,t){void 0===t&&(t=0);var n=new Date(1e3*e),i=n.getTimezoneOffset(),a=-t/60-180;if(i!==a){var r=60*(a-i)*1e3;n.setTime(1e3*e-r)}var o=n.getHours(),s=n.getMinutes();return o+":"+(s<10?"0":"")+s}function A(e,t,n){return'<a href="/'+Object(l.htsc)(t)+'" class="mem_link">'+Object(l.htsc)(n)+"</a>"}function b(e,t){return t?e.replace(d,(function(e,t,n){return A(0,t,n)})):e.replace(c,(function(e,t,n,i){return A(0,t,i)}))}function y(e){var t=r.default.getQuery("community");return t&&(e+="&community="+t),e}function w(e,t){var n,r,s=store.mail,l=s.cur,c=s.members,u=Date.now()/1e3,d=g(u,l.timeShift),_=e.message||"";"send"!==e.act&&e.id&&(n=store.mail.msgs[e.id]),a||(a=document.createElement("div")),a.textContent=_,_=a.innerHTML,a.textContent="";var p,h={};if(e.media&&0===e.media.indexOf("sticker")){h.sticker=1;var m=+e.media.replace("sticker","");m&&(p={id:m,url:Stickers.getStickerUrl(m,k()),height:f})}else for(var v,A=1;v=e["attach"+A+"_type"];A++)h[v]?h[v]+=1:h[v]=1;r=e.attached_messages?(e.attached_messages+"").split(";"):e.mail_edit_attach_fwd&&n?n.forwards.concat():[];var y=!!e.has_reply,w="send"===e.act?"send"+e.random_id:"edit"+e.id,O=_,S=O=O.replace(/(@|\*)(\S+)(?: +\(([^\n]+?)\))?/g,(function(e,t,n,i){i||(i=t+n);var a=0,r=/^(club|public|event)([\d]+)$/.exec(n);/^id[\d]+$/.test(n)?a=parseInt(n.substr(2)):r&&(a=parseInt(r[2]));for(var o="id",s=Object.keys(c),l=0,u=s.length;l<u;l++){var d=s[l];if(c[d]&&c[d].domain===n){a=d;break}}return"-"===a[0]&&(a=a.slice(1),o="club"),a?"["+o+a+"|"+i+"]":e}));S=b(S=Object(i.wrapLinks)(S),!0),S=Object(o.emojiToHTML)(S);var C={id:"send"===e.act?w:e.id,sendId:w,peerId:"send"===e.act?e.to:e.peerId,authorId:l.viewerId,adminId:l.groupId?l.userId:void 0,ts:u,date:d,dateShort:d,text:S,textInput:_,body:O,isUnread:!n||n.isUnread,isOut:!0,edited:"send"!==e.act,canEdit:!1,attaches:h,forwards:y?[]:r,hasReply:y,reply:y?r[0]:void 0,pending:!t,failed:!!t,attachesLoading:!!Object.keys(h).length};return l.groupId&&(C.adminName=lang.mobile_mail_you,C.adminUrl=c[l.userId].url),p&&(C.sticker=p),C}function O(e){return e.edited?"edit"+e.id:"send"+e.randomId}function S(e,t){return new Promise((function(n,i){Object(s.ajaxRequest)(e,t,(function(e){e.error?i({type:"server",code:e.code||0,message:e.message||""}):n(e.result)}),(function(e,t,n){var a=null,r="unknown",o=0;if(n instanceof XMLHttpRequest){var s=n;0===s.status?r="network":(r="server_status",o=s.status)}else 0===e&&null==t&&null==n?r="response_parsing":e===ajax.RESPONSE_CAPTCHA?(r="captcha",a=n):r="unknown";i({type:r,code:o,message:"",data:a})}))}))}function k(){return hasClass("x2",document.body)?2*f:f}function C(e){var t=e.keyboard,n=e.authorId,i=e.msgId;if(t.buttons&&t.buttons.length){t=Object.assign(t,{author_id:n,chat_local_id:i});var a=document.createElement("div");t.buttons.forEach((function(e){e.forEach((function(e){var t=e.action.label;a.textContent=t;var n=a.innerHTML;e.action.label=Object(o.emojiToHTML)(n),e.action.rawLabel=t}))})),a=null}else t=null;return t}function E(e){return!isFinite(e)&&("string"!=typeof e||"~"!==e[0])}function j(e,t){if(void 0===e&&(e=""),void 0===t&&(t=""),!window.isNewMail)return!1;if(0===e.indexOf("/write"))return!0;"string"==typeof t&&(t=Object(s.qs2obj)("?"===t[0]?t.slice(1):t));var n=t,i=n.act,a=n.m;return"/mail"===e&&"add_to_chat"!==i&&"flush_history"!==i&&"info"!==i&&"unpin"!==i&&"edit_chat"!==i&&"change_chat_name"!==i&&"leave_chat"!==i&&"new_chat"!==i&&"chat_preview"!==i&&"return_to_chat"!==i&&"show_medias"!==i&&"toggle_community_block"!==i&&"community_toggle_important"!==i&&"ban_user"!==i&&"add_user"!==i&&"community_mark_answered"!==i&&"invite_link"!==i&&"reset_link"!==i&&"send"!==i&&"show_peer_profile"!==i&&"toggle_peer_profile_tags"!==i&&"edit_peer_profile_tags"!==i&&"edit_peer_profile_note"!==i&&70!=a&&71!=a&&76!=a&&784!=a&&783!=a&&786!=a&&785!=a&&787!=a}},"r/ag":function(e,t,n){"use strict";n.r(t),n.d(t,"POPUP_DISAPPEAR_TIME",(function(){return u})),n.d(t,"POPUP_NAV_PREFIX",(function(){return c}));var i=n("Po+v"),a=n("vWwi"),r=n("1By4"),o=n("UxAg"),s=n("j80l"),l=n("OcsD"),c="pop_",u=200;Object.assign(i.default,{open:function(e,t,n){void 0===n&&(n={});var i=n,r=i.hash,o=i.oncloseCallback,s=i.withoutCloning;if(O(e),v=Boolean(n.forceScrollDisable),t){if(!s){var u=e;(e=u.cloneNode(!0)).original=u}e.appendedToBody=!0,e.withoutCloning=s,document.body.appendChild(e)}e.classList.add(_);var d=e.$(m.scroll);Object(a.disableBodyScroll)(e,{forceScrollDisable:v}),o&&A.push([e,o]);if(d){if(y(e,d),e.onResizeHandler=function(){y(e,d)},Object(l.addEvent)(window,"resize",e.onResizeHandler),!window.MutationObserver)return e;e.scrollContentObserver=new MutationObserver(e.onResizeHandler),e.scrollContentObserver.observe(d,{childList:!0,subtree:!0})}if(r){var f="#"+c+r,p=nav.cur.split("#")[0];nav.go(p+f,!1,{push_only:!0}),g[f]=e}return e},close:w});i.default;i.default._onOverlayClick=b;var d="Popup",_="Popup_open",f="Popup_hasScroll",p="ScrollView",h="Popup--closing",m={open:"."+_,popup:"."+d,wrap:"."+"Popup__wrap",content:"."+"Popup__content",scroll:".Popup__scroll",header:".Popup__header",footer:".Popup__footer"},v=!1,g={},A=[];function b(e,t,n){var i=e.closest(m.popup);Object(l.isFunction)(t)?t({$popup:i}):t&&r.default.handle(t,{$popup:i}),n&&w(i)}function y(e,t){var n=e.$(m.header),i=e.$(m.footer);t.scrollHeight-6>t.offsetHeight?(Object(l.addClass)(e,f),Object(l.addClass)(t,p),ContentScrollView.restore()):(Object(l.removeClass)(e,f),Object(l.removeClass)(t,p),t.scrollTop=0);var a=Object(l.getCh)(),r=0,o=0;n&&(r=n.offsetHeight),i&&(o=i.offsetHeight);var s=Math.min(a-r-o-100,420);Object(l.setStyle)(t,"max-height",s+"px")}function w(e,t){void 0===t&&(t={});var n=t,i=n.smooth,r=n.velocity,u=n.lastY;if(e&&!e.classList.contains(d)&&(e=e.closest(m.popup)),e||(e=Object(o.$)(m.open)),e){var f=Object(o.$)(m.wrap,e),p=Object(o.$)(m.content,e);if(i&&r&&u){var g=Object(l.getH)(p),b=(g-u)*r.y;return b>=300&&(b=200),b=Math.max(150,Math.min(300,b)),l.setStyle.animate(f,"transform",{duration:b,func:"cubic-bezier(0.0, 0.0, 0.2, 1)"}),l.setStyle.transform(f,1,[0,g+"px"]),e.classList.add(h),setTimeout((function(){w(e,{onClose:t.onClose})}),1.1*b)}if(i){e.classList.add(h);var y=Object(l.getH)(p);return l.setStyle.transform(f,1,[0,y+"px"]),setTimeout((function(){w(e,{onClose:t.onClose})}),200*1.1)}if(e.classList.remove(_),e.appendedToBody&&document.body.contains(e)&&Object(l.replace)(e,e.withoutCloning?e:e.original),e.classList.remove(h),l.setStyle.transform(f),Object(l.removeEvent)(window,"resize",e.onResizeHandler),e.scrollContentObserver&&e.scrollContentObserver.disconnect(),Object(o.$)(m.open)||Object(a.enableBodyScroll)(void 0,{forceScrollDisable:v}),nav.cur&&nav.cur.startsWith("#"+c)){var S=s.default.make(nav.path,qs2obj(nav.params));nav.set({nav:Object(l.extend)({},nav,{cur:nav.path,path:nav.path||"",push:S||""})})}var k,C=(k=e,(A.find((function(e){return e[0]===k}))||[])[1]);C&&(C(),O(e)),t.onClose&&t.onClose(),window.cur&&window.cur.app&&window.cur.app.frame&&window.cur.app.frame.focus()}}function O(e){var t=A.findIndex((function(t){return t[0]===e}));t>=0&&A.splice(t,1)}nav.onPopState&&nav.onPopState((function(){var e=g[nav.cur];e&&(w(e),delete g[nav.cur])})),window.Popup=i.default;t.default=i.default},r0fY:function(e,t,n){"use strict";var i,a,r,o,s,l,c,u,d,_,f,p,h,m,v;n.r(t),n.d(t,"EventScreens",(function(){return i})),n.d(t,"ProductionStatEventTypes",(function(){return a})),n.d(t,"NavigationProductionStatEventTypes",(function(){return r})),n.d(t,"ActionProductionStatEventTypes",(function(){return o})),n.d(t,"ClickProductionStatEventTypes",(function(){return s})),n.d(t,"ViewProductionStatEventTypes",(function(){return l})),n.d(t,"MarketScreenNames",(function(){return c})),n.d(t,"MarketEventTypes",(function(){return u})),n.d(t,"EventItemType",(function(){return d})),n.d(t,"EventItemSubType",(function(){return _})),n.d(t,"RegistrationItemEventTypes",(function(){return f})),n.d(t,"RegistrationFieldItemNames",(function(){return p})),n.d(t,"MarketingTransitionItemCampaignType",(function(){return h})),n.d(t,"MarketingTransitionItemEventType",(function(){return m})),n.d(t,"MarketingTransitionItemSourceType",(function(){return v})),function(e){e.NOWHERE="nowhere",e.OTHER="other",e.START="start",e.START_BOX="start_box",e.START_PROCEED_AS="start_proceed_as",e.REGISTRATION_COMPLETE="registration_complete",e.REGISTRATION_COUNTRY="registration_country",e.REGISTRATION_PHONE="registration_phone",e.REGISTRATION_PHONE_VERIFY="registration_phone_verify",e.REGISTRATION_PASSWORD="registration_password",e.REGISTRATION_EDUCATION="registration_education",e.REGISTRATION_EMAIL="registration_email",e.REGISTRATION_NAME="registration_name",e.REGISTRATION_INVITE_CONFIRM="registration_invite_confirm"}(i||(i={})),function(e){e.TYPE_NAVGO="type_navgo",e.TYPE_ACTION="type_action",e.TYPE_CLICK="type_click",e.TYPE_VIEW="type_view"}(a||(a={})),function(e){e.GO="go",e.BACK="back",e.TAB_OPEN="tab_open"}(r||(r={})),function(e){e.TYPE_REGISTRATION_ITEM="type_registration_item",e.TYPE_MARKETING_TRANSITION_ITEM="type_marketing_transition_item",e.TYPE_DONUT_PAYMENT_ITEM="type_donut_payment_item",e.TYPE_CALL_ITEM="type_voip_call_item"}(o||(o={})),function(e){e.TYPE_MARKET_CLICK="type_market_click",e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item"}(s||(s={})),function(e){e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item",e.TYPE_MARKET_VIEW="type_market_view"}(l||(l={})),function(e){e.MARKETPLACE="marketplace",e.MARKETPLACE_BLOCK="marketplace_block",e.MARKETPLACE_SEARCH="marketplace_search"}(c||(c={})),function(e){e.TYPE_MARKET_ORDERS_ITEM="type_market_orders_item",e.TYPE_MARKET_CARTS_ITEM="type_market_carts_item",e.TYPE_MARKET_GOODS_ITEM="type_market_item",e.TYPE_MARKET_MARKETPLACE_ITEM="type_market_marketplace_item"}(u||(u={})),function(e){e.ARTICLE="article",e.GROUP="group",e.PHOTO="photo",e.POST="post",e.STORY="story",e.USER="user",e.BROWSER="browser",e.NARRATIVE="narrative",e.MINI_APP="mini_app",e.GAME="game",e.VIDEO="video",e.MARKET_ITEM="market_item",e.MARKET_ITEM_ALBUM="market_item_album",e.MARKET_ORDER="market_order",e.CATALOG_BANNER="catalog_banner"}(d||(d={})),function(e){e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.OPEN_WIKI="open_wiki"}(_||(_={})),function(e){e.SCREEN_PROCEED="screen_proceed",e.SCREEN_SKIP="screen_skip",e.SCREEN_RETURN="screen_return",e.COMMON_SERVER_ERROR="common_server_error",e.RESEND_SMS_CODE="resend_sms_code",e.RESEND_SMS_CODE_FAILED="resend_sms_code_failed",e.INCORRECT_SMS_CODE="incorrect_sms_code",e.INCORRECT_PASSWORD="incorrect_password",e.INCORRECT_NAME="incorrect_name",e.INCORRECT_CAPTCHA="incorrect_captcha",e.INCORRECT_PHONE_NUMBER="incorrect_phone_number",e.INCORRECT_BDAY="incorrect_bday",e.INCORRECT_SEX="incorrect_sex",e.INCORRECT_EMAIL="incorrect_email",e.INCORRECT_EDUCATION="incorrect_education"}(f||(f={})),function(e){e.PHONE_COUNTRY="phone_country",e.PHONE_NUMBER="phone_number",e.COUNTRY="country",e.CITY="city",e.EMAIL="email",e.UNIVERSITY="university",e.FACULTY="faculty",e.SCHOOL="school",e.CHAIR="chair",e.YEAR_FROM="year_from",e.YEAR_TO="year_to",e.CLASS="class",e.EDU_FORM="edu_form",e.EDU_STATUS="edu_status",e.GRADUATION="graduation",e.SPECIALIZATION="specialization",e.RULES_ACCEPT="rules_accept",e.SMS_CODE="sms_code",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.SEX="sex",e.BDAY="bday",e.PASSWORD="password"}(p||(p={})),function(e){e.UNAUTH_BOTTOM_BANNER="unauth_bottom_banner",e.UNAUTH_ACTION_BOX="unauth_action_box"}(h||(h={})),function(e){e.OPEN="open",e.CLOSE="close",e.CLICK_SIGN_UP="click_sign_up",e.CLICK_SIGN_IN="click_sign_in"}(m||(m={})),function(e){e.LIKE="like",e.SHARE="share",e.MORE="more"}(v||(v={}))},rEJs:function(e,t,n){"use strict";n.r(t),n.d(t,"events",(function(){return i}));var i={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init"}},rKUZ:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=n("z9sQ"),o=n("BoyB"),s=n("fdw3");function l(){var e=Object(i.default)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){var t,n,i=e.dimmed,s=e.animation,u=!!e.compact,f=e.typingCount,p=a.default.class("typing",{dimmed:i,id:e.id,empty:d(f),animation:s}),h=_(e);"audio"===s?(t=Object(o.default)({class:r.default.class("typing__loading",{audio:!0,compact:u})}),n=""):"dots"===s?(t=Object(o.default)({class:r.default.class("typing__loading",{audio:!1,compact:u})}),n=""):"simple-dots"===s&&(t="",n=a.default.html(l()));return a.default.html(c(),p,t,h,n)};function d(e){return!e}function _(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,a=t,r="";if(1===a&&i.length>=1){var o=i[0];r=(r=n.mobile_mail_recaudio_1).replace("{name}",o)}else if(2===a&&i.length>=2){var l=i[0],c=i[1];r=(r=(r=n.mobile_mail_recaudio_2).replace("{name1}",l)).replace("{name2}",c)}else if(a>1&&i.length>=1){var u=i[0];r=(r=(r=n.mobile_mail_recaudio_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(r=langNumeric(a,n.mobile_mail_recaudio_N_unknown));return r}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return"";var i=e,a=t,r="";if(1===a&&i.length>=1)r="";else if(2===a&&i.length>=2){var o=i[0],l=i[1];r=(r=(r=n.mobile_mail_mixtyping_2).replace("{name1}",o)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];r=(r=(r=n.mobile_mail_mixtyping_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(r=langNumeric(a,n.mobile_mail_mixtyping_N_unknown));return r}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!Object(s.isArray)(e))return e?n.mobile_mail_typing_1_short:"";var i=e,a=t,r="";if(1===a&&i.length>=1){var o=i[0];r=(r=n.mobile_mail_typing_1).replace("{name}",o)}else if(2===a&&i.length>=2){var l=i[0],c=i[1];r=(r=(r=n.mobile_mail_typing_2).replace("{name1}",l)).replace("{name2}",c)}else if(a>1&&i.length>=1){var u=i[0];r=(r=(r=n.mobile_mail_typing_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(r=langNumeric(a,n.mobile_mail_typing_N_unknown));return r}(e.typing,e.typingCount)}var f=n("UxAg");Object.assign(u,{setTyping:function(e,t){var n="string"==typeof e?Object(f.$)(".typing_id_"+e):e,i=n.$(".typing__names");n.classList.toggle("typing_empty",d(t.typingCount)),i.innerHTML=_(t)},getElem:function(e){return Object(f.$)(".typing_id_"+e)}});t.default=u;window.Typing=u,Object.assign(window,{Typing_renderNames:_,Typing_isEmpty:d})},rKp0:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=n("Mc5h"),o=n("O5lf"),s=n("V2dH"),l=n("1KAK"),c=n("eWFs"),u=n("HGMY"),d=n("TYsd"),_=n("Y6JH"),f=n("fdw3"),p=n("dLIZ");function h(){var e=Object(i.default)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n      <div class="mailScrap__empty mailScrap__empty_',' mailScrap_casper">\n        <div class="mailScrap__casperIcon" aria-hidden="true">\n          ','\n        </div>\n        <div class="mailScrap__casperText">\n          ',"\n        </div>\n      </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="mailScrap__empty mailScrap__empty_','">\n      ',"\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return g=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return A=function(){return e},e}var b=function(e){var t=e.scrap,n=e.isCasper,i="peer"===t,o=E(t),l=i?k("before"):"",c=k("after"),g=k("center"),b=function(e){var t,n=a.default.class("mailScrap__items",((t={})[e]=!0,t)),i=y(e);return Object(r.default)({mix:n,inner:i})}(t),w=n?"":function(e){var t=C(e);return a.default.html(v(),e,t)}(t),O=n?function(e){var t=d.default.html(Object(_.default)(Object(p.getGhostOutline56Icon)())),n=Object(f.getLang)("mobile_casper_chat_no_messages");return a.default.html(m(),e,t,n)}(t):"",S=i?Object(s.default)():"",j=i?d.default.html(Object(u.default)()):"",T=i?(I=store.mail.cur.notification||"",M=a.default.onClick("MailScrap.clearSystemMessage2"),a.default.html(h(),M,I)):"";var I,M;return a.default.html(A(),o,l,b,w,O,c,j,S,T,g)};function y(e){for(var t=store.mail,n=t.cur,i=t.msgs,r=t.scraps[e],o=r.length,s=[],l=!1,c=0;c<o;c++){if(c>0&&"peer"===e&&!l){var u=i[r[c-1]],d=i[r[c]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){l=!0,s.push(w(e,r[c],!0));continue}}s.push(w(e,r[c]))}return a.default.list(s)}function w(e,t,n){void 0===n&&(n=!1);var i=store.mail,a=i.cur,r="";if("folder"===e)r="important"===a.folder?O(t):S(t);else if("search"===e)if("peers"===a.tab){var o=t;i.peers[o].isIncomingMR||(r=function(e){return Object(c.default)(e)}(o))}else{r=O(t)}else if("peer"===e){r=function(e,t){void 0===t&&(t=!1);return Object(l.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){r=S(t)}return r}function O(e){var t=store.mail.msgs[e].peerId;return Object(c.default)(t,e)}function S(e){return Object(c.default)(e,"last")}function k(e){var t,n=a.default.class("mailScrap__loading",((t={})[e]=!0,t)),i=Object(o.default)({mix:""});return a.default.html(g(),n,i)}function C(e){var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty,ad_tag:t.mobile_mail_sublist_empty}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function E(e){var t,n=store.mail,i=n.cur,r=n.reached,o=!0,s=!1,l=!1,c=!1;if("peer"===e){var u=i.peerId,d=n.scraps.peer,_=d.length,f=n.rolls.peer[u]||[];o=r.peer.before[u]&&d[0]===f[0],s=last(d)===last(f)&&r.peer.after[u],0===_&&(s=!0);var p=u?n.peers[u]:null;p&&(l=!!p.systemMessageCode,p.isChannel&&(c=p.ownerId!==i.viewerId))}else if("mrs"===e)s=r.mrs;else if("folder"===e)s=r.folder[i.folder];else if("search"===e){var h=i.tab;i.query;if("peers"===h){var m=n.scraps.search.length;s=r.search[i.tab][i.query]||m>0}else s=r.search[i.tab][i.query]}return a.default.class("mailScrap",((t={})[e]=!0,t.empty=function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.reached,r=!1;switch(e){case"peer":var o=n.peerId,s=t.rolls.peer[o];0===(s?s.length:0)&&a.peer.after[o]&&a.peer.before[o]&&(r=!0);break;case"mrs":0===i.mrs.length&&a.mrs&&(r=!0);break;case"folder":0===i.folder.length&&a.folder[n.folder]&&(r=!0);break;case"search":0===i.search.length&&a.search[n.tab][n.query]&&(r=!0)}return r}(e),t.systemMessage=l,t.reachedBefore=o,t.reachedAfter=s,t.tab="search"===e&&i.tab,t.isChannel=c,t))}n("+cqQ");var j=n("3pHe"),T=n("BZzM"),I=(n("s0aB"),n("GR/G")),M=n.n(I);Object.assign(b,{updateClass:R,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,R("peer"),N()}()},resetPrevScraps:function(){D={folder:[],search:[],peer:[]}},redrawPeer:function(){B("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach((function(e){return e.className=E("peer")}))},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;B("folder",i.folder,e),$$(".mailScrap_folder").forEach((function(e){return e.className=E("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=C("folder")}))},redrawSearch:function(){$$(".mailScrap__items_search").forEach((function(e){return e.innerHTML=y("search")})),$$(".mailScrap_search").forEach((function(e){return e.className=E("search")})),$$(".mailScrap__empty_search").forEach((function(e){return e.innerHTML=C("search")}))},redrawMRs:function(e){B("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach((function(e){return e.className=E("mrs")})),$$(".mailScrap__empty_mrs").forEach((function(e){return e.innerHTML=C("mrs")}))},redrawSystemMessage:N,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.innerHTML=L(e,!0)})),$$(".mailScrap_folder").forEach((function(e){return e.className=E("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=C("folder")}))},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.insertAdjacentHTML("beforeend",L(e))}))},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach((function(t){[].slice.call(t.children).slice(e).forEach((function(e){return t.removeChild(e)}))}))},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(x([e],!0));n.appendChild(t),M()(t,i),R("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);R("peer"),e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)}));var n=j.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout((function(){return window._preventedCheckTop=!1}));var i='\n    <div class="load_before load_before_closed">\n      '+x(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach((function(e){return e.insertAdjacentHTML("afterbegin",i)})),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)})),$$(".mailScrap__items_peer").forEach((function(n){n.insertAdjacentHTML("beforeend",x(e,t))})),R("peer"),Object(T.resizePosters)()},peerReplaceItems:function(e){e.forEach((function(e){var t=$(".msg_id_"+e),n=ceFromString(x([e],!0));M()(t,n),CasperTimer.init(e)})),Object(T.resizePosters)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach((function(t){return t.innerHTML=x(e)}))},peerGoToBottom:function(){var e=j.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:P,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&P()}}),uVK.onReady((function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;D.folder=e.folder.slice(),D.search=e.search.slice(),D.peer=e.peer.slice()}}));var D={folder:[],search:[],peer:[]};function P(){remove($(".msg__newMsgsDivider"))}function x(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,a=i.cur,r=i.msgs,o=!!$(".msg__newMsgsDivider");return e.map((function(e,i){var s=r[e];return i>0&&!o&&!t&&!n.isUnread&&s.isUnread&&s.authorId!==a.viewerId?(n=s,o=!0,w("peer",e,!0)):(n=s,w("peer",e))})).join("")}function L(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map((function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":w("folder",e)})).join("")}function B(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var a=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach((function(n,a){var r=i.indexOf(n);-1===r?(i.splice(a,0,n),domInsert(e,t(n),a)):r!==a&&(i.splice(r,1),i.splice(a,0,n),before(e.children[r],e.children[a]))})),i.forEach((function(t,i){-1===n.indexOf(t)&&a.push(e.children[i])})),a.forEach(remove)}($(".mailScrap__items_"+e),(function(t){return w(e,t)}),t,n)}function R(e){$$(".mailScrap_"+e).forEach((function(t){return t.className=E(e)}))}function N(){$$(".mailScrap__systemMessage").forEach((function(e){e.innerHTML=store.mail.cur.notification||""}))}t.default=b;window.MailScrap=b},rc7J:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=i.default.class("AlbumInfoRow",{withoutBottomBorder:e.withoutBottomBorder},"--");return{inner:[{inner:[{src:e.avatar,alt:"avatar",tag:"img"}],class:"AlbumInfoRow__avatar",href:e.author_url,onclick:"cancelEvent(event); nav.go(this);",tag:"a"},{inner:[{inner:[e.title],class:"AlbumInfoRow__title",href:e.url,tag:"a"},{inner:[e.subtitle],class:"AlbumInfoRow__subtitle",tag:"div"}],class:"AlbumInfoRow__content",tag:"div"}],class:t,onclick:"nav.go('"+e.url+"')",tag:"div"}};t.default=a},s0aB:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),r=n("Mc5h"),o=n("AXyT"),s=n("9y81"),l=n("KMpi"),c=n("Y6JH"),u=n("rKUZ"),d=n("fdw3"),_=n("gZry"),f=n("LBnd"),p=n("TjCR"),h=n("yOyn"),m=(n("ZvT/"),n("k0dR"));function v(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title">\n          <div class="convo__title">',"</div>\n          ","\n          ",'\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">','</div>\n          </div>\n        </div>\n        <div class="convo__row convo__row_text">\n          <div class="convo__typing">','</div>\n          <div class="convo__text">','</div>\n          <div class="convo__row_right convo__unreadBox" ',">\n            ",'\n            <div class="convo__unreadOut"></div>\n            ','\n          </div>\n          <div class="convo__status">',"</div>\n        </div>\n      </a>\n    </div>\n  "]);return v=function(){return e},e}var g=function(e){var t,n,i=e.more,r="",_="",f=0,p=!1,m="";i&&(r=i.text,_=i.date,f=i.unreadCount,p=i.muted,m=i.typing?Object(u.default)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(_=""));var g=a.default.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!m,important:e.important,unread:e.isLast&&(f>0||e.isMarkedUnread),unreadOut:e.isLast&&f<0}),O=Object(l.default)({mix:"convo__avatar",photos:e.photos,url:e.profileUrl,name:e.name,isContact:e.isContact}),S=b({pending:t,failed:n}),k=A(e.online),C=Object(s.default)({mix:"convo__star",icon:"star",blue:!0}),E=y(e.peerProfile),j=e.isLast?Object(o.default)({mix:"convo__unread",value:w(f,e.isMarkedUnread),gray:p}):"",T=e.url,I=a.default.onClick("Convo._onClick","event",T),M=e.isCasper?'<span class="convo__casper" title="'+Object(d.getLang)("mobile_casper_chat_title")+'">'+Wd.html(Object(c.default)(Object(h.getCasper16Icon)()))+"</span>":"";return a.default.html(v(),g,I,k,O,e.url,e.title,E,M,C,_,m,r,S?"hidden":"","",j,S)};function A(e){return"mobile"===e?Wd.html({inner:[{inner:[Object(c.default)({icon:Object(_.getOnlineMobileComposite16Icon)()})],class:"mlvi_default",tag:"div"},{inner:[Object(c.default)({icon:Object(f.getOnlineMobileCompositeMuted16Icon)()})],class:"mlvi_muted",tag:"div"}],class:"lvi mlvi convo__online convo__online_mobile",tag:"div"}):"desktop"===e?Object(r.default)({mix:a.default.class("convo__online",{desktop:!0})}):Object(r.default)({mix:"convo__online"})}function b(e){var t=window.lang;return e.pending?Wd.html({inner:[Object(c.default)({icon:Object(p.getRecent16Icon)()})],class:"convo__pending",tag:"div"}):e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}function y(e){var t=e.tags,n=e.tagsData,i=[];t&&n.peerTags&&(i=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var a,r=i.length;if(!r&&!n.fromAd)return"";if(n.fromAd&&!r)a={class:"convo__adTag",inner:[Object(d.getLang)("mobile_mail_ad_tag_no_access_text"),Object(c.default)(Object(m.getAdTag10Icon)())]};else if(n.fromAd||1!==r){var o=window.lang,s=r+(n.fromAd?1:0);a={class:"convo__extraTag",inner:langNumeric(s,o.mobile_mail_peer_profile_extra_tags)}}else{var l=i[0];a={class:"convo__peerTag",inner:l.name,style:"background-color: "+l.color}}return Wd.html({class:"convo__peerTags",inner:a})}function w(e,t){var n=e;return t&&e<=0&&(n="empty"),n}var O=n("UxAg"),S=n("+cqQ"),k=n("OcsD");n("jk6M");function C(e,t){e.stopPropagation(),e.preventDefault(),g.onTap(t)}Object.assign(g,{onTap:Object(S.default)("url"),setOnline:function(e,t){Object(O.$$)(".convo_id_"+e+" .convo__online").forEach((function(e){e.outerHTML=A(t)}))},setLastMsg:function(e,t,n){var i=n.dateShort,a=n.pending,r=n.failed;Object(O.$$)(".convo_last.convo_id_"+e).forEach((function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=b({pending:a,failed:r}),a||r?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=i,e.$(".convo__unreadBox").hidden=!1)}))},setTyping:function(e,t){Object(O.$$)(".convo_last.convo_id_"+e).forEach((function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||Object(d.isArray)(i))){var a=n.$(".typing"),r=a&&q.parseClass("typing",a.className);a&&r.animation===t.animation?u.default.setTyping(a,t):(e.classList.add("convo_typing"),n.innerHTML=Object(u.default)(t))}else n.innerHTML="",e.classList.remove("convo_typing")}))},setUnreadCount:function(e,t,n){Object(O.$$)(".convo_last.convo_id_"+e).forEach((function(e){var i=e.$(".Oval");e.classList.toggle("convo_unread",t>0||n),e.classList.toggle("convo_unreadOut",t<0),o.default.setValue(i,w(t,n))}))},setImportant:function(e,t){Object(O.$$)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_important",t)}))},updateAdTag:function(e,t){Object(O.$$)(".convo_id_"+e).forEach((function(e){var n=Object(O.$)("convo__peerTags",e);t.fromAd&&!n&&(n=Object(k.ceFromString)(y({tagsData:t})),after(n,Object(O.$)(".convo__title",e)))}))}}),g._onClick=C;t.default=g;window.Convo=g,window.Convo__online=A},t7Ww:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalMenuBtn",(function(){return l})),n.d(t,"ModalMenuContent",(function(){return f})),n.d(t,"ModalMenuIcon",(function(){return c})),n.d(t,"ModalMenuTitle",(function(){return d})),n.d(t,"ModalMenuBody",(function(){return u})),n.d(t,"ModalMenuHeaderCloseButton",(function(){return _}));var i=n("r/ag"),a=n("29dZ"),r=n("Y6JH"),o=n("fdw3"),s=n("c9MT");function l(e){var t=e.class?" "+e.class:"";return t=e.isBtn?Object(o.concatValues)(t," ModalMenu__customBtn"):Object(o.concatValues)(t," ModalMenu__item"),Object(a.default)({url:e.url,class:"ModalMenu__btn "+t,theme:e.theme?e.theme:"none",size:e.size?e.size:"",inner:e.inner,on_click:e.onclick,use_native_onclick:!0,attrs:e.attrs,"aria-label":e["aria-label"]||""})}function c(e){return{inner:[{inner:[e.inner],class:"ModalMenu__icon",tag:"div"}],class:"ModalMenu__iconWrapper",tag:"div"}}function u(e){return{inner:[e.inner],class:"ModalMenu__customBody",tag:"div"}}function d(e){return{inner:[e.inner],class:"ModalMenu__title",tag:"div"}}function _(e){return void 0===e&&(e={}),{inner:[Object(r.default)({icon:Object(s.getDismiss24Icon)()})],class:"ModalMenu__headerCloseButton",onClick:e.onClose?e.onClose:["ModalMenu.close","this"],"aria-label":Object(o.getLang)("mobile_close"),tag:"button"}}function f(e){return e.class+=" ModalMenuContent",e}t.default=function(e){var t=e.attached?"ModalMenu--attached":"",n=window.lang,r=[];if(e.title&&r.push({class:"ModalMenu__title",inner:e.title}),e.body&&r.push({class:"ModalMenu__body",inner:e.body}),Object(o.isArray)(e.items)){var s=e.items.map((function(e){return e}));r.push(s)}e.close&&r.push(Object(a.default)({class:"ModalMenu__btn ModalMenu__cancel",theme:"secondary",size:"large",inner:e.closeText?e.closeText:n.mobile_cancel,on_click:e.onClose?e.onClose:["ModalMenu.close","this"],use_native_onclick:!0}));var l=function(e){if(e&&e[0]&&e[0].inner&&e[0].inner.inner&&"ModalMenuHeader"===e[0].inner.inner[0].class)return!0;return!1}(r)?" ModalMenu--hasHeader":"";return Object(i.default)({id:e.id||"",class:"ModalMenu "+e.class+" "+t+" "+l,on_overlay_click_native:e.on_overlay_click?e.on_overlay_click:["ModalMenu.close","this"],content:r})}},tgcV:function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=function(){return t(i)},i.onerror=function(){return n(new Error("Stylesheet load error for "+e))},document.head.appendChild(i)}))}function a(e){var t,n=(t=e,new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.response):n(i.response)},i.onerror=function(){n(i.response)},i.send()})));return n.then((function(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)})),n}var r;n.r(t),n.d(t,"addStatic",(function(){return _})),n.d(t,"preloadStaticForNavigation",(function(){return f})),n.d(t,"initStaticManager",(function(){return p}));var o=[];function s(e,t){var n=e;t&&(n+="?"+t);var i=new Promise((function(t,i){var a,r,o;a=n,r=function(n){n?(window.stManager.staticFiles[e]=null,i(n)):t()},(o=document.createElement("script")).src=a,o.onload=function(){return r(null,o)},o.onerror=function(){return r(new Error("Script load error for "+a))},document.head.appendChild(o)}));return window.stManager.staticFiles[e]=i,i}function l(e,t){var n=function(){if(void 0!==r)return r;try{var e=document.createElement("b");e.style.display="flex",r="flex"===e.style.display}catch(e){r=!1}return r}()?i:a,o=e;t&&(o+="?"+t);var s=n(o).catch((function(){return window.stManager.staticFiles[e]=null,Promise.resolve()}));return window.stManager.staticFiles[e]=s,s}function c(e){window.stManager.staticFiles[e]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles&&window.stManager?(Object.keys(window.vk.stFiles).forEach((function(e){return c(e)})),window.vk.stFiles=[]):setTimeout(u,0)}function d(e){o[e]&&o[e]()}function _(e){return void 0===e&&(e={}),Promise.all(Object.keys(e).map((function(t){return n=t,i=e[t],window.stManager.staticFiles[n]||(n.includes(".js")?s(n,i):n.includes(".css")?l(n,i):Promise.resolve());var n,i})))}function f(e){var t=window.vk.stNavMap||{};for(var n in t){if(t.hasOwnProperty(n))if(new RegExp(n).test(e)){_(t[n]||{});break}}}function p(){u(),window.stManager={done:d,staticFiles:[],registerLoadedScript:c}}},tlMv:function(e,t,n){"use strict";n.r(t);var i=n("g3t9");t.default=i.default},tqja:function(e,t){var n,i=(n={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(e,t,i,a,r,o){if(void 0===o&&(o=!1),e.classList.contains("_locked"))return!1;var s=!0;return n[t]&&(s=!1),e.classList.add("_locked"),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:t,resource:i,group_id:a,hash:r},{onDone:function(){if(e.classList.remove("_locked"),o)o();else if(s){var t=attr(e,"href");nav.go(t)}}}),!s}});window.GroupActionButton=i},u33z:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function r(){var e=Object(i.default)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return r=function(){return e},e}function o(){var e=Object(i.default)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return o=function(){return e},e}var s=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return a.default.html(o(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return a.default.html(r(),s,t,e.onClick,e.text)};t.default=s;window.MailButton=s},uQjJ:function(e,t,n){"use strict";n.r(t);var i=n("4O8T"),a=n.n(i);window.EventEmitter=a.a,t.default=a.a},uo4j:function(e,t){ownerPhotoUpload.onUploadedDone((function(e){var t=geByClass1("feedAssistance_profilePhoto");if(t){var i=geByClass1("feedAssistanceProfilePhotoContent__avatar",t),a=geByClass1("feedAssistanceProfilePhotoContent__desc",t),r=geByClass1("feedAssistanceProfilePhotoContent__title",t),o=geByClass1("feedAssistance__footerButton",t);(function(e,t){if(window.Image){var i=new Image;i.onload=function(){return n(e,t)},i.src=e}else n(e,t)})(e=function(e){return e.replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"")}(e),i),r&&(r.textContent=getLang("mobile_assistance_profile_photo_uploaded_title")),a&&(a.textContent=getLang("mobile_assistance_profile_photo_uploaded_desc")),FeedAssistance.setFilled(t),remove(o)}})),FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto");function n(e,t){var n;t&&(addClass("feedAssistanceProfilePhotoContent__avatar_uploaded",t),setStyle(t,"background-image","url("+e+")")),n=e,geByClass("al_u"+vk.id).forEach((function(e){domData(e,"photo")&&domData(e,"photo",n);var t=geByClass1("_u"+vk.id,e);t&&"IMG"===t.tagName&&(t.src=n)}))}},"v+Uj":function(e,t,n){"use strict";n.r(t),n.d(t,"getCurrentElementIndex",(function(){return p})),n.d(t,"getElements",(function(){return f})),n.d(t,"scrollToElem",(function(){return _})),n.d(t,"_onWheel",(function(){return v}));var i=n("z9sQ");var a=function(e){return{class:[i.default.class("Slider",{snapping:!!e.snapping},"--"),e.class||e.mix],id:e.id,inner:{class:["Slider__scroll","_preventMenuOpen"],attrs:e.attrs,onwheel:["Slider._onWheel","event","this"],inner:{class:"Slider__line",attrs:{role:"presentation"},inner:e.inner}}}},r=n("OcsD"),o=n("UxAg"),s=n("jk6M");window.Slider={scrollToElem:_,nextElem:h,prevElem:m},Slider._onWheel=v,onDOMReady(A),onDOMReady((function(){onBodyResize(g)}));var l=".Slider",c=".Slider--snapping",u=".Slider__scroll",d=".Slider__line";function _(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n="center"),e){var i=e.closest(u),a=e.offsetLeft;"center"===n&&(a-=i.offsetWidth/2-e.offsetWidth/2);var o=0;if(window.getComputedStyle){var s=getComputedStyle(e);(s.scrollMarginLeft||s.scrollSnapMarginLeft)&&(o+=Object(r.toInt)(s.scrollMarginLeft||s.scrollSnapMarginLeft))}t&&i.scrollTo?(Object(r.domData)(i,"left",a-o),i.scrollTo({left:a-o,behavior:"smooth"})):i.scrollLeft=a-o}}function f(e){return e=Object(r.ge)(e),Object(o.$)(d,e).childNodes}function p(e,t){var n=Object(o.$)(u,e);return t||(t=f(e)),Array.from(t).map((function(e,t){return{index:t,scrollLeft:Math.abs(e.offsetLeft-n.scrollLeft)}})).sort((function(e,t){return e.scrollLeft-t.scrollLeft}))[0].index}function h(e,t,n){void 0===t&&(t=!1);var i=f(e=Object(r.ge)(e)),a=i[p(e,i)+1];h&&_(a,t,n)}function m(e,t,n){void 0===t&&(t=!1);var i=f(e=Object(r.ge)(e)),a=i[p(e,i)-1];a&&_(a,t,n)}function v(e,t){e.preventDefault();var n=e.deltaX,i=e.deltaY;Math.abs(n)>Math.abs(i)&&(t.scrollLeft+=n)}function g(){var e=Object(o.$$)(c);Array.from(e).forEach((function(e){var t=Object(o.$)(u,e);t.scrollLeft=t.scrollLeft}))}function A(){(s.default.ios||s.default.msie_edge)&&(onDOMReady(y),window.page&&window.page.onChange(y),window.MutationObserver&&onDOMReady((function(){document.body&&new MutationObserver(b).observe(document.body,{subtree:!0,childList:!0})})))}function b(e){e.forEach((function(e){e.addedNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&e.$$(l).forEach(w)}))}))}function y(){Object(o.$$)(l).forEach(w)}function w(e){var t=getComputedStyle(e),n=Number(t.paddingTop.replace("px","")),i=Number(t.paddingBottom.replace("px",""));e.style.overflow="hidden",e.style.height=e.offsetHeight-n-i+"px",e.$(u).style.paddingBottom="20px"}t.default=a;window.Slider=a,Object(r.extend)(a,{scrollToElem:_,nextElem:h,prevElem:m,_onWheel:v})},vOeY:function(e,t,n){"use strict";n.r(t),n.d(t,"Form",(function(){return c})),n.d(t,"PasswordRepeatRule",(function(){return l}));var i=n("b6Sp"),a=n("UxAg"),r=n("OcsD"),o=["error"];var s=n("fdw3"),l={validator:function(e,t,n){var i=e.values;return!("pass_repeat"!==t||!e.wasFocused[t]&&!n||i[t]===i.pass)&&Object(r.getLang)("join_pwds_mismatch")}},c=function(){function e(e,t,n){this.errors={},this.serverErrors={},this.wasFocused={},this.name=e,this.layout=t,this.options=n,this.errors=Object(s.getState)(this.name).errors||{},this.serverErrors=this.errors}return Object.defineProperty(e.prototype,"values",{get:function(){return Object(i.getFormValues)(this.layout)},enumerable:!0,configurable:!0}),e.prototype.getSubmitButton=function(){return Object(a.$)("[type=submit]",this.layout)},e.prototype.onFocus=function(e){this.wasFocused[e]=!0},e.prototype.validate=function(e){var t=this;void 0===e&&(e=!1);var n=Object(i.getFormValues)(this.layout),r={};return Object.keys(n).forEach((function(n){t.options.rules.forEach((function(i){var a=i.validator(t,n,e);a&&(r[n]=a)}))})),this.errors=r,Object.keys(n).forEach((function(e){var n=r[e]||t.serverErrors[e]||"";"string"!=typeof n&&(n=n.__raw__);var i=Object(a.$)("[name="+e+"]");if(i){var s=i.closest(".FormItem");s&&(function(e,t){var n=Object(a.$)(".FormItem__bottom",e);n.innerHTML=t,n.classList.toggle("FormItem__bottom--hidden",!t)}(s,n),function(e,t){o.forEach((function(n){n!==t&&e.classList.remove("FormItem--"+n)}));var n=Object(a.$)("input",e);if(t){e.classList.add("FormItem--"+t);var i=e.getAttribute("data-name");i&&n.setAttribute("aria-describedby",i+"-bottom")}else n.removeAttribute("aria-describedby")}(s,n?"error":""))}})),!(0!==Object.keys(r).length)},e}()},vOib:function(e,t,n){"use strict";n.r(t);var i=n("UWnA"),a=n("8ZMO"),r=n("KiYr"),o=n("z9sQ"),s=n("fdw3");function l(e){var t=[e];return Object(s.isArray)(e)&&(t=Object(s.wdToFlatArray)(e)),t.join("")}function c(e){var t=l(e);return!t||"<div></div>"===t}var u=function(e){if(void 0===e&&(e={}),e.content_only)return{outerHTML:l(e.content)};var t=e.title,n=e.corner||{},s=e.inner||e.content||e.children,u=e.anchor,d=e.alert,_=e.style||{},f=e.attrs||{},p=e.noShadow,h="gray";null!==e.count&&(h="black");var m=e.pageBlock?"PageBlock PageBlock--separate":"",v=[t];if(null!==e.count){var g={inner:[e.count],class:"Pad__count",tag:"span"};v.push(g)}return{tag:e.tag||"div",class:[e.class||e.mix,o.default.class("Pad",{empty:c(s),noBorder:e.no_border,noCapsTitle:e.no_caps_for_title,style_extraTopPadding:_.extra_top_padding,theme:h,noShadow:p}),m],ref:e.ref,attrs:f,"data-id":e.name||e.id,inner:[u?Object(a.default)({mix:"Pad__anchor",id:u}):null,d?Object(i.default)({inner:[Object(r.default)({inner:[d],class:"Pad__alert",theme:e.alert_theme})],style:{tiny_padding_bottom:!0}}):null,t?Object(i.default)({inner:[e.isHeaderPage?{inner:[v],class:"Pad__title",tag:"h1"}:{inner:[v],class:"Pad__title",tag:"h3"},n.url?{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"a"}:{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"div"}],class:"Pad__header"}):null,t?{inner:[s],class:["Pad__content",e.content_mix],tag:"div"}:s]}};t.default=u},vOyG:function(e,t){e.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"]},vWwi:function(e,t,n){"use strict";n.r(t),n.d(t,"disableBodyScroll",(function(){return c})),n.d(t,"enableBodyScroll",(function(){return u}));var i,a=n("OcsD"),r=n("jk6M"),o=!1,s=null,l=null;function c(e,t){if(void 0===t&&(t={}),window.MutationObserver&&!o){window.nav.saveScrollPosition();var n=document.body;s=n.style.overflow,o=!0,r.default.ios||r.default.ipad||(n.style.overflow="hidden"),t.forceScrollDisable&&(n.style.height="100%",document.documentElement.style.overflow="hidden"),l=new MutationObserver((function(){n.contains(e)||u()})),i=Object(a.scrollTop)(),document.body&&(document.body.classList.add("fixed"),Object(a.setStyle)(document.body,{top:"-"+i+"px"}),r.default.safari&&Object(a.getCw)()<882&&document.scrollingElement&&(document.scrollingElement.scrollTop=i||0,setTimeout((function(){document.scrollingElement&&(document.scrollingElement.scrollTop=i||0)}),100),setTimeout((function(){document.scrollingElement&&(document.scrollingElement.scrollTop=i||0)}),300))),l.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}}function u(e,t){void 0===t&&(t={}),window.MutationObserver&&o&&(document.body.style.overflow=s,(null==t?void 0:t.forceScrollDisable)&&(document.documentElement.style.overflow="initial"),null==l||l.disconnect(),document.body&&(document.body.classList.remove("fixed"),Object(a.setStyle)(document.body,{top:""}),Object(a.scrollTop)(i)),o=!1)}},vhZE:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("z1UI"),r=n("Y6JH"),o=n("+7CI"),s=n("xTMR"),l=n("1W7h"),c=n("HaOv");var u=function(e){void 0===e&&(e={});var t={},n=e.raw||"",u=e.hash||"",d=e.text||"";"album"===(e.attachment_type||"")&&(e.height-=60),e.type&&"blur"!==e.type||(e.width>=250&&e.height>=250?e.type="blurWithText":e.type="blur"),("blur"===e.type||e.only_icon)&&(delete e.button,delete e.title),e.type&&(t[e.type]=!0);var _,f=i.default.class("PostPhotoRestriction",t,"--");"blur"!==e.type&&"blurWithText"!==e.type||(_=e.width<100||e.height<100?Object(r.default)({icon:Object(o.getHideOutline28Icon)()}):Object(r.default)({icon:Object(s.getHideOutline56Icon)()})),"block"===e.type&&(!e.forceText&&(e.width<300||e.height<250)&&(delete e.title,delete e.text),_=e.width<100||e.height<100?Object(r.default)({icon:Object(l.getBlockOutline28Icon)()}):Object(r.default)({icon:Object(c.getDoNotDisturbOutline56Icon)()})),_={inner:[_],class:"SplashScreen__icon",tag:"div"},"block"!==e.type||e.title||(e.title=e.text);var p="PostPhotoRestriction.clear(this, event, '"+d+"', '"+e.button+"', '"+n+"', '"+u+"')";return{inner:[{inner:[Object(a.default)({title:e.title,icon_raw:_,more_text:e.button,more_type:"outlineMono",more_onclick:p,more_ontouchend:p,more_native_onclick:!0})],class:"PostPhotoRestriction__splash",tag:"div"}],class:f,tag:"div"}},d=n("he4e"),_=n("OcsD");window.PostPhotoRestriction={clear:d.clear,onClearConfirm:d.onClearConfirm,onClearDecline:d.onClearDecline};t.default=Object(_.extend)(u,{onClear:d.onClear,isCleared:d.isCleared})},vk58:function(e,t,n){"use strict";n.r(t);var i=n("29dZ"),a=n("fdw3"),r=n("z9sQ");var o=function(e){var t=e.btns||e.inner||[],n=e.mode||"horizontal",o=e.align||"start";Object(a.isArray)(e.inner)&&1===e.inner.length&&e.inner[0].length>1&&(t=e.inner[0]),e.nowrap&&(t=t.map((function(e){return e.nowrap=!0,e})));var s,l=r.default.class("BtnStack",{stretchOnSmallScreens:e.stretch_on_small_screens,table:e.nowrap,mode:n,align:o}),c=t.map((function(e){if(!e)return null;var t=["BtnStack__btn"];if(e.class&&t.push(e.class),e.mix&&t.push(e.mix),e.class=Object(a.arrayUnique)(Object(a.arrayFlat)(t)),!!e._&&e._.__is_wd_internal_data||Object(a.arrayIncludes)(t,"CellButton")||(e=Object(a.extend)(Object(i.default)(e),{nowrap:e.nowrap,is_icon:e.is_icon})),e.nowrap){var n=r.default.class("BtnStack__cell",{icon:e.is_icon});return delete e.nowrap,{inner:[e],class:n,tag:"div"}}return e}));return e.after&&(s={class:r.default.class("BtnStack__cell",e.after_mix),inner:e.after}),{inner:[c[0]?c:null,s],class:l,tag:"div"}};t.default=o},vkmG:function(e,t,n){"use strict";n.r(t),n.d(t,"symbols",(function(){return i})),n.d(t,"escape",(function(){return a})),n.d(t,"encodeHTMLEntities",(function(){return r})),n.d(t,"decodeHTMLEntities",(function(){return o}));var i=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function a(e){return i.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(new RegExp(i,"ig"),n)}),e)}function r(e){return a(e).replace(/[\u00A0-\u9999<>\&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"}))}function o(e){return i.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(new RegExp(n,"ig"),i)}),e).replace(/&#(\d+);/g,(function(e,t){return String.fromCodePoint(t)}))}},w1QQ:function(e,t){window.FeedAssistance={hide:function(e,t,n){var i=domCA(e,".feedAssistance"),a=hasClass(i,"feedAssistance_filled");remove(i),a||function(e,t,n){var i=FeedAssistanceStats.getFromRef(e);ajax.post("/feed",{_ajax:1,type:t,hash:n,act:"hide_assistance",from:i})}(e,t,n);return!1},setFilled:function(e){var t=hasClass(e,"feedAssistance")?e:domCA(e,".feedAssistance");addClass("feedAssistance_filled",t)}}},wCFN:function(e,t,n){"use strict";n.r(t),n.d(t,"AlertBox",(function(){return s}));var i=n("OcsD"),a=n("TYsd"),r=n("Po+v"),o=n("29dZ");function s(e,t,n,s){void 0===s&&(s={});var l=Object(i.ceFromString)(a.default.html(Object(r.default)({id:s.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[Object(o.default)({onClick:n||"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:a.default.wrap(getLang("mobile_close"))})]}]})));domInsert(document.body,l),r.default.open(l,!0)}window.page&&page.onChange((function(){$$(".AlertBox").forEach((function(e){return r.default.close(e)}))})),window.AlertBox=s},wMVj:function(e,t,n){"use strict";n.r(t);var i=n("UxAg"),a=n("+cqQ"),r=n("jk6M"),o=n("OcsD"),s=n("a0wW"),l=n("eGQV"),c=n("izth"),u=n("wkhI"),d=n("VzJG"),_=function(){if(!window.storybook){var e=!(!window.history||!history.pushState),t=se((function(){return f}));onDOMReady((function(){s.default.setFlag(s.FLAG_SUPPORTS_HISTORY_API,e)}));var n={},f=null,p=[],h=!1;if(e)addEvent(window,"popstate",(function(e){if(window.isNewMail&&_.onPopState())return preventEvent(e),void stopEvent(e);var t=extend({no_push:!0,need_restore:!0});if(e.state&&e.state.nav){var n=e.state.nav,a=n.tab,r=n.prev_tab;t=extend(t,{tab:a,prev_tab:r})}cur.share&&cur.share.destroy&&cur.share.destroy();var o=Object(i.$)(".Popup_open");location.href.includes("#pop_")||Popup.close(o),D(location,null,t)}));else{var m=location.hash||"";"#/"==m.substr(0,2)&&I(m.substr(1),null,{replace:!0});var v=function(e){(e=(e||"").substr(1))&&"/"==e.substr(0,1)||(e=location),D(e,null,{no_push:!0,need_restore:!0})};"onhashchange"in window?addEvent(window,"hashchange",(function(){v(location.hash||"")})):(!function e(){var n=location.hash||"";f!==n&&(f=n,t(!0)),setTimeout(e,100)}(),t((function(e){v(e)})))}var g=(location.pathname||"").replace(/^\/+/,"/"),A=location.search||"",b=location.hash||"";return{onBeforeGo:Object(a.default)(),onBeforeGo2:Object(a.default)(),onPopState:Object(a.default)(),go:D,al_go:M,app_go:function(e,t,n){if(!n)return!0;if(checkEvent(t))return!0;remove("app_go_frame");var i=getHref(e),a=ce("iframe",{id:"app_go_frame",src:n,onload:function(){remove("app_go_frame"),i&&_.hard_go(i)}},{display:"none"});return window.bodyNode.appendChild(a),!1},hard_go:I,go_after:function(e,t){return!Object(o.ajaxLayoutEnabled)()||(!!checkNav(t.target,{skip_onclick:!0,skip_clicable:!0})||(!1===e||_.go(e,t)||cancelEvent(t),!1))},page_set:function(e,t,n){j(e,t,n)},page_get:function(e,t){return void 0===t&&(t=Tabbar.getCurrentId()),function(e,t){for(var n=S(t),i=n.length-1;i>=0;--i){var a=n[i];if(a.h===e||a.a===e)return a.d}return!1}(e,t)},saveScrollPosition:function(){var e=E();e&&e.d&&(e.d.st=scrollTop())},set:L,checkUrl:T,tryHistoryBack:function(){var e=h;return e&&history.go(-e),h=!1,!!e},zInit:function(){var e=qs2obj(_.params);e.z&&P(e.z)},getPostParams:B,cur:g+A+b,path:g,params:A.substr(1),hash:b,clear:function(){n={},_.initStore(),p=[],Tabbar.setHistory(n)},hasUpdate:function(e,t,n){if(!e||!e.need_check_updates)return!1;var i=t,a=C(S(e.tab),i);if(!a||!n.html)return!1;var r=a.d.lm.check_updates,o=n.lm.check_updates;return!(!r&&!o)&&(o!==r&&{currentCache:a})},needUpdate:function(e,t,n){if(!e||!e.need_check_updates)return!0;var i=t,a=C(S(e.tab),i);if(!a||!n.html)return!0;var r=a.d.lm.check_updates,o=n.lm.check_updates;return!r&&!o||o!==r},updateCurrentPage:function(){var e=E();page.set(e.h,e.d,{forceUpdate:!0})},isTabHaveCache:function(e,t){var n=S(e);return!!n&&!!C(n,t)},getQuery:function(e){var t=qs2obj(_.params);return e?t[e]||null:t},getNotifierScrollTop:function(){var e=p.find((function(e){return"/settings?act=notifier"===e.h}));return e?e.d.st:null},reload:function(){return _.go(_.cur)},tryBack:function(){var e=p.slice(-2)[0];return!!e&&(_.go(e.h,null,{need_restore:!0}),!0)},backToTabHistory:function(e){var t=k(),n=t.findIndex((function(e){return!0===e.current})),i=e&&hasClass("al_back",e),a=e&&e.classList.contains("mh_back_replace"),r=attr(e,"href"),o=t[n-1];if(o)return t.splice(n,t.length),_.go(o.h,null,{need_restore:i});if(r)return O(Tabbar.getCurrentId()),_.go(r,null,{replace:a});var s=Tabbar.getCurrentId(),l=Tabbar.getDefaultURL(s);return O(s),_.go(l,null,{replace:a})},openInNativeApp:function(e,t,n,i){var a=this;if(void 0===i&&(i=!1),this._openAppInProgress)return!1;cancelEvent(t);var o={android:"https://vk.cc/android",iphone:"https://vk.cc/iphone"},s=i?n.href:"vk://vk.com"+(ge("vk_wrap").offsetWidth<882&&_.prev_cur?_.prev_cur:_.cur),l=r.default.mi?1500:300;r.default.safari&&(l=10===r.default.ios?1100:r.default.ios>10&&r.default.ios<12?0:r.default.ios>=12&&r.default.ios<13?2800:r.default.ios>=13?1800:300);var c=Date.now(),u=setTimeout((function(){a._openAppInProgress=!1,Date.now()-c>l+200||!document.hasFocus()||(n&&n.href?_.hard_go(n.href):_.hard_go(o[e]))}),l);if(addEvent(window,"blur",(function e(){clearTimeout(u),a._openAppInProgress=!1,removeEvent(window,"blur",e)})),r.default.ios){addEvent(window,"focus",(function e(){window.menu&&window.menu.close(),removeEvent(window,"focus",e)}))}else window.menu&&window.menu.close();return this._openAppInProgress=!0,_.hard_go(s),statlogsValueEvent("mvk_open_in_native_link",1,e),!1},initOpenInNativeAppBtn:function(){if(!isVkWebView()){var e=geByClass1("mmi_open_in_app");e&&addClass("supported",e)}},initStore:function(){window.store&&(window.store.tabs=n)},getPageJs:function(){var e=Object(i.$)("#page_script");return e?e.innerText:p.length&&p[p.length-1].d.js||""},onMenuItemClick:function(e,t){var n=getW("vk_wrap")>=882?"full_version":"mobile";if(t&&Object(d.recordClick)(t),statlogsValueEvent("mvk_navigation_pages","click","tabbar",e,n),"/wall"===_.cur.substr(0,5)&&"add"===_.getQuery("act")){var a=Object(i.$)("#feed_add_form"),r=qs2obj(a.action.split("?")[1]),o=a.getAttribute("data-hash")||r.hash;o&&post.saveDraft(null,o)}},setFvLink:function(e){_.fv_link=e}}}function y(){Tabbar.setHistory(n)}function w(e){var t=window.Tabbar;if(!t)throw new Error("Tabbar is not defined: "+JSON.stringify(e));if(e.lm&&e.lm.tab&&e.lm.is_tab_page||e.options&&e.options.forceSetCurrent){var n=t.getCurrentId(),i=e.lm&&e.lm.tab||e.options.tab;t.setCurrentId(i),n!==i&&y()}else e.lm&&!e.lm.tab&&(e.lm.tab=t.getCurrentId())}function O(e){n[e]=[]}function S(e){return!!n[e]&&n[e]}function k(){return S(Tabbar.getCurrentId())}function C(e,t){var n=(e||[]).filter((function(e){return e.d===t||e.h===t}));return!(!n||!n[0])&&n[0]}function E(){var e=(k()||[]).filter((function(e){return!0===e.current}));return!(!e||!e[0])&&e[0]}function j(e,t,i){var a;t.options&&t.options.is_fast&&t.options.prev_tab?a=S(t.options.prev_tab):(w(t),a=k(),t.lm&&t.lm.is_tab_page&&(a=!1));var r=function(){var e=E();return e&&e.d&&e.d.options&&e.d.options.replaceState}()||function(e){return e&&e.options&&e.options.replacePrevPage}(t),o=!1;if(a){for(var s=-1,l=a.length-1;l>=0;l--)if(a[l].h===e||a[l].a===e){s=l;break}s>-1&&a.splice(s+1,a.length);for(var c=a.length-1;c>=0;c--){var u=a[c];u.h===e||u.a===e?(a[c]={h:e,d:t,a:i,current:!0},o=!0):a[c].current=!1}}if(!o){var d={h:e,d:t,a:i,current:!0};if(a){var _=a[a.length-1],f=_&&_.d&&_.d.options&&_.d.options.removeAfterNextResponse;(r||f)&&a.pop(),a.push(d),a.length>20&&a.shift()}else{var p=Tabbar.getCurrentId(),h=E();if(h&&h.d&&h.d.options&&h.d.options.need_check_updates&&d.d.lm.check_updates){var m=d.d.html,v=h.d.page;d.d.page=v,d.d.newHTML=m}n[p]=[d]}}if(isArray(a)){for(var g=-1,A=a.length-1;A>=0;A--)if(!0===a[A].current){g=A;break}if(g>0){var b=g-1;a[b].h.includes("/like?act=publish")&&function(e,t){e.splice(t,1)}(a,b)}}}function T(e){var t;if(t=/^(https?:)\/\/([^:\/]+)?(?::(\d+))??(\/+\\+)?(.*)$/i.exec(e)){if(t[1]!==location.protocol)return!1;if(t[2]&&t[2]!==location.hostname)return!1;if(t[3]&&t[3]!==location.port)return!1;e=t[5]||""}var n=e.match(/[^\/|\\|\s+]+\/\S+/g);return e=n?n[n.length-1].trim():e}function I(e,t,n){if(checkEvent(t))return!0;if(n&&n.push_only)return!0;if(n&&n.replace)location.replace(e);else if(e){var i=getHref(e);i===location.href.replace(location.origin,"")?location.reload():location.href=i}return!0}function M(e,t,n){cancelEvent(t);var i=getHref(e);if(Object(o.ajaxLayoutEnabled)()){if(n&&n.push_only)return!0;if(ajax.nav(i,n))return document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!0}I(i,t,n)}function D(t,n,i){var a,r,o=window.Tabbar;if(t&&t.href){if(/vk\.com\/vkui\/([a-zA-Z_]+)/.test(t.href))return I(t.href,n,i),!1;if(r=t.href,t.getAttribute&&t.getAttribute("data-change-location-with-post-away")){var s={};return(a=B(t)).post_id&&(s.post=a.post_id,a.ad_data&&(s.post_ad_data=a.ad_data),a.post_click_cc_key&&(s.cc_key=a.post_click_cc_key),r="/away.php?to="+encodeURIComponent(r)+"&"+obj2qs(s).substr(1)),I(r,n,i),!1}}if(t&&t.href&&t.dataset&&t.dataset.setFrom&&(t.href=Url.make(t.href,{from:_.cur})),_.onBeforeGo(t,n,i))return!1;if(i=extend({no_push:!1,push_only:!1,replace:!1},i),checkEvent(n))return!stopEvent(n);if(!t)return!0;e&&(i.no_push||i.need_restore)&&(h=!1);var l=t,d="",f="",p="";function m(e){return"a"===tag(e)?e:gpeByTag("a",e)}!t.href&&t.getAttribute&&(l=t.getAttribute("data-href"));var v=n&&m(n.target)||t&&t.tagName&&m(t);if(("input"==tag(t)||"button"==tag(t))&&("submit"==t.type||"image"==t.type)&&t.form){if(t.disabled)return!0;var g=t.form,A={},b=g.action||"",y=!1;if(each(g,(function(e,n){return!(n.name&&!n.disabled&&!Object(u.isFieldIgnored)(n))||("radio"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==t||("image"===n.type&&n!==t||("file"===n.type?(y=!0,!1):"checkbox"===n.type?(A[n.name]=n.checked?1:0,!0):void(A[n.name]=n.value))))))})),"image"==t.type&&(A[t.name]=t.value,A[t.name+".x"]=1,A[t.name+".y"]=1),y||"multipart/form-data"==attr(g,"enctype"))return function(e){var t=ce("iframe");attr(t,"id","upload_iframe"),attr(t,"name","upload_iframe"),attr(t,"width","0"),attr(t,"height","0"),attr(t,"border","0"),attr(t,"style","width:0;height:0;border:none;position:absolute;left:-1000px;"),append(t,e.parentNode),window.frames.upload_iframe.name="upload_iframe",t=ge("upload_iframe");var n=!1;return each(e,(function(e,t){if("submit"===t.type)return n=t,!1})),addEvent(t,"load",(function e(){removeEvent(t,"load",e),setTimeout((function(){remove(t),unlockButton(n)}),2e3)})),Object(c.setDocumentDomain)(),attr(e,"target","upload_iframe"),attr(e,"method","post"),attr(e,"enctype","multipart/form-data"),attr(e,"encoding","multipart/form-data"),append(ce("input",{type:"hidden",id:"__extra",name:"__extra",value:1}),e),e.submit(),setTimeout((function(){lockButton(n),remove("__extra")})),!1}(g);if(!(l=T(b)))return!0;g.method&&"get"!=g.method?i.params=A:l=l.split("?",1).shift()+obj2qs(A)}if(hasClass("al_need_login",t)&&(i.redirectToLoginPage=!0),"string"!=typeof l){if(!l)return!0;"/"!==(d=(l.pathname||"").replace(/^\/+/,"/")).substr(0,1)&&(d="/"+d),f=l.search.substr(1),p=l.hash,l=d+l.search+p;if(/^(?:%40|@)-?[.a-z0-9_]+-[a-z0-9-]+(?:[\?&]\w+\=[a-z0-9-_]+)*$/.test(d.substr(1))&&window.cur&&window.cur.module){var O=window.cur.module;if("feed"===O)"search"===qs2obj(_.params).section&&(O="feed_search");f+="&ref="+O}}else{var S=l.split("#"),k=S.shift();p=S.length?"#"+S.join("#"):"",d=(k=k.split("?")).shift(),f=k.join("?"),!p&&!f||d||(d=_.path,k||(f=_.params),l=d+(f?"?"+f:"")+p)}var C=qs2obj(f);function E(e,t,n){var i=n&&C[t];return!(!e||i)&&(C[t]=e,!0)}if(E((a=B(v,!!C._post_click_type)).post_id,"_post",!0),E(a.post_click_type,"_post_click_type",!0),C._post_click_type&&(E(a.post_click_mention_id,"_post_click_mention_id",!0),E(a.post_click_cc_key,"_post_click_cc_key",!0),E(a.post_click_url,"_post_click_url",!0),E(a.ad_data,"_post_ad_data",!0)&&E(a.ad_block_unique_id,"_post_ad_block_unique_id")),-1!==location.pathname.indexOf("/groups_catalog")&&0!==l.indexOf("/")&&(l="/"+l),0!==location.pathname.indexOf("/app")&&0===d.indexOf("/app")&&C&&C.act&&"app_r"===C.act)return!!n||(I(t,n,i),!1);if(f=obj2qs(C).substr(1),n&&l&&_.cur&&l.split("#").shift()==_.cur.split("#").shift()&&p&&!i.force&&(scrollToHash(p),i.push_only=!0),i.no_push&&_.cur==l&&!i.force)return!1;if(i.push_only)return L(extend(i,{nav:{push:l,path:d,params:f,hash:p}})),!1;if(addClass("active",i.link||t),hasClass("al_back_history",t))return addClass("al_back",i.link||t),removeClass("al_back_history",i.link||t),_.backToTabHistory(i.link||t);if((b||i.isForm)&&(i.removeAfterNextResponse=null==i.removeAfterNextResponse||i.removeAfterNextResponse),t.classList&&(t.classList.contains("al_tab")||t.classList.contains("SliderTabs__tab")||t.classList.contains("Unfold__item_replaceState"))&&(i.replaceState=!0),hasClass("al_back",t)){var j=C.act;window.isNewMail&&"/mail"===location.pathname&&!j||"show"===j&&!geByClass1("messenger")?i.need_restore=!1:i.need_restore=!0}var D=attr(t,"data-tabbar");if(D){var x=o.getCurrentId();x!==D?(D!==o.TAB_ID_MESSAGES&&0===o.getTabCounter(D)&&(i.need_restore=!0),D===o.TAB_ID_FEED&&"/feed"===l&&(i.need_check_updates=!0),i.tab=D,i.prev_tab=x,i.forceSetCurrent=!0):(i.tab=D,i.prev_tab=D,i.replace=!0),w({lm:{tab:D,is_tab_page:!0}})}else if(i.tab)i.native_prev=o.getCurrentId(),i.is_native_back=!0,i.forceSetCurrent=!0,w({lm:{tab:i.tab,is_tab_page:!0}});else{var R=o.getCurrentId();i.tab=R;var N=!(!this||!isString(this.cur))&&this.cur.substr(1);o.TAB_IDS.includes(N)?i.prev_tab=N:i.prev_tab=R}var F=function(e){var t=window.cur,n=window.menu,i=qs2obj(e.nav.params),a=qs2obj(_.params);if((a.z||i.z)&&a.z!=i.z){if(_.path==e.nav.path){var r=copy(i),o=copy(a);if(delete r.z,delete o.z,r=obj2qs(r),o=obj2qs(o),r==o)return P(i.z,!1,e),L(e),n.close(null,!0),!1}e.zProcess=function(t,n){P(i.z,t,extend({},e,{no_push:!0}),n)}}if(e.onPreNav=function(){e.zProcess&&(e.zProcess(),delete e.zProcess)},!e.ignore_cur_process&&t.processNav&&t.processNav(e))return L(e),n.close(null,!0),!1;return M(e.nav.push,null,e),!1}(extend(i,t.tagName?{target:t}:{},{nav:{push:l,path:d,params:f,hash:p}}));return F||cancelEvent(n),F}function P(e,t,n,i){var a,r=window.photo,o=window.zlayer;if(e){if(a=/^photo(-?\d+_\d+)(?:\/([a-z0-9_-]+(\/rev)?)?)?$/i.exec(e)){if(!0===i)return!1;var s=a[1]||"",l=a[2]||"";return r.zopen(!1,null,s,l,{no_push:(n||{}).no_push}),o&&!1!==t&&void 0!==t&&(o._st=t),QRPhotoPosting&&QRPhotoPosting.close(),!0}if(a=/^story(-?\d+_\d+)(\/([a-z0-9_-]+))?(\/?[a-z0-9_:]+)?$/i.exec(e)){var c=window.Stories;if(!0===i)return!1;if(!c.opened){var u=a[1]+(a[2]?a[2]:"/"+a[1])+(a[4]?a[4]:"");c.init(u)}return!0}if(a=/^narrative([0-9\-]+)_(\d+)(?:_(\d+))?$/i.exec(e)){window.Stories;if(!0===i)return!1;var d=a,_=d[1],f=d[2],p=d[3];return window.showNarrative(_,f,p,"",{source:"narrative_link"}),!0}if(a=/^\/?doc(-?\d+)_(\d+)(\/?([a-z0-9_-]+))?$/i.exec(e))return!0!==i&&(r.zopen(null,null,a[1]+"_"+a[2],"",{no_push:(n||{}).no_push,isDoc:!0,hasVideo:!1,hash:a[4]}),o&&!1!==t&&void 0!==t&&(o._st=t),!0);if(a=/^\/?publish_photo(-?\d+)?$/i.exec(e)){if(!0===i)return!1;QRPhotoPosting&&QRPhotoPosting.show()}}return!1!==i&&(o&&o.close(),Stories&&Stories.opened&&Stories.close({isPopState:!0,closeAll:!0}),QRPhotoPosting&&QRPhotoPosting.close(),!0)}function x(t,n,i){if(void 0===i&&(i=null),e)!function(e,t,n){var i=window.Tabbar.getCurrentId(),a={nav:{tab:t.tab||i,prev_tab:t.prev_tab}};window.isNewMail?t.replace?history.replaceState(extend({},n,a),null,e):history.pushState(extend({},n,a),null,e):t.replace?history.replaceState(a,null,e):history.pushState(a,null,e)}(t,n,i);else{var a="/"==t.substr(0,1)?t:"/"+t,r="#"+a,o=location.pathname+location.search+r;ge("base").href=a,n.replace?location.replace(o):(f=r,location.href=o)}}function L(t){if(!t.no_push&&_.cur!=t.nav.push){if(!window.isBasicOffline&&Object(l.isOfflineCapable)()&&!1===navigator.onLine&&!t.push_only)return I(t.nav.push,null,t);try{window.isNewMail?x(t.nav.push,t,t.historyState):x(t.nav.push,t),e&&!t.no_push&&(t.nav_init||t.nav_incr)?(t.nav_init&&(h=0),t.nav_incr&&!1!==h&&h++,h>30&&(h=!1)):h=!1}catch(e){return I(t.nav.push,null,t)}}_.cur!==t.nav.push&&(_.prev_cur=_.cur,_.prev_fv_link=_.fv_link),_.cur=t.nav.push,_.path=t.nav.path,_.params=t.nav.params,_.hash=t.nav.hash,_.path&&0!==_.path.indexOf("/")&&(_.path="/"+_.path)}function B(e,t){var n=!(!e||!e.getAttribute),i={};if(!n)return i;var a=e.getAttribute("data-post-id");a&&(i.post_id=a);var r=e.getAttribute("data-post-click-type");r&&(i.post_click_type=r);var o=e.getAttribute("mention_id");o&&(i.post_click_mention_id=o);var s=e.getAttribute("data-post-click-cc-key");s&&(i.post_click_cc_key=s);var l=[e.getAttribute("href"),e.getAttribute("data-href")];if(each(l,(function(e,t){if(t&&"#"!==t)return i.post_click_url=t,!1})),!!r||t){var c=gpeByClass("_ads_block_data_w",e),u=(c=c||gpeByClass("_ads_promoted_post_data_w",e))&&c.getAttribute("data-ad"),d=c&&c.getAttribute("data-ad-block-uid");u&&(i.ad_data=u),d&&(i.ad_block_unique_id=d)}return i}}();onDOMReady((function(){window.storybook||(_.initOpenInNativeAppBtn(),_.initStore())})),window.nav=_,t.default=_},wTbK:function(e,t,n){"use strict";n.r(t),n.d(t,"open",(function(){return b})),n.d(t,"close",(function(){return O})),n.d(t,"ModalMenuBtn",(function(){return s.ModalMenuBtn})),n.d(t,"ModalMenuIcon",(function(){return s.ModalMenuIcon})),n.d(t,"ModalMenuTitle",(function(){return s.ModalMenuTitle})),n.d(t,"ModalMenuBody",(function(){return s.ModalMenuBody})),n.d(t,"ModalMenuHeaderCloseButton",(function(){return s.ModalMenuHeaderCloseButton}));var i,a,r,o=n("OcsD"),s=n("t7Ww"),l=n("r/ag"),c=n("UxAg"),u=function(){function e(e){this.lastTime=0,this.lastRegisteredTime=0,this.lastCoordinates=[0,0],this.velocity={x:0,y:0},this.lastTime=e.time,this.lastCoordinates=[e.x,e.y],this.velocity={x:0,y:0}}return e.getVelocity=function(e,t,n){return{x:t/e||0,y:n/e||0}},e.prototype.registerEvent=function(t){if("touchmove"===t.type){var n=+t.touches[0].clientX,i=+t.touches[0].clientY,a=t.timeStamp-this.lastTime;if(t.timeStamp-this.lastRegisteredTime<=16.67)this.lastCoordinates=[n,i],this.lastTime=t.timeStamp;else{var r=n-this.lastCoordinates[0],o=i-this.lastCoordinates[1];this.velocity=e.getVelocity(a,r,o),this.lastTime=t.timeStamp,this.lastRegisteredTime=this.lastTime,this.lastCoordinates=[n,i]}}else window.clog&&window.clog("[Gestures.js] unhandled event "+t.type)},e}(),d=n("CQvH"),_=!1,f=null,p=0,h=0,m={},v=null,g=Object(c.$)(".Popup__wrap",i),A=!1;function b(e,t,n,s){void 0===t&&(t=!0),void 0===n&&(n=""),void 0===s&&(s={});var u=s,_=u.settling,f=void 0===_?75:_,p=u.expandable,h=void 0!==p&&p;if(s.settling=f,s.expandable=h,i=l.default.open(e,t,{hash:n,withoutCloning:s.withoutPopupCloning}),m=s,g=Object(c.$)(".Popup__wrap",i),r=Object(c.$)(".Popup__content",g),void 0===s.swipeDown&&(s.swipeDown=!0),h&&w(i)){i.classList.add("ModalMenu--expandable");var v=(100-m.settling)/100*window.innerHeight;C=v,o.setStyle.animate(g,"transform",{duration:200,func:"ease"}),o.setStyle.transform(g,1,[0,v])}return I(),Object(o.onBodyResize)(I),s.swipeDown&&window.innerWidth<882&&(scrollTop(0),Object(o.addEvent)(r,"touchstart",S,{passive:!0}),Object(o.addEvent)(r,"touchmove",E,{capture:!0}),Object(o.addEvent)(r,"touchcancel touchend",j,{passive:!0}),Object(o.addEvent)(g,"click",y,{passive:!0}),Object(o.addEvent)(g,"click",y,{passive:!0})),(a=Object(d.setFocusTrap)(i))&&(a.exitIntent=function(){return!1}),i}function y(e){if(g&&e.target===g)return(a=Object(d.setFocusTrap)(i))&&(a.exitIntent=function(){return!1}),i}function w(e){var t=Object(c.$)(".ModalMenu__body",e)||Object(c.$)(".ModalMenuContent",e)||Object(c.$)(".Popup__content",e);return!(Object(o.getCw)()>=882)&&(t.scrollHeight||Object(o.getH)(t))>=window.innerHeight}function O(e,t){if(void 0===t&&(t={}),e||(e=document.activeElement),e){var n=e.closest(".ModalMenu.Popup_open")||e;n&&n.classList.contains("ModalMenu")&&(innerWidth<882?l.default.close(n,{smooth:!0,velocity:!(!v||!v.velocity)&&v.velocity,lastY:h,onClose:t.onClose}):setTimeout((function(){l.default.close(n),t.onClose&&t.onClose()})),Object(o.removeEvent)(r,"touchstart",S,{passive:!0}),Object(o.removeEvent)(r,"touchmove",E,{capture:!0}),Object(o.removeEvent)(r,"touchcancel touchend",j,{passive:!0}),Object(o.removeEvent)(g,"click",y,{passive:!0}),Object(o.removeEvent)(g,"click",y,{passive:!0}),f=null,p=0,k=!1,h=0,C=0,i=null,g=null,r=null,v=null,m={},Object(o.onBodyResize)("__clear",I),a&&(a(),a=null))}}function S(e){if(e.touches&&e.touches.length>1)_=!1;else{var t=e.target.closest(".ScrollView")||Object(c.$)(".ScrollView",e.target);if(!Object(c.$)(".ModalMenu").classList.contains("ModalMenu--blocked")){var n=m.expandable&&w(i);A=n,f=e.touches[0],p=e.touches[0].clientY,t&&t.scrollTop>1?_=!1:(v=new u({time:e.timeStamp,x:e.touches[0].clientX,y:e.touches[0].clientY}),_=!0)}}}var k=!1,C=0;function E(e){if(e.touches&&e.touches.length>1)_=!1;else if(f&&_){var t=e.touches[0];v.registerEvent(e);var n=-Math.min(0,p-t.clientY-C);0!==n&&(Object(o.cancelEvent)(e),h=n,k||(i.classList.add("ModalMenu--dragging"),browser.ios&&o.setStyle.animate(g,"transform",{duration:50,func:"linear"}),k=!0),T(n),o.setStyle.transform(g,1,[0,n]))}}function j(e){if(_){_=!1,i.classList.remove("ModalMenu--dragging"),k=!1,T(h);var t=m.expandable&&w(i);A=t;var n=i.classList.contains("ModalMenu--expanded"),a=!n,r=function(e){void 0===e&&(e=[]);return e.find((function(e){return 0!==e.scrollTop||e.scrollHeight>e.offsetHeight}))}(e.path),s=!1;r&&(s=0!==r.scrollTop);var l=!1,c=!1;v&&(l=!s&&v.velocity.y>=.6,c=!s&&v.velocity.y<=-.15);var u=h/innerHeight*100,d="";n?d="expand":a&&(d="collapse");var f=d;l&&u<8?u=8:c&&(u=0),!t&&u>=8||u>=100-m.settling+8?f="close":n?u>=8&&!s&&(f="collapse"):a&&w(i)&&u<=100-m.settling&&(f="expand"),function(e){if(!e)return;i.classList.toggle("ModalMenu--expanded","expand"===e),"close"!==e&&g.style.removeProperty("transition");switch(e){case"collapse":i.classList.add("ModalMenu--restore");var t=0;w(i)&&(t=(100-m.settling)/100*window.innerHeight),C=t,o.setStyle.transform(g,1,[0,t]),T(C=t,!0),setTimeout((function(){i&&i.classList.remove("ModalMenu--restore"),0===t&&Object(o.setStyle)(g,{transform:""})}),200);break;case"expand":i.classList.add("ModalMenu--restore"),i.classList.add("ModalMenu--expanded"),o.setStyle.transform(g,1,[0,0]),T(C=0,!0),setTimeout((function(){i&&(I(),i.classList.remove("ModalMenu--restore"))}),200);break;case"close":C=0,O(i,m)}}(f),v=null}}function T(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),A){var n=(100-m.settling)/100*window.innerHeight,i=Object(c.$)(".ModalMenuHeader__title",g),a=Object(c.$)(".ModalMenuHeader__close",g),r=1-Math.max(0,Math.min(1,(null===e?C:e)/n));t&&(o.setStyle.animate(i,"transform",{duration:250}),o.setStyle.animate(a,"transform, opacity",{duration:250})),o.setStyle.transform(i,1,[44*r,0]),o.setStyle.transform(a,r),Object(o.setStyle)(a,{opacity:r})}}function I(){var e=Object(c.$)(".ModalMenuContent",i),t=Object(c.$)(".ModalMenuHeader",i);if(e&&t){var n=Object(o.getH)(t),a=Object(o.getH)(e),r=Math.min(Object(o.getCh)(),a+n+"px");Object(o.getCw)()>=882&&(r=null),Object(o.setStyle)(e,"height",r)}}Object(o.addEvent)(window,"keydown",(function(e){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(c.$)(".ModalMenu.Popup_open");if(t)switch(e.keyCode){case 27:O(t,m)}})),Object(o.addEvent)(window,"click",(function(e){if(e.isTrusted){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(c.$)(".ModalMenu.Popup_open"),n=!!e.target.closest(".ModalMenu");if(t&&n&&!e.target.closest(".Popup__content")){var i=Object(c.$)(".Popup__overlay",t);window.clog("Simulate modal overlay click"),i.click()}}}),{passive:!0});t.default=s.default;Object(o.extend)(s.default,{open:b,close:O}),window.ModalMenu=s.default},wTgh:function(e,t,n){"use strict";function i(e,t){void 0===t&&(t=0);var n=32768&t;return e=(e=e.replace(/([a-zA-Z\-_\.0-9]+@[a-zA-Z\-_0-9]+\.[a-zA-Z\-_\.0-9]+[a-zA-Z\-_0-9]+)/g,(function(e){return'<a href="mailto:'+e+'">'+e+"</a>"}))).replace(/(https?:\/\/)?(([A-Za-zА-Яа-яЁё0-9@][A-Za-zА-Яа-яЁё0-9@\-\_\.]*[A-Za-zА-Яа-яЁё0-9@])(\/([A-Za-zА-Яа-я0-9@\-\_#%&?+\/\.=;:~]*[^\.\,;\(\)\?<\&\s:])?)?)/gi,(function(){var e=arguments[3],t=arguments[2],i=arguments[0],a=arguments[1]||"http://";if(-1==e.indexOf(".")||-1!=e.indexOf(".."))return i;var r=e.split(".").pop();if(r.length>7||-1==indexOf("place,camera,info,name,academy,aero,arpa,coop,media,museum,mobi,travel,xxx,asia,biz,com,net,org,gov,mil,edu,int,tel,ac,ad,ae,af,ag,ai,al,am,an,ao,aq,ar,as,at,au,aw,ax,az,ba,bb,bd,be,bf,bg,bh,bi,bj,bm,bn,bo,br,bs,bt,bv,bw,by,bz,ca,cc,cd,cf,cg,ch,ci,ck,cl,cm,cn,co,cr,cu,cv,cx,cy,cz,de,dj,dk,dm,do,dz,ec,ee,eg,eh,er,es,et,eu,fi,fj,fk,fm,fo,fr,ga,gd,ge,gf,gg,gh,gi,gl,gm,gn,gp,gq,gr,gs,gt,gu,gw,gy,hk,hm,hn,hr,ht,hu,id,ie,il,im,in,io,iq,ir,is,it,je,jm,jo,jp,ke,kg,kh,ki,km,kn,kp,kr,kw,ky,kz,la,lb,lc,li,lk,lr,ls,lt,lu,lv,ly,ma,mc,md,me,mg,mh,mk,ml,mm,mn,mo,mp,mq,mr,ms,mt,mu,mv,mw,mx,my,mz,na,nc,ne,nf,ng,ni,nl,no,np,nr,nu,nz,om,pa,pe,pf,pg,ph,pk,pl,pm,pn,pr,ps,pt,pw,py,qa,re,ro,ru,rs,rw,sa,sb,sc,sd,se,sg,sh,si,sj,sk,sl,sm,sn,so,sr,st,su,sv,sy,sz,tc,td,tf,tg,th,tj,tk,tl,tm,tn,to,tp,tr,tt,tv,tw,tz,ua,ug,uk,um,us,uy,uz,va,vc,ve,vg,vi,vn,vu,wf,ws,ye,yt,yu,za,zm,zw,рф,укр,сайт,онлайн,срб,cat,pro,local".split(","),r))return i;if(-1!=i.indexOf("@"))return i;try{i=decodeURIComponent(i)}catch(e){}return i.length>55&&(i=i.substr(0,53)+".."),i=htsc(i),!n&&e.match(/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/)?'<a href="'+(a+(t=replaceEntities(t).replace(/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,encodeURIComponent))).replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'">'+i+"</a>":'<a href="/away?to='+encodeURIComponent(a+replaceEntities(t))+'" target="_blank">'+i+"</a>"}))}n.r(t),n.d(t,"wrapLinks",(function(){return i}))},wcVR:function(e,t,n){"use strict";n.r(t);var i={_def_opts:{enableHighAccuracy:!0,maximumAge:3e5,timeout:6e4},_provider:null,initW3C:function(){i._provider=navigator.geolocation,i.getCurrentPosition=function(e,t,n){i._provider.getCurrentPosition((function(t){void 0!==t.latitude?e(extend(t,{coords:extend(t.coords||{},{latitude:t.latitude,longitude:t.longitude})})):e(t)}),t,n)}},initGears:function(){var e=window.google;i._provider=e.gears.factory.create("beta.geolocation")},initSymbian:function(){var e=window.device;i._provider=e.getServiceObject("Service.Location","ILocation"),i.getCurrentPosition=function(e,t){i._provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},(function(n,i,a){4==i?t({code:2,message:"Position unavailable"}):e({timestamp:null,coords:{latitude:a.ReturnValue.Latitude,longitude:a.ReturnValue.Longitude,altitude:a.ReturnValue.Altitude,heading:a.ReturnValue.Heading}})}))}},initPalm:function(){i.getCurrentPosition=function(e,t,n){var i={};n&&(n.enableHighAccuracy&&1==n.enableHighAccuracy&&(i.accuracy=1),n.maximumAge&&(i.maximumAge=n.maximumAge),n.responseTime&&(n.responseTime<5?i.responseTime=1:n.responseTime<20?i.responseTime=2:i.timeout=3)),new window.Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:i,onSuccess:function(t){e({timestamp:t.timestamp,coords:{latitude:t.latitude,longitude:t.longitude,heading:t.heading}})},onFailure:function(e){1==e.errorCode?t({code:3,message:"Timeout"}):2==e.errorCode?t({code:2,message:"Position unavailable"}):t({code:0,message:"Unknown Error: webOS-code"+e.errorCode})}})}},getCurrentPosition:function(e,t,n){i._provider.getCurrentPosition(e,t,extend(i._def_opts,n||{}))},init:function(){var e=window,t=e.google,n=e.device,a=e.Mojo;try{var r="undefined";if(typeof navigator.geolocation!==r)i.initW3C();else if(typeof window.google!==r&&typeof t.gears!==r)i.initGears();else if(typeof n!==r&&typeof n.getServiceObject!==r)i.initSymbian();else{if(typeof a===r||"Mojo.Service.Request"==typeof a.Service.Request)return!1;i.initPalm()}}catch(e){return!1}return!0}};window.geo=i,t.default=i},wkhI:function(e,t,n){"use strict";n.r(t),n.d(t,"setFieldIgnored",(function(){return a})),n.d(t,"isFieldIgnored",(function(){return r}));var i=n("OcsD"),a=function(e,t){void 0===t&&(t=!0),Object(i.attr)(e,"data-ignore-field",!!t&&"true")},r=function(e){return"true"===Object(i.attr)(e,"data-ignore-field")}},wyHI:function(e,t){var n=window,i=n.gpeByClass,a=n.hasClass,r=n.addClass,o=n.removeClass,s=n.geByClass1,l=n.setStyle,c=n.tooltip,u=n.ajax;window.Fave={showActionsTT:function(e,t){cancelEvent(t);var n=i("FaveArticles__row",e);if(a(n,"wi_actions_opened"))Fave.hideActionsTT();else{var o=s("wi_actions_wrap",n),u=s("FaveArticles__row_actions",n);l(o,"top",e.offsetTop+e.offsetHeight+"px"),r(n,"wi_actions_opened"),c.addHandler(Fave.hideActionsTT),c.show(o,u)}},hideActionsTT:function(){o("wi_actions_opened",s("wi_actions_opened")),c.hide()},removeArticle:function(e,t,n){Fave.hideActionsTT();var a=i("FaveArticles__row",e);r(a,"removed"),u.post("fave.php",{act:"defave_article",link:t,hash:n},{onFail:function(){return o(a,"removed")}})},restoreArticle:function(e,t,n){var a=i("FaveArticles__row",e);o(a,"removed"),u.post("fave.php",{act:"enfave_article",link:t,hash:n},{onFail:function(){return r(a,"removed")}})}}},xk4V:function(e,t,n){var i=n("4fRq"),a=n("I2ZF");e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}},yVza:function(e,t){window.FaceRecognitionSwitch={onChange:function(e,t){ajax.post(e,{checked:t.checked,_ajax:1})}}},yuVR:function(e,t){var n="friendsStat.events",i=null;function a(){clearTimeout(i);var e=lsGet(n)||[];if(e.length){lsSet(n);var t,a={act:"stats"};a=extend(a,(t={},each(e,(function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]})),t)),ajax.post("/friends",a)}}window.FriendsStats={log:function(e,t){var r=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(e,t);if(!r)return;var o=lsGet(n)||[];o.push({type:e,data:r}),lsSet(n,o),clearTimeout(i),i=setTimeout(a,1e4)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},i=setTimeout(a,1e4)},z1UI:function(e,t,n){"use strict";n.r(t);var i=n("k+Df");t.default=i.default},z9Td:function(e,t,n){"use strict";n.r(t),n.d(t,"PLATFORM_MVK",(function(){return i}));var i="mvk"},z9sQ:function(e,t,n){"use strict";n.r(t);n("OcsD");var i={class:function(e,t,n){void 0===t&&(t={});void 0===n&&(n="_");var i=[e];return Object.keys(t).forEach((function(r){if(a(r)){var o=t[r];!0===o?i.push(""+e+n+r):a(o)&&i.push(""+e+n+r+n+o)}})),i.join(" ")},setMod:function(e,t,n){var i,r=new RegExp("\\s*"+t+"(_[-a-zA-Z]+)?");i=!0===n?" "+t:a(n)?" "+t+"_"+n:"";r.test(e.className)?e.className=e.className.replace(r,i):e.className+=i}};function a(e){return"number"==typeof e||"string"==typeof e&&e}t.default=i;window.Bem=i},zHNa:function(e,t){var n=need("Control"),i=need("Popup"),a={init:function(){var e=geByClass1("_adultConfirm"),t=geByClass1("_adultConfirm__submit",e),i=geByClass1("adultConfirm__checkbox",e);toggleClass("adultConfirm__submit_disabled",t,!n.isChecked(i))},toggle:function(e){var t=gpeByClass("_adultConfirm",e.$control),n=geByClass1("_adultConfirm__submit",t);toggleClass("adultConfirm__submit_disabled",n,!e.checked)},submit:function(e,t){if(cancelEvent(e),!hasClass("adultConfirm__submit_disabled",t)){var n=gpeByClass("_adultConfirm",t),a=geByClass1("_adultConfirm__form",n),r={_ajax:1};each(geByTag("input",a),(function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(r[i]=t.value)}));var o=attr(a,"action");ajax.post(o,r),i.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}};window.AdultConfirm=a},zRDV:function(e,t){var n="";window.DonutDuration={init:function(e){n=e.select_url||""},selectDuration:function(e){var t=document.querySelector("#value_link");if(t){var i=n.replace("{value}",e);t.setAttribute("href",i)}}}},zouF:function(e,t,n){"use strict";n.r(t),n.d(t,"Confirm",(function(){return l}));var i=n("TYsd"),a=n("Po+v"),r=n("fdw3"),o=n("29dZ"),s=n("UxAg");function l(e,t,n,s){void 0===s&&(s={});var l=i.default.preactElemFromTemplate(Object(a.default)({id:s.id,class:"Confirm",scrollable:!0,header:{title:s.title||Object(r.getLang)("mobile_warning_header")},on_overlay_click_native:n,content:[e,{class:"Popup__buttons",inner:[Object(o.default)({onClick:t,use_native_onclick:!0,class:"Popup__button",theme:s.theme_accept_btn||"regular",url:s.yes_href,inner:s.yes_label||Object(r.getLang)("mobile_continue")}),Object(o.default)({onClick:n||"Popup.close(this, event)",use_native_onclick:!0,class:"Popup__button",theme:s.theme_close_btn||"secondary",url:s.no_href,inner:s.no_label||Object(r.getLang)("mobile_cancel")})]}]}));return a.default.open(l,!0,{withoutCloning:s.withoutPopupCloning})}window.page&&window.page.onChange((function(){Object(s.$$)(".Confirm").forEach((function(e){return a.default.close(e)}))})),window.Confirm=l},zq7H:function(e,t,n){"use strict";n.r(t),n.d(t,"COUNTERS_POS_NOTIFICATIONS",(function(){return i})),n.d(t,"COUNTERS_POS_MESSAGES",(function(){return a})),n.d(t,"COUNTERS_POS_APPS",(function(){return r})),n.d(t,"DESKTOP_WIDTH",(function(){return o}));var i=2,a=3,r=10,o=882},zvhO:function(e,t,n){"use strict";function i(e){return"number"==typeof e&&!isNaN(e)}n.r(t),n.d(t,"isNumber",(function(){return i}))}},[[9,"runtime","vendors","icons","b-82d9927df0978c64fbba746460792e53","b-bb8a45b66effa6a9a720f7c1b25cb90c"]]]);